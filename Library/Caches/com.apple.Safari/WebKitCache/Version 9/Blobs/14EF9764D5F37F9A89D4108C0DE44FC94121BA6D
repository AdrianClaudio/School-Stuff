if(typeof ta==="undefined"){var ta={}}var api=(function(){if(window.IS_DEBUG==null){window.IS_DEBUG=false}if(window.VERSION_MAP==null){window.VERSION_MAP={}}if(window.CDNHOST==null){window.CDNHOST=""}var a={overlays:{},maps:{},bmaps:{},common:{},phac:{},servlet:{},support:{},util:{},widgets:{},commerce:{},mobfull:{},photos:{},media:{},hac:{filters:{}},t4b:{},api:{maps:{}},p13n:{},registration:{},meta:{},reviews:{}};a.id=function(d){try{return document.id(d)}catch(f){if(a.util.error){a.util.error.record(f,"ta.id - trouble wrapping",null,{elmtArg:a.util.error.describe(d)})}}};a.select=function(){var e=Array.from(arguments),f=e.length>1&&(("string"===typeof e[0])?e.pop():e.shift())||document,d=e.shift();return Slick.search(f,d,new Elements)};a.invoke=function(d,e){d.each(function(f){f[e]()})};a.selectInvoke=function(d,e){a.invoke($$(d),e)};a.css=function(e,d){return Asset.css(e,Object.merge({media:"screen, print"},d))};a.throttle=function(j,e,g,h){var f=(new Date()).getTime();var i;if(e in c){i=c[e];if(f-i.lastReset<i.minResolution){i.cb=j;return}}else{i=c[e]={start:f,minResolution:Math.max(Math.floor(g/10),50)}}i.cb=j;function d(){delete c[e];i.cb()}if(i.timeout){clearTimeout(i.timeout)}if(h&&(f-i.start>h)){d()}else{i.lastReset=f;i.timeout=setTimeout(d,g)}};var c={};var b=a;b.extend=_.extend;b.bind=function(d,e){return Function.prototype.bind.apply(d,Array.from(arguments).slice(1))};b.addEvent=function(d,f,e){return d&&$(d).addEvent(f,e)};b.addEvents=function(e,d){return e&&$(e).addEvents(d)};b.fireEvent=function(e,f,d){return e&&$(e).fireEvent(f,d)};b.removeEvent=function(d,f,e){return d&&$(d).removeEvent(f,e)};b.removeEvents=function(e,d){return e&&$(e).removeEvents(d)};b.createElement=function(d,e){return new Element(d,e)};b.getSize=function(d){return d&&$(d).getSize()};b.getPosition=function(d,e){return d&&$(d).getPosition(e)};b.getCoords=function(d){return d&&$(d).getCoordinates()};b.addClass=function(d,e){return d&&$(d).addClass(e)};b.removeClass=function(d,e){return d&&$(d).removeClass(e)};b.toggleClass=function(d,e,f){return d&&$(d).toggleClass(e,f)};b.hasClass=function(d,e){return d&&$(d).hasClass(e)};b.find=function(d,e){return $(e||document).getElement(d)};b.findAll=b.select;b.adopt=function(d){return Element.prototype.adopt.apply($(d),Array.prototype.slice.call(arguments,1))};b.parent=function(e,d){return e&&$(e).getParent(d)};b.getOffsetParent=function(d){return d&&$(d).getOffsetParent()};b.getOffsets=function(d){return d&&$(d).getOffsets()};b.setStyle=function(d,f,e){return d&&$(d).setStyle(f,e)};b.bindAll=function(d){if(arguments.length>1){Array.from(arguments).slice(1).each(function(e){d[e]=b.bind(d[e],d)})}else{Object.each(d,function(f,e){d[e]=b.bind(f,d)})}return d};b.checkBrowser=function(){return Array.from(arguments).some(function(d){return !!Browser[d]})};b.isNode=function(d){return(typeof Node==="object"?d instanceof Node:d&&typeof d==="object"&&typeof d.nodeType==="number"&&typeof d.nodeName==="string")};b.isElement=function(d){return(typeof HTMLElement==="object"?d instanceof HTMLElement:d&&typeof d==="object"&&d.nodeType===1&&typeof d.nodeName==="string")};b.inDocument=function(d){return !!d.parentNode&&d.parentNode.nodeType!==11};b.removePropertyEvent=function(f,h,g){if(h.substr(0,2)!=="on"){h="on"+h}f=$(f);var l="ta.call(",k=f.getProperty(h),d=k&&k.indexOf(g),j=k&&k.indexOf(")",d),i;if(!k||d<0){return}if(k.charAt(j+1)==";"){j++}if(k.charAt(d+g.length)=="("){i=k.slice(0,d)+k.slice(j+1)}else{if(d>=l.length+1&&k.substr(d-l.length-1,l.length)==l){d-=l.length+1;i=k.slice(0,d)+k.slice(j+1)}}f.setProperty(h,i&&i.trim())};b.containsEvent=function(e,h){if(!h){return false}var d=h.pageX,g=h.pageY;var f=b.getCoords(e);if("fixed"==(b.getOffsetParent(e)||e).style.position||typeof d==="undefined"||typeof g==="undefined"){d=h.clientX;g=h.clientY}return(g>=f.top&&g<=f.bottom&&d>=f.left&&d<=f.right)};b.containsElement=function(d,e){if(!d||!e){return false}while(e!=null){if(e===d){return true}e=e.parentElement}return false};b.elementOrParentMatches=function(d,e){if(!d||!e){return false}while(d!=null){if(e(d)){return true}d=d.parentElement}return false};b.createNamespace=function(d){var e=d.split(".");return e.reduce(function(g,f){return g[f]||(g[f]={})},window)};b.mixin=function(d){Array.prototype.slice.call(arguments,1).forEach(function(e){for(var f in e){this[f]=e[f]}},d);return d};b.merge=function(g){var f=Array.prototype.slice.call(arguments,1);for(var e=0,d=f.length;e<d;e++){for(var h in f[e]){if(f[e].hasOwnProperty(h)){g[h]=f[e][h]}}}return g};b.isArray=function(d){return Object.prototype.toString.call(d)==="[object Array]"};b.forceReflow=function(d){d&&d.offsetWidth};b.scrollTop=function(){var d=window.pageYOffset!==undefined,e=((document.compatMode||"")==="CSS1Compat");return d?window.pageYOffset:e?document.documentElement.scrollTop:document.body.scrollTop};b.scrollLeft=function(){var d=window.pageXOffset!==undefined,e=((document.compatMode||"")==="CSS1Compat");return d?window.pageXOffset:e?document.documentElement.scrollLeft:document.body.scrollLeft};b.stopEvent=function(d){if(d){if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=true}if(d.preventDefault){d.preventDefault()}else{d.returnValue=false}}return false};if(window.define){define("ta",[],function(){return a})}return b})();api.merge(ta,api);var ifdefNN=function(a){return typeof(a)!=="undefined"&&a!==null};(function(a){var b={};if(typeof window!=="undefined"){if(!window.ta_store){window.ta_store={}}b=window.ta_store}else{if(typeof global!=="undefined"){if(!global.ta_store){global.ta_store={}}b=global.ta_store}}a.store=function(c,d){b[c]=d;return d};a.retrieve=function(c){return b[c]};a.has=function(c){return typeof(b[c])!="undefined"};a.retrieveOrStore=function(c,d){var e=b[c];if(typeof(e)=="undefined"){b[c]=d;e=d}return e};a.remove=function(c){var d=b[c];delete b[c];return d};a.keep=function(e,f){var d=[];var c=a.retrieve(e);if(c){if(c instanceof Array){d=c}else{d.push(c)}}if(f instanceof Array){d=d.combine(f)}else{d.push(f)}a.store(e,d)};a.merge=function(c,e){var d=a.retrieve(c)||{};if(Object&&Object.merge){a.store(c,Object.merge(d,e))}else{if(a.jquery){a.store(c,a.jquery.extend({},d,e))}else{if($&&$.extend){a.store(c,$.extend({},d,e))}}}};a.asInt=function(d,c){var e=parseInt(a.retrieve(d));return isNaN(e)?(c||0):e};a.asFloat=function(d,c){var e=parseFloat(a.retrieve(d));return isNaN(e)?(c||0):e};a.executeCallbacks=function(d){if(a.has(d)){var e=a.retrieve(d);if(!e instanceof Array){return}for(var c=0;c<e.length;c++){e[c]()}}}})(ta);var ta=window.ta||{};var define;ta.rollupAmdShim=ta.rollupAmdShim||(function(){var m={};var e={};var d={};var b={};var h=function(){};var l=function(){};function c(p,n){var o;for(o=0;o<p.length;++o){m[p[o]]=true}for(o=0;o<n.length;++o){e[n[o]]=true}if((typeof define!=="function")||!define.isTaRollupShim){if(typeof define==="function"){h=define}else{h=function(){}}define=i}if((typeof require!=="function")||!require.isTaRollupShim){if(typeof require==="function"){l=require}else{l=function(){}}require=f}}function i(p,r,s,n){var o,q;if(typeof p==="string"&&typeof r==="object"&&typeof s==="function"){if(d.hasOwnProperty(p)){return}q=a(r,p);if(q){o=s.apply(null,q);d[p]=o;s=g(j,null,o);if(m[p]){k(p,o)}}else{if(m[p]){l([p],g(k,null,p))}}}return h(p,r,s,n)}i.amd=true;i.isTaRollupShim=true;function f(o,q,n,t){var p;if(typeof o==="string"&&typeof q!=="function"){p=a([o]);if(p){return p[0]}try{return l(o,q,n,t)}catch(r){var s="Missing required dependency: "+o;while((o=b[o])){s+="->"+o}throw new Error(s)}}else{if(typeof o==="object"&&typeof q==="function"){p=a(o);if(p){q.apply(null,p);return}}}return l(o,q,n,t)}f.isTaRollupShim=true;function a(t,q){var p,n,r,o;var s=[];for(p=0;p<t.length;++p){n=t[p];o=null;if(n){if(d.hasOwnProperty(n)){o=d[n];s.push(o)}else{if(e[n]){r=n.split("/");if(r[0]==="underscore"){r[0]="_"}for(o=window;r.length>1&&o;o=o[r.shift()]){}if(r.length>0&&o){o=o[r[0]]||o[r[0].toLowerCase()]}if(o){d[n]=o;h(n,[],g(j,null,o))}s.push(o)}else{if(q){b[q]=n;q=null}}}}else{s.push(null)}}if(s.length!==t.length){return}return s}function k(p,q){var n=p.split("/");var r=ta;var o;if(n[0]==="ta"){n.shift()}while(n.length>1){o=n.shift();if(!r[o]){r[o]={}}r=r[o]}if(n.length>0){o=n.shift();if(!(o in r||o.toLowerCase() in r)){r[o]=q;r[o.toLowerCase()]=q}}}function j(n){return n}function g(o,n){var p=[].slice.call(arguments,2);return function(){var q=p.concat.apply(p,arguments);return o.apply(n,q)}}return{install:c}})();if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["utils/store","utils/BatchRequest"],["ta","ta","ta","ta","ta","ta","ta","ta","ta","ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"core",files:{"js-amd":{src:{utils:{BatchRequest:1,store:1}}}},_:{baseUrl:"/"}})};define("utils/store",[],function(){var a={};if(typeof window!=="undefined"){if(!window.ta_store){window.ta_store={}}a=window.ta_store}else{if(typeof global!=="undefined"){if(!global.ta_store){global.ta_store={}}a=global.ta_store}}return{add:function(b,c){a[b]=c;return c},get:function(b){return a[b]},has:function(b){return typeof(a[b])!="undefined"},getOrAdd:function(b,c){var d=a[b];if(typeof(d)=="undefined"){a[b]=c;d=c}return d},remove:function(b){var c=a[b];delete a[b];return c}}});ta.load=function(c,g){var f=false;var d=ta.findFileKey(c);if(d){f=VERSION_MAP[d]}if(f){var a=d+"_callback";if(ta.has(a)){var e=ta.retrieve(a);e.push(g);ta.store(a,e)}else{ta.store(a,[function(){delete VERSION_MAP[d];if(g){g()}}]);var b=function(){var h=ta.remove(a);h.each(function(i){if(i){i()}})};if(typeof f==="object"){ta.loadInOrder(f,b)}else{Asset.javascript(f,{onLoad:b})}}}return f};ta.loadInOrder=function(a,d){var c=a.slice();var b=function(){if(c.length===0){d&&d()}else{Asset.javascript(c.shift(),{onLoad:b})}};b()};ta.findFileKey=function(f){if(typeof f!="string"||!VERSION_MAP){return}var d=false;var c=false;if(VERSION_MAP[f]){c=f}else{if(VERSION_MAP[f+".js"]){c=f+".js"}else{var a=f.split(".");var b=0;while(a&&a.length>1&&b<10){a=a.slice(0,-1);var e=a.join("-")+".js";if(e&&VERSION_MAP[e]){c=e;break}b++}}}return c};(function(ta){var _eventListeners={};ta.call=function(funcName,evnt,elmt){if(evnt==null){if(IS_DEBUG){alert("You must pass the event.\n\nUsage:\nta.call('ta.namespace.Class.function', event);")}return false}if(funcName==null){if(IS_DEBUG){alert("ta.call of undefined function")}return false}var func=funcName;if(typeof(funcName)==="function"){funcName="<func>"}else{if(!/^ta\.[\w\d\.]+$/.test(funcName)){if(IS_DEBUG){alert("Invalid function name. Must be of the form: ta.namespace.Class.function")}return false}}var e=new Event(evnt||window.event);if(!elmt){elmt=e.target}elmt=ta.id(elmt);if(!elmt){ta.util.error.record(null,"ta.call re-wrap fail (non-DOM element) - "+funcName,evnt,{elmtArg:ta.util.error.describe({none:"none"}),funcName:funcName})}else{if(!elmt.$family){ta.util.error.record(null,"ta.call re-wrap fail - "+funcName,evnt,{elmtArg:ta.util.error.describe(elmt),funcName:funcName})}}var argSet=arguments;var args=Array.from(argSet).slice(3);args.splice(0,0,e,elmt);try{args.unshift({callback:_ta_call_defer,evt:e});args.unshift(func);return ta.run.apply(null,args)}catch(_ex){ta.util.error.record(_ex,"ta.call - "+funcName,evnt)}return false};var _ta_call_defer=function(func,options){if(options){delete (options.evt)}ta.run.apply(null,arguments)};ta.run=function(func,options){var argSet=arguments,args=Array.from(argSet).slice(2);try{var fn=ta.fn(func);if(fn&&typeOf(fn)==="function"){var retVal=fn.apply(window,Array.from(args));if(options&&options.onComplete){var completeFun=ta.fn(options.onComplete);if(completeFun){completeFun(retVal)}}return retVal}else{if(options&&options.evt){new Event(options.evt).preventDefault()}}var callback=options&&options.callback;ta.load(func,(callback||ta.run).pass(arguments))}catch(_ex){ta.util.error.record(_ex,"ta.run - "+func)}return false};ta.on=function(name,f){var v=_eventListeners[name];if(!v){v=_eventListeners[name]=[]}v.push(f)};ta.fireEvent=function(name){var args=Array.from(arguments),listeners=_eventListeners[name];args.shift();if(listeners){listeners.each(function(callback){callback.attempt(args)})}};ta.off=function(name,f){var v=_eventListeners[name],index;if(v instanceof Array){index=v.indexOf(f);if(index>=0){v.splice(index,1)}}};var OneTimeFunctionQueue=function(evtName){var _queue=[];var _runNow=false;var _execFn=function(fn,name){try{fn()}catch(_ex){try{ta.util.error.record(_ex,"OneTimeFunctionQueue "+evtName+(name?"-"+name:""))}catch(ignore){}}};var _runQueuedFunctions=function(){var startTiming=new Date();var funcTimings={};var anonFuncCounter=1;var recordTiming=ta.has("ta.js_load_tracking")&&evtName=="load";_queue.sort(function(a,b){return(a.priority-b.priority)||(a.subpriority-b.subpriority)});for(var i=0;i<_queue.length;++i){var funcStartTime=new Date();_execFn(_queue[i].func,_queue[i].name);if(recordTiming){var funcEndTime=new Date();var funcName=_queue[i].name;if(!funcName){funcName="Anon "+(anonFuncCounter++)}funcTimings[funcName]=funcEndTime.getTime()-funcStartTime.getTime()}}_queue=[];if(recordTiming){var endTiming=new Date();var totalTime=endTiming.getTime()-startTiming.getTime();ta.util.perf.loadPingback(totalTime,funcTimings)}};if(evtName!=null){window.addEvent(evtName,function(){_runNow=true;_runQueuedFunctions()})}this.addToQueue=function(fn,priority,name){if(!fn){ta.util.error.record(null,"addToQueue for "+evtName+" queue - no function");return}if(typeof priority==="string"){name=priority;priority=false}if(_runNow){_execFn(fn,name)}else{priority=priority||(100+_queue.length);_queue.push({func:fn,priority:priority,name:name,subpriority:_queue.length})}};this.executeQueue=function(){_runQueuedFunctions()}};var _readyQ=new OneTimeFunctionQueue("domready");var _loadQ=new OneTimeFunctionQueue("load");var _lazyImgQ=new OneTimeFunctionQueue(null);ta.queueForReady=function(fn,priority,name){_readyQ.addToQueue(fn,priority,name)};ta.queueForLoad=function(fn,priority,name){if(typeof IS_DEBUG!="undefined"&&IS_DEBUG){var tempName=name;if(typeof priority==="string"){tempName=priority}}_loadQ.addToQueue(fn,priority,name)};ta.queueLazyImg=function(element){var priority;try{priority=element.priority||1000}catch(ignore){return}var _fn=function(){try{if(element.oSRC!==""){if(element.tagName.toUpperCase()==="IMG"){element.src=element.oSRC}else{element.style.backgroundImage="url('"+element.oSRC+"')"}element.oSRC="";element.priority=""}}catch(e){ta.util.error.record(e,"lazy img",null,{src:element.src,oSRC:element.oSRC})}};_lazyImgQ.addToQueue(_fn,priority)};ta.hasEventListener=function(name){return !!(_eventListeners[name])};ta.manualProcessLoadQueue=function(){_loadQ.executeQueue()};ta.processLazyImages=function(){_lazyImgQ.executeQueue()};ta.fn=function(fn){switch(typeof(fn)){case"function":return fn;case"string":var f=false;try{f=eval(fn)}catch(e){}if(!f){var ns=fn.split("."),n=ns.pop();try{ns=eval(ns.join("."));f=ns&&ns._magic&&ns._magic.partial(n)}catch(e){}}if(f&&typeof(f)==="function"){return f}break}return null}}(ta));(function(E,d,j){d=E.ta=E.ta||{};d.analytics||(d.analytics={});var K=8;var b="impressionTrackingTree";var f=0,g=1,o=2;var i=[];var D=60;var H=function(U){return typeof U==="function"};var z=function(){var V=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],X;if(E.XMLHttpRequest){X=new XMLHttpRequest()}else{for(var U=0;U<V.length;U++){try{X=new ActiveXObject(V[U]);break}catch(W){}}}return X};var m=function(U,V){try{if(!U||typeof V!=="object"){return}if(E.JSON&&JSON.stringify){var W=JSON.stringify(V);if(W&&W.length<100000){i.push([U,W]);if(i.length>D){i.shift()}}}}catch(X){}};var t=function(Z,V,aa){if(!Z||typeof V!=="object"){C(new Error("postUrl/dataObj is null/empty/undefined"),"TA.Record _simpleAjaxPost",null,arguments);if(aa){aa()}return}var W;if(typeof Request!=="undefined"&&E.MooTools){W={url:Z,method:"post",data:V};if(aa){W.onComplete=aa;W.timeout=3000}var X=new Request(W).send();m(Z,V);return X}else{if(typeof Zepto!=="undefined"&&Zepto&&H(Zepto.ajax)){W={type:"POST",url:Z,data:V,error:function(ad,ab){var ac=/InvalidTrackingTreeException/;if(E.IS_DEBUG&&new RegExp(ac).exec(ad.response)){var ae=/Caused by:\s(.*)\n/;alert("TRACKING ERROR DETECTED\n"+new RegExp(ae).exec(ad.response)[1])}C(new Error("XHR error, errorType = "+ab),"TA.Record _simpleAjaxPost",null,arguments)}};if(aa){W.complete=aa;W.timeout=3000}Zepto.ajax(W)}else{if(typeof jQuery=="function"){W={url:Z,type:"POST",data:V};if(aa){W.complete=aa;W.timeout=3000}jQuery.ajax(W)}else{var U=z(),Y=h(V);U.open("POST",Z,false);U.setRequestHeader("Content-type","application/x-www-form-urlencoded");U.send(Y)}}}m(Z,V)};var C=function(){if(d&&d.util&&d.util.error&&d.util.error.record){d.util.error.record.apply(this,arguments)}else{if(d&&d.m&&H(d.m.recordJSError)){d.m.recordJSError(arguments)}}};var A=function(U){if(U===j||U==null){return""}if(typeof U!=="string"){U=U.toString()}return U.replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*")};var T=function(X){var U=[];for(var V in X){var W=X[V];U.push(A(V)+"."+A(W))}return U.join("*")};var x=function(U){if(U===j||U===null){return""}if(typeof U!=="string"){U=U.toString()}return U.replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*").replace(/\~/g,"!~")};var s=function(X){var U=[];for(var V in X){var W=X[V];U.push(x(V)+"."+x(W))}return U.join("*")};var q=function(U){var V=/(https?:\/\/[^\/]+)?\/([^#.?-]*)/;var W=V.exec(U);if(W){if(typeof W[2]!="undefined"){return(W[2])?W[2]:"Home"}}return null};var P=function(){var U=d.analytics.pageData&&d.analytics.pageData.length&&d.analytics.pageData[d.analytics.pageData.length-1];if(U&&U.url){return U.url.substring(1)}else{var V=/\/([^-]*)/.exec(E.location.pathname);return V?V[1]:null}};var Q=function(W,U,X){var V=new RegExp("(-"+U+"([0-9]+))|([?&]"+X+"=([0-9]+))");var Y=V.exec(W);if(Y){if(typeof Y[2]!="undefined"){return Y[2]}if(typeof Y[4]!="undefined"){return Y[4]}}return null};var I=function(U){return Q(U,"d","detail")||Q(U,"g","geo")};var J=function(U){var V=document.cookie.match("(?:^|;)\\s*"+U+"=([^;]*)");if(V){V=V[1];if(V.indexOf("%1%")===0){V=V.substring(3)}return decodeURIComponent(V)}return false};var r=function(X,Y,V){try{var U;if(V.encode){Y=encodeURIComponent(Y)}if(V.domain){Y+="; domain="+V.domain}if(V.path){Y+="; path="+V.path}if(V.duration){U=new Date();U.setTime(U.getTime()+V.duration*1000);Y+="; expires="+U.toGMTString()}if(V.secure){Y+="; secure"}document.cookie=X+"="+Y}catch(W){C(W,"_setCookieInSeconds",null,arguments)}};var S=function(){if(d.m&&d.m.store&&d.m.store.has("bookingSessionId")){return d.m.store.get("bookingSessionId")}return null};var B=function(){var U=false;if(typeof d.userLoggedIn==="boolean"){if(typeof d.userSecurelyLoggedIn==="boolean"){U=d.userLoggedIn?(d.userSecurelyLoggedIn?o:g):f}else{U=d.userLoggedIn}}return U};var N=function(X,V){var U={gac:X[1],gaa:X[2],gal:X[3],gav:X[4],gani:X[5],gass:P(),gasl:I(document.location.href),gads:q(V),gadl:I(V),gapu:d.uid,gams:B()},W=S();if(!U.gass){throw new Error("Src servlet undefined, gac:"+U.gac+", gaa:"+U.gaa+", gal:"+U.gal)}if(!U.gads){throw new Error("Dst servlet undefined. gac:"+U.gac+", gaa:"+U.gaa+", gal:"+U.gal)}if(d.has&&d.has("gatt")){U.gatt=d.retrieve("gatt")}if(W){U.bsid=W}r("EVT",T(U),{domain:cookieDomain,duration:5,encode:true,path:"/"})};var O=function(X){if(!X||!X.className||!X.firstChild){return false}var W=new RegExp("\\b"+b+"\\b"),U=X.firstChild.nodeType,V=X.firstChild.nodeValue;return W.test(X.className)&&U===K&&V!==""};d.analytics._GARecordRequest=function(Z,X){var V={gac:Z[1],gaa:Z[2],gal:Z[3],gav:Z[4],gani:Z[5],gass:P(),gasl:I(document.location.href),gapu:d.uid,gams:B()},Y=S(),U;if(X){V.gacl=X}if(d.has&&d.has("gatt")){V.gatt=d.retrieve("gatt")}if(Y){V.bsid=Y}var W;try{W=d.retrieve("batch_garecord")&&require("utils/BatchRequest")}catch(aa){}if(W){U={get:function(){W.queue("/GARecord",V)}}}else{if(typeof Request!="undefined"&&E.MooTools){U=new Request({url:"/GARecord",data:V})}else{U={get:function(){setTimeout(function(){var ab=new XMLHttpRequest();ab.open("GET","/GARecord?"+h(V),true);ab.send(null)},1)}}}}m("/GARecord",V);return U};var h=function(V){var W=[];for(var U in V){W.push(encodeURIComponent(U)+"="+encodeURIComponent(V[U]))}return W.join("&")};d.urlArgLookup=function(X,U){var W=new RegExp("[\\?&]"+X+"=(\\w+)");var V=W.exec(U);if(V&&typeof V[1]!==j){return V[1]}return null};d.analytics._JSON_parse=function(U){if(JSON.parse){return JSON.parse(U)}if(JSON.decode){return JSON.decode(U)}throw new Error("No JSON.parse or JSON.decode")};d.analytics._validatedTrackEventArray=function(W,Y,U,X,V){if(W&&typeof W!="string"){W=W.toString()}if(Y&&typeof Y!="string"){Y=Y.toString()}if(U&&typeof U!="string"){U=U.toString()}if(!X){X=0}else{if(typeof X!="number"){X=parseFloat(X);if(isNaN(X)){X=0}}}if(typeof V!="boolean"){V=(V===true)}return["_trackEvent",W,Y,U,X,V]};d.analytics._toEvtParams=function(W){try{var U={gac:W.module,gaa:W.action,gal:W.context,gav:W.value,gani:W.noninteraction};U.gass=P();U.gasl=I(document.location.href);U.gapu=d.uid;U.gams=B();return U}catch(V){C(V,"ta.analytics._toEvtParams",null,W)}};d.analytics._trackEventAfterAjax=function(V){try{d.trackDMPBehavior(V.module,V.action,V.context,V.value,V.noninteraction)}catch(U){C(U,"ta.analytics._trackEventAfterAjax",null,V)}};d.getEventPathOptions=function(Z,W,V){try{var Y=u(V,Z);if(!Y){C(null,"ta.getEventPathOptions - invalid element",null,arguments);return}var U=G(Y);if(W){U.noninteraction=W}return U}catch(X){C(X,"ta.getEventPathOptions",null,arguments)}};d.analytics._trackEventPathAfterAjax=function(U){try{d.trackEventOnPage(U.category,U.action,U.label,U.value,U.noninteraction)}catch(V){C(V,"ta.analytics._trackEventPathAfterAjax",null,arguments)}};d.trackPhysicalCommerce=function(W,V,Z,U){try{var X=d.analytics._validatedTrackEventArray(W,"Commerce-Physical",V,Z,false);d.analytics._GARecordRequest(X,U).get()}catch(Y){C(Y,"ta.trackPhysicalCommerce",null,arguments)}};d.trackAttemptedCommerce=function(V,U,X){try{d.trackDMPBehavior(V,U,X,null,null)}catch(W){C(W,"ta.trackAttemptedCommerce",null,arguments)}};d.trackPhysicalAndAttemptedCommerce=function(W,V,X,Y,U){d.trackPhysicalCommerce(W,V,Y,U);d.trackAttemptedCommerce(W,V,X,Y)};d.trackImpressionEventOnPage=function(V,X,U,W){V=V||"";X=X||"";U=U||"";W=W||0;d.trackEventOnPage(V,X,U,W,true)};d.trackEventOnPage=function(V,Z,U,Y,X){try{var W=d.analytics._validatedTrackEventArray(V,Z,U,Y,X);d.analytics._GARecordRequest(W).get();d.trackDMPBehavior(V,Z,U,Y,X)}catch(aa){C(aa,"ta.trackEventOnPage",null,arguments)}};d.trackCommerceClickForInsight=function(Z){if(!d.retrieve("insight_profile_commerce_clicks_from_data_attributes.enabled")){return}try{var aa=d.id(Z),ad,V,ab,U,X,ae,W,Y;ad=aa.get("data-offerauthor");V=aa.get("data-locationId");ab=aa.get("data-pernight");X=d.meta.link.getUrlFromClickElem(aa);ae=d.popups.PopUtil.extractSlotFromCommerceUrl(X);U=I(document.location.href);W={};W.providerName=""+ad;W.clickLocId=""+V;W.price=""+ab;W.slot=""+ae;W.pageLocId=""+U;Y=JSON.encode(W);d.trackEventOnPage("InsightEvent","InsightCommerceClick",Y)}catch(ac){C(ac,"ta.trackCommerceClickForInsight",null,arguments)}};d.trackEventOnPageOnce=function(Y,aa,W,X){var U="eventsAlreadyTracked",Z;if(ifdefNN(d)&&ifdefNN(d.m)&&ifdefNN(d.m.store)){Z=d.m.store.get(U)}else{Z=d.retrieve(U)}if(!Z){Z={};if(ifdefNN(d)&&ifdefNN(d.m)&&ifdefNN(d.m.store)){d.m.store.add(U,Z)}else{d.store(U,Z)}}var V=Y+"|"+aa+"|"+W;if(!Z[V]){d.trackEventOnPage(Y,aa,W,0,X);Z[V]=true}};d.trackDMPBehavior=function(V,Y,U,X,W){try{if(d.common&&d.common.dmp&&d.common.dmp.isEnabled()){d.common.dmp.sendGABehavior(V,Y,U,X,W)}}catch(Z){C(Z,"Error adding and sending GARecord behavior to DMP")}};d.setEvtCookie=function(W,Z,V,Y,U){try{var X=d.analytics._validatedTrackEventArray(W,Z,V,Y,false);N(X,U);if(d.common&&d.common.dmp&&d.common.dmp.isEnabled()){d.common.dmp.sendEventBehavior(W,Z,V,Y,M())}}catch(aa){C(aa,"ta.setEvtCookie",null,arguments)}};var v=function(W){var V;try{V=J("MEVT")||"";if(V.length>0){V+="~"}V+=s(W);if(V.length>1024){throw"MEVT Cookie is full"}r("MEVT",V,{domain:cookieDomain,duration:5,encode:true})}catch(U){C(U,"_appendMevtCookie",null,arguments);return false}return true};var l="trk";var a=l.length;var L="etk";var p=/^([A-Z]{1,2}:)?[A-Za-z_0-9\-\.]+$/;var M=function(){var U=(typeof event!="undefined")?event:E.event;if(U){return U.target||U.srcElement}return document.activeElement};d.analytics.getCommentTrackingPath=function(U,V){return u(U,V)};var u=function(aa,ac){if(!aa){aa=M();if(!aa){C(null,"_getCommentTrackingPath - no element provided or event target element",null,arguments);return null}}if(aa.nodeType!=1){return null}var af=[];if(ac&&typeof ac=="string"&&ac!==""){if(p.test(ac)){if(ac.substring(0,2)=="P:"){af.push(ac.substring(2));return af}else{af.push(ac)}}}if(typeof aa.previousSibling==="undefined"){C(null,"_getCommentTrackingPath - browser does not support previousSibling",null,arguments);return af}LOOP_PARENT_NODES:for(var X=aa;X!=document.body;X=X.parentNode){if(X==null){C(null,"_getCommentTrackingPath - LOOP_PARENT_NODES got unexpected null node",null,arguments);break}var ad=0;for(var U=X.previousSibling;U!=null;U=U.previousSibling){if(U.nodeType==K){var W=U.nodeValue;if(W==L){ad++;continue}if(W.substring(0,a)!=l){continue}if(ad>0){ad--;continue}var Z=W.substring(a).split("/");if(!Z){C(null,'ta._getCommentTrackingPath - cannot split context class: "'+W+'"',null,arguments)}for(var ae=Z.length-1;ae>=0;ae--){var V=Z[ae];var ab=p.exec(V);if(!ab){C(null,'ta._getCommentTrackingPath - tracking prefix used with invalid context: "'+Z[ae]+'"',null,arguments);continue}if(ab[1]=="P:"){var Y=ab[0].substring(2);af.push(Y);break LOOP_PARENT_NODES}else{af.push(ab[0])}}}}}return af};var G=function(W){if(W.length===0){return null}var U={action:W[0],label:"",value:"1",category:W[W.length-1]};W.shift();for(var V=W.length-2;V>=0;V--){U.label+=W[V];if(V>0){U.label+="/"}if(W[V].substring(0,2)=="N:"){U.value=W[V].substring(2)}}if(U.label===""){U.label="Unknown"}return U};d.trk=function(Z,V,U,W){try{var Y=U?U.getAttribute("data-trk-path"):null;if(Y){Y=Y.replace("P:","");Y=Y.split("/");Y.reverse()}else{Y=u(U,Z);if(!Y){C(null,"ta.trk - invalid element for "+Z,null,arguments);return}}d.trkWithPath(Y,V,W)}catch(X){C(X,"ta.trk",null,arguments)}};d.trkWithPath=function(Z,X,Y){try{if(!Z){C(null,"ta.trkWithPath - no path in arguments",null,arguments);return}if(Y&&Y.length>0&&Z.length&&Z.splice){for(var V=Y.length-1;V>=0;V--){if(typeof(Y[V])==="string"){Z.splice(1,0,Y[V])}}}var U=G(Z);d.trackEventOnPage(U.category,U.action,U.label,U.value,X)}catch(W){C(W,"ta.trkWithPath",null,arguments)}};d.trkImpTree=function(V,X){try{if(!O(V)){C(null,"ta.trkImpTree called with invalid trackTreeElem!",null,arguments);if(X){X()}return}var U=V.firstChild.nodeValue;n(U,X)}catch(W){C(W,"ta.trkImpTree",null,arguments);if(X){X()}}};d.recordImpression=function(U,W){if(!U){if(W){W()}return}try{n(F(U),W)}catch(V){C(V,"ta.recordImpression",null,arguments);if(W){W()}}};var y="<!--";var w="-->";var F=function(U){var V=U.indexOf(y),W=0,X=U.indexOf(w);if(V!==-1){W=V+y.length}if(X===-1){X=U.length}return U.substring(W,X)};d.analytics.stripCommentsFromTree=F;var k="\\";var c="/";d.analytics.appendAscendTokens=function(V){var X=0,W=0,U=0;for(X=0;X<V.length;X++){if(V[X]===c){U++}else{if(V[X]===k){W=X+1;while(W<V.length&&V[W]===k){U--;X=W;W++}}}}if(U>0){for(X=0;X<U;X++){V+=k}}return V};var n=function(U,W){var V={tTreeStr:U&&U.trim(),tTreeUid:d.uid&&d.uid.trim(),tTreeLastReferrer:E.location.href,tTreeIsMemberSignedIn:B()};if(d.m&&d.m.store&&d.m.store.has("bookingSessionId")){V.bsid=d.m.store.get("bookingSessionId")}if(!V.tTreeStr){C(new Error("tTreeStr is null/undefined/empty."),"ta._sendTreeImpression",null)}else{if(!V.tTreeUid){C(new Error("tTreeUid is null/undefined/empty."),"ta._sendTreeImpression",null)}}t("/ImpressionRecord",V,W)};d.setEvtCookieAndPath=function(Z,U,W){try{if(!W){W=M()}var Y=u(W,Z);if(!Y){C(null,"ta.setEvtCookieAndPath - invalid element for "+Z,null,arguments);return}var V=G(Y);if(!U){while(W.nodeName!="A"){if(W==document.body){break}W=W.parentNode}U=W.href;if(!U){C(null,"ta.setEvtCookieAndPath - no url parameter and cannot find a.href",null,arguments);return}}d.setEvtCookie(V.category,V.action,V.label,V.value,U)}catch(X){C(X,"ta.setEvtCookieAndPath",null,arguments)}};d.recordPageview=function(V,Y){if(!V){return}var U=q(V),X="/PageviewRecord",W=Y?Y:{};if(U){W.servletName=U;t(X,W)}};d.resetPageDataUrl=function(){var U;if(d&&d.analytics&&d.analytics.pageData){U=d.analytics.pageData&&d.analytics.pageData.length&&d.analytics.pageData[d.analytics.pageData.length-1];if(U){U.url=""}}};d.trackEngagementClick=function(U,V){if(!U||!V){C(new Error("object/selectionFunction is null/undefined"),"ta.trackEngagementClick",null,arguments);return}if(!H(V)){C(new Error("passed variable selectionFunction is not a function"),"ta.trackEngagementClick",null,V);return}V(U)};d.placementNodeSelectorTracker=function(Z){if(!Z||!Z.element||!Z.type){C(new Error("object/element/type is null/undefined"),"ta.placementNodeSelectorTracker",null,Z);return}var ae=Z.element;var Y=Z.type;var aa;var V;var ag;var af;var U;var ad;var W=d.analytics.getCommentTrackingPath(ae);Y=Y+"_Click";if(!W){C(new Error("trackTreePath is null/undefined"),"ta.placementNodeSelectorTracker",null,arguments);return}if(W.length<1){C(new Error("trackTreePath is missing information"),"ta.placementNodeSelectorTracker",null,arguments);return}aa=W.getLast();if(!aa){C(new Error("placement is null/undefined"),"ta.placementNodeSelectorTracker",null,W);return}for(ad=W.length-1;ad>=0;ad--){U=W[ad];if(!U){continue}if(U.indexOf("N:")===0){V=U;break}}if(aa==="HH_MainList"){V="N:1"}else{if(!V){C(new Error("positionNode is null/undefined"),"ta.placementNodeSelectorTracker",null,W);return}}ag=V.split(":");if(ag&&ag.length===2){af=ag[1]}else{C(new Error("positionSplit appears to be incorrect"),"ta.placementNodeSelectorTracker",null,arguments);return}if(!af){C(new Error("position is null/undefined"),"ta.placementNodeSelectorTracker",null,arguments);return}var ac=parseInt(af,10);if(isNaN(ac)){C(new Error("position is not a number"),"ta.placementNodeSelectorTracker",null,af);return}var ah=R(aa);if(ah===-1){return}af=ac+ah;aa=e(aa);var X;var ab=d.select("#jfy_filter_bar_sort .jfy_sort.selected");if(ab&&ab.length===1){ab=ab[0];X=ab.getAttribute("data-currentSort")}d.trackEventOnPage(aa,Y,X,af)};var e=function(U){if(!U){return U}if(P()!=="Hotels"){return"Clicks_"+U}var V;if(U==="Hotels_MainList"||U==="Hotels_MainList_Sponsored"){V="Clicks_"+U}else{if(U==="hotels_list_short_cells2"){V="Clicks_Hotels_MainList"}else{if(U==="sponsored_coupon_listing"){V="Clicks_Hotels_MainList_Sponsored"}}}if(d.id("sponsoredCouponListingWrap")&&V==="Clicks_Hotels_MainList"){V+="_Sponsored"}V+=(d.widgets.calendar.getCheckRatesData())?"_PostDates":"_PreDates";return V};var R=function(X){if(!X){C(new Error("placement is null/undefined"),"ta._shiftOrdinalsWithSponsoredPlacement",null,X);return -1}if(P()!=="Hotels"){return 0}var V=0;var Z=d.retrieve("hac.offset");if(Z&&Z>0){V=Z}if(!d.id("sponsoredCouponListingWrap")){return V}var W=document.getElement("#HAC_RESULTS .pageNumbers .current");var U;if(W){var Y=W.getAttribute("data-page-number");U=parseInt(Y,10);if(isNaN(U)||!U){C(new Error("pageNumber is not a number"),"ta._shiftOrdinalsWithSponsoredPlacement",null,Y);return -1}}if(X==="hotels_list_short_cells2"||X==="Hotels_MainList"){V+=U;return V}if(Z&&Z>0&&(X==="sponsored_coupon_listing"||X==="Hotels_MainList_Sponsored")){V+=(U-1)}return V};d.getRecentTARecords=function(){return i};d.addTypeAheadMevt=function(U){U.t="ta";return v(U)};d.addGARecordMevt=function(X,Y,W,ac,V){try{var U=d.analytics._validatedTrackEventArray(X,Y,W,ac,false),ab={t:"ga",gac:U[1],gaa:U[2],gal:U[3],gav:U[4],gani:U[5],gass:P(),gasl:I(document.location.href),gads:q(V),gadl:I(V),gapu:d.uid,gams:B()},Z=S();if(!ab.gass){throw new Error("Src servlet undefined, gac:"+ab.gac+", gaa:"+ab.gaa+", gal:"+ab.gal)}if(!ab.gads){throw new Error("Dst servlet undefined. gac:"+ab.gac+", gaa:"+ab.gaa+", gal:"+ab.gal)}if(d.has&&d.has("gatt")){ab.gatt=d.retrieve("gatt")}if(Z){ab.bsid=Z}v(ab);if(d.common&&d.common.dmp&&d.common.dmp.isEnabled()){d.common.dmp.sendEventBehavior(X,Y,W,ac,M())}}catch(aa){C(aa,"ta.addGARecordMevt",null,arguments)}}})(window,ta);(function(){var f=[];var a=3000;function b(l,n){var g=f.length;f.push({name:l,properties:[]});for(var m in n){var h=true;if(g>0){for(var j=0;h&&j<g;j++){if(f[j].properties.indexOf(m)!=-1){h=false}}}if(h){f[g].properties.push(m)}}}b("node",document.createTextNode(""));b("Element",Element.prototype);f[1].properties.push("uid");b("element",document.createElement("div"));b("input",document.createElement("input"));f[3].properties.push("autocomplete");var e={element:"E",number:"N","function":"F",string:"S","boolean":"B",object:"O",collection:"C",whitespace:"W"};function d(h){var g=typeOf(h);return null==h?"_":(e[g]?e[g]:(g=="null"?"!":g))}ta.util.error={types:f,override:false,errorCount:0,record:function(y,h,s,u,n){if(!y){y=new Error("Stub error to build stack.")}if(ta.has("ta.error.record.inFlight")||ta.util.error.errorCount>9){return}ta.util.error.errorCount++;ta.store("ta.error.record.inFlight",true);var p=false;try{p=document.getElement("body").hasClass("js_logging")}catch(B){}if(!p){return}if(IS_DEBUG&&console.error){console.error("JS_ERROR_RECORD: "+h,y)}var E=true;if(u&&u.hasOwnProperty("error_script")&&!ta.util.error.isInternalScript(u.error_script)&&!ta.util.error.isScriptInline(u.error_script)){E=false}var m={};var D=false;try{if(s||window.event){s=new Event(s||window.event);D=ta.id(s.target);m.eTarg=this.getSelectorString(D)}}catch(r){}if(typeof(debugCacheKey)!="undefined"){m.key=debugCacheKey}var g=window.pageServlet;if(!g){g="unknown"}m.servlet=g;if(!n||typeof n!="string"){n="ERROR"}if(!E){n="WARN";m.warnReason="externalError"}else{if(!IS_DEBUG&&ta.util.error.errorCount>1){n="WARN";m.warnReason="notFirstJSError"}}var H={extraInfoError:"Problem storing extra info"};var G="";var l={};try{var j="";try{j=window.navigator.userAgent}catch(t){}var k="";var i="";if(D){if(typeof D.id!=="function"){k=D.id}i=D.className}var w=false;try{w=doCookieCheck()}catch(B){}var z="";if(typeof serverPool!="undefined"&&serverPool){z=serverPool}var v="";if(window.MooTools){v+="MooTools "}if(window.jQuery){v+="jQuery ";n="WARN";m.warnReason="jquery"}l={TARGET_ID:k,TARGET_CLASS:i,PAGE_UID:ta.uid,INTERNAL_JS:ta.util.error.getScriptSrcs(),CLIENT_POOL:z,COOKIES_ENABLED:w,JS_LIBS:v};if(!E){l.INTERNAL_ERROR="false"}if(ta.util.error.errorCount>1){l.PRIOR_JS_PAGE_ERRORS=ta.util.error.errorCount-1}}catch(A){u=H}m.xInfo=ta.util.error._getExtraInfoString(l,u);try{m.eUrl=window.location.href}catch(r){}var o="No Error";try{if(y){if(Object.prototype.toString.call(y)===Object.prototype.toString.call(new Error)){o=y.name+"-"+y.message}else{if(typeof y==="object"){o="non-Error object "+Object.prototype.toString.call(y)+" passed, sample properties - ";var F=0;for(prop in y){if(y.hasOwnProperty(prop)){o+=prop.substring(0,30)+": "+(y[prop]&&y[prop].toString?y[prop].toString().substring(0,20):y[prop])+", ";if(++F>4){break}}}}else{o="non-Object error passed: "+(""+y).substring(0,30)}}o=o.replace(/[\r\n]/g,"")}}catch(r){}m.eMsg=o;var x="";try{x=ta.util.error.getErrorBlock(h).substring(0,150);m.eBlk=x}catch(r){}try{if(x.indexOf("window.onerror")!=0){var C=ta.util.error.getErrorStack(y);if(C){m.eStak=C}}}catch(r){}try{if(ta.widgets&&ta.widgets.calendar){m.eDates=ta.widgets.calendar.getErrorDates()}}catch(r){}m.eLogLevel=n;try{new Request({url:"/JSErrorRecord",data:m}).send()}catch(B){m={eBlk:"JSErrorRecord Error",servlet:g,eLogLevel:"ERROR",eMsg:"no error retrieved"};new Request({url:"/JSErrorRecord",data:m}).send()}if(IS_DEBUG){(window.ERRORS||(window.ERRORS=[])).push(m)}if(ta.util.error.override){if(ta.util.error.override.match(/alert/)){ta.util.error.alert(m)}if(ta.util.error.override.match(/console/)&&console){ta.util.error.console(m)}}ta.remove("ta.error.record.inFlight");if(IS_DEBUG&&y&&n==="ERROR"&&false){throw y}if(IS_DEBUG){var q=ta.util.error._buildToolbarElement(o,h,n);if(ta.has("debug.toolbar.loaded")){ta.util.error.addErrorInJSToolbar(q)}else{ta.util.error._jsToolbarErrorsToAdd.push(q)}}},_jsToolbarErrorsToAdd:[],_buildToolbarElement:function(i,h,g){var j="<td class='"+g+"'>"+g+"</td><td><b>Error Block</b>:: "+h+", <b>Error Message</b>:: "+i+"</td>";return new Element("tr",{html:j})},addErrorInJSToolbar:function(i){var g=document.getElement("#DEBUG_JS_ERROR_DETAILS tbody"),h=document.getElement(".perfButtonWrap .jsErrors");if(!i){return}if(g){i.inject(g)}if(i.innerHTML&&i.innerHTML.indexOf("ERROR")>-1){h.addClass("ERROR")}else{h.addClass("WARN")}},_getExtraInfoString:function(q,g){var m="_extraInfoError_:Problem storing extra info.";var o={};var r="";try{var p=typeOf(g);var j={};if(p==="array"||p==="arguments"){for(var l=0;l<g.length;l++){var h=g[l];var n=typeof h;if(n==="string"||n==="number"||n==="boolean"){j[l]=h}else{j[l]=typeof h}}g=j}o=Object.merge(q,g);r=JSON.encode(o);if(r){if(r.length>a){r=r.substring(0,a)}return r.replace(/[\r\n]/g,"")}}catch(k){}try{o=q;r=JSON.encode(o);if(r){if(r.length>a){r=r.substring(0,a)}return r.replace(/[\r\n]/g,"")}}catch(k){}return m},getErrorBlock:function(g){if(typeof g!="undefined"&&g!==null){return g.toString().replace(/[\r\n]/g,"")}return"null or undefined"},getErrorStack:function(m){var n="";try{if(arguments&&arguments.callee&&!Browser.chrome&&!Browser.firefox&&!Browser.safari){var p=[];var h=arguments.callee.caller;h=h.caller;var k=0;while(h&&k++<20){var i=h.toString();if(i.match(/onErrorFunc/)){h=h.caller;continue}var g=i.length;var j=g>100?100:g;var q=i.substring(0,j);q=q.replace(/(\n|\r|\'|\")/g,"");q+="::";p.push(q);h=h.caller}return p.join(" ")}}catch(l){n="-arguments.callee issue"}if(m&&m.stack){var o=m.stack.split("\n");o=o.map(function(s){var r=s.lastIndexOf("/");if(r>0){s=s.substr(r+1)}return s});return o.join()}return"none"+n},getSelectorString:function(h){if(!h){return""}var g=[h];while(typeof h!="undefined"&&h&&typeof h.parentNode!="undefined"){g.push(h=h.parentNode)}g=g.map(function(j){if(j&&j.tagName){var i=j.tagName;if(j.id){i+="#"+j.id}if(j.className){i+="."+j.className}return i}return""});g=g.reverse().join(">");g=g.replace(/\s+/g,".");return g},ajaxFailure:function(i,h,g){ta.util.error.record(null,i,null,Object.merge({status:h.status},g))},alert:function(g){var h="";Object.each(g,function(j,i){h=h+i+": "+j+"\n"});window.alert(h)},console:function(g){if(console){console.error(g)}},getScriptSrcs:function(){var g="";Array.each(document.getElementsByTagName("script"),function(k,h){if(!k){return}var j=k.src;if(ta.util.error.isInternalScript(j)){var i="";if(g!=""){i=", "}j=j.substring(j.indexOf("/js")+1);g=g+i+j}});if(g.length>a){g=g.substring(0,a)}return g},isInternalScript:function(g){if(!g||!g.indexOf){return false}var h=window.CDNHOST||"";if(window.IS_DEBUG&&h==""){return g.match(/(js3\/|js\/)/)!=null}else{return g.indexOf(h)==0}},isScriptInline:function(h){if(!h||!h.indexOf){return false}var g="noPage";try{g=window.location.href}catch(i){}if(h===g){return true}return false},describe:function(h){if(null==h){return"_N"}var j=d(h),i=[],l,m;for(var k in h){l=false;for(var g=0;!l&&g<f.length;g++){if(f[g].properties.indexOf(k)!=-1){l=true;if(i.indexOf(f[g].name)==-1){i.push(f[g].name)}}}if(!l){j+=","+k+":"+d(h[k])}}if(i.length>0){j+=","+i.join(",")}return j}};var c=Cookie.read("JS_ERROR_HANDLING");if(c){ta.util.error.override=c}})();window.ta||(window.ta={});(function(a){a.util||(a.util={});var c="interruption_record";var e=["popup","popunder","gate","other"];var d=function(h,f){try{if(a&&a.util&&a.util.error&&a.util.error.record&&typeof a.util.error.record==="function"){a.util.error.record(f,h,null,null)}}catch(g){}};var b=function(g){for(var f=0;f<e.length;f++){if(g===e[f]){return true}}return false};a.util.recordInterruption=function(g,f){try{if(!b(g)){d("ta.util.recordInterruption: Invalid type")}else{if(!f){d("ta.util.recordInterruption: Name cannot be null or blank")}else{if(a.trackEventOnPage&&typeof a.trackEventOnPage==="function"){a.trackEventOnPage(c,g,f.replace(",",""),0,true)}else{d("ta.util.recordInterruption: cannot track event on page")}}}}catch(h){d("ta.util.recordInterruption: exception tracking event",h)}}}(ta));(function(n,h){var y=false,j="taLsTest",i="1",q="TALocalStorageCurrentSessionId",l=false,m="session-",k=false,A=[];var t=function(){return !!(l||k)};var u=function(e){if(!t()){typeof n!=="undefined"&&n.util&&n.util.error&&n.util.error.record(null,"Accessing localStorage session cookie before session logic intialized: "+e);return false}return true};var p=function(e){return b(e,"value")};var v=function(e){return b(e,"now")};var b=function(D,F){if(!F){return null}try{var E=JSON.parse(y.getItem(D)||"0"),H;if(!E){return null}if(E.ttl&&E.ttl+E.now<new Date().getTime()){y.removeItem(D);return null}if(!E.hasOwnProperty(F)){return null}y.setItem("512",E[F]);H=y.getItem("512");y.removeItem("512");return H}catch(G){}return null};var B=function(D){try{y.removeItem(D)}catch(E){}};var C=function(D){try{var F=y.getItem(D);if(F!==null&&F!==h){return true}}catch(E){}return false};var a=function(E,F,D){try{y.setItem(E,JSON.stringify({ttl:D||0,now:new Date().getTime(),value:F}))}catch(G){}};var r=function(D){k=true;if(!D){typeof n!=="undefined"&&n.util&&n.util.error&&n.util.error.record(null,"Attempting to initialize localStorage with invalid sesion key: "+D);return false}if(!x()){return false}l=p(q);if(!l||l!=D){l=D;a(q,l);var e=p("latestPageServlet");if(e){a("sessionEntryServlet",e)}d();if(C(q)){typeof n!=="undefined"&&n.store&&n.store("isFirstSessionPageView",true)}}};var d=function(){try{var F=m+l;var D=new RegExp("^"+m);if(y.length){for(var E=0;E<y.length;E++){var H=y.key(E);try{if(D.test(H)&&H!=F){B(H)}}catch(G){}}}}catch(I){}};var x=function(){var E=false;try{if(y&&y.setItem){y.setItem(j,i);E=y.getItem(j)!=i;y.removeItem(j);if(E){y=false}return !!y}}catch(D){}return false};var g=function(D){try{y.setItem("session-"+l,JSON.stringify(D))}catch(E){}};var s=function(){try{var D=y.getItem("session-"+l);if(D){return JSON.parse(D)}}catch(E){}return{}};var c=function(e){A.push(e)};var f={enabled:x(),get:p,set:a,remove:B,has:C,getTimeStamp:v,updateSessionId:r,onSessionStorageChange:c,canUseSession:t,getSessionKey:function(D){if(!u(D)){return null}var e=s();if(e){return e[D]}return null},setSessionKey:function(D,E){if(!u(D)){return}var e=s();if(!e){e={}}e[D]=E;g(e)},removeSessionKey:function(D){if(!u(D)){return}var e=s();if(!e){return}delete e[D];g(e)},hasSessionKey:function(D){if(!u(D)){return false}var e=s();if(e){var E=e[D];if(E!==null&&E!==h){return true}}return false},setStorage:function(e){y=e;this.enabled=x()}};n.localStorage=f;if(typeof window!=="undefined"){var z=false;try{var o=window.localStorage;z=o}catch(w){}n.localStorage.setStorage(z);(function(){function D(G){G=G||window.event;if(l&&(!G.key||G.key==="session-"+l)){for(var F=0,E=A.length;F<E;F++){A[F](G)}}}var e=!!window.addEventListener;if(e){window.addEventListener("storage",D,false)}else{document.attachEvent("onstorage",D)}})()}}(ta));(function(i,k,e){var l=[],m=[],h=false,o=false;var d,n;if(typeof document.hidden!=="undefined"){d="hidden";n="visibilitychange"}else{if(typeof document.mozHidden!=="undefined"){d="mozHidden";n="mozvisibilitychange"}else{if(typeof document.msHidden!=="undefined"){d="msHidden";n="msvisibilitychange"}else{if(typeof document.webkitHidden!=="undefined"){d="webkitHidden";n="webkitvisibilitychange"}}}}function j(){o=false;for(var p in m){if(m.hasOwnProperty(p)){m[p]()}}}function f(){o=true;for(var p in l){if(l.hasOwnProperty(p)){l[p]()}}}function g(){var q=document[d]?l:m;for(var p in q){if(q.hasOwnProperty(p)){q[p]()}}}function a(){if(typeof document[d]==="undefined"){k.addEvent("focus",j);k.addEvent("blur",f)}else{document.addEventListener(n,g)}h=true}function b(){if(typeof document[d]==="undefined"){k.removeEvent("focus",j);k.removeEvent("blur",f)}else{document.removeEventListener(n,g)}o=false;h=false}function c(r,q){var p=r.indexOf(q);if(p>=0){return r.splice(p,1)}return null}i.pageVisibility={addFocusListener:function(p){m.push(p);if(!h){a()}},addBlurListener:function(p){l.push(p);if(!h){a()}},removeFocusListener:function(p){if(p){c(m,p)}else{m.length=0}if(m.length===0&&l.length===0){b()}},removeBlurListener:function(p){if(p){c(l,p)}else{l.length=0}if(m.length===0&&l.length===0){b()}},hidden:function(){if(typeof document.hidden!=="undefined"){return document.hidden}return o}}})(ta,window);(function(){ta=window.ta=window.ta||{};var b=ta.prerender||(ta.prerender={});b.states={PREFETCH_SENT:"prefetchSent",CLEAR:"clear"};var a=function(f){if(ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(f)}};var e=function(i,k,g,j,h){if(ta.analytics&&ta.analytics._validatedTrackEventArray&&ta.analytics._GARecordRequest){var f=ta.analytics._validatedTrackEventArray(i,k,g,j,h);ta.analytics._GARecordRequest(f).get();return true}return false};var d=function(){if("visibilityState" in document){b._visibilityState="visibilityState";b._visibilitystatechanged="visibilitychange";return}var g=["webkit","moz","ms","o"];for(var f=0;f<g.length;f++){if((g[f]+"VisibilityState") in document){b._visibilityState=g[f]+"VisibilityState";b._visibilitystatechanged=g[f]+"visibilitychange"}}};var c=function(){try{if(b._state===b.states.PREFETCH_SENT&&document[b._visibilityState]!=="prerender"){e("Prerender","shown","",0,true);b._state=b.states.CLEAR}}catch(f){a(f)}};b._init=function(f){try{b._enabled=f;b._state=b.states.CLEAR;d();if(!b.isSupported()||!b.isEnabled()){return}if(document[b._visibilityState]==="prerender"){if(e("Prerender","prefetch","",0,true)){b._state=b.states.PREFETCH_SENT;document.addEventListener(b._visibilitystatechanged,c,false)}}}catch(g){a(g)}};b.isEnabled=function(){return b._enabled};b.isSupported=function(){return b._visibilityState!==undefined}})();(function(){if(typeof performancePingbackInit=="undefined"||performancePingbackInit.initialized){return}performancePingbackInit.initialized=true;ta.queueForReady(function(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.domready=new Date().getTime()}},0,"perf.recordReady");ta.queueForLoad(function(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.load=new Date().getTime();setTimeout(function(){a()},0)}},10000000,"perf.recordLoad");function b(){var c=performancePingbackInit.domready-performancePingbackInit.start;var d=performancePingbackInit.load-performancePingbackInit.start;var g="/PerformancePingback?ppuid="+performancePingbackInit.uid+"&load="+d+"&domready="+c+"&servlet="+performancePingbackInit.servlet;if(performancePingbackInit.behaviorEnd&&performancePingbackInit.behaviorStart){var f=performancePingbackInit.behaviorEnd-performancePingbackInit.behaviorStart;g+="&behavior="+f}if(window.performance&&window.performance.timing){for(var e in window.performance.timing){var h=window.performance.timing[e];if(typeof h==="number"){g+="&"+e+"="+h}}}g+="&coldcache="+(!performancePingbackInit.isTaReferrer);new Request({url:g}).send()}function a(){if(typeof performancePingbackInit!="undefined"&&performancePingbackInit.enabled&&performancePingbackInit.domready&&performancePingbackInit.load){if(!("readyState" in document)||!("onreadystatechange" in document)||!("addListener" in document)){b();return}if(document.readyState==="complete"){setTimeout(function(){b()},0)}else{document.addListener("readystatechange",function(){if(document.readyState==="complete"){setTimeout(function(){b()},0)}})}}}})();(function(){ta.util.perf={loadPingback:function(c,d){try{var a={};var f="";var b=false;f+="[[";Object.each(d,function(h,e){if(b){f+=","}f+=e+":"+h;b=true});f+="]]";a.functionTimes=f;a.totalTime=c;if(ta.uid){a.uid=ta.uid+""}a.errorsOnLoad=ta.has("ta.onload.errors");a.servlet=window.pageServlet;new Request({url:"/LoadRecord",data:a}).send()}catch(g){ta.util.error.record(g,"ta.util.perf.loadPingback",false,{totalLoadTime:c,funcTimes:d})}}}})();(function(a){Object.append(a,{isHotelsRedesign2011:function(){if(ta.has("hac.isHotelsRedesign2011")){return ta.retrieve("hac.isHotelsRedesign2011")}if(window.pageServlet=="LastMinute"){ta.store("hac.isHotelsRedesign2011",true);return true}var c=ta.id("HAC_SMRY");var b=c&&c.hasClass("hotels_re_2011");ta.store("hac.isHotelsRedesign2011",b);return b},isSmartDealsFilters:function(){if(ta.has("smartdeals.isSmartDealsFilters")){return ta.retrieve("smartdeals.isSmartDealsFilters")}var b=ta.id("DEALS");var c=b&&b.hasClass("sdfilters");ta.store("smartdeals.isSmartDealsFilters",c);return c},isDHTMLCRRedesign2012:function(){if(ta.has("overlays.isDHTMLCRRedesignBasic")){return ta.retrieve("overlays.isDHTMLCRRedesignBasic")}var b=$$(".overlay");var c=b&&b.hasClass("rgba_flyout");ta.store("overlays.isDHTMLCRRedesignBasic",c);return c},isRestaurantsRedesign2012:function(){if(ta.has("eateries.isRestaurants")){return ta.retrieve("eateries.isRestaurants")}var c=ta.id("EATERIES_2012");var b=c&&c.hasClass("gridA");ta.store("eateries.isRestaurants",b);return b},isAttractionsRedesign2012:function(){if(ta.has("attractions.isAttractions")){return ta.retrieve("attractions.isAttractions")}var b=ta.id("ATTRACTIONS_2012");var c=b&&b.hasClass("gridA");ta.store("attractions.isAttractions",c);return c},isMetaHomepageIntegration2013:function(){if(ta.has("home.isMetaHomepageIntegration2013")){return ta.retrieve("home.isMetaHomepageIntegration2013")}var c=ta.id("PPT");var b=c&&c.hasClass("ppt_container");ta.store("home.isMetaHomepageIntegration2013",b);return b},isMetaHotels2013:function(){if(ta.has("hotelsMeta.isMetaHotels2013")){return ta.retrieve("hotelsMeta.isMetaHotels2013")}var c=ta.id("PAGE");var b=c&&c.hasClass("meta_hotels");ta.store("hotelsMeta.isMetaHotels2013",b);return b},isMetaHotel2013:function(){if(ta.has("hotel.meta2013")){return ta.retrieve("hotel.meta2013")}var d=ta.id("MAIN"),c=d&&(d.hasClass("Hotel_Review")||d.hasClass("ShowUserReviews")||d.hasClass("Hotels")||d.hasClass("HACSearch"));ta.store("hotel.meta2013",c);return c},isFlights2013:function(){return $$(".new_lander").length>0},isMetaHotelsRequest:function(){return ta.has("isMetaHotelsRequest")},isHacMap:function(){return ta.has("hac.maps.isHacMap")},isFall2013MastheadRefresh:function(){return ta.has("fall_2013_masthead_refresh")},isHRTabs2014:function(){return ta.has("hr_tabs_2014")},isTabletAlbumViewer:function(){return ta.retrieve("tabletAlbumPhotoLightbox.enabled")},isTabletRotationCTATest:function(){return ta.retrieve("tabletRotationCTATest.enabled")},isWarUsabilityTest:function(){return ta.id(document.body).hasClass("war_usability")},isAirport:function(){return window.pageServlet=="Airport"}})})(ta);(function(a,c,b,d){b.browser=(function(g){var f=function(){return navigator.userAgent.indexOf("MSIE 10.0")>=0},h=function(){return g.retrieve("ta.isIE11orHigher")},e=function(){var n=g.retrieve("metaCheckRatesDebugFeatureEnabled"),j=null,k=h(),l=k?127:0,i=(c.innerWidth==screen.width&&((screen.height-c.innerHeight)===l));if(n){return true}try{j=!!new ActiveXObject("htmlfile")}catch(m){j=false}return !j&&i&&(k||f())};return{isIE9orHigher:function(){return navigator.appVersion.indexOf("MSIE 9")>=0||f()||h()},isIE10Metro:function(){return f()&&e()},isIEMetro:function(){return e()}}}(b))}(document,window,ta));(function(a,f,b,h){var g="screenSizeRecord";function c(){var l=a.documentElement,j=a.body,k=f.innerWidth||l.clientWidth||j.clientWidth,i=f.innerHeight||l.clientHeight||j.clientHeight,n=screen.width,m=screen.height;return"s"+n+"x"+m+"b"+k+"x"+i}function e(k){var i=c(),j=b.localStorage.getSessionKey(g);if(i!==j){b.localStorage.setSessionKey(g,i);b.trackEventOnPage("screenSizeRecord",k,i)}}function d(){if(!b.retrieve("screenSizeRecord")||!b.localStorage.enabled){return}e("load");var i;f.addEvent("resize",function(){if(i){clearTimeout(i)}i=setTimeout(function(){e("resize")},250)})}b.queueForLoad(d,"ScreenSizeRecord.onLoad")})(document,window,ta);/* Dust - Asynchronous Templating - v2.3.5
* http://linkedin.github.io/dustjs/
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */
(function(root){var dust={},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",loggingLevels=[DEBUG,INFO,WARN,ERROR,NONE],EMPTY_FUNC=function(){},logger={},originalLog,loggerContext;dust.debugLevel=NONE;dust.silenceErrors=false;if(root&&root.console&&root.console.log){loggerContext=root.console;originalLog=root.console.log}logger.log=loggerContext?function(){if(typeof originalLog==="function"){logger.log=function(){originalLog.apply(loggerContext,arguments)}}else{logger.log=function(){var message=Array.prototype.slice.apply(arguments).join(" ");originalLog(message)}}logger.log.apply(this,arguments)}:function(){};dust.log=function(message,type){type=type||INFO;if(dust.debugLevel!==NONE&&dust.indexInArray(loggingLevels,type)>=dust.indexInArray(loggingLevels,dust.debugLevel)){if(!dust.logQueue){dust.logQueue=[]}dust.logQueue.push({message:message,type:type});logger.log("[DUST "+type+"]: "+message)}if(!dust.silenceErrors&&type===ERROR){if(typeof message==="string"){throw new Error(message)}else{throw message}}};dust.onError=function(error,chunk){logger.log("[!!!DEPRECATION WARNING!!!]: dust.onError will no longer return a chunk object.");dust.log(error.message||error,ERROR);if(!dust.silenceErrors){throw error}else{return chunk}};dust.helpers={};dust.cache={};dust.register=function(name,tmpl){if(!name){return}dust.cache[name]=tmpl};dust.render=function(name,context,callback){var chunk=new Stub(callback).head;try{dust.load(name,chunk,Context.wrap(context,name)).end()}catch(err){dust.log(err,ERROR)}};dust.stream=function(name,context){var stream=new Stream();dust.nextTick(function(){try{dust.load(name,stream.head,Context.wrap(context,name)).end()}catch(err){dust.log(err,ERROR)}});return stream};dust.renderSource=function(source,context,callback){return dust.compileFn(source)(context,callback)};dust.compileFn=function(source,name){name=name||null;var tmpl=dust.loadSource(dust.compile(source,name));return function(context,callback){var master=callback?new Stub(callback):new Stream();dust.nextTick(function(){if(typeof tmpl==="function"){tmpl(master.head,Context.wrap(context,name)).end()}else{dust.log(new Error("Template ["+name+"] cannot be resolved to a Dust function"),ERROR)}});return master}};dust.load=function(name,chunk,context){var tmpl=dust.cache[name];if(tmpl){return tmpl(chunk,context)}else{if(dust.onLoad){return chunk.map(function(chunk){dust.onLoad(name,function(err,src){if(err){return chunk.setError(err)}if(!dust.cache[name]){dust.loadSource(dust.compile(src,name))}dust.cache[name](chunk,context).end()})})}return chunk.setError(new Error("Template Not Found: "+name))}};dust.loadSource=function(source,path){return eval(source)};if(Array.isArray){dust.isArray=Array.isArray}else{dust.isArray=function(arr){return Object.prototype.toString.call(arr)==="[object Array]"}}dust.indexInArray=function(arr,item,fromIndex){fromIndex=+fromIndex||0;if(Array.prototype.indexOf){return arr.indexOf(item,fromIndex)}else{if(arr===undefined||arr===null){throw new TypeError('cannot call method "indexOf" of null')}var length=arr.length;if(Math.abs(fromIndex)===Infinity){fromIndex=0}if(fromIndex<0){fromIndex+=length;if(fromIndex<0){fromIndex=0}}for(;fromIndex<length;fromIndex++){if(arr[fromIndex]===item){return fromIndex}}return -1}};dust.nextTick=(function(){return function(callback){setTimeout(callback,0)}})();dust.isEmpty=function(value){if(dust.isArray(value)&&!value.length){return true}if(value===0){return false}return(!value)};dust.filter=function(string,auto,filters){if(filters){for(var i=0,len=filters.length;i<len;i++){var name=filters[i];if(name==="s"){auto=null}else{if(typeof dust.filters[name]==="function"){string=dust.filters[name](string)}else{dust.log("Invalid filter ["+name+"]",WARN)}}}}if(auto){string=dust.filters[auto](string)}return string};dust.filters={h:function(value){return dust.escapeHtml(value)},j:function(value){return dust.escapeJs(value)},u:encodeURI,uc:encodeURIComponent,js:function(value){if(!JSON){dust.log("JSON is undefined.  JSON stringify has not been used on ["+value+"]",WARN);return value}else{return JSON.stringify(value)}},jp:function(value){if(!JSON){dust.log("JSON is undefined.  JSON parse has not been used on ["+value+"]",WARN);return value}else{return JSON.parse(value)}}};function Context(stack,global,blocks,templateName){this.stack=stack;this.global=global;this.blocks=blocks;this.templateName=templateName}dust.makeBase=function(global){return new Context(new Stack(),global)};Context.wrap=function(context,name){if(context instanceof Context){return context}return new Context(new Stack(context),{},null,name)};Context.prototype.get=function(path,cur){if(typeof path==="string"){if(path[0]==="."){cur=true;path=path.substr(1)}path=path.split(".")}return this._get(cur,path)};Context.prototype._get=function(cur,down){var ctx=this.stack,i=1,value,first,len,ctxThis;first=down[0];len=down.length;if(cur&&len===0){ctxThis=ctx;ctx=ctx.head}else{if(!cur){while(ctx){if(ctx.isObject){ctxThis=ctx.head;value=ctx.head[first];if(value!==undefined){break}}ctx=ctx.tail}if(value!==undefined){ctx=value}else{ctx=this.global?this.global[first]:undefined}}else{if(ctx){if(ctx.head){ctx=ctx.head[first]}else{ctx=undefined}}}while(ctx&&i<len){ctxThis=ctx;ctx=ctx[down[i]];i++}}if(typeof ctx==="function"){var fn=function(){try{return ctx.apply(ctxThis,arguments)}catch(err){return dust.log(err,ERROR)}};fn.isFunction=true;return fn}else{if(ctx===undefined){dust.log("Cannot find the value for reference [{"+down.join(".")+"}] in template ["+this.getTemplateName()+"]")}return ctx}};Context.prototype.getPath=function(cur,down){return this._get(cur,down)};Context.prototype.push=function(head,idx,len){return new Context(new Stack(head,this.stack,idx,len),this.global,this.blocks,this.getTemplateName())};Context.prototype.rebase=function(head){return new Context(new Stack(head),this.global,this.blocks,this.getTemplateName())};Context.prototype.current=function(){return this.stack.head};Context.prototype.getBlock=function(key,chk,ctx){if(typeof key==="function"){var tempChk=new Chunk();key=key(tempChk,this).data.join("")}var blocks=this.blocks;if(!blocks){dust.log("No blocks for context[{"+key+"}] in template ["+this.getTemplateName()+"]",DEBUG);return}var len=blocks.length,fn;while(len--){fn=blocks[len][key];if(fn){return fn}}};Context.prototype.shiftBlocks=function(locals){var blocks=this.blocks,newBlocks;if(locals){if(!blocks){newBlocks=[locals]}else{newBlocks=blocks.concat([locals])}return new Context(this.stack,this.global,newBlocks,this.getTemplateName())}return this};Context.prototype.getTemplateName=function(){return this.templateName};function Stack(head,tail,idx,len){this.tail=tail;this.isObject=head&&typeof head==="object";this.head=head;this.index=idx;this.of=len}function Stub(callback){this.head=new Chunk(this);this.callback=callback;this.out=""}Stub.prototype.flush=function(){var chunk=this.head;while(chunk){if(chunk.flushable){this.out+=chunk.data.join("")}else{if(chunk.error){this.callback(chunk.error);dust.log("Chunk error ["+chunk.error+"] thrown. Ceasing to render this template.",WARN);this.flush=EMPTY_FUNC;return}else{return}}chunk=chunk.next;this.head=chunk}this.callback(null,this.out)};function Stream(){this.head=new Chunk(this)}Stream.prototype.flush=function(){var chunk=this.head;while(chunk){if(chunk.flushable){this.emit("data",chunk.data.join(""))}else{if(chunk.error){this.emit("error",chunk.error);dust.log("Chunk error ["+chunk.error+"] thrown. Ceasing to render this template.",WARN);this.flush=EMPTY_FUNC;return}else{return}}chunk=chunk.next;this.head=chunk}this.emit("end")};Stream.prototype.emit=function(type,data){if(!this.events){dust.log("No events to emit",INFO);return false}var handler=this.events[type];if(!handler){dust.log("Event type ["+type+"] does not exist",WARN);return false}if(typeof handler==="function"){handler(data)}else{if(dust.isArray(handler)){var listeners=handler.slice(0);for(var i=0,l=listeners.length;i<l;i++){listeners[i](data)}}else{dust.log("Event Handler ["+handler+"] is not of a type that is handled by emit",WARN)}}};Stream.prototype.on=function(type,callback){if(!this.events){this.events={}}if(!this.events[type]){dust.log("Event type ["+type+"] does not exist. Using just the specified callback.",WARN);if(callback){this.events[type]=callback}else{dust.log("Callback for type ["+type+"] does not exist. Listener not registered.",WARN)}}else{if(typeof this.events[type]==="function"){this.events[type]=[this.events[type],callback]}else{this.events[type].push(callback)}}return this};Stream.prototype.pipe=function(stream){this.on("data",function(data){try{stream.write(data,"utf8")}catch(err){dust.log(err,ERROR)}}).on("end",function(){try{return stream.end()}catch(err){dust.log(err,ERROR)}}).on("error",function(err){stream.error(err)});return this};function Chunk(root,next,taps){this.root=root;this.next=next;this.data=[];this.flushable=false;this.taps=taps}Chunk.prototype.write=function(data){var taps=this.taps;if(taps){data=taps.go(data)}this.data.push(data);return this};Chunk.prototype.end=function(data){if(data){this.write(data)}this.flushable=true;this.root.flush();return this};Chunk.prototype.map=function(callback){var cursor=new Chunk(this.root,this.next,this.taps),branch=new Chunk(this.root,cursor,this.taps);this.next=branch;this.flushable=true;callback(branch);return cursor};Chunk.prototype.tap=function(tap){var taps=this.taps;if(taps){this.taps=taps.push(tap)}else{this.taps=new Tap(tap)}return this};Chunk.prototype.untap=function(){this.taps=this.taps.tail;return this};Chunk.prototype.render=function(body,context){return body(this,context)};Chunk.prototype.reference=function(elem,context,auto,filters){if(typeof elem==="function"){elem.isFunction=true;elem=elem.apply(context.current(),[this,context,null,{auto:auto,filters:filters}]);if(elem instanceof Chunk){return elem}}if(!dust.isEmpty(elem)){return this.write(dust.filter(elem,auto,filters))}else{return this}};Chunk.prototype.section=function(elem,context,bodies,params){if(typeof elem==="function"){elem=elem.apply(context.current(),[this,context,bodies,params]);if(elem instanceof Chunk){return elem}}var body=bodies.block,skip=bodies["else"];if(params){context=context.push(params)}if(dust.isArray(elem)){if(body){var len=elem.length,chunk=this;if(len>0){if(context.stack.head){context.stack.head["$len"]=len}for(var i=0;i<len;i++){if(context.stack.head){context.stack.head["$idx"]=i}chunk=body(chunk,context.push(elem[i],i,len))}if(context.stack.head){context.stack.head["$idx"]=undefined;context.stack.head["$len"]=undefined}return chunk}else{if(skip){return skip(this,context)}}}}else{if(elem===true){if(body){return body(this,context)}}else{if(elem||elem===0){if(body){return body(this,context.push(elem))}}else{if(skip){return skip(this,context)}}}}dust.log("Not rendering section (#) block in template ["+context.getTemplateName()+"], because above key was not found",DEBUG);return this};Chunk.prototype.exists=function(elem,context,bodies){var body=bodies.block,skip=bodies["else"];if(!dust.isEmpty(elem)){if(body){return body(this,context)}}else{if(skip){return skip(this,context)}}dust.log("Not rendering exists (?) block in template ["+context.getTemplateName()+"], because above key was not found",DEBUG);return this};Chunk.prototype.notexists=function(elem,context,bodies){var body=bodies.block,skip=bodies["else"];if(dust.isEmpty(elem)){if(body){return body(this,context)}}else{if(skip){return skip(this,context)}}dust.log("Not rendering not exists (^) block check in template ["+context.getTemplateName()+"], because above key was found",DEBUG);return this};Chunk.prototype.block=function(elem,context,bodies){var body=bodies.block;if(elem){body=elem}if(body){return body(this,context)}return this};Chunk.prototype.partial=function(elem,context,params){var partialContext;partialContext=dust.makeBase(context.global);partialContext.blocks=context.blocks;if(context.stack&&context.stack.tail){partialContext.stack=context.stack.tail}if(params){partialContext=partialContext.push(params)}if(typeof elem==="string"){partialContext.templateName=elem}partialContext=partialContext.push(context.stack.head);var partialChunk;if(typeof elem==="function"){partialChunk=this.capture(elem,partialContext,function(name,chunk){partialContext.templateName=partialContext.templateName||name;dust.load(name,chunk,partialContext).end()})}else{partialChunk=dust.load(elem,this,partialContext)}return partialChunk};Chunk.prototype.helper=function(name,context,bodies,params){var chunk=this;try{if(dust.helpers[name]){return dust.helpers[name](chunk,context,bodies,params)}else{dust.log("Invalid helper ["+name+"]",WARN);return chunk}}catch(err){dust.log(err,ERROR);return chunk}};Chunk.prototype.capture=function(body,context,callback){return this.map(function(chunk){var stub=new Stub(function(err,out){if(err){chunk.setError(err)}else{callback(out,chunk)}});body(stub.head,context).end()})};Chunk.prototype.setError=function(err){this.error=err;this.root.flush();return this};function Tap(head,tail){this.head=head;this.tail=tail}Tap.prototype.push=function(tap){return new Tap(tap,this)};Tap.prototype.go=function(value){var tap=this;while(tap){value=tap.head(value);tap=tap.tail}return value};var HCHARS=new RegExp(/[&<>\"\']/),AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(s){if(typeof s==="string"){if(!HCHARS.test(s)){return s}return s.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;")}return s};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(s){if(typeof s==="string"){return s.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t")}return s};if(typeof exports==="object"){module.exports=dust}else{root.dust=dust}})((function(){return this})());/* dustjs-helpers - v1.2.0
* https://github.com/linkedin/dustjs-helpers
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */
(function(dust){var _console=(typeof console!=="undefined")&&(typeof IS_DEBUG!=="undefined")&&IS_DEBUG?console:{log:function(){}};function isSelect(context){var value=context.current();return typeof value==="object"&&value.isSelect===true}function jsonFilter(key,value){if(typeof value==="function"){return value.toString().replace(/(^\s+|\s+$)/mg,"").replace(/\n/mg,"").replace(/,\s*/mg,", ").replace(/\)\{/mg,") {")}return value}function filter(chunk,context,bodies,params,filterOp){params=params||{};var body=bodies.block,actualKey,expectedValue,filterOpType=params.filterOpType||"";if(typeof params.key!=="undefined"){actualKey=dust.helpers.tap(params.key,chunk,context)}else{if(isSelect(context)){actualKey=context.current().selectKey;if(context.current().isResolved){filterOp=function(){return false}}}else{_console.log("No key specified for filter in:"+filterOpType+" helper ");return chunk}}expectedValue=dust.helpers.tap(params.value,chunk,context);if(filterOp(coerce(expectedValue,params.type,context),coerce(actualKey,params.type,context))){if(isSelect(context)){context.current().isResolved=true}if(body){return chunk.render(body,context)}else{_console.log("Missing body block in the "+filterOpType+" helper ");return chunk}}else{if(bodies["else"]){return chunk.render(bodies["else"],context)}}return chunk}function coerce(value,type,context){if(value){switch(type||typeof(value)){case"number":return +value;case"string":return String(value);case"boolean":value=(value==="false"?false:value);return Boolean(value);case"date":return new Date(value);case"context":return context.get(value)}}return value}var helpers={tap:function(input,chunk,context){if(typeof input!=="function"){return input}var dustBodyOutput="",returnValue;returnValue=chunk.tap(function(data){dustBodyOutput+=data;return""}).render(input,context);chunk.untap();if(returnValue.constructor!==chunk.constructor){return returnValue}else{if(dustBodyOutput===""){return false}else{return dustBodyOutput}}},sep:function(chunk,context,bodies){var body=bodies.block;if(context.stack.index===context.stack.of-1){return chunk}if(body){return bodies.block(chunk,context)}else{return chunk}},idx:function(chunk,context,bodies){var body=bodies.block;if(body){return bodies.block(chunk,context.push(context.stack.index))}else{return chunk}},contextDump:function(chunk,context,bodies,params){var p=params||{},to=p.to||"output",key=p.key||"current",dump;to=dust.helpers.tap(to,chunk,context);key=dust.helpers.tap(key,chunk,context);if(key==="full"){dump=JSON.stringify(context.stack,jsonFilter,2)}else{dump=JSON.stringify(context.stack.head,jsonFilter,2)}if(to==="console"){_console.log(dump);return chunk}else{return chunk.write(dump)}},"if":function(chunk,context,bodies,params){var body=bodies.block,skip=bodies["else"];if(params&&params.cond){var cond=params.cond;cond=dust.helpers.tap(cond,chunk,context);if(eval(cond)){if(body){return chunk.render(bodies.block,context)}else{_console.log("Missing body block in the if helper!");return chunk}}if(skip){return chunk.render(bodies["else"],context)}}else{_console.log("No condition given in the if helper!")}return chunk},math:function(chunk,context,bodies,params){if(params&&typeof params.key!=="undefined"&&params.method){var key=params.key,method=params.method,operand=params.operand,round=params.round,mathOut=null,operError=function(){_console.log("operand is required for this math method");return null};key=dust.helpers.tap(key,chunk,context);operand=dust.helpers.tap(operand,chunk,context);switch(method){case"mod":if(operand===0||operand===-0){_console.log("operand for divide operation is 0/-0: expect Nan!")}mathOut=parseFloat(key)%parseFloat(operand);break;case"add":mathOut=parseFloat(key)+parseFloat(operand);break;case"subtract":mathOut=parseFloat(key)-parseFloat(operand);break;case"multiply":mathOut=parseFloat(key)*parseFloat(operand);break;case"divide":if(operand===0||operand===-0){_console.log("operand for divide operation is 0/-0: expect Nan/Infinity!")}mathOut=parseFloat(key)/parseFloat(operand);break;case"ceil":mathOut=Math.ceil(parseFloat(key));break;case"floor":mathOut=Math.floor(parseFloat(key));break;case"round":mathOut=Math.round(parseFloat(key));break;case"abs":mathOut=Math.abs(parseFloat(key));break;default:_console.log("method passed is not supported")}if(mathOut!==null){if(round){mathOut=Math.round(mathOut)}if(bodies&&bodies.block){return chunk.render(bodies.block,context.push({isSelect:true,isResolved:false,selectKey:mathOut}))}else{return chunk.write(mathOut)}}else{return chunk}}else{_console.log("Key is a required parameter for math helper along with method/operand!")}return chunk},select:function(chunk,context,bodies,params){var body=bodies.block;if(params&&typeof params.key!=="undefined"){var key=dust.helpers.tap(params.key,chunk,context);if(body){return chunk.render(bodies.block,context.push({isSelect:true,isResolved:false,selectKey:key}))}else{_console.log("Missing body block in the select helper ");return chunk}}else{_console.log("No key given in the select helper!")}return chunk},eq:function(chunk,context,bodies,params){if(params){params.filterOpType="eq"}return filter(chunk,context,bodies,params,function(expected,actual){return actual===expected})},ne:function(chunk,context,bodies,params){if(params){params.filterOpType="ne";return filter(chunk,context,bodies,params,function(expected,actual){return actual!==expected})}return chunk},lt:function(chunk,context,bodies,params){if(params){params.filterOpType="lt";return filter(chunk,context,bodies,params,function(expected,actual){return actual<expected})}},lte:function(chunk,context,bodies,params){if(params){params.filterOpType="lte";return filter(chunk,context,bodies,params,function(expected,actual){return actual<=expected})}return chunk},gt:function(chunk,context,bodies,params){if(params){params.filterOpType="gt";return filter(chunk,context,bodies,params,function(expected,actual){return actual>expected})}return chunk},gte:function(chunk,context,bodies,params){if(params){params.filterOpType="gte";return filter(chunk,context,bodies,params,function(expected,actual){return actual>=expected})}return chunk},"default":function(chunk,context,bodies,params){if(params){params.filterOpType="default"}return filter(chunk,context,bodies,params,function(expected,actual){return true})},size:function(chunk,context,bodies,params){var key,value=0,nr,k;params=params||{};key=params.key;if(!key||key===true){value=0}else{if(dust.isArray(key)){value=key.length}else{if(!isNaN(parseFloat(key))&&isFinite(key)){value=key}else{if(typeof key==="object"){nr=0;for(k in key){if(Object.hasOwnProperty.call(key,k)){nr++}}value=nr}else{value=(key+"").length}}}}return chunk.write(value)},dchoice:function(chunk,context,bodies,params){var choiceVar,value,cMod10,cMod100,locale=context.global.LOCALE;params=params||{};if(isNaN(parseInt(params.key),10)){_console.log("Choice variable not a number.");return chunk.write("")}choiceVar=Math.abs(params.key);cMod10=choiceVar%10;cMod100=choiceVar%100;if(locale==="ru"){if(cMod100!==11&&cMod10===1){value=params.arg0}else{if(cMod10>=2&&cMod10<=4&&(cMod100<=10||cMod100>=20)){value=params.arg1}else{value=params.arg2}}}else{if(locale==="cs"||locale==="sk"){if(choiceVar===1){value=params.arg0}else{if(choiceVar>=2&&choiceVar<=4){value=params.arg1}else{value=params.arg2}}}else{if(locale==="sr"||locale==="uk"){if(choiceVar>=11&&choiceVar<=14){value=params.arg2}else{if(cMod10===1){value=params.arg0}else{if(cMod10>=2&&cMod10<=4){value=params.arg1}else{value=params.arg2}}}}else{_console.log("Invalid dchoice locale: "+locale+". This should have been caught earlier.");value=""}}}return chunk.write(value)},dchoice2:function(chunk,context,bodies,params){var choiceVar,value;params=params||{};if(isNaN(parseInt(params.key),10)){_console.log("Choice variable not a number.");return chunk.write("")}choiceVar=Math.abs(params.key);if(choiceVar%100!==11&&(choiceVar%100)%10===1){value=params.arg0}else{value=params.arg1}return chunk.write(value)}};dust.helpers=helpers})(dust);(function(g){var i=/^ *(\w+) +in +([$_a-zA-Z][.$_\w]*)/;var k=/^\//;var c=/^[a-zA-Z:]*\/\//;var f=/ctx\.(?:get\("(.*?)"\)|getPath\(false,\["(.*?)"\]\)),ctx,"h"(?:,\["(.*?)"\])?/;var n=/","/g;var b=/^\s|\s(?=\s|$)/g;var o=g.helpers["if"].bind(g.helpers);var l=g.helpers.eq.bind(g.helpers);var m=g.helpers.select.bind(g.helpers);var q=g.helpers.math.bind(g.helpers);var j=g.helpers.tap.bind(g.helpers);function p(r){return r===~~r}function a(s){if(typeof s!="function"){return s}s=s.toString();var r="";var u=/(?:reference\((.*?)\)|write\("(.*?)"\))[.;]/g;var t;var v;while(!!(t=u.exec(s))){if(t[1]){v=t[1].match(f);if(v){if(v[1]){r+=" {"+v[1]}else{if(v[2]){r+=" {"+v[2].replace(n,".")}}if(v[3]){r+="|"+v[3].replace(n,"|")}r+="} "}}else{if(t[2]){r+=t[2]}}}return r.replace(b,"")}function e(t,r){var s=r.split(".");while(t&&s.length>0){t=t[s.shift()]}return t}function d(s,r){if(s){if(!k.test(s)){s="/"+s}if(!s.match(c)){s=r.global.CDN_HOST+s}}return s}function h(s){var t=ta.retrieve&&ta.retrieve("BOOKING_FEATURES"),r=t&&(t.indexOf(s.trim().toUpperCase())>=0);if(!r){r=!!(ta.has&&ta.has("feature."+s))||!!(ta.retrieve&&ta.retrieve(s+".feature"))||!!(ta.m&&ta.m.feature&&ta.m.feature.enabled(s))}return r}if(typeof console=="undefined"){console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}}}g.helpers["if"]=function(s,t,r,v){try{return o(s,t,r,v)}catch(u){console.error("Error in @if statement: "+u.name+": "+u.message+".",'Condition "'+a(v.cond)+'"','evaluated to "'+j(v.cond,s,t)+'".');return s}};g.helpers.select=function(s,u,r,v){var t=j(v.key,s,u);if(t==0){if(t==="0"){v.key=0}}else{if(t==+t){v.key=+t}}return m(s,u,r,v)};g.helpers.math=function(s,t,r,v){var u=t.current();if(v.inherit){v[v.inherit]=typeof u.selectKey!=="undefined"?u.selectKey:u._dustFilterOptions.selectKey}return q(s,t,r,v)};g.helpers.eq=function(s,u,r,w){var t=j(w.key,s,u);var v=j(w.value,s,u);if(t==+t){w.key=+t}if(v==+v){w.value=+v}return l(s,u,r,w)};g.helpers.contains=function(s,t,r,v){if(!(v.collection&&v.collection.indexOf)){console.error("@contains helper requires a valid 'collection' parameter");return s}var u=j(v.value,s,t);if(typeof u=="undefined"){console.error("@contains requires a 'value' parameter");return s}if(~v.collection.indexOf(u)){return r.block(s,t)}return r["else"]?r["else"](s,t):s};g.helpers.range=function(A,s,r,v){var u=+j(v.begin,A,s);if(!p(u)){u=0}var w=+j(v.end,A,s);if(!p(w)){console.error("@range requires an integral 'end' parameter")}var t=+j(v.step,A,s);if(!p(t)){t=(w-u)/Math.abs(w-u)}var x=t>0;try{for(var y=u;x?y<w:y>w;y=y+t){s.stack.head.$val=y;A=r.block(A,s)}}catch(z){console.error("Error in @range block",z.message)}delete s.stack.head.$val;return A};g.helpers.truncate=function(s,t,r,x){var w=g.escapeHtml(j(x.value,s,t))||"";var u=j(x.length,s,t)||100;var v=w.length<=u?w:(w.slice(0,u-3).replace(/(?:\s*\&\S*|\s+)$/,"")+"...");return s.write(v)};g.helpers.localizeInt=function(s,u,r,y){var w=j(y.val,s,u)||0;var v=w.toString().split("");if(v.length>3){v.reverse();if(u.global.LOCALE=="en_IN"){w="";var x=",";for(var t=0;t<v.length;t++){w=v[t]+w;if(t<v.length-1){if(t>=3&&((t-3)%2==1)){w=x+w}else{if(t<3&&t%3==2){w=x+w}}}}}else{w="";var x=",";if(u.global.LOCALE=="de"||u.global.LOCALE=="it"||u.global.LOCALE=="nl"||u.global.LOCALE=="br"||u.global.LOCALE=="es"||u.global.LOCALE=="es_AR"||u.global.LOCALE=="es_CL"||u.global.LOCALE=="es_CO"||u.global.LOCALE=="es_VE"||u.global.LOCALE=="fr_BE"||u.global.LOCALE=="pt_BR"||u.global.LOCALE=="nl_BE"||u.global.LOCALE=="tr"||u.global.LOCALE=="da"||u.global.LOCALE=="el"||u.global.LOCALE=="id"||u.global.LOCALE=="vi"||u.global.LOCALE=="sr"){x="."}else{if(u.global.LOCALE=="fr"||u.global.LOCALE=="pl"||u.global.LOCALE=="en_ZA"||u.global.LOCALE=="de_AT"||u.global.LOCALE=="fr_CA"||u.global.LOCALE=="fr_CH"||u.global.LOCALE=="pt_PT"||u.global.LOCALE=="no"||u.global.LOCALE=="nb"||u.global.LOCALE=="ru"||u.global.LOCALE=="hu"||u.global.LOCALE=="sk"||u.global.LOCALE=="uk"||u.global.LOCALE=="cs"||u.global.LOCALE=="fi"||u.global.LOCALE=="in"){x=" "}else{if(u.global.LOCALE=="it_CH"||u.global.LOCALE=="de_CH"){x="'"}}}for(var t=0;t<v.length;t++){w=v[t]+w;if(t%3==2&&t<v.length-1){w=x+w}}}}return s.write(w)};g.helpers.quotes=function(v,w,t,x){x=x||{};var u=j(x.italics,v,w)||"";var r=w.global.IS_RTL?"&#x201d;":"&#x201c;";var s=w.global.IS_RTL?"&#x201c;":"&#x201d;";if(u=="true"){r="<i>"+r+"</i>";s="<i>"+s+"</i>"}v.write(r);v=t.block(v,w);return v.write(s)};g.helpers.fbPic=function(s,u,r,v){var w=j(v.id,s,u);var t=j(v.size,s,u);s.write("<img ");if(w){s.write('src="//graph.facebook.com/'+w+"/picture?type=square");if(t){s.write("&width="+t+"&height="+t)}s.write('" ')}s=r.block(s,u);return s.write("/>")};g.helpers.img=function(s,t,r,v){var u=d(j(v.src,s,t),t);s.write("<img ");if(u){s.write('src="'+u+'" ')}if(r.block){s=r.block(s,t)}return s.write("/>")};g.helpers.imgUrl=function(s,t,r,v){var u=d(j(v.src,s,t),t);if(u){s.write(u)}if(r.block){s=r.block(s,t)}return s};g.helpers.fittedImg=function(C,w,t,z){var s=j(z.src,C,w);var y=j(z.height,C,w);var v=j(z.width,C,w);var u=s.url;var B=s.height;var A=s.width;var r="";var D="";var x;if(A==0||B==0){r='style= "width:'+v+"px; height: "+y+'px;" '}else{if(y/B<v/A){x=v/A;B=Math.floor(B*x);A=v;D=Math.floor((B-y)/2)*-1;r='style= "width:'+A+"px; height: "+B+"px; margin-top: "+D+'px;" '}else{x=y/B;A=Math.floor(A*x);B=y;D=Math.floor((A-v)/2)*-1;r='style= "width: '+A+"px; height: "+B+"px; margin-left: "+D+'px; "'}}C.write('<div style="height:'+y+"px; width:"+v+'px; overflow: hidden;" >');if(u){C.write('<img src="'+u+'" '+r+"/>")}C=t.block(C,w);return C.write("</div>")};g.helpers.lazyimg=function(t,u,s,w){var r=j(w["class"],t,u);var v=j(w.src,t,u);t.write('<img class="lazy '+(r?r:"")+'" ');if(v){if(typeof window=="undefined"){t.write('data-src="'+v+'" ')}else{t.write('src="'+v+'" ')}}t=s.block(t,u);return t.write("/>")};g.helpers.avatarWithFBOverlay=function(u,v,s,w){var t=j(w.avatar,u,v);var x=j(w.id,u,v);var r=j(w["class"],u,v);u.write('<div class="avatar-with-overlay '+r+'" ');if(t){u.write('style="background-image: url('+t+')">')}else{u.write('style="background-image: url(//graph.facebook.com/'+x+'/picture?type=square)">')}u.write('<img src="'+v.global.CDN_HOST+'/img2/social/social_on_mobile/fb_icon_20x20.png" ');u.write('class="overlay" />');return u.write("</div>")};g.helpers.avatar=function(u,v,s,w){var t=j(w.avatar,u,v);var x=j(w.id,u,v);var r=j(w["class"],u,v);u.write('<div class="avatar '+r+'" ');if(t){u.write('style="background-image: url('+t+')">')}else{u.write('style="background-image: url(//graph.facebook.com/'+x+'/picture?type=square)">')}return u.write("</div>")};g.helpers.pos=function(t,u,r,v){var s=v&&v.start!=null?v.start:1;if(u.stack){u.stack.head.$pos=u.stack.index+s}if(r&&r.block){t=r.block(t,u)}return t};g.helpers.bubbleRating=function(u,v,t,x){var w=g.helpers.tap(x.value,u,v);var y=g.helpers.tap(x.ratingType,u,v)||"ss";var r=w?(w.toString().length==1?w.toString()+"0":w*10):null;var s=g.helpers.tap(x["class"],u,v);w=+w;u.write('<div class="rate rate_'+y+" "+y+r+" "+(s?s:"")+'">');u.write("<img ");u.write('src="'+v.global.CDN_HOST+'/img2/sprites/ratings-v6.png" ');u.write('class="sprite-ratings" property="v:rating" alt="');u.write(w+' of 5 stars" content="'+w+'" />');return u.write("</div>")};g.helpers.bubbleRatingSvg=function(s,t,r,w){var v=g.helpers.tap(w.value,s,t);var x=+g.helpers.tap(w.multiplier,s,t)||20;var u=v*x;u=u<0?0:u>100?100:u;s.write('<div class="svgico bubblesempty">');s.write('<div class="bubbles" style="width:'+u+'%;"><div class="svgico bubblesfull"></div></div>');return s.write("</div>")};g.helpers.removeNonDigits=function(s,t,r,v){var u=j(v.value,s,t);return s.write(u.replace(/[^0-9]/g,""))};g.helpers.digitize=function(x,s,r,u){var z=+j(u.value,x,s);var w=+j(u.padding,x,s);var t=p(z)?z.toString().split(""):[];if(!p(w)){w=0}var y=w-t.length;if(y>0){while(y--){t.unshift("0")}}for(var v=0;v<t.length;v++){x=r.block(x,g.makeBase({digit:t[v]}))}return x};g.helpers.oxEach=function(x,r,w,E){if(r.stack.tail&&!(r.stack.head&&r.stack.head.__ox__)){console.error("Cannot call @oxEach within a section block");return x}var H=j(E.context,x,r);var v=H.match(i);var C=v[1];var z=v[2].split(".");var y=r.get(z[0]);var B;for(B=1;y&&B<z.length;B++){y=y[z[B]]}if(!y){return x}var I=j(E.name,x,r)||("each"+C.charAt(0).toUpperCase()+C.slice(1));var u="begin" in E||"end" in E;var F=+j(E.begin,x,r);if(!p(F)||F<0){F=0}var s=+j(E.end);s=isNaN(s)?null:s;if(s!=null&&(!p(s)||s<F)){console.error("Invalid @oxEach end index in collection"+z);s=null}var t=y.__offset__||0;x.write('<!-- @oxEach name="'+I+'" context="'+H+'"');if(u){x.write(' begin="'+F+'"');if(s!=null){x.write(' end="'+s+'"')}}x.write(" -->\n");F=F-t;if(s!=null){s=Math.min(s-t,y.length)}else{s=y.length}for(B=F;B<s;B++){var D=y[B];if(!D){console.error("@oxEach requires non-null items in collection "+z);break}var G={};for(var A in r.stack.head){G[A]=r.stack.head[A]}G[C]=D;G.$idx=B+t;G.$idx1=G.$idx+1;G.__ox__=true;G=r.rebase(G);x=w.block(x,G)}x.write("<!-- /oxEach -->\n");return x};g.helpers.oxContains=function(s,u,r,x){if(!(x.collection&&x.collection.indexOf)){console.error("@oxContains helper requires a valid 'collection' parameter");return s}var t=j(x.key,s,u);if(typeof t=="undefined"){console.error("@oxContains requires a 'key' parameter");return s}var w=j(x.value,s,u);if(typeof w=="undefined"){console.error("@oxContains requires a 'value' parameter");return s}var v=function(y){return y!=null&&e(y,t)==w};if(x.collection.filter(v).length>0){return r.block(s,u)}return r["else"]?r["else"](s,u):s};g.helpers.ifChanged=function(t,v,s,x){var w=x.collection;if(!(w&&w.indexOf)){console.error("@ifChanged helper requires a valid 'collection' parameter");return t}var u=j(x.key,t,v);if(typeof u=="undefined"){console.error("@ifChanged requires a valid 'key' parameter");return t}var r=+j(x.idx,t,v);if(!p(r)){console.error("@ifChanged requires a valid 'idx' parameter");return t}if(r<1||e(w[r],u)!=e(w[r-1],u)){return s.block(t,v)}return s["else"]?s["else"](t,v):t};g.helpers.oxSection=function(w,s,r,u){var t=j(u.namespace,w,s);var v=j(u.nsid,w,s);var z=j(u.tag,w,s)||"div";if(typeof t==="undefined"){console.error("@oxSection requires a valid 'namespace' parameter");return w}w.write("<"+z+' data-ox-section-name="'+t+'"');if(typeof v!=="undefined"){w.write(' data-ox-section-id="'+v+'"')}for(var y in u){if(y==="namespace"||y==="nsid"||y==="tag"){continue}var x=j(u[y],w,s);if(typeof y==="undefined"||typeof x==="undefined"){console.error("@oxSection key or value is undefined: "+y);continue}w.write(" "+y+'="'+x+'"')}w.write(" />\n");w=r.block(w,s);w.write("</"+z+">\n");return w};g.helpers.substr=function(A,B,r,v){var z=g.escapeHtml(g.helpers.tap(v.str,A,B))||"",s=g.helpers.tap(v.begin,A,B)||0,w=g.helpers.tap(v.end,A,B)||z.length,x=g.helpers.tap(v.len,A,B)||z.length,t=g.helpers.tap(v.underflow,A,B)||"",u=g.helpers.tap(v.overflow,A,B)||"";var y=(s==0?"":t)+(x<w-s?z.substr(s,x)+u:z.slice(s,w));return A.write(y)};g.helpers.increment=function(s,u,r,w){var v=+j(w.base,s,u);var t=+j(w.addon,s,u);if(!p(v)){v=0}if(!p(t)){t=0}u.stack.head.$increment_val=v+t;s=r.block(s,u);delete u.stack.head.$increment_val;return s};g.helpers.feature=function(v,w,s,x){var u=j(x.name,v,w),t=x.hasOwnProperty("enabled")?j(x.enabled,v,w):true;if((typeof u=="undefined")||!u||!u.trim()){console.error("@feature requires a 'name' parameter");return v}u=u.trim();if(t){t=t.toString().trim()!=="false"}var r=h(u);if(r===t){return s.block(v,w)}return s["else"]?s["else"](v,w):v};g.helpers.localizeShowKeyOnHover=function(t,v,r,w){var s=h("DUST_LOCALIZE_SHOW_KEY_ON_HOVER");if(s){var u=j(w.key,t,v);t.write('<span class="ta-localized" title="');if(u){t.write(u)}t.write('">')}if(r.block){t=r.block(t,v)}if(s){t.write("</span>")}return t}}(dust));(function(a){a.helpers.iterate=function(o,d,b,f){var m=b.block,h,l,j,e,g,c;f=f||{};function n(k,i){if(k<i){return 1}else{if(k>i){return -1}}return 0}function p(i,k){return m(o,d.push({$key:i,$value:k,$type:typeof k}))}if(f.key){g=a.helpers.tap(f.key,o,d);if(m){if(!!f.sort){h=a.helpers.tap(f.sort,o,d);l=[];for(e in g){if(g.hasOwnProperty(e)){l.push(e)}}c=d.global[h];if(!c&&h==="desc"){c=n}if(c){l.sort(c)}else{l.sort()}for(j=0;j<l.length;j++){o=p(l[j],g[l[j]])}}else{for(e in g){if(g.hasOwnProperty(e)){o=p(e,g[e])}}}}else{_console.log("Missing body block in the iter helper.")}}else{_console.log("Missing parameter 'key' in the iter helper.")}return o}})(typeof exports!=="undefined"?module.exports=require("dustjs-linkedin"):dust);(function(h){var r=h.helpers.tap.bind(h.helpers),q="__ttParentContext",t="dustTree",g="\\",n="/",a=/^([A-Z]{1,2}:)?[\\$-.\a-zA-Z_0-9|]+$/,l=/\\+$/,b=function(u){return u.global.__treeString},e=function(u){return u.global.__incrementingCounters},s=function(v,u,w){if(!v.global.__incrementingCounters){v.global.__incrementingCounters={}}v.global.__incrementingCounters[u]=w},k=function(v){var u=v.global.__treeString;v.global.__treeString=null;v.global.__incrementingCounters={};return u},j=function(v){var u=b(v),w=v.global[q];if(u!=null){return}u=v.global.__treeString=[];v.global.__incrementingCounters={};if((typeof w==="string"||w instanceof String)&&w.length>0){if(w[w.length-1]===g){u.push(w.substring(0,w.length-1));u.push(g)}else{u.push(w)}}},m=function(v,w,u){if(u&&u.block){v=u.block(v,w)}return v},p=function(v,u,w){if(u&&u.block&&v){v.write(w)}},f=function(y,w,x,v){var u=b(x),z=u.length;if(z===0||u[z-1]===g){u.push(y)}else{u.push(n);u.push(y)}p(w,v,"<!--trk"+y+"-->")},c=function(v,w,u){b(w).push(g);p(v,u,"<!--etk-->")},o=function(y,v,w,u){var x=d(y);j(w);if(x){f(y,v,w,u)}v=m(v,w,u);if(x){c(v,w,u)}return v},i=function(v){var u=b(v);return u?u.join(""):""},d=function(u){return(typeof u==="string"||u instanceof String)&&a.test(u)};h.helpers.track=function(v,w,u,z){try{var A=r(z&&z.noTrack,v,w);if(A){v=m(v,w,u);return v}var y=r(z&&z.name,v,w);return o(y,v,w,u)}catch(x){console.error(x)}};h.helpers.trackTree=function(w,y,v,B){var A,x=r(B&&B.name,w,y),u=k(y),z=t;j(y);w=m(w,y,v);A=i(y);if(w&&w.write){if(x){z=z+" "+x}w.write("<div class='"+z+"' data-tree='"+A+"'></div>")}y.global.__treeString=u;return w};h.helpers.trackWithIncrementingValue=function(C,v,u,w){var B,A,y=r(w&&w.name,C,v),x=w.hasOwnProperty("offset")&&w.offset?r(w.offset,C,v):1,z=window.ta&&ta.retrieve&&ta.store?ta.retrieve("dust.continue_inc_track"):null;if(y&&y.indexOf(":")<0){B=e(v);if(!B){if(v&&v.global&&v.global.DEBUG){console.warn("trackWithIncrementingValue outside of a @trackTree context.")}}if(!B||!B[y]){if(z&&z[y]){A=z[y]+1}else{A=x}}else{A=B[y]+1}s(v,y,A);y=y+":"+A;if(z){ta.store("dust.continue_inc_track",B)}}return o(y,C,v,u)};h.tracking={TREE_CLASS:t,setParentTree:function(v,u){if(u&&u.global){u.global[q]=v}},cleanTree:function(u){return u?u.replace(l,""):u}}}(dust));(function(g,f,h){var a=null,e=function(){if(a!=null){return a}try{a=JSON.parse(ta.retrieve("dustGlobalContext"));return a}catch(i){}return{}},c=function(k,m,i,o){var l=e(),n=g.find(i),j=f.makeBase(l).rebase(m);if(!n||!k||!l.LOCALE||!f){return false}f.render(b(k),j,function(q,p){if(p){n.innerHTML=p}else{if(q){ta.util.error.record(q,"Error rendering dust template "+k)}}if(o){o(m)}});return true},d=function(k,m){var l=e(),i=f.makeBase(l).rebase(m),j=ta.util.Deferred(true);if(!k||!l.LOCALE||!f){j.reject("Missing dependencies");return j.promise()}f.render(b(k),i,function(o,n){if(n){j.resolve(n)}else{if(o){ta.util.error.record(o,"Error rendering dust template "+k);j.reject(o)}}});return j.promise()},b=function(i){var j=i.replace(/\//g,"_").replace(".dust",""),k=e().LOCALE;return k+j};g.dust={render:c,renderToString:d}})(ta,dust);define("popunder/utils",[],function(){function b(){return{height:window.outerHeight||document.documentElement.clientHeight,width:window.outerWidth||document.documentElement.clientWidth,left:window.screenLeft||window.screenX||0,top:window.screenTop||window.screenY||0}}function c(){var e=(ta.page&&ta.page.hasDates&&ta.page.hasDates("STAYDATES"))||(ta.widgets&&ta.widgets.calendar&&ta.widgets.calendar.hasPageDates());if(ta.ab&&ta.ab.roomlist&&ta.ab.roomlist.getData){var f=ta.ab.roomlist.getData();if(f&&f.summary){e=!!(f.summary.checkin&&f.summary.checkOut)}}return e}function a(){var e=window.modelGeoId;var g=window.modelLocId;if(ta.ab&&ta.ab.roomlist&&ta.ab.roomlist.getData){var f=ta.ab.roomlist.getData();if(f&&f.summary){e=f.summary.geoId;g=f.summary.locationId}}return{geoId:e,locId:g}}function d(f){var e=Array.prototype.slice.call(arguments,1);return f?ta.util.merge.apply(null,e):e[0]}return{getWindowInfo:b,isDated:c,getLocationModel:a,mergeIfTrue:d}});define("mixins/mixin",[],function(){return function(d){var b=Array.prototype.slice.call(arguments,1),a,e;for(var c in b){if(!b.hasOwnProperty(c)){continue}a=b[c];for(e in a){d[e]=a[e]}}return d}});define("mixins/Events",["ta"],function(b){var a=function(){this.events={};Array.prototype.slice.call(arguments).forEach(function(c){this.events[c]=[]},this)};a.create=(function(){function c(d){return a.apply(this,d)}c.prototype=a.prototype;return function(){return new c(arguments)}}());a.extend=function(d,e){var c=Object.create(a.prototype);c.delegate=d;a.apply(c,e);return c};a.prototype.on=a.prototype.addListener=function(d,c){if(this.events[d]!==undefined){this.events[d].push(c)}else{if(this.delegate){this.delegate.on(d,c)}else{this.events[d]=[c]}}return this};a.prototype.off=a.prototype.removeListener=function(e,d){if(this.events[e]!==undefined){if(d){var c=this.events[e].indexOf(d);if(c>=0){this.events[e].splice(c,1)}}else{this.events[e].length=0}}else{if(this.delegate){this.delegate.removeListener(e,d)}}return this};a.prototype.removeAllListeners=function(d){if(d&&this.events[d]!==undefined){this.events[d].length=0}else{if(!d){for(var c in this.events){if(this.events.hasOwnProperty(c)){this.events[c].length=0}}if(this.delegate&&this.delegate.removeAllListeners){this.delegate.removeAllListeners()}}else{if(this.delegate&&this.delegate.removeAllListeners){this.delegate.removeAllListeners(d)}}}};a.prototype.hasListeners=function(c){if(c){if(this.events.hasOwnProperty(c)){return this.events[c].length>0}if(this.delegate&&this.delegate.hasListeners){return this.delegate.hasListeners(c)}}return false};a.prototype.emit=function(d){if(this.events[d]){var c=Array.prototype.slice.call(arguments,1);this.events[d].forEach(function(e){if(e){try{e.apply(this,c)}catch(f){if(typeof f==="string"){f=new Error(f)}if(typeof(b)==="object"&&b&&b.util&&b.util.error&&b.util.error.record){b.util.error.record(f,"Error in event handler for "+d)}else{if(typeof(b)==="object"&&b&&b.log&&b.log.error){b.log.error(f,"Error in event handler for "+d)}else{if(typeof(b)==="object"&&b&&b.m&&b.m.recordJSError){b.m.recordJSError([f,"Error in event handler for "+d])}else{if(console.error){console.error("Error in event handler for "+d,f)}else{console.log("Error in event handler for "+d)}}}}}}},this)}else{if(this.delegate&&this.delegate.emit){this.delegate.emit.apply(delegate,arguments)}}return this};return a});define("popunder/context/base-context",["mixins/mixin","mixins/Events","popunder/utils"],function(b,a,d){var c=function(e){return b(this,new a("activate"),e)};c.prototype={init:function(){},isActive:function(){return true},generateUrl:function(){return"/PricefinderPopunder?content=PCB"},generateModel:function(){return{hasDates:d.isDated()}},servletName:"PricefinderPopunder?PCB"};return c});define("popunder/context/default",["popunder/context/base-context"],function(a){return new a({isActive:function(){return ta&&ta.localStorage&&ta.localStorage.enabled},generateUrl:function(b){return"/CpmForward"},servletName:"CpmForward"})});define("popunder/context/attraction-review",["popunder/context/base-context","popunder/utils"],function(b,a){return new b({isActive:function(){return window.pageServlet==="Attraction_Review"},generateUrl:function(c){return"/SmartDeals-g"+c.geoId+"-d"+c.locId},generateModel:function(){return a.mergeIfTrue(this.isActive(),b.prototype.generateModel(),a.getLocationModel())},servletName:"HotelsNearSD"})});define("popunder/context/geo-hotels",["popunder/context/base-context","popunder/utils"],function(b,a){return new b({isActive:function(){return window.pageServlet==="Hotels"},generateUrl:function(c){return"/SmartDeals-g"+c.geoId},generateModel:function(){return a.mergeIfTrue(this.isActive(),b.prototype.generateModel(),a.getLocationModel())},servletName:"SmartDeals"})});define("popunder/context/hotel-detail",["popunder/context/base-context","popunder/utils"],function(b,a){return new b({isActive:function(){return window.pageServlet==="Hotel_Review"},generateUrl:function(c){return"/Hotel_Review-s1-g"+c.geoId+"-d"+c.locId},generateModel:function(){return a.mergeIfTrue(this.isActive(),b.prototype.generateModel(),a.getLocationModel())},servletName:"HotelHighlight"})});define("popunder/context/ib-booker",["ta","popunder/context/base-context","popunder/utils"],function(a,d,c){var b=false;return new d({init:function(){var e=this;a.on("bookingSuccess",function(){b=true;e.emit("activate")})},isActive:function(){return b},generateModel:function(){return c.mergeIfTrue(this.isActive(),d.prototype.generateModel(),c.getLocationModel())},generateUrl:function(e){return"/PricefinderPopunder?content=ATTRACTIONS_XSELL&detail="+e.locId},servletName:"Attractions_Xsell"})});define("popunder/context/ib-abandoner",["ta","popunder/context/base-context","popunder/utils"],function(a,d,c){var b=false;return new d({init:function(){var e=this;a.on("ibRoomsAvailable",function(f){a.addEvent(window,"beforeunload",function(){b=true;e.emit("activate",{dak:f.detailedAvailabilityKey})})})},isActive:function(){return b},generateModel:function(){return c.mergeIfTrue(this.isActive(),d.prototype.generateModel(),c.getLocationModel())},generateUrl:function(e){return"/PricefinderPopunder?content=ROOMS_LIST&geo="+e.geoId+"&detail="+e.locId+"&dak="+e.dak},servletName:"Rooms_List"})});define("popunder/context/meta-clicker",["ta","popunder/context/base-context","popunder/utils"],function(a,d,c){var b=false;return new d({init:function(){var e=this;a.addEvent(window,"metaLinkClick",function(i,k,g,j){if(a.hasClass(i,"bookableOffer")){return}var h=!!a.find(".bookableOffer[data-locationid="+j+"]");var f=!!a.find('[data-locationid="'+j+'"][data-navarea-availability="Available"]');if(!h&&f){b=true;e.emit("activate",{locId:j})}})},isActive:function(){return b},generateModel:function(){return c.mergeIfTrue(this.isActive(),d.prototype.generateModel(),c.getLocationModel())},generateUrl:function(e){return"/PricefinderPopunder?content=META_XSELL&detail="+e.locId+"&geo="+e.locId},servletName:"Meta_Xsell"})});define("popunder/context/ib-skipper",["ta","popunder/context/base-context","popunder/utils"],function(a,d,c){var b=false;return new d({init:function(){var e=this;a.addEvent(window,"metaLinkClick",function(i,k,g,j){if(a.hasClass(i,"bookableOffer")){return}var h=!!a.find(".bookableOffer[data-locationid="+j+"]");var f=!!a.find('[data-locationid="'+j+'"][data-navarea-availability="Available"]');if(h&&f){b=true;e.emit("activate",{locId:j})}})},isActive:function(){return b},generateModel:function(){return c.mergeIfTrue(this.isActive(),d.prototype.generateModel(),c.getLocationModel())},generateUrl:function(e){return"/PricefinderPopunder?content=META_XSELL&detail="+e.locId+"&geo="+e.locId},servletName:"Meta_Xsell"})});define("popunder/context/ib-abandoner-survey",["ta","popunder/context/base-context","popunder/utils"],function(a,d,c){var b=false;return new d({init:function(){var e=this;if(window.pageServlet==="HotelBookingRoomSelectionHtml"){a.addEvent(window,"beforeunload",function(){b=true;e.emit("activate")})}},isActive:function(){return b},generateModel:function(){return c.mergeIfTrue(this.isActive(),d.prototype.generateModel(),c.getLocationModel())},generateUrl:function(e){return"/PricefinderPopunder?content=BOOKING_SURVEY"}})});define("popunder/context/flights",["ta","popunder/context/base-context","popunder/utils"],function(a,c,b){return new c({isActive:function(){return window.pageServlet==="CheapFlightsSearchResults"&&a.retrieve("flights.suppressExitUnit")!==true},generateModel:function(){return b.mergeIfTrue(this.isActive(),c.prototype.generateModel(),{customParams:a.retrieve("flights.exitUnitParams")})},generateUrl:function(d){return"/FlightsExitUnit?"+d.customParams},servletName:"FlightsExitUnit"})});define("popunder/context/smarter_travel",["popunder/context/base-context","popunder/utils"],function(b,a){return new b({isActive:function(){return(window.pageServlet==="Hotels"||window.pageServlet==="Hotel_Review")&&a.isDated()},generateModel:function(){return a.mergeIfTrue(this.isActive(),b.prototype.generateModel(),a.getLocationModel())},generateUrl:function(c){return"/PricefinderPopunder?content=SMARTER_TRAVEL&g="+c.geoId},servletName:"SmarterTravelLander"})});define("popunder/context-store",["popunder/context/base-context","popunder/context/default","popunder/context/attraction-review","popunder/context/geo-hotels","popunder/context/hotel-detail","popunder/context/ib-booker","popunder/context/ib-abandoner","popunder/context/meta-clicker","popunder/context/ib-skipper","popunder/context/ib-abandoner-survey","popunder/context/flights","popunder/context/smarter_travel"],function(l,h,i,f,a,g,b,j,e,c,d,k){return{ATTRACTION_REVIEW:i,DEFAULT:h,FALLBACK:new l(),GEO_HOTELS:f,HOTEL_DETAIL:a,IB_ABANDONER:b,IB_BOOKER:g,IB_SKIPPER:e,META_CLICKER:j,IB_ABANDONER_SURVEY:c,FLIGHTS:d,SMARTER_TRAVEL:k}});define("popunder/context-manager",["ta","popunder/context-store"],function(d,a){var b="pu_context";function c(p){var r=a[p],o=r.generateModel(),q=e();if(p===q.type){return d.util.merge({},q,o)}else{return d.util.merge({type:p},o)}}function e(){var o;if(d.localStorage&&d.localStorage.enabled&&d.localStorage.getSessionKey&&d.localStorage.canUseSession()){o=d.localStorage.getSessionKey(b)}return o||{type:"FALLBACK",geoId:null,locId:null}}function j(o){if(d.localStorage&&d.localStorage.enabled&&d.localStorage.setSessionKey&&d.localStorage.canUseSession()){d.localStorage.setSessionKey(b,o)}}function i(p,o){j(d.util.merge(c(p),o))}function n(){var p=e(),o=a[p.type];return o.generateUrl(p)}function m(){var p=e(),o=a[p.type];return o.servletName}function l(){var o=e();return a[o.trackingType].servletName||m()}function h(){var o=e();return o.trackingType||o.type}function g(){return e().hasDates}function f(){return e().geoId}function k(){return e().type}return{updateType:i,getContextualUrl:n,getContextualServletName:m,getTrackingServletName:l,getTrackingType:h,isDated:g,getGeoId:f,getType:k}});if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["popunder/popunder-manager","popunder/chrome-new-window-strategy","popunder/console-strategy","popunder/ff-new-window-strategy","popunder/ie-new-window-strategy","popunder/safari-new-window-strategy","popunder/contextual-provider"],["ta","ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"popunder",files:{"js-amd":{src:{popunder:{"ff-new-window-strategy":1,"chrome-new-window-strategy":1,"safari-new-window-strategy":1,"contextual-provider":1,"ie-new-window-strategy":1,"popunder-manager":1,"console-strategy":1}}}},_:{baseUrl:"/"}})};define("popunder/popunder-manager",["ta"],function(h){var b=1000*60*60*24;var g,l,f=false,c=false;function n(r,p,q){g=r;l=p;if(!g||!l||window.name==="POPUNDER_CONTENT_FRAME"){return}!q&&a()}function i(q){if(h.browser.isIE10Metro()){return"ie10metro"}if(!q.target){return false}if(window.noPopClass&&h.elementOrParentMatches(q.target,function(r){return h.hasClass(r,window.noPopClass)})){return"no_cpu_class"}var p=q.target.onclick;if(p&&p.toString&&p.toString().match(/window\.open/g)){return"onclick_script"}if(h.elementOrParentMatches(q.target,function(r){return r.target&&r.tagName==="A"})){return"has_target"}return false}function j(q,r){var p,s;if(q==="unload"&&typeof Browser!=="undefined"&&Browser.chrome){return"Chrome_unload"}if(f&&q==="unload"&&!window.isTakeOver){return"paused"}if(!h.util||!h.util.cookie||!h.util.cookie.canSet()){return"failed_cookie_check"}p=h.util.cookie.readRaw("CommercePopunder");if(p&&(p!=="SuppressUnload"||q!=="click")){return"already_popped"}if(window.location.protocol==="http:"&&h.has("httpsDestination")){return"http_to_https"}if(q==="click"){s=i(r);if(s){return s}}if(typeof blockPU!=="undefined"&&blockPU){return"block_pu"}return false}function o(p){p=p||window.event;if(!f&&p.target&&h.elementOrParentMatches(p.target,function(q){return q.tagName==="A"})){f=true;setTimeout(d,1000)}}function d(){f=false}function a(){h.addEvent(document,"click",o);h.addEvent(document,"click",h.bind(k,null,"click"));h.addEvent(window,"beforeunload",h.bind(k,null,"unload"))}function e(q){var p=new Date(new Date().getTime()+b);h.util.cookie.write("CommercePopunder",q,p)}function k(q,s){var v,t,p;if(!g){return}p=l.getContentInfo();if(!p){return}v=j(q,s);if(v&&!c){return v}try{if(window.localStorage){localStorage.setItem("CommercePopunder.timeStamp",new Date().getTime())}}catch(r){h.util.error.record(r,"commercePopunder - localStorage after before pop",null,{},"WARN")}t={name:"CommercePopunder",url:p.url,width:p.size.width,height:p.size.height,event:s};window.fireEvent&&window.fireEvent("onPopunderBlur");try{localStorage.setItem("CommercePopunder.fallbackRelativeUrl","/PricefinderPopunder?content=PCB")}catch(u){}if(g.spawn(t)){m(p.url);e("SuppressAll*"+new Date().getTime());c=false}else{h.util.error.record(null,"commercePopunder - past rules, no pop",null,{},"WARN");if(q==="unload"){e("SuppressUnload")}}}function m(v){try{if(!v){return}var r="CommerceEnhancedPopunder";if(v.match(/AlsoViewedLB/)){r="AlsoViewedLB"}else{var p=v.match(/RuleBasedPopunder\?Rule=\d+/);if(p){var s=p[0].match(/\d+/);r="RuleBasedPopunder_"+s[0]}}var q="OpenWindow";var u=h.retrieve("checkrates.HWtracking");if(u){q="OpenWindow_"+u;h.remove("checkrates.HWtracking")}h.trackEventOnPage("CommercePopunder",q,r,"popunder",true)}catch(t){h.util.error.record(t,"CommercePopunder - trackPopunder")}}return{init:n}});define("popunder/chrome-new-window-strategy",["popunder/utils"],function(e){var b=function(){var g,f;g=null;window.hasStnData=function(){return !!g};window.setStnData=function(h){if(!h){return}g=g||{};if(h.left){g.left=h.left}if(h.top){g.top=h.top}if(h.height){g.height=h.height}if(h.width){g.width=h.width}if(h.url){g.url=h.url}};window.wrapupStn=function(h){if(!g||!g.url||window.document.hasFocus()||!window.opener.document.hasFocus()){if(h){window.close()}return}window.clearInterval(f);window.moveTo(g.left,g.top);window.resizeTo(g.width,g.height);window.location.href=g.url};window.resizeTo(0,navigator.userAgent.indexOf("Macintosh")!==-1?0:1);window.moveTo(9999,9999);window.setTimeout(function(){if(typeof window.wrapupStn==="function"){window.wrapupStn(true)}},60000);f=window.setInterval(function(){if(window.document.hasFocus()){return}if(typeof window.wrapupStn==="function"){window.wrapupStn()}},100)},c="<script>("+b.toString()+")()<\/script>";function d(h,i,g,s,f,j){var l=window.open("about:blank",h,"scrollbars=yes,resizeable=yes,height=1,width=1,top=9999,left=9999"),t,n=false,q=function(){window.clearInterval(p);window.clearTimeout(r);m.src="about:blank";window.document.body.removeChild(m)},m,o,k,p,r;if(!l){return null}t=l.document.open();t.write(c);t.close();l.setStnData({url:i,left:g,top:s,height:f,width:j});m=window.document.createElement("iframe");m.style.display="none";window.document.body.appendChild(m);o=m.contentDocument;k=o.createElement("div");o.body.appendChild(k);k.innerHTML='<object data="data:application/pdf;base64, JVBERi0xLjMKJf////8KMSAwIG9iago8PCAvQ3JlYXRvciAoUHJhd24pCi9Qcm9kdWNlciAoUHJhd24pCj4+CmVuZG9iagoyIDAgb2JqCjw8IC9UeXBlIC9QYWdlcwovQ291bnQgMQovS2lkcyBbNSAwIFJdCj4+CmVuZG9iagozIDAgb2JqCjw8IC9UeXBlIC9DYXRhbG9nCi9QYWdlcyAyIDAgUgovTmFtZXMgNyAwIFIKPj4KZW5kb2JqCjQgMCBvYmoKPDwgL0xlbmd0aCA3Ngo+PgpzdHJlYW0KL0RldmljZVJHQiBjcwowLjAwMCAwLjAwMCAwLjAwMCBzY24KL0RldmljZVJHQiBDUwowLjAwMCAwLjAwMCAwLjAwMCBTQ04KcQpRCgplbmRzdHJlYW0KZW5kb2JqCjUgMCBvYmoKPDwgL1R5cGUgL1BhZ2UKL1BhcmVudCAyIDAgUgovTWVkaWFCb3ggWzAgMCA2MTIuMCA3OTIuMF0KL0NvbnRlbnRzIDQgMCBSCi9SZXNvdXJjZXMgPDwgL1Byb2NTZXQgWy9QREYgL1RleHQgL0ltYWdlQiAvSW1hZ2VDIC9JbWFnZUldCj4+Cj4+CmVuZG9iago2IDAgb2JqCjw8IC9TIC9KYXZhU2NyaXB0Ci9KUyA8ZmVmZjAwNjEwMDcwMDA3MDAwMmUwMDYxMDA2YzAwNjUwMDcyMDA3NDAwMjgwMDI3MDA0ZjAwNmUwMDY1MDAyMDAwNmQwMDZmMDA2ZDAwNjUwMDZlMDA3NDAwMjAwMDcwMDA2YzAwNjUwMDYxMDA3MzAwNjUwMDJlMDAyZTAwMmUwMDI3MDAyOT4KPj4KZW5kb2JqCjcgMCBvYmoKPDwgL1R5cGUgL05hbWVzCi9KYXZhU2NyaXB0IDggMCBSCj4+CmVuZG9iago4IDAgb2JqCjw8IC9OYW1lcyBbKHh5enp5KSA2IDAgUl0KPj4KZW5kb2JqCnhyZWYKMCA5CjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDAxNSAwMDAwMCBuIAowMDAwMDAwMDcxIDAwMDAwIG4gCjAwMDAwMDAxMjggMDAwMDAgbiAKMDAwMDAwMDE5MCAwMDAwMCBuIAowMDAwMDAwMzE2IDAwMDAwIG4gCjAwMDAwMDA0NzAgMDAwMDAgbiAKMDAwMDAwMDY0OSAwMDAwMCBuIAowMDAwMDAwNzAxIDAwMDAwIG4gCnRyYWlsZXIKPDwgL1NpemUgOQovUm9vdCAzIDAgUgovSW5mbyAxIDAgUgo+PgpzdGFydHhyZWYKNzQ1CiUlRU9GCg"></object>';p=window.setInterval(function(){var u;try{u=l.document.hasFocus()}catch(v){q();return}if(n&&!u){q();if(l&&typeof l.wrapupStn==="function"){l.wrapupStn()}}n=u});r=window.setTimeout(q,2000);return l}function a(g){var f,h=e.getWindowInfo();try{f=d(g.name,g.url,h.left+(h.width-g.width)/2,h.top+(h.height-g.height)/2,g.height,g.width)}catch(i){f=null}return !!f}return{spawn:a}});define("popunder/console-strategy",[],function(){return{spawn:function(a){console.log("Spawning popunder with options: ",a);return true}}});define("popunder/ff-new-window-strategy",["popunder/utils"],function(a){return{spawn:function(c){var b,f,d=a.getWindowInfo();window.open("javascript:window.blur();","_self","");b=window.open(c.url,c.name,"toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1,width=1,height=1,left="+(d.left+d.width)+",top="+(d.top+d.height));if(!b){return false}b.blur();window.focus();try{f=b.open("about:blank","ff_helper_win","");if(f){f.close()}}catch(g){}try{b.moveTo(d.left+(d.width-c.width)/2,d.top+(d.height-c.height)/2);b.resizeTo(c.width,c.height)}catch(g){}return !!b}}});define("popunder/ie-new-window-strategy",["popunder/utils"],function(a){return{spawn:function(c){var b,d=a.getWindowInfo();b=window.open(c.url,c.name,"toolbar=1,location=1,directories=1,status=1,menubar=0,resizable=1,copyhistory=1,scrollbars=1,width=1,height=1,left="+(d.left+d.width)+",top="+(d.top+d.height));if(!b){return false}b.blur();window.focus();window.document.focus();if(window.event&&window.event.srcElement){window.event.srcElement.focus()}b.moveTo(d.left+(d.width-c.width)/2,d.top+(d.height-c.height)/2);b.resizeTo(c.width,c.height);return !!b}}});define("popunder/safari-new-window-strategy",["popunder/utils"],function(a){return{spawn:function(d){var b,e=a.getWindowInfo(),c=window.name;document.domain=window.location.hostname;b=window.open(d.url,d.name,"toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1,width=1,height=1,left="+(e.left+e.width)+",top="+(e.top+e.height));if(!b){return false}b.blur();window.focus();if(!c){c=window.location.host.replace(/[-.]/g,"");window.name=c}window.open("",c);window.focus();b.moveTo(e.left+(e.width-d.width)/2,e.top+(e.height-d.height)/2);b.resizeTo(d.width,d.height);return !!b}}});define("popunder/contextual-provider",["ta","popunder/context-manager","popunder/context-store","popunder/utils"],function(g,a,b,m){var j={};var e=false;function d(o){var p=j[o];return p?p.priority:undefined}function k(o){var p=j[o];return p?p.behaviour:undefined}function c(p){var o;for(o in j){if(!j.hasOwnProperty(o)){continue}p(o)}}function l(p){var o=null;c(function(q){var s=b[q],r=d(q),u=k(q),t=d(o);if(s.isActive()&&(u==="INCLUDE"||(p&&u==="TRACK"))&&(t===undefined||r>=t)){o=q}});return o||"DEFAULT"}function f(r){var u=a.getType(),q=a.getTrackingType(),v=l(),s=l(true),p=d(u),o=d(v);r=r||{};r.trackingType=(d(s)>=d(q))?s:q;var t=(!u||p===undefined||o>=p)?v:u;a.updateType(t,r)}function h(){var o=e?((screen&&screen.height*0.9)||796):696;var q=668;var p=m.getWindowInfo().height;o=Math.max(o,q);if(p>q){o=Math.min(o,p)}return{size:{width:1040,height:o},url:"/PriceFinderPopunder"}}function i(){c(function(o){b[o].on("activate",f).init()})}function n(p,o){j=p;e=o;i();f();if(g.page&&g.page.usingUnifiedDates){g.page.on("dateSelected",function(r,q){if(q==="STAYDATES"){setTimeout(f,5000)}})}else{if(g.addEvent&&g.on){g.addEvent(window,"newInlinePageDates",function(){setTimeout(f,5000)});g.on("onHACUpdateComplete",function(){setTimeout(f,5000)})}}}return{init:n,getContentInfo:h}});define("mootoolsShim",[],function(){var a=null;if(window.MooTools){a=new Class({Extends:Elements,first:function(){return this.length?new a(this[0]):new a()},html:function(c){if(!this.length){return null}if(!arguments.length){return this[0].get("html")}this.each(function(d){d.set("html",c)},this);return this},css:function(d,c){if(typeOf(d)==="object"){this.setStyles(d);return this}else{if(arguments.length===1){return this.length?this[0].getStyle(d):null}}this.each(function(e){e.setStyle(d,c)},this);return this},hasClass:function(c){if(!this.length){return false}return this.some(function(d){return d.hasClass(c)})},focus:function(){this.length&&this[0].focus()},width:function(){return this.length?this[0].getSize().x:null},height:function(c){if(!this.length){return null}if(arguments.length){this[0].setStyle("height",c);return this}return this[0].getSize().y},position:function(){if(!this.length){return null}var c=this[0].getPosition(this[0].getOffsetParent());return{top:c.y,left:c.x}},offset:function(){if(!this.length){return null}try{var c=this[0].getPosition();return{top:c.y,left:c.x}}catch(d){return{top:0,left:0}}},offsetParent:function(){return this.length?this.getOffsetParent():null},attr:function(d,c){if(typeOf(d)==="object"){Object.each(d,function(f,e){this.each(function(g){g.setAttribute(e,f)},this)},this);return this}if(arguments.length===1){return this.length?this[0].getAttribute(d):null}else{this.each(function(e){e.setAttribute(d,c)},this)}return this},prop:function(d,c){if(arguments.length===1){return this.length?this[0].getProperty(d):null}this.each(function(e){e.setProperty(d,c)},this);return this},append:function(c){return this.adopt(c)},remove:function(){this.each(function(c){c.destroy()},this)},data:function(c,d){if(arguments.length===1){return this.length?this[0].retrieve(c):null}if(this.length){this.store(c,d)}return this},on:function(d,c){return this.addEvent(d,c)},off:function(d,c){return this.removeEvent(d,c)},trigger:function(c,d){return this.fireEvent(c,d)},empty:function(){this.each(function(c){c.empty()});return this},each:function(c){this.parent(function(d){c.apply(d,arguments)},this);return this}})}var b=function(c,e){var f=document.id(c,e,document);if(f){var d=new a;d.push(f);return d}e=(e&&e!==document&&e[0])?e[0]:e;return Slick.search(e||document,c,new a)};b.each=function(c,d){if(Array.isArray(c)){Array.each(c,d)}else{Object.each(c,d)}};b.type=window.typeOf;b.extend=function(d,c){return Object.merge(d,c)};b.ajax=function(c){new Request({url:c.url,data:c.data,onSuccess:c.success,onFailure:c.error,onComplete:c.complete,timeout:c.timeout,method:c.type||c.method||"post",async:("async" in c)?c.async:true,withCredentials:!!(c.xhrFields&&c.xhrFields.withCredentials)}).send()};b.makeArray=Array.from;b.isArray=function(c){return Object.prototype.toString.call(c)==="[object Array]"};b.Event=function(c){return new Event(c)};b.param=function(c){if(c&&c.nodeName==="FORM"){return Element.toQueryString(ta.id(c))}return Object.toQueryString(c)};return b});define("dom-lib",["ta","mootoolsShim"],function(a,b){if(window.Zepto){return window.Zepto}if(window.MooTools){return b}if(a&&a.jquery){return a.jquery}return a});define("utils/browserutils",[],function(){var d={},b=window.navigator?window.navigator.userAgent.toLowerCase():"",a=window.navigator?window.navigator.platform.toLowerCase():"",c=b.match(/(opera|ie|firefox|chrome|trident|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],e=c[1]=="ie"&&document.documentMode;if(c[1]==="trident"){c[1]="ie";c[2]=parseInt(c[2],10)+4}d.name=(c[1]=="version")?c[3]:c[1];d.version=e||parseFloat((c[1]=="opera"&&c[4])?c[4]:c[2]);d.Platform={name:b.match(/ip(?:ad|od|hone)/)?"ios":(b.match(/(?:webos|android)/)||a.match(/mac|win|linux/)||["other"])[0]};d[d.name]=true;d[d.name+parseInt(d.version,10)]=true;d.Platform[d.Platform.name]=true;return d});define("api-mod",["dom-lib","utils/browserutils"],function(domlib,browser){var _isBodyOrDocumentElement=function(el){if(!el){return false}return(/^(?:body|html)$/i).test(el.tagName)};var _getWindowSize=function(){var el=(!document.compatMode||document.compatMode==="CSS1Compat")?document.body.parentNode:document.body;return{x:el.clientWidth,y:el.clientHeight}};return{fn:function(fn){switch(typeof(fn)){case"function":return fn;case"string":var f=false;try{f=eval(fn)}catch(e){}if(!f){var ns=fn.split("."),n=ns.pop();try{ns=eval(ns.join("."));f=ns&&ns._magic&&ns._magic.partial(n)}catch(e){}}if(f&&typeof(f)==="function"){return f}break}return null},bind:function(fn,obj){return Function.prototype.bind.apply(fn,Array.prototype.slice.call(arguments,1))},bindAll:function(obj){if(arguments.length>1){Array.prototype.slice.call(arguments,1).forEach(function(name){obj[name]=this.bind(obj[name],obj)},this)}else{var that=this;domlib.each(obj,function(fn,name){obj[name]=that.bind(fn,obj)})}return obj},inDocument:function(elmt){return !!elmt.parentNode&&elmt.parentNode.nodeType!==11},addEvent:function(elmt,type,fn){return elmt&&domlib(elmt).on(type,fn)},fireEvent:function(elmt,type,args){return elmt&&domlib(elmt).trigger(type,args)},removeEvent:function(elmt,type,fn){return elmt&&domlib(elmt).off(type,fn)},removePropertyEvent:function(elmt,type,fn){if(type.substr(0,2)!=="on"){type="on"+type}elmt=domlib(elmt);var c="ta.call(",p=elmt.attr(type),x=p&&p.indexOf(fn),e=p&&p.indexOf(")",x),r;if(!p||x<0){return}if(p.charAt(e+1)===";"){e++}if(p.charAt(x+fn.length)==="("){r=p.slice(0,x)+p.slice(e+1)}else{if(x>=c.length+1&&p.substr(x-c.length-1,c.length)===c){x-=c.length+1;r=p.slice(0,x)+p.slice(e+1)}}elmt.prop(type,r&&r.trim())},store:function(elmt,key,value){return domlib(elmt).data(key,value)},retrieve:function(elmt,key){return domlib(elmt).data(key)},getSize:function(elmt){if(!elmt){return null}if(_isBodyOrDocumentElement(elmt)||elmt===window||elmt===document){return _getWindowSize()}return{x:elmt.offsetWidth,y:elmt.offsetHeight}},getPosition:function(elmt){return elmt&&domlib(elmt).offset()},getCoords:function(elmt){if(!elmt){return null}var size=this.getSize(elmt),position=this.getPosition(elmt);return{top:position.top,left:position.left,bottom:position.top+size.y,right:position.left+size.x,height:size.y,width:size.x}},getOffsetParent:function(elmt){return elmt&&domlib(elmt).offsetParent()},containsElement:function(parentElement,childElement){if(!parentElement||!childElement){return false}while(childElement!=null){if(childElement===parentElement){return true}childElement=childElement.parentElement}return false},checkBrowser:function(){var args=Array.prototype.slice.call(arguments);return args.some(function(b){return !!browser[b]})},containsEvent:function(elmt,evnt){if(!evnt){return false}var x=evnt.pageX,y=evnt.pageY;var s=this.getCoords(elmt);if("fixed"===domlib(this.getOffsetParent(elmt)||elmt).css("position")||typeof x==="undefined"||typeof y==="undefined"){x=evnt.clientX;y=evnt.clientY}return(y>=s.top&&y<=s.bottom&&x>=s.left&&x<=s.right)},select:function(){var args=Array.prototype.slice.call(arguments),context=args.length>1&&(("string"===typeof args[0])?args.pop():args.shift())||document,selector=args.shift();return domlib(selector,context)},addClass:function(elmt,className){return elmt&&domlib(elmt).addClass(className)},removeClass:function(elmt,className){return elmt&&domlib(elmt).removeClass(className)},toggleClass:function(elmt,className,state){return elmt&&domlib(elmt).toggleClass(className,state)},hasClass:function(elmt,className){return elmt&&domlib(elmt).hasClass(className)},destroy:function(elmt){return elmt&&elmt.parentNode&&elmt.parentNode.removeChild(elmt)},find:function(selector,elmt){var elements=domlib(selector,elmt||document);return elements.length?elements[0]:null},scrollTop:function(){var supportPageOffset=window.pageYOffset!==undefined,isCSS1Compat=((document.compatMode||"")==="CSS1Compat");return supportPageOffset?window.pageYOffset:isCSS1Compat?document.documentElement.scrollTop:document.body.scrollTop},scrollLeft:function(){var supportPageOffset=window.pageXOffset!==undefined,isCSS1Compat=((document.compatMode||"")==="CSS1Compat");return supportPageOffset?window.pageXOffset:isCSS1Compat?document.documentElement.scrollLeft:document.body.scrollLeft},createElement:function(tag,attributes){var el=document.createElement(tag);domlib(el).attr(attributes);return el},isElement:function(obj){return(typeof HTMLElement==="object"?obj instanceof HTMLElement:obj&&typeof obj==="object"&&obj.nodeType===1&&typeof obj.nodeName==="string")},isArray:function(obj){return Object.prototype.toString.call(obj)==="[object Array]"},adopt:function(elmt){domlib(elmt).append(Array.prototype.slice.call(arguments,1))},setStyle:function(elmt,property,value){return elmt&&domlib(elmt).css(property,value)},stopEvent:function(event){if(event){if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}if(event.preventDefault){event.preventDefault()}else{event.returnValue=false}}return false},mixin:function(target){Array.prototype.slice.call(arguments,1).forEach(function(mixin){for(var prop in mixin){this[prop]=mixin[prop]}},target);return target},merge:function(target){var fromList=Array.prototype.slice.call(arguments,1);for(var i=0,len=fromList.length;i<len;i++){for(var prop in fromList[i]){if(fromList[i].hasOwnProperty(prop)){target[prop]=fromList[i][prop]}}}return target},getFormData:function(form){var ret={};var qs=domlib.param(form);if(typeof("qs")==="string"){qs=qs.split("#")[0].split("?").pop();var pairs=qs.split("&");for(var i=0;i<pairs.length;i++){var nv=pairs[i].split("=");if(nv.length>=2&&nv[0]){var name=decodeURIComponent(nv[0]);var oldval=ret[name];var newval=decodeURIComponent(nv[1]);if(!oldval){ret[name]=newval}else{if(newval){if(typeof(oldval)==="string"){oldval=[oldval];ret[name]=oldval}oldval.push(newval)}}}}}return ret},toFormQueryString:function(obj){var qslist=[];for(var key in obj){if(obj.hasOwnProperty(key)){var val=obj[key];if(val&&typeof(val)==="object"){for(var i=0;val.length&&i<val.length;++i){var subval=val[i];subval=typeof(subval)==="object"?"":String(subval);qslist.push(encodeURIComponent(key)+"="+encodeURIComponent(subval))}}else{qslist.push(encodeURIComponent(key)+"="+encodeURIComponent(String(val)))}}}return qslist.join("&")},toArray:function(thing){if(typeof thing.length!=="number"){return[thing]}return Array.prototype.slice.call(thing)},throttled:function(func,delay){var last=Date.now();return function(){if(Date.now()-last<delay){return}last=Date.now();return func.apply(this,arguments)}}}});define("utils/BatchRequest",["dom-lib","ta","api-mod"],function(g,b,f){var e=1000;var c=10*1000;var d={};function a(j,i){d[j]=d[j]||[];d[j].push(i);b.throttle(h,"batched-request",e,c)}function h(){for(var i in d){if(!d.hasOwnProperty(i)){continue}g.ajax({type:"post",url:i,data:{batched:true,data:d[i]}})}d={}}f.addEvent(window,"onpagehide" in window?"pagehide":"unload",h);return{queue:a}});ta.util.cookie={expireTimeForPID:5,expireTimeForPID_remove:0,cookiePIDName:"NPID",setPIDCookie:function(a){try{Cookie.write(ta.util.cookie.cookiePIDName,a,{domain:cookieDomain,time:ta.util.cookie.expireTimeForPID})}catch(b){var c="";if(typeof cookieDomain!="undefined"){c=cookieDomain}ta.util.error.record(b,"set pid cookie",null,{pid:a,cookieDomain:c})}},removePIDCookie:function(){try{Cookie.write(ta.util.cookie.cookiePIDName,"",{domain:cookieDomain,time:ta.util.cookie.expireTimeForPID_remove})}catch(a){}},openWindowWithPID:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}window.open(b,"_blank");ta.util.cookie.removePIDCookie()},setAjaxAction:function(c,a){if(c[0]!="/"){c="/"+c}c="target:"+c;try{var f=Array.from(arguments).join("|");Cookie.write("ajaxAction",f,{domain:cookieDomain,path:"/"})}catch(b){var d="";if(typeof cookieDomain!="undefined"){d=cookieDomain}ta.util.error.record(b,"set pid cookie",null,{pid:pid,cookieDomain:d})}},setPID:function(b,a){if(ta.id(a).get("tag")!="a"){a=a.getParent("a")}if(pid=a.className.match(/pid(\d+)/)){ta.util.cookie.setPIDCookie(pid[1])}},setPIDNoA:function(a){pid=a.className.match(/pid(\d+)/);if(pid){ta.util.cookie.setPIDCookie(pid[1])}},showCookieBanner:function(){try{var b=ta.id("COOKIE_BANNER"),c=$(document.body);if(b&&c){b.inject(c,"top");b.setStyles({position:"fixed",top:-3000,left:-3000});b.show();var a=b.getHeight();b.setStyle("margin-top",0-a);b.hide();b.setStyles({top:0,left:0,position:"relative"});b.show();b.set("tween",{duration:"long",onComplete:function(){window.fireEvent("showingCookieConsentBanner")}});b.tween("margin-top",0);window.fireEvent("cookieBannerShown");Cookie.write("cookieconsent","1",{duration:3600})}}catch(d){ta.util.error.record(d,"ta.util.cookie.showCookieBanner")}},canSet:function(){document.cookie="SessionTest=true";if(document.cookie.match("(^|;)\\s*SessionTest=true\\s*(;|$)")){document.cookie="SessionTest=; expires=Thu, 01 Jan 1970 00:00:01 GMT";return true}return false},readRaw:function(a){var b=document.cookie.match("(?:^|;)\\s*"+a.escapeRegExp()+"=([^;]*)");return b?b[1]:false},write:function(b,c,a){document.cookie=b+"="+c+(a?"; expires="+a.toUTCString():"")}};setPID=ta.util.cookie.setPIDCookie;ta.util.ASDF={asdf:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}window.location=asdf(b)},asdfPxlAndPid:function(d,b,a){var e="http://ad.doubleclick.net/ad/";var c=";sz=1x1";if(a){ta.util.cookie.setPIDCookie(a)}if(b){new Element("img",{src:e+b+c})}window.location=asdf(d)},asdfPopup:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}ta.servlet.Popup.open(asdf(b))},asdfPopupEmail:function(a){ta.servlet.Popup.open(asdf(a),"email",580,460,30,25)},asdfPopupGuide:function(a){ta.servlet.Popup.open(asdf(a),"dest_guide",565,700,(screen.width-700)/2,(screen.height-600)/2)},asdfPopupTerms:function(a){ta.servlet.Popup.open(asdf(a),"terms",300,300,30,25)},asdfPopupDir:function(a){new Request({url:"/ActionRecord?action=getDirectionsListings"}).send();ta.servlet.Popup.open(asdf(a),null,800,600)},asdfDcd:function(a){return asdf(a)}};function getOffset(a){if(a>=97&&a<=122){return a-61}if(a>=65&&a<=90){return a-55}if(a>=48&&a<=71){return a-48}return -1}function asdf(d){var g={"":["&","=","p","6","?","H","%","B",".com","k","9",".html","n","M","r","www.","h","b","t","a","0","/","d","O","j","http://","_","L","i","f","1","e","-","2",".","N","m","A","l","4","R","C","y","S","o","+","7","I","3","c","5","u",0,"T","v","s","w","8","P",0,"g",0],q:[0,"__3F__",0,"Photos",0,"https://",".edu","*","Y",">",0,0,0,0,0,0,"`","__2D__","X","<","slot",0,"ShowUrl","Owners",0,"[","q",0,"MemberProfile",0,"ShowUserReviews",'"',"Hotel",0,0,"Expedia","Vacation","Discount",0,"UserReview","Thumbnail",0,"__2F__","Inspiration","V","Map",":","@",0,"F","help",0,0,"Rental",0,"Picture",0,0,0,"hotels",0,"ftp://"],x:[0,0,"J",0,0,"Z",0,0,0,";",0,"Text",0,"(","x","GenericAds","U",0,"careers",0,0,0,"D",0,"members","Search",0,0,0,"Post",0,0,0,"Q",0,"$",0,"K",0,"W",0,"Reviews",0,",","__2E__",0,0,0,0,0,0,0,"{","}",0,"Cheap",")",0,0,0,"#",".org"],z:[0,"Hotels",0,0,"Icon",0,0,0,0,".net",0,0,"z",0,0,"pages",0,"geo",0,0,0,"cnt","~",0,0,"]","|",0,"tripadvisor","Images","BookingBuddy",0,"Commerce",0,0,"partnerKey",0,"area",0,"Deals","from","\\",0,"urlKey",0,"'",0,"WeatherUnderground",0,"MemberSign","Maps",0,"matchID","Packages","E","Amenities","Travel",".htm",0,"!","^","G"]};var b="";for(var a=0;a<d.length;a++){var h=d.charAt(a);var e=h;if(g[h]&&a+1<d.length){a++;e+=d.charAt(a)}else{h=""}var f=getOffset(d.charCodeAt(a));if(f<0||typeof g[h][f]=="String"){b+=e}else{b+=g[h][f]}}return b};ta.util.Doer={doit:function(e,d){var c="/"+e;var b=0;for(var a in d){if(b===0){c+="?"}else{c+="&"}c+=a+"="+d[a];b++}return c},aimdoit:function(j,c,a,k){var b=ta.util.Doer.doit(j,c);new Event(a).preventDefault();var i=475;var d=390;var g=210;var f=5;if(k){i=980;d=800;g=240}else{if(screen.width>=1024&&screen.height>=768&&c&&(c.area.indexOf("Text")!=-1||c.area.indexOf("Thumbnail")!=-1)){i=900;d=768;g=240}else{if(screen.width>1024){i=800;d=600;g=240}else{if(screen.width>800){i=620;d=500;g=240}}}}ta.store("commerce.AIMWindow",ta.servlet.Popup.open(b,null,i,d,g,f,false,true));if(ta.retrieve("isDaoDao")){if(ta.retrieve("checkrates.check_more_re")){dd.commerce.checkrates.checkMorePopupAIM(a,c)}}else{var e=ta.retrieve("meta.popProPhotosCRLeavebehind")&&!ta.widgets.calendar.hasPageDates()&&c&&c.area!="Icon_Amenities";if(ta.retrieve("checkrates.isCRLB")&&!ta.id("CHECK_RATES_LB")&&(!ta.retrieve("checkrates.meta_ui_post_click_prices")||e)){ta.run("ta.overlays.Factory.loadCheckRatesLBOverlay",{},a,null,c)}}},tadoit:function(d,b,c,a){window.location=ta.util.Doer.tadoless(d,b,c,a)},tadoless:function(g,c,f,j,b){var a="/"+g;for(var h in c){a+="-"+h+c[h]}var e=f.length;for(var d=0;d<e;d++){a+="-"+f[d]}if(!b){a+=".html"}if(j.length>0){a+=j}return a}};ta.util.pending={};ta.util.pending.waitForMore=function(e,c,a,b,d){if(ta.has("pending."+e)){ta.util.pending.cancel(e)}ta.store("pending."+e,{timer:c.delay(a,d,b),fn:c,t:"m",n:a})};ta.util.pending.waitForFn=function(id,fn){try{var tmp=eval(fn),data;if(tmp){if(typeOf(tmp)==="function"){if(ta.has("pending.callback."+id)){ta.retrieve("pending.callback."+id)()}else{if(ta.has("pending."+id)){data=ta.retrieve("pending."+id);if(data.evnt){tmp.attempt([data.evnt,data.elmt])}else{tmp.attempt()}}else{tmp.attempt()}}}else{if(IS_DEBUG){alert("fn is not a function: "+typeOf(tmp))}}}else{ta.util.pending.waitForFnAgain(id,fn)}}catch(e){ta.util.pending.waitForFnAgain(id,fn)}};ta.util.pending.WAIT_DELAY=100;ta.util.pending.WAIT_TIMEOUT=50;ta.util.pending.waitForFnAgain=function(c,a){var b=ta.has("pending."+c)?ta.retrieve("pending."+c):{t:"f",fn:a,count:1};if(b.count<ta.util.pending.WAIT_TIMEOUT){b.count++;b.timer=ta.util.pending.waitForFn.invokeLater(ta.util.pending.WAIT_DELAY,null,[c,a]);ta.store("pending."+c,b)}else{if(IS_DEBUG&&!ta.has("pending.ignore."+c)){alert("timed out ("+(ta.util.pending.WAIT_TIMEOUT*ta.util.pending.WAIT_DELAY)+"ms) waiting for function: "+a)}}};ta.util.pending.waitForFile=function(c,a,b){if(ta.load(a)){ta.util.pending.waitForFn(c,b)}};ta.util.pending.waitForHandler=function(d,b,c,a){ta.store("pending."+d,{count:0,t:"f",fn:b,evnt:c,elmt:a});ta.util.pending.waitForFn(d,b)};ta.util.pending.cancel=function(b){var a=ta.remove("pending."+b);if(a&&a.timer){clearTimeout(a.timer)}};ta.util.pending.lock=function(d,b,c,a){if(ta.has("pending."+d)){return[a,false].pick()}ta.store("pending."+d,true);if(c){ta.util.pending.unlock.delay(c,null,d)}return b()};ta.util.pending.unlock=function(b){var a=ta.remove("pending."+b);if(a&&typeof a==="object"){a.count--;if(a.count===0){a.fn()}else{ta.store("pending."+b,a)}}};ta.util.pending.multilock=function(c,a,b){ta.store("pending."+c,{count:b,fn:a})};ta.util.pending.multilockUpdate=function(d,c){var b="pending."+d,a=ta.retrieve(b);if(a){a.count+=c}};ta.util.pending.wait=function(e,c,b,d,a){ta.store("pending."+e,{timer:c.delay(b,d,a)})};ta.util.pending.waitForElement=function(d,a,c){if(ta.has("pending."+d)){return}var b=$(a);if(b){ta.util.pending.cancel("pending."+d);c(b)}else{ta.store("pending."+d,{timer:ta.util.pending.waitForElement.delay(2,null,[d,a,c])})}};ta.util.pending.waitFor=function(a,c,b){if(a()){return c()}setTimeout(function(){ta.util.pending.waitFor(a,c,b)},b);return false};ta.util.pending.waitWithPing=function(b,e,a,c){function d(i,f,g){var h=b();if(h){e(h)}else{if(a&&i>0&&i%Math.ceil(g*1000/f)==0){a(i*f/1000)}setTimeout(function(){d(i+1,f,g)},f)}}d(0,100,c||3)};ta.util.pending.waitForSelector=function(b,d,a,c){ta.util.pending.waitWithPing(function(){return ta.find(b)},d,a,c)};ta.util.load={loadedMap:false,loadingMap:false,callbacks:[]};ta.util.load.maps=function(a){if(ta.util.load.loadedMap){a&&a()}else{if(ta.util.load.loadingMap){ta.util.load.callbacks.push(a)}else{ta.util.load.loadingMap=true;return ta.maps.load.library(function(){ta.util.load.loadedMap=true;ta.util.load.loadingMap=false;a&&a();ta.util.load.callbacks.each(function(b){b&&b()})})}}};ta.util.load.mapsLazy=function(a){return ta.run("ta.maps.load.library",{},a)};function _loadMapsV2(d,c,e){d=d||[];var b=ta.remove("infobox_js");if(b){var a=1+d.length;var f=function(){a--;if(!a){c()}};if(!ta.load(e,function(){ta.util.load.maps(function(){Asset.javascript((b),{onLoad:f})})})){ta.util.error("Rollup file was not found: ",e)}d.each(function(g){Asset.css(g,{onLoad:f})})}else{ta.util.error("'infobox_js' path was not specified for this page")}}ta.util.load.loadMapV2Lite=function(a,b){_loadMapsV2(b,a,"ta-mapsv2-lite")};ta.util.load.loadMapV2=function(a,b){_loadMapsV2(b,a,"ta-mapsv2")};ta.util.load.GoogleLoader=function(a){if(ta.has("googleloader.state")){if(ta.retrieve("googleloader.state")=="loaded"){return a()}else{return ta.util.load.GoogleLoader.delay(500,this,a)}}else{ta.store("googleloader.state","loading");ta.store("googleloader.callback",a);new Asset.javascript("//www.google.com/jsapi?callback=ta.util.load.GoogleLoaderCallback")}};ta.util.load.GoogleLoaderCallback=function(){ta.store("googleloader.state","loaded");var a=ta.remove("googleloader.callback");a()};ta.util.load.LocalSearch=function(a){ta.util.load.GoogleLoader(function(){google.load("search","1",{callback:function(){}})})};ta.util.date={};ta.util.date.MS_IN_DAY=1000*60*60*24;ta.util.date.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];ta.util.date.HOUR_CONST=12;ta.util.date.THAI_BUDDHIST_YEAR_OFFSET=543;ta.util.date.MAX_STAY_DURATION_DAYS=30;ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT=330;ta.util.date.inDateSet=function(c,b){if((c==null)||(b==null)){return false}var e=b.length;for(var d=0;d<e;d++){var f=b[d];if(f.length){var g=f[0].getTime();var a=f[1].getTime();if((g<=c.getTime())&&(a>=c.getTime())){return true}}else{if(c.getTime()==f.getTime()){return true}}}return false};ta.util.date.rangesIntersect=function(a,b){return Math.max(a[0].getTime(),b[0].getTime())<=Math.min(a[1].getTime(),b[1].getTime())};ta.util.date.getDaysInRange=function(b,a){return Math.round((a.getTime()-b.getTime())/ta.util.date.MS_IN_DAY)+1};ta.util.date.getLastDayOfMonth=function(a){var b=new Date();if(a){b=new Date(a.getTime())}b=new Date(ta.util.date.normalize(b));b.setDate(1);b.setMonth(b.getMonth()+1);b.setDate(0);return b.getDate()};ta.util.date.getDaysApart=function(c,b){var a=24*60*60*1000;if(c&&b){return Math.round(Math.abs((c.getTime()-b.getTime())/(a)))}return 0};ta.util.date.inSameMonth=function(b,a){return(b!=null)&&(a!=null)&&(b.getMonth()==a.getMonth())&&(b.getYear()==a.getYear())};ta.util.date.normalize=function(a){return a.setHours(ta.util.date.HOUR_CONST,0,0,0)};ta.util.date.create=function(c,a,b){return new Date(c,a,b,ta.util.date.HOUR_CONST)};ta.util.currency={};ta.util.currency.formatCurrency=function(d,a,h,b){var g=a?a:"USD";var c=currencySymbol[g];var f=d;if(!b){f=ta.util.currency.formatThousands(Math.round(d))}var e=c[0];if(h&&ta.util.currency.addSpace(e)){if(!c[1]){return e+" "+f}else{return f+" "+e}}if(!c[1]){return e+f}else{return f+e}};ta.util.currency.formatCurrencyRange=function(g,b,a,f){var e=a?a:"USD";var c=currencySymbol[e];var d=c[0];if(f&&ta.util.currency.addSpace(d)){g=ta.util.currency.formatThousands(Math.round(g));b=ta.util.currency.formatThousands(Math.round(b));return ta.util.currency.formatCurrency(g+" - "+b,a,true,true)}else{g=ta.util.currency.formatCurrency(g,a);b=ta.util.currency.formatCurrency(b,a);return g+" - "+b}};ta.util.currency.addSpace=function(a){return/^[a-zA-Z]+$/i.test(a)};ta.util.currency.formatThousands=function(b){if(typeof groupingSize=="undefined"||typeof groupingSeparator=="undefined"||groupingSize<1){return b}var a="";var d=""+b;for(var c=1;c<=d.length;c++){a=d.charAt(d.length-c)+a;if(c%groupingSize==0&&c<d.length){a=groupingSeparator+a}}return a};ta.util.currency.setCurrencyAndReload=function(a,b){var c="SetCurrency";Cookie.write(c,a,{time:15});b=b?b+"|":"";ta.trackEventOnPage("CurrencyPicker","Select",b+a);location.reload(true)};ta.util.Toggle={};ta.util.Toggle.siblings=function(c,b){c.preventDefault();var a=true;if(b.hasClass("closed")){a=false}b.toggleClass("closed sprite-arrow_toggle_blu_lft");b.getParent().getChildren().each(function(d){if(d!=b&&typeof d.hasClass!=="undefined"&&d.hasClass!=null&&!d.hasClass("ignore_toggle")){d.setStyle("display",a?"none":"block")}})};ta.util.Toggle.parentClass=function(c,a){c.preventDefault();var b=a.getParent(".toggle");b.toggleClass("off")};ta.util.Toggle.toggleTarget=function(d,b,c){d.preventDefault();var a=true;if($(b).hasClass("closed")){a=false}$(b).toggleClass("closed");$(b).toggleClass("open");$(c).setStyle("display",a?"none":"block")};ta.util.Toggle.toggleForm=function(b,d,c){var a=$(b).getParent(".formToggle");if(/sel_(\w+)/.test(a.className)){var e=RegExp.$1;a.removeClass("sel_"+e);a.getElement(".form_"+e).hide();var f=a.getElement(".header_"+e);if(f){f.hide()}}a.addClass("sel_"+d);var f=a.getElement(".header_"+d);if(f){f.show()}a.getElement(".form_"+d).show();return false};ta.util.Toggle.toggleLI=function(e,d,a){var c=e.getNext();for(var b=0;b<1000&&c&&c.id!=d.id;b++){if(a){c.show()}else{c.hide()}c=c.getNext()}if(a){e.hide()}else{e.show()}if(a){d.show()}else{d.hide()}};ta.util.Toggle.splitHotel=function(){var c=$$("#HOTEL_DESCRIPTION .descriptive_text").get("text").toString();var b=1000;if(c&&c.length>b){var a=c.substring(0,b);var d=c.substring(b,c.length);$$("#HOTEL_DESCRIPTION .descriptive_text").set("text",a);$$("#HOTEL_DESCRIPTION .description_ellipsis").show("inline");$$("#HOTEL_DESCRIPTION .more_description").show("inline");$$("#HOTEL_DESCRIPTION .descriptive_text_last").set("text",d)}};ta.util.Toggle.expandHotel=function(c,b){var a=b.getPrevious(".descriptive_text_last");var d=b.getNext(".less_description");b.hide();if(a){a.show("inline");a.getPrevious()&&a.getPrevious().hide()}d&&d.show("inline")};ta.util.Toggle.truncateHotel=function(c,b){var d=b.getPrevious(".more_description");var a=b.getPrevious(".descriptive_text_last");d&&d.show("inline");if(a){a.hide();a.getPrevious()&&a.getPrevious().show("inline")}b.hide()};ta.util.Toggle.toggleRecentReview=function(c,e,d){var b=c.getPrevious().getChildren();for(i=0;i<b.length;i++){var a=b[i];if(a.style.display=="none"){a.style.display=""}else{a.style.display="none"}}c.set("text",c.get("text").contains("<")?e+" > ":d+" < ")};ta.util.Toggle.expandList=function(c,a,f){try{var b=c.getChildren();if(b.length>a){for(i=a;i<b.length;i++){b[i].hide()}var g=new Element("span",{html:f,"class":"taLnk hvrIE6 moreLink",events:{click:function(){for(i=a;i<b.length;i++){b[i].show()}g.hide()}}});g.inject(c,"after")}}catch(d){ta.util.error.record(d,"Failed to Toggle.expandList")}};ta.util.URL={parse:function(c){if(/^(\w+):(.*)/.test(c)){c=RegExp.$2;switch(RegExp.$1){case"DOM":elmt=document.getElement(c);c=(elmt&&elmt.href)?elmt.href:"#";break;case"GMapsLC":if(c.length==0){break}tmp=c.split(",");ops={from:pageServlet,Action:tmp.shift()};tmp.each(function(d){if(/^g(\d+)$/.test(d)){ops.g=RegExp.$1}else{if("ext"==d){ops.ext="y"}else{if(/^(.*)=(.*)$/.test(d)){ops[RegExp.$1]=RegExp.$2}else{ops[d]=""}}}});c="/GMapsLocationController?"+Object.toQueryString(ops);break;case"ABS":var a=(window.location.port=="80"||window.location.port=="")?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+c;break;case"ABSPAGE":var a=(window.location.port=="80"||window.location.port=="")?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+c;if(c.indexOf(".html")==-1){c+=".html"}break;case"REL":var b=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"));if(/\/$/.test(window.location.pathname)){b=window.location.pathname}var a=window.location.port=="80"?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+b+c;break;default:c=RegExp.$1+":"+c;break}}return c},getParameter:function(c,a){var b=new RegExp("[?&]"+a+"=([^&]+)");if(b.test(c)){return RegExp.$1}return false},getAbsoluteUrl:function(a){return location.protocol+"//"+location.hostname+a},https:function(a){a=a||"";if(a.indexOf("http")===-1){a=ta.util.URL.getAbsoluteUrl(a)}if(a.indexOf("https://")===0){return a}if(ta.retrieve("access_control_headers")){return a.replace("http://","https://")}return a},getServletNameFromUrl:function(a){return/^(?:\w+:\/\/.*)?\/([^-?]*).*/.exec(a)&&RegExp.$1}};ta.util.i18n={};ta.util.i18n.isRtl=function(){return ta.id(document.body).hasClass("rtl")};ta.util.element={};ta.util.element.replaceContent=function(f,e,c){var d=f;var b=e;if(!b.getElement(".progresstab")){var a=c+(c.indexOf("?")==-1?"?":"&")+"xhr=true";var g=new Element("div",{"class":"progresstab"});g.inject(b);new Request({url:a,onSuccess:function(h,i){b.empty();b.innerHTML=h;if(window.behavior){window.behavior.apply(b)}b.fireEvent("onContentReplaced",[d,b])},evalScripts:true}).get()}};ta.util.element.trackIfMapView=function(){if(ta.retrieve("maps_v2_open")){ta.trackEventOnPage("QC_Meta_Map_Detail","map_open")}};ta.util.element.spinner=function(b,a){$(a).getParent(".spinnerReplaceable").getChildren().each(function(c){if(c.hasClass("spinner")){c.show()}else{c.hide()}})};ta.util.element.clearDefault=function(b,a){if(a.value==a.defaultValue){a.value=""}};ta.util.element.limitLength=function(b,a,c){if(a.value.length>=c){a.value=a.value.substr(0,c);return false}};ta.util.element.updateValue=function(a,b){if(a&&a.get("value")!=b){a.set("value",b);a.fireEvent("change",a)}};ta.util.element.moveContent=function(a,b){if(!a||!b){return}b.innerHTML=a.innerHTML;a.innerHTML=""};ta.util.element.keepInWindow=function(d,c){if(!d||!d.setStyle){return}if(!c){c={top:true,right:true,bottom:true,left:true}}function e(h,i){var j=parseInt(h.getStyle(i));return j||j===0}var g=2;var f=d.getCoordinates();var b=Window.getSize();var a=Window.getScroll();if(c.right&&e(d,"right")){if(f.left<a.x+g){d.setStyle("right",b.x+a.x-f.width-g)}else{if(f.right>b.x-a.x-g){d.setStyle("right",g)}}}else{if(c.left&&e(d,"left")){if(f.left<a.x+g){d.setStyle("left",g)}else{if(f.right>b.x-a.x-g){d.setStyle("left",b.x+a.x-f.width-g)}}}}if(c.bottom&&e(d,"bottom")){if(f.top<a.y+g){d.setStyle("bottom",b.y+a.y-f.height-g)}else{if(f.bottom>b.y-a.y-g){d.setStyle("bottom",g)}}}else{if(c.top&&e(d,"top")){if(f.top<a.y+g){d.setStyle("top",g)}else{if(f.bottom>b.y-a.y-g){d.setStyle("top",b.y+a.y-f.height-g)}}}}};ta.util.element.makeTextFit=function(o,k,g,j,c){c=c||1;j=j||8;var r=false;var q=ta.select(o);for(var h=0;h<q.length;h++){var i;var n;var f;if(parseInt(g)==g){i=g;n=i}else{f=q[h].getElement(g);if(!f){return}i=f.getSize();n=i.y}var a=q[h].getElement(k);if(!a){return}var p=a.getSize();if(n<p.y){var d=a.getStyle("font-size");if(d){var e=function(t,s){return(s=="px"&&t>=j)||(s=="em"&&t>=0.5)||(s=="pt"&&t>6)||(s=="%"&&t>=50)};var l=d.replace(/[\d\.]/g,"");var b=parseFloat(d)*Math.sqrt(n/p.y);if(l=="px"){b=Math.max(parseInt(b),j)}if(e(b,l)){a.setStyle("font-size",b+l);r=true}}}}if(r>0&&c<4){var m=this;setTimeout(function(){m.makeTextFit(o,k,g,j,c+1)},1)}};ta.util.element.makeTextFitOneLine=(function(){var a=4;var b=0.9;var c=function(d,e){fontSize=d.getStyle("font-size");newSize=parseFloat(fontSize)*e;unit=fontSize.replace(/[\d\.]/g,"");if(unit=="px"&&newSize<8){newSize=8}if(unit=="em"&&newSize<0.5){newSize=0.5}if(unit=="pt"&&newSize<6){newSize=6}if(unit=="%"&&newSize<50){newSize=50}d.setStyle("font-size",newSize+unit)};return function(g,d){var e=ta.select(g);e.forEach(function(k){var h=(parseFloat(k.getStyle("padding-left"))||0)+(parseFloat(k.getStyle("padding-right"))||0);for(var j=0;j<a&&k.scrollWidth>k.clientWidth;j++){var l=(k.clientWidth-h)/(k.scrollWidth-h);c(k,l)}if(k.scrollWidth>k.clientWidth){c(k,b)}});if(d){var f;e.forEach(function(i){var h=i.getStyle("font-size");if(!f||parseFloat(h)<parseFloat(f)){f=h}});e.forEach(function(h){h.setStyle("font-size",f)})}}})();ta.util.element.autoResizeTextInNode=(function(){var a=4;var b=0.9;var d=function(e,f){fontSize=e.getStyle("font-size");newSize=parseFloat(fontSize)*f;unit=fontSize.replace(/[\d\.]/g,"");if(unit=="px"&&newSize<8){newSize=8}if(unit=="em"&&newSize<0.5){newSize=0.5}if(unit=="pt"&&newSize<6){newSize=6}if(unit=="%"&&newSize<50){newSize=50}e.setStyle("font-size",newSize+unit)};function c(f,g){var h=f.getAttribute("data-sizegroup"),e=parseFloat(f.getStyle("font-size"));if(!h){return}g[h]=Math.min(g[h]||Number.MAX_VALUE,e)}ta.on("refreshedDOMContent",function(e){ta.util.element.autoResizeTextInNode(e)});ta.queueForLoad(function(){if(ta.id(document.body)){ta.util.element.autoResizeTextInNode(ta.id(document.body))}},"autoResize all targets on load");return function(e){if(!ta.id(e)){return}var g=ta.id(e).getElements(".autoResize");var f={};g.forEach(function(k){if(!k.isVisible()){return}var h=(parseFloat(k.getStyle("padding-left"))||0)+(parseFloat(k.getStyle("padding-right"))||0);for(var j=0;j<a&&k.scrollWidth>k.clientWidth;j++){var l=(k.clientWidth-h)/(k.scrollWidth-h);d(k,l)}if(k.scrollWidth>k.clientWidth){d(k,b)}k.removeClass("autoResize");c(k,f)});g.forEach(function(h){var i=h.getAttribute("data-sizegroup");if(!i){return}h.setStyle("font-size",f[i]+"px")})}})();ta.util.element.makeSameWidth=function(a){var b=0;var c=document.getElements(a);if(c&&c.length>1){c.forEach(function(e){var d=Math.round(parseFloat(e.getStyle("width")));if(d&&d>b){b=d}});c.setStyle("width",b)}};ta.util.element.fitToContentsHorizontally=function(b,c,d,a){a=a||1;if(a<=0||c>d){return}var e=function(f){return f.scrollWidth>f.clientWidth||f.scrollHeight>f.clientHeight};ta.select(b).forEach(function(f){f.setStyle("width",c);for(var g=c;g<d&&e(f);g+=a){f.setStyle("width",g)}if(e(f)){f.setStyle("width",d)}})};ta.util.element.scrollIntoView=function(b,f,a,h){if(!b){return}var g=b.getPosition().y+(f||0);if(a&&Fx.Scroll){try{var c=b.getParent();while(c&&c!=document.body&&c.getStyle("overflow")!="auto"){c=c.getParent()}}catch(d){c=null}if(!c||c==document.body||c.getStyle("overflow")!="auto"){c=window}else{g=(b.getPosition(c).y+c.getScrollTop())+(f||0)}(new Fx.Scroll(c,{wait:false,duration:300,onComplete:function(){h&&h()}})).start(0,g)}else{window.scrollTo(0,g);h&&h()}};ta.util.element.isScrolledIntoView=function(d,g){if(!d||!d.isVisible()){return false}var f;try{f=d.getBoundingClientRect()}catch(c){return false}var e=f.bottom;var b=f.top;if(g){var a=g.offsetHeight;var h=g.getPosition();if(a){if(h&&h.y==0){e-=a}else{b+=a}}}return(!!f&&e>=0&&f.right>=0&&b<=document.documentElement.clientHeight&&f.left<=document.documentElement.clientWidth)};ta.util.element.doIfElementIsVisible=function(d,e,b){function a(){if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}function c(){if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b)}else{window.addEvent("scroll",a);window.addEvent("resize",c)}};ta.util.element.isScrolledIntoAdjustedView=function(c,k,d){if(!c){return false}var h;try{h=c.getBoundingClientRect()}catch(f){return false}var j=h.bottom,i=h.top,b=h.left,a=h.right;if(k){if(k.bottom){j=j+k.bottom>0?j+k.bottom:0}if(k.top){i=i+k.top>0?i+k.top:0}if(k.left){b=b+k.left>0?b+k.left:0}if(k.right){a=a+k.right>0?a+k.right:0}}if(d){var e=d.offsetHeight;var g=d.getPosition();if(e){if(g&&g.y==0){j-=e}else{i+=e}}}return(!!h&&j>=0&&a>=0&&i<=document.documentElement.clientHeight&&b<=document.documentElement.clientWidth)};ta.util.element.doIfElementAdjustedPositionIsVisible=function(d,f,e,b){function a(){if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}function c(){if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b)}else{window.addEvent("scroll",a);window.addEvent("resize",c)}};(function(){ta.util.element.trackWhenScrolledIntoView=function(e,f,g,d,c){if(e&&f){a.push({e:e,k:f,cb:g,once:!d,persistent:c})}};var a=[];function b(){for(var c=a.length-1;c>=0;c--){var e=a[c];var f;if(e.e.substr){f=ta.select(e.e)}else{if(e.e.join){f=e.e}else{f=new Elements([e.e])}}if(f.length>0){var d=e.inView;f.each(function(g){var h=g.offsetWidth==0&&g.offsetHeight==0||g.getStyle("display")=="none";if(!h){e.inView=e.inView||ta.util.element.isScrolledIntoView(g,e.persistent)}});if(!d&&e.inView){if(!e.cb||e.cb()){ta.trackEventOnPage(e.k[0],e.k[1],e.k[2],e.k[3]);if(e.once){a.splice(c,1)}}}}}}window.addEvent("scroll",function(){ta.throttle(b,"ta.util.element.trackWhenScrolledIntoView",250,1000)});window.addEvent("resize",b);window.addEvent("load",b)})();ta.util.element.getTotalWidth=function(a){if(!a){return 0}return(parseInt(a.getComputedStyle("width"))||a.getWidth()||0)+(parseInt(a.getComputedStyle("margin-left"))||0)+(parseInt(a.getComputedStyle("margin-right"))||0)+(parseInt(a.getComputedStyle("padding-left"))||0)+(parseInt(a.getComputedStyle("padding-right"))||0)+(parseInt(a.getComputedStyle("border-left-width"))||0)+(parseInt(a.getComputedStyle("border-right-width"))||0)};ta.util.element.getTotalHeight=function(a){if(!a){return 0}return(parseInt(a.getComputedStyle("height"))||a.getHeight()||0)+(parseInt(a.getComputedStyle("margin-top"))||0)+(parseInt(a.getComputedStyle("margin-bottom"))||0)+(parseInt(a.getComputedStyle("padding-top"))||0)+(parseInt(a.getComputedStyle("padding-bottom"))||0)+(parseInt(a.getComputedStyle("border-top-height"))||0)+(parseInt(a.getComputedStyle("border-bottom-height"))||0)};ta.util.element.copyAjaxPreserves=function(f,g){var d,e,h,c,a,j,b;if(!g||!f){return}d=g.getElements(".ajax_preserve");if(d&&d.length>0){h={};e=f.getElements(".ajax_preserve, .ajax_preserve_noreplace");for(c=0;c<e.length;++c){a=e[c].getAttribute("data-ajax-preserve");if(a){h[a]=e[c]}}for(c=0;c<d.length;++c){j=d[c];a=j.getAttribute("data-ajax-preserve");if(!a||!j.parentElement){continue}b=h[a];if(b){j.parentElement.replaceChild(b,j)}}}};ta.util.element.replaceContentWithAjaxPreserve=function(c,b){ta.util.element.copyAjaxPreserves(b,c);b.innerHTML="";var a=document.createDocumentFragment();while(c.firstChild){a.appendChild(c.firstChild)}b.appendChild(a)};ta.util.element.setContentElementWithAjaxPreserve=function(c,a,b){ta.util.element.copyAjaxPreserves(c,a);if(b){a.replaces(c)}else{c.innerHTML="";c.appendChild(a)}};ta.util.link={ajaxSubmit:function(a,c,b){if(a){new Event(a).preventDefault()}if(b){ta.util.cookie.setPIDCookie(b)}if(!c.className.match(/\bform_(\w+)\b/)){return}var f=$(RegExp.$1);var e={url:c.href,data:f,onFailure:function(h){if(f){f.removeClass("ajaxInFlight")}ta.util.error.ajaxFailure("link - ajaxSubmit",h)}};var g=window["callback"+f.id];if(c.className.match(/method_(\w+)\b/)){e.method=RegExp["$1"]}if(c.className.match(/\btgt_(\w+)\b/)){e.update=RegExp["$1"]}else{e.onSuccess=function(h){if(f){f.removeClass("ajaxInFlight")}ta.overlays.showInLightbox(h);if(g&&typeOf(g)=="function"){g()}}}var d=window["validate"+f.id];if(d&&typeOf(d)=="function"&&d.apply(f)==false){return}f.addClass("ajaxInFlight");if(c.className.match(/\bevalScripts\b/)){e.evalScripts=true}(e.update?new Request.HTML(e):new Request(e)).send()},ajaxCall:function(a,b){if(a){new Event(a).preventDefault()}if(!(tgt=b.className.match(/\btgt_(\w+)\b/))){return}tgt=$(tgt[1]);new Request.HTML({url:b.href,update:tgt,onFailure:ta.util.error.ajaxFailure.partial("link - ajaxCall")}).send()},popResWidth:function(b,e,d){try{var a=475,f=390,i=210;if(screen.width>1024){a=800;f=600;i=240}else{if(screen.width>800){a=620;f=500;i=240}}var g=Object.merge({width:a,height:f,xOffset:i,yOffset:5},d);ta.util.link.popup(b,e,g)}catch(c){ta.util.error.record(c,"ta.util.link - popCustom",b,g)}},popPhoto:function(a,d,c){try{Cookie.write("PhotoPop","1",{domain:cookieDomain});var e=Object.merge({name:"media",width:782,height:820},c);ta.util.link.popup(a,d,e)}catch(b){ta.util.error.record(b,"ta.util.link - popPhoto",a,e)}},popup:function(m,a,j){try{var g=Object.merge({name:false,width:950,height:610,xOffset:false,yOffset:false,noScroll:0,aHref:false,fullOptions:true,ensureReferrer:false,isAsdf:false},j);new Event(m).preventDefault();var f=false,b="",l=false;var c=1;if(ta.has("ta.popups.popupIndex")&&typeof ta.retrieve("ta.popups.popupIndex")!="undefined"){c=ta.retrieve("ta.popups.popupIndex")}if(!g.aHref){g.aHref=a.href}g.aHref=g.aHref.replace("%7Cnavarea%7C",ta.meta.link.getPhotoNavArea(a));if(g.isAsdf&&g.aHref){if(ta.util.ASDF.asdfDcd){g.aHref=ta.util.ASDF.asdfDcd(g.aHref).replace(/&amp;/g,"&")}}if(g.aHref&&g.aHref.indexOf("p=HotelsCom")>-1){g.width=Math.max(g.width,960);try{g.height=Math.max(g.height,window.getHeight(),600)}catch(h){g.height=Math.max(g.height,600)}}if(g.width){b+=",width="+g.width}if(g.height){b+=",height="+g.height}if(g.xOffset){b+=",screenX="+g.xOffset+",left="+g.xOffset}if(g.yOffset){b+=",screenY="+g.yOffset+",top="+g.yOffset}if(!Browser.chrome){g.noScroll=1}if(g.fullOptions){var i=1;if(ta.browser.isIE9orHigher()){i=0}b="toolbar=1,resizable=1,menubar="+i+",location=1,status=1,scrollbars="+g.noScroll+b}else{b="toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars="+g.noScroll+b}if(!g.name){g.name="p"+(c++)}ta.store("ta.popups.popupIndex",c);if(g.ensureReferrer&&Browser&&Browser.ie){try{l=new Element("a",{target:g.name,href:g.aHref});l.inject(ta.id(document.body),"bottom");f=window.open("",g.name,b);l.click();l.destroy()}catch(d){ta.util.error.record(d,"ta.util.link - pop ensure referrer",m,g)}}else{try{f=window.open(g.aHref,g.name,b)}catch(h){ta.util.error.record(h,"ta.util.link - popping window",m,{href:g.aHref,name:g.name,args:b})}}if(typeof f!="undefined"&&f!==null){try{f.opener=self;f.focus()}catch(d){}}}catch(k){ta.util.error.record(k,"ta.util.link - popup",m,g)}},directionsPop:function(a,c,b,d){if(d){new Request({url:"/ActionRecord?action="+d}).send()}if(ta.trackEventOnPage){ta.trackEventOnPage("map_pin_overlay","directions_click")}ta.util.link.popup(a,c,b)},directionsPopInfoCard:function(a,c,b,d){if(d){new Request({url:"/ActionRecord?action="+d}).send()}if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","map_info_window","directions_cta")}ta.util.link.popup(a,c,b)},targetBlank:function(a,d,c){try{var e=Object.merge({aHref:false,isAsdf:false},c);if(e.isAsdf&&e.aHref){if(ta.util.ASDF.asdfDcd){e.aHref=ta.util.ASDF.asdfDcd(e.aHref).replace(/&amp;/g,"&")}}var f=c&&c.action&&(c.action=="website"||c.action=="deals"||c.action=="packages");if(ta.retrieve("ta.bl_calendar_lb")&&!ta.widgets.calendar.hasPageDates()&&f){ta.run("ta.overlays.Factory.loadCheckRatesLBOverlay",{},a,d,{detail:c.detailId,gaContext:"BLLightbox-"+c.action})}if(e.newTab||navigator.appVersion.indexOf("MSIE 7.")!=-1){window.open(e.aHref,"_blank")}else{if(ta.retrieve("ta.bl_calendar_lb")&&f){ta.servlet.Popup.openExternalWithDefaultOptions(e.aHref)}else{window.open(e.aHref,"_blank")}}}catch(b){ta.util.error.record(b,"ta.util.link - targetBlank",a,e)}}};ta||(ta={});ta.util||(ta.util={});ta.util.localstorage=(function(a,d,b,e){var f="taLsTest",c="1";return{canUseLocalStore:function(){try{if(d.localStorage){localStorage.setItem(f,c);return(c===localStorage.getItem(f))}}catch(g){}return false},canUseSessionStore:function(){try{if(d.sessionStorage){sessionStorage.setItem(f,c);return(c===sessionStorage.getItem(f))}}catch(g){}return false}}}(document,window,ta));(function(a){a.util.sessionStorage={};a.util.sessionStorage.canUseSessionStore=function(){try{if(window.sessionStorage){var c="taLsTest";sessionStorage.setItem(c,"1");var b=sessionStorage.getItem(c);return(b=="1")}}catch(d){return false}}}(ta));(function(){window.ta||(window.ta={});window.ta.util||(window.ta.util={});if(window.ta.util.Deferred){return}var a=["success","failure","always","progress"];var e={resolved:["success","always"],rejected:["failure","always"]};var g=function(){};function h(i){g.prototype[i]=function(k,j){return b(this,i,j?k.bind(j):k)}}for(var d=0;d<a.length;d++){h(a[d])}g.prototype.then=function(j,k){var i=this.success(j);return k?i.failure(k):i};window.ta.util.Deferred=function(l){var i="pending";var k=new g();k.queue=[];k.args=null;k.aplus=(typeof l==="boolean")&&l;k.status=function(){return i};var j={notify:function(){if(c(i)){throw new Error("Promise has already been fulfilled.")}var n=Array.prototype.slice.call(arguments);var p,o,m;for(o=0,m=k.queue.length;o<m;o++){p=k.queue[o];if(p.hook==="progress"){p.callback.apply(null,n)}}return k},resolve:function(){if(c(i)){throw new Error("Promise has already been fulfilled.")}i="resolved";k.args=Array.prototype.slice.call(arguments);return f(k)},reject:function(){if(c(i)){throw new Error("Promise has already been fulfilled.")}i="rejected";k.args=Array.prototype.slice.call(arguments);return f(k)},isFulfilled:function(){return c(i)},promise:function(){return k}};return j};var c=function(i){return i==="resolved"||i==="rejected"};var b=function(j,i,k){if(j.fwd){return b(j.fwd,i,k)}j.queue.push({hook:i,callback:k});return f(j)};var f=function(k){if(k.fwd){return f(k.fwd)}var j,i;while(c(k.status())&&(j=k.queue.shift())){if(~e[k.status()].indexOf(j.hook)){i=j.callback.apply(null,k.args);if(i instanceof g){i.queue=i.queue.concat(k.queue.splice(0));k=k.fwd=i}else{if(i&&k.aplus){k.args=[i]}}}}return k}}());ta.util.decoder={base64Decoder:function(g){g=g.replace(/\-/g,"+").replace(/\_/g,"/");if(g.length%4!==0){var h=4-g.length%4;for(var f=0;f<h;f++){g=g+"="}}var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="",p,n,k="",o,l,j,i="";for(var e=0;e<g.length;e+=4){o=d.indexOf(g.charAt(e));l=d.indexOf(g.charAt(e+1));j=d.indexOf(g.charAt(e+2));i=d.indexOf(g.charAt(e+3));if(o==-1||l==-1||j==-1&&i==-1){ta.util.error.record(null,"Facebook signed request contains invalid base64 letter",null,{code:g});return}p=(o<<2)|(l>>4);n=((l&15)<<4)|(j>>2);k=((j&3)<<6)|i;a=a+String.fromCharCode(p);if(j!=64){a=a+String.fromCharCode(n)}if(i!=64){a=a+String.fromCharCode(k)}p=n=k="";o=l=j=i=""}return unescape(a)}};ta.util.files={reset:function(a){if(Browser.ie){a.clone(false,true).replaces(a)}else{a.value=""}},upload:function(c,e,g){function b(j,h){var k;try{k=document.createElement("<"+j+' name="'+h+'">')}catch(i){k=document.createElement(j);k.setAttribute("name",h)}return k}var f="upload_iframe_"+(Math.random()+"").split(".")[1];var d=b("iframe",f);d.setAttribute("id",f);d.setAttribute("src","about:blank");d.setAttribute("width","0");d.setAttribute("height","0");d.setAttribute("border","0");d.setAttribute("style","width:0; height:0; border:none; display:none; ");document.body.appendChild(d);c.target=f;function a(){ta.id(d).removeEvent("load",a);var h=d.contentWindow.document;g(h);setTimeout(function(){d.parentNode.removeChild(d)},250)}ta.id(d).addEvent("load",a);c.submit()}};ta.util.replace=(function(){return{img:function(b,a){try{b.src=ta.retrieve(a).src}catch(c){}}}})();(function(a){a.util||(a.util={});a.util.ajax=function(l){l||(l={});try{if(l.trackEvent&&a.analytics){var c=a.analytics._toEvtParams(l.trackEvent);l.data=a.util.merge(l.data||{},c)}}catch(f){if(a.util&&a.util.error&&a.util.error.record){a.util.error.record(f,"ta.util.ajax.initialize.trackEvent")}}var k=a.util.Deferred(l.aplus);var j=function(e){};var i,d;var g=function(e){if(!e){return""}return e.replace(/^\s*while\(1\);\s*/,"")};var h={onComplete:typeof l.onComplete==="function"?l.onComplete:j,onSuccess:typeof l.onSuccess==="function"?l.onSuccess:j,onFailure:typeof l.onFailure==="function"?l.onFailure:j,onReadOnly:l.onReadOnly||j,onRedirect:l.onRedirect||j};l.onComplete=function(){var m;var q=i.getResponseHeader("content-type");var n=l&&l.useContentType;try{if(!n||(q.indexOf("application/json")>=0)){var p=g(i.responseText);m=JSON.decode?JSON.decode(p):JSON.parse(p)}}catch(o){}if(!m){m={text:i.responseText}}if(!m.code){m.code=i.status||0}m.contentType=q;try{if(l&&l.trackEvent&&a.analytics){a.analytics._trackEventAfterAjax(this.options.trackEvent)}}catch(o){if(a&&a.util&&a.util.error&&a.util.error.record){a.util.error.record(o,"ta.util.ajax.onComplete.trackEventAfterAjax")}}if(m.code>=200&&m.code<300){m.status="ok";k.resolve(m)}else{if(m.code===301||m.code===302){m.status="redirect";k.reject(m)}else{m.status||(m.status="error");k.reject(m)}}};l.onCancel=function(){k.reject({code:0,status:"abort"})};l.onTimeout=function(){k.reject({code:0,status:"timeout"})};delete l.onLoadStart;delete l.onProgress;delete l.onException;delete l.onSuccess;delete l.onFailure;i=b(l);if(typeof l.onRequestCreated==="function"){l.onRequestCreated(i)}return k.promise().always(function(e){h.onComplete.call(i,e);if(e.status==="redirect"){h.onRedirect.call(i,e)}else{if(e.status==="readonly"){h.onReadOnly.call(i,e)}else{if(~["abort","timeout","error"].indexOf(e.status)){h.onFailure.call(i,e)}else{h.onSuccess.call(i,e)}}}})};function b(d){if(typeof MooTools!=="undefined"&&typeof Request!=="undefined"){return(new Request(d).send()).xhr}var h=new XMLHttpRequest();var j=h.abort.bind(h);var i=d.method?d.method.toUpperCase():"GET";var g=d.url||"/";var c=[];var f,e;if(d.withCredentials){h.withCredentials(true)}h.onreadystatechange=function(){if(this.readyState===4){clearTimeout(f);d.onComplete()}};h.abort=function(){j();d.onCancel()};if(d.timeout){f=setTimeout(function(){j();d.onTimeout()},d.timeout)}d.data||(d.data={});for(e in d.data){if(d.data.hasOwnProperty(e)&&d.data[e]!==null){c.push(e+"="+encodeURIComponent(d.data[e]))}}if(/GET/.test(i)){g+=(/\?/.test(g)?"&":"?")+c.join("&")}if(/POST/.test(i)){d.headers||(d.headers={});d.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"}h.open(i,g);for(e in d.headers){h.setRequestHeader(e,d.headers[e])}d.onRequest&&d.onRequest.call(h);h.send(/POST/.test(i)?c.join("&"):null);return h}}(ta));try{(function(a){a.util||(a.util={});a.util.imageServer=function(c){var b=(typeof(CDNHOST)==="string"&&CDNHOST)||(typeof(cdnhost)==="string"&&cdnhost);if(b&&c){if(!/^\//.test(c)){c="/"+c}c=b+c}return c}})(ta)}catch(e){ta.util.error.record(e,"cannot do ta.util.imageServer",null,{path:path})};ta.common.search={ta_repoll:null,getRepoll:function(){if(!this.ta_repoll){this.ta_repoll=ta.common.Repoll()}return this.ta_repoll},langSelect:function(b,a){if(a.form.elements.q.value.length>0){a.form.submit()}},useCurrentLocation:function(a){ta.select(".locNotFound.hidden").removeClass("hidden")},clearOnFocus:function(b,a){if(a.value==a.defaultValue){a.value="";a.removeClass("focusClear")}},defaultOnBlur:function(b,a){if(a.value==""){a.addClass("focusClear");a.value=a.defaultValue}},getFormFields:function(c){var d={};for(var a=0;a<c.elements.length;++a){var b=c.elements[a];if(b.name===""||b.nodeName!=="INPUT"||!b.value){continue}d[b.name]=b.value}return d},getUrlFromForm:function(c){var e=c.action;var a=ta.common.search.getFormFields(c);var d=[];for(var b in a){d.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]))}return e+"?"+d.join("&")},validate:function(b,a){if(a.q.value.trim()==""||$(a.q).hasClass("focusClear")){return false}setOneTimeCookie("SRCHACT","NEW");return true},recordAndValidate:function(e,i,g,k,m){if(g||ta.common.search.validate(e,i)){k=k||ta.retrieve("ta_typeahead_widget");var n=function(){if(k&&k.options&&k.options.onSubmit){var q=ta.common.search.getUrlFromForm(i);var p=e?e.type:"";k.options.onSubmit(k,q,m,p)}i.submit()};if(k&&k.options&&k.options.skipRecordAfterValidate){k.hide();n();return false}var h=k&&k.options?k.options.startTime:undefined;var l=k?k.lastSuccessfulQuery:undefined;var d=k&&k.options&&k.options.geoId;var c=k&&k.options?k.options.name:undefined;var b=k&&k.historyShown;var j=ta.id("TYPEAHEAD_REDIRECT");j.value="true";var o=ta.id("MASTAHEAD_TYPEAHEAD_START_TIME");o.value=h;var a=ta.id("MASTAHEAD_TYPEAHEAD_UI_ORIGIN");a.value=c;if(k){k.hide()}var f=k&&k.options?k.options.searchSessionId:undefined;if(!f){f="no_search_session_id"}if(!m){new Request({method:"GET",data:{action:"RECORD",eventType:"search_bttn",startTime:h,source:c,query:l,uiOrigin:c,global:(!d||pageServlet=="Search"),scope:(!d||pageServlet=="Search")?"G":d,hadHistory:b,searchSessionId:f},onSuccess:n,onFailure:n,url:"/TypeAheadJson"}).send()}else{n()}}return false},selectLang:function(b,d){try{var n=function(o){var e=o.match(/([\d.]+)px/);if(e){return parseFloat(e)}return 0};var g=ta.id("SEARCH_LANG_SELECT_POPUP");if(!g){return false}if(!g.hasClass("hidden")){var f=ta.id("SEARCH_LANG_SELECT_INPUT");var i=ta.id("SEARCH_LANG_SELECTED");if(f){var h=d.id.match(/lang_(.+)/);if(h){var c=h[1];if("all"==c){f.value=""}else{f.value=c}}if(i){if(ta.isFall2013MastheadRefresh()){if(h){g.getElements(".langSelectOption").removeClass("selected");d.addClass("selected")}}else{i.set("html",ta.id(d).get("html"))}}}g.addClass("hidden");if(!ta.isFall2013MastheadRefresh()&&i&&!ta.common.search.widthfixed){var j=ta.common.search.width;var l=n(i.getStyle("width"));var a=Math.max(j,l);if(j!=l){i.setStyle("width",a+"px");ta.common.search.widthfixed=true}}}else{g.removeClass("hidden");if(!ta.isFall2013MastheadRefresh()){var i=ta.id("SEARCH_LANG_SELECTED");if(i&&!ta.common.search.widthfixed){ta.common.search.width=n(i.getStyle("width"))}}}}catch(k){ta.util.error.record(k,"select search lang")}},reviews:function(c,b){new Request({url:"/ActionRecord?action=SearchReviews"}).send();if(b&&b.getElement){var a=b.getElement(".searchTestText");if(a){alert(a.innerHTML)}}else{alert("Coming Soon!")}return false},replaceOrAddParam:function(b,a){var e=a.split("=");var g=e[0];var f=e[1];var d=new RegExp("([\\?#&])("+g+"=\\w+)");var c=d.exec(b);if(c){return b.replace(d,"$1"+a)}else{return b+"&"+a}},extractParam:function(b,e,d){var c=new RegExp("[\\?#&]"+e+"=(\\w+)");var a=c.exec(b);if(a){return a[1]}else{if(d){return d}}return null},selectOption:function(b,d){var p=function(e){do{e=e.getParent()}while(e&&e.nodeName!=="FORM");return e};var c=ta.id(d);var i=ta.id(p(c));try{var o=function(q){var e=q.match(/([\d.]+)px/);if(e){return parseFloat(e)}return 0};var h=i.getElement(".SEARCH_SELECT_POPUP");if(!h){return false}if(!h.hasClass("hidden")){h.addClass("hidden");var f=i.getElement(".SEARCH_SELECT_INPUT");var j=i.getElement(".SEARCH_SELECTED");if(f){var g=c.hasClass("lang_all");if(g){f.value=1}else{f.value=2}if(j){j.set("html",c.get("html"))}}if(j){var k=ta.common.search.width;var n=o(j.getStyle("width"));var a=Math.max(k,n);j.setStyle("width",a+"px")}}else{h.removeClass("hidden");var j=i.getElement(".SEARCH_SELECTED");if(j){ta.common.search.width=o(j.getStyle("width"))}}}catch(l){ta.util.error.record(l,"select search lang")}},buildSearchHref:function(d,e,f,j){var a=window.location.hash;var f=f||0;if(d){a=ta.common.search.replaceOrAddParam(a,"ssrc="+d)}if(j){a=ta.common.search.replaceOrAddParam(a,"dist="+j)}a=ta.common.search.replaceOrAddParam(a,"o="+f);window.location.hash=a;var i=ta.retrieve("searchTrackingId");var g=ta.retrieve("searchRefinementId");var h=ta.retrieve("sessionId");var c=ta.retrieve("searchSessionId");var b=window.location.href;b=b.replace(/#.*/,"");if(i){b=ta.common.search.replaceOrAddParam(b,"sid="+i)}if(g){b=ta.common.search.replaceOrAddParam(b,"rf="+g)}if(h){b=ta.common.search.replaceOrAddParam(b,"sessionId="+h)}if(c){b=ta.common.search.replaceOrAddParam(b,"searchSessionId="+c)}if(!d){d=ta.common.search.extractParam(a,"ssrc","a")}b=ta.common.search.replaceOrAddParam(b,"actionType=updatePage");b=ta.common.search.replaceOrAddParam(b,"ssrc="+d);b=ta.common.search.replaceOrAddParam(b,"dist="+j);b=ta.common.search.replaceOrAddParam(b,"o="+f);b=ta.common.search.replaceOrAddParam(b,"ajax=search");return b},loadSRPlacement:function(f){function a(){var n=0;var l=ta.find(".pagination .currentPageNumber");var k=30;if(l){var g=l.get("data-position");if(g){n=(g-1)*k}}var j="a";var m=ta.id("SEARCH_FILTERS_COLUMN");if(m&&m.getElement(".selected")){j=m.getElement(".selected").id}var i=ta.common.search.buildSearchHref(j,"PG",n);var h=ta.retrieve("resultCacheKey");if(h){i+="&resultCacheKey="+h}return i}if(!ta.retrieve("commerce_on_srp")){return}if(!ta.widgets.calendar.hasPageDates()){return}var c=document.getElements(".result.LODGING").length!==0;var e=!ta.id("page-repoll-not-done");if(!f&&(!c||e)){return}var b=a();var d=this.getRepoll();d.setPageUrl(b);d.setNotDone()}};if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["ta/common/Flyout","ta/servlet/Reviews","utils/cookieutils","ta/maps/opener"],["ta","ta","ta","ta","ta","ta","ta","ta","ta","ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"ta-core-lite",files:{"js-amd":{src:{utils:{cookieutils:1}}},js3:{src:{ta:{common:{Flyout:1},maps:{opener:1},servlet:{Reviews:1}}}}},_:{baseUrl:"/"}})};define("overlays/utils",["api-mod"],function(b){var a={};a.arrowDir={above:"bottom",below:"top",left:"right",right:"left",leftEvenInRtl:"right",rightEvenInRtl:"left",bottomRight:"top",bottomLeft:"top"};a.arrowDirRtl={above:"bottom",below:"top",left:"right",right:"left",leftEvenInRtl:"left",rightEvenInRtl:"right",bottomRight:"top",bottomLeft:"top"};a.getArrowDir=function(i,g,c){var f=(b.hasClass(document.body,"rtl")?a.arrowDirRtl:a.arrowDir);if(i==="wideside"&&g&&c){var e=b.getSize(g);var d=b.getPosition(g);var h=b.getSize(c);return d.left>(h.x-d.left-e.x)?f.left:f.right}return f[i]};a.injectContent=function(d,e,g,c,f){if(b.isElement(g)){b.adopt(d,g)}else{if(c){g=b.find(c,e);b.removeClass(g,"hidden");b.adopt(d,g)}else{if(f){g=b.find(f);g&&(d.innerHTML+=g.innerHTML)}else{d.innerHTML+=g}}}};a.injectContentWithDataAttrs=function(d,e,g,c,f){g=g||(e&&e.getAttribute("data-content"))||"";c=c||(e&&e.getAttribute("data-element"))||"";f=f||(e&&e.getAttribute("data-element-copy"))||"";a.injectContent(d,e,g,c,f)};a.parseOffsets=function(c){if(!c||!c.length){return{x:0,y:0}}return{x:c[0]&&parseInt(c[0],10)||0,y:c[1]&&parseInt(c[1],10)||0}};a.loadingSpinnerHtml=function(){var e='<div style="padding:36px; min-width: 100px; min-height: 100px">';if(window.AnimationEvent){e+='<div class="cssLoadingSpinner" style="display:block">'}var d=window.CDNHOST||ta.retrieve("CDNHOST");e+='<div class="spinnerImage" style="position: absolute; top: 50%; left: 50%; width: 32px; height: 32px; margin-top: -16px; margin-left: -16px; background:url('+d+'/img2/generic/site/ajax-loader.gif)"></div>';if(window.AnimationEvent){for(var c=1;c<=8;c++){e+='<div class="cssLoadingSpinner_step'+c+'"></div>'}e+="</div>"}return e+"</div>"};return a});define("overlays/Overlay",["api-mod","mixins/Events","overlays/utils"],function(d,c,b){var a=function(g,e){this.sourceElement=g;this.domParent=document.body;this.container=null;this.contentElement=null;d.mixin(this,new c("show","hide","destroy","positionDirty","hover"));d.bindAll(this,"show","hide","destroy");var e=(e&&Object.prototype.toString.call(e)==="[object Array]"?e:Array.prototype.slice.call(arguments,1));for(var f=0;f<e.length;f++){e[f]&&e[f].call(this)}};a.prototype.isOpen=function(){return d.inDocument(this.container)};a.prototype.show=function(){if(d.inDocument(this.container)){return this}this.domParent.appendChild(this.container);this.emit("show");return this};a.prototype.hide=function(e){if(!d.inDocument(this.container)){return this}this.domParent.removeChild(this.container);this.emit("hide",{trigger:e});return this};a.prototype.destroy=function(){this.hide();this.emit("destroy");this.sourceElement=null;this.contentElement=null;return this};a.prototype.reposition=function(){this.emit("positionDirty");return this};a.prototype.updateContent=function(e){this.contentElement.innerHTML="";b.injectContentWithDataAttrs(this.contentElement,this.sourceElement,e);return this.reposition()};return a});define("overlays/styles/modal",["api-mod","overlays/utils"],function(c,b){function d(f,g,h,e){this.container=c.createElement("span",{"class":"ui_overlay ui_modal "+g});if(h){this.header=c.createElement("div",{"class":"header_text"});this.header.innerHTML=h;this.container.appendChild(this.header)}if(e){this.subheader=c.createElement("div",{"class":"subheader_text"});this.subheader.innerHTML=e;this.container.appendChild(this.subheader)}this.inner=c.createElement("div",{"class":"body_text"});this.container.appendChild(this.inner);this.contentElement=this.inner;this.close=c.createElement("div",{"class":"ui_close_x"});this.container.appendChild(this.close)}var a=function(h,g,f,j,e,i){f=f||(h&&h.getAttribute("data-modal"))||"";j=j||(h&&h.getAttribute("data-header"))||"";e=e||(h&&h.getAttribute("data-subheader"))||"";return function(){d.call(this,g,f,j,e);this.updateContent(i);c.addEvent(this.close,"click",c.bind(function(){this.hide.apply(this,arguments)},this,"close-button"))}};return a});define("overlays/position",["api-mod","overlays/utils","utils/browserutils"],function(i,g,f){function d(o,n,m,l){return function(p,r,q){return function(){function s(){var u=i.getSize(this.container),z=i.getSize(this.arrow)||{x:0,y:0},A=a(p,this.sourceElement),v=(A?i.getSize(A):{x:0,y:0}),x=(A?i.getPosition(A):{left:0,top:0}),D=i.getSize(this.domParent),w=g.parseOffsets(k(p)),y=!A||r||h(this.sourceElement);this.container.style.position=y&&!q?"fixed":"absolute";if(A&&A.getAttribute("data-anchorWidth")){if(i.hasClass(document.body,"rtl")){x.left+=v.x;v.x=Number(A.getAttribute("data-anchorWidth"));x.left-=v.x}else{v.x=Number(A.getAttribute("data-anchorWidth"))}}if(m&&l){this.container.style.position="fixed";this.container.style.left=(o()+w.x)+"px";this.container.style.top=(n()+w.y)+"px";this.container.style.right=(m()+w.x)+"px";this.container.style.bottom=(l()+w.y)+"px"}else{this.container.style.right="auto";var B=Math.floor(o(u,z,v,x,D,y))+w.x;if(this.domParent===document.body){B=Math.max(B,0);if(B+u.x>D.x){B=D.x-u.x}}this.container.style.left=B+"px";var C=Math.floor(n(u,z,v,x,D,y))+w.y;this.container.style.top=C+"px"}}this.on("show",s);this.on("positionDirty",s);this.reposition=s.bind(this)}}}function b(l,m){return function(){return function(){function n(){var o=i.getSize(this.container);this.container.style.position="fixed";if(l){if(i.hasClass(document.body,"rtl")){this.container.style.right="50%";this.container.style.marginRight=-o.x/2+"px"}else{this.container.style.left="50%";this.container.style.marginLeft=-o.x/2+"px"}}if(m){this.container.style.top="50%";this.container.style.marginTop=-o.y/2+"px"}}this.on("show",n);this.on("positionDirty",n)}}}function j(){return function(){return function(){function l(){this.container.addClass("cssCentered")}this.on("show",l);this.on("positionDirty",l)}}}function a(m,l){if(!m||!m.length||!isNaN(m[0])){return l}return l&&i.find(m[0],l)}function k(l){if(!l||!l.length||!isNaN(l[0])){return l}return l.slice(1)}function h(l){while(l){if(l==document.body){return false}if(l.style.position){return l.style.position=="fixed"}if(l.currentStyle&&l.currentStyle.position==="fixed"){return true}if(window.getComputedStyle&&getComputedStyle(l).getPropertyValue("position")==="fixed"){return true}l=l.parentNode}return false}var e={};e.above=d(function(q,n,l,m,p,o){return m.left+(l.x/2)-(q.x/2)-(o?i.scrollLeft():0)},function(q,n,l,m,p,o){return m.top-q.y-n.y-(o&&!f.Platform.ios?i.scrollTop():0)});e.below=d(function(q,n,l,m,p,o){return m.left+(l.x/2)-(q.x/2)-(o?i.scrollLeft():0)},function(q,n,l,m,p,o){return m.top+(l.y)+n.y-(o&&!f.Platform.ios?i.scrollTop():0)});e.bottomRight=d(function(q,n,l,m,p,o){return m.left-(o?i.scrollLeft():0)},function(q,n,l,m,p,o){return m.top+(l.y)+n.y-(o&&!f.Platform.ios?i.scrollTop():0)});e.bottomLeft=d(function(q,n,l,m,p,o){return m.left-(q.x-l.x)-(o?i.scrollLeft():0)},function(q,n,l,m,p,o){return m.top+(l.y)+n.y-(o&&!f.Platform.ios?i.scrollTop():0)});e.left=d(function(q,n,l,m,p,o){return m.left-q.x-n.x-(o?i.scrollLeft():0)},function(q,n,l,m,p,o){return m.top+(l.y/2)-(q.y/2)-(o&&!f.Platform.ios?i.scrollTop():0)});e.right=d(function(q,n,l,m,p,o){return m.left+l.x+n.x-(o?i.scrollLeft():0)},function(q,n,l,m,p,o){return m.top+(l.y/2)-(q.y/2)-(o&&!f.Platform.ios?i.scrollTop():0)});e.wideside=d(function(q,n,l,m,p,o){if(m.left>(p.x-m.left-l.x)){return m.left-q.x-n.x-(o?i.scrollLeft():0)}else{return m.left+l.x+n.x-(o?i.scrollLeft():0)}},function(q,n,l,m,p,o){return m.top+(l.y/2)-(q.y/2)-(o&&!Browser.Platform.ios?i.scrollTop():0)});e.center=d(function(p,n,l,m,o){return(o.x/2)-(p.x/2)},function(q,n,l,m,p,o){return(p.y/2)-(q.y/2)+(o?0:i.scrollTop())});e.topCenter=d(function(p,n,l,m,o){return(o.x/2)-(p.x/2)},function(q,n,l,m,p,o){return 0});e.movingCenter=b(true,true);e.movingCenterX=b(true,false);e.movingCenterY=b(false,true);e.cssCentered=j();e.absolute=d(function(){return 0},function(){return 0});e.framed=d(function(){return 0},function(){return 0},function(){return 0},function(){return 0});e.offScreen=d(function(){return -10000},function(){return -10000});e.noop=function(){return function(){}};e.rightEvenInRtl=e.right;e.leftEvenInRtl=e.left;if(typeof(document)!="undefined"&&i.hasClass(document.body,"rtl")){e.left=e.rightEvenInRtl;e.right=e.leftEvenInRtl;var c=e.bottomRight;e.bottomRight=e.bottomLeft;e.bottomLeft=c}return e});define("overlays/options/closeOnEscape",["api-mod"],function(b){function c(d){if(d.keyCode===27){this.hide("escape")}}var a=function(){var d=b.bind(c,this);this.on("show",function(){b.addEvent(document,"keydown",d)}).on("hide",function(){b.removeEvent(document,"keydown",d)})};return a});define("overlays/options/repositionOnEvent",["api-mod"],function(a){function b(){this.emit("positionDirty")}return function(d,c){return function(){var f=c.splice?c:[c];var e=a.bind(b,this);this.on("show",function(){f.forEach(function(g){a.addEvent(d,g,e)})}).on("hide",function(){f.forEach(function(g){a.removeEvent(d,g,e)})})}}});define("overlays/options/autoReposition",["overlays/options/repositionOnEvent"],function(a){return a(window,["resize","scroll"])});define("overlays/styles/windowshade",["api-mod"],function(b){var a=function(c){return function(){this.shade=b.createElement("div",{"class":"ui_backdrop "+(c||"dark")});this.on("show",function(){this.domParent.appendChild(this.shade)});var d=this.hide;this.hide=function(){if(b.inDocument(this.shade)){this.domParent.removeChild(this.shade)}d.apply(this,arguments)}}};return a});define("utils/objutils",[],function(){var l=function(y){return y};var k=function(y){return true};var b=function(y){return false};if(typeof(Object.freeze)==="function"){l=Object.freeze.bind(Object);b=Object.isFrozen.bind(Object);k=Object.isFrozen.bind(Object)}function r(y,z){for(var x in z){if(z.hasOwnProperty(x)){y[x]=z[x]}}return y}function w(){var G,z,x,y,D,E,C=arguments[0]||{},B=1,A=arguments.length,F=false;if(typeof C==="boolean"){F=C;C=arguments[B]||{};B++}if(typeof C!=="object"&&!a(C)){C={}}for(;B<A;B++){if((G=arguments[B])!=null){for(z in G){x=C[z];y=G[z];if(C===y){continue}if(F&&y&&(p(y)||(D=j(y)))){if(D){D=false;E=x&&j(x)?x:[]}else{E=x&&p(x)?x:{}}C[z]=w(F,E,y)}else{if(y!==undefined){C[z]=y}}}}}return C}function u(y){if(typeof(y)!=="object"||y===null||k(y)){return y}for(var x in y){if(y.hasOwnProperty(x)){y[x]=u(y[x])}}return l(y)}function s(y){if(typeof(y)!=="object"||y===null){return y}for(var x in y){if(y.hasOwnProperty(x)){var z=y[x];if(z===null){delete y[x]}else{s(z)}}}return y}function d(A){var y;if(typeof(A)!=="object"||A===null){return A}if(A.constructor===Array){y=[];for(var z=0;z<A.length;++z){y.push(d(A[z]))}}else{y={};for(var x in A){if(A.hasOwnProperty(x)){y[x]=d(A[x])}}}return l(y)}function f(A){var y;if(typeof(A)!=="object"||A===null){return A}if(A.constructor===Array){y=[];for(var z=0;z<A.length;++z){y.push(f(A[z]))}}else{y={};for(var x in A){if(A.hasOwnProperty(x)){y[x]=f(A[x])}}}return y}function n(A){var y;if(typeof(A)!=="object"||A===null){return A}y=A;if(A.constructor===Array){if(b(A)){y=[];y.length=A.length}for(var z=0;z<A.length;++z){y[z]=n(A[z])}}else{if(b(A)){y={}}for(var x in A){if(A.hasOwnProperty(x)){y[x]=n(A[x])}}}return y}function t(z){var x;if(typeof(z)!=="object"||z===null){return z}if(z.constructor===Array){x=[];for(var y=0;y<z.length;++y){x.push(z[y])}}else{x=r({},z)}return x}function c(z,y){if(z!==y){if(z){if(!y||(z.length!==y.length)){return false}for(var x=0;x<z.length;x++){if(z[x]!==y[x]){return false}}}else{return !y}}return true}function h(A,z){if(A!==z){if(A){if(!z){return false}if(j(A)&&j(z)){return c(A,z)}var y=Object.keys(A);if(!c(y,Object.keys(z))){return false}for(var x=0;x<y.length;x++){if(A[y[x]]!==z[y[x]]){return false}}}else{return !z}}return true}function g(y,A){var x={};var z,B;for(z=0;z<y.length;++z){B=y[z];x[B[A]]=B}return x}function m(z,y){var x=z[y];if(!(x||z.propertyIsEnumerable(y))){throw"missing property: "+y}return x}function i(z,x){for(var y in z){if(z.hasOwnProperty(y)&&!x(z,z[y])){delete z[y]}}return z}function j(x){if(Array.isArray){return Array.isArray(x)}return Object.prototype.toString.call(x)==="[object Array]"}function v(A,y,z){var x;if(y){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(y,A,z)}x=y.length;z=z?z<0?Math.max(0,x+z):z:0;for(;z<x;z++){if(z in y&&y[z]===A){return z}}}return -1}function a(x){var y={};return x&&y.toString.call(x)==="[object Function]"}function p(z){var y,x;if(!z||toString.call(z)!=="[object Object]"){return false}y=Object.getPrototypeOf(z);if(!y){return true}x=Object.hasOwnProperty.call(y,"constructor")&&y.constructor;return typeof x==="function"&&Object.toString.call(x)===Object.toString.call(Object)}function o(z){var y=[];for(var x in z){if(z.hasOwnProperty(x)){y.push(x)}}return y}function q(y,z){for(var x in y){if(y.hasOwnProperty(x)){if(z(y[x],x,y)){return y[x]}}}}function e(C,D,z){var y,A=0,B=C.length,x=B===undefined||a(C);if(z){if(x){for(y in C){if(D.apply(C[y],z)===false){break}}}else{for(;A<B;){if(D.apply(C[A++],z)===false){break}}}}else{if(x){for(y in C){if(D.call(C[y],y,C[y])===false){break}}}else{for(;A<B;){if(D.call(C[A],A,C[A++])===false){break}}}}return C}return{setProps:r,deepFreeze:u,deepFreezeCopy:d,unfreezeForDust:n,undefineNulls:s,shallowCopy:t,deepCopy:f,shallowEquals:h,index:g,need:m,filterProps:i,keys:o,isArray:j,inArray:v,isFunction:a,isPlainObject:p,each:e,extend:w,find:q}});define("utils/AjaxData",["ta","mixins/Events"],function(c,b){function d(){}function e(f){var g={};var h;g.url=f.url;g.data=f.data;g.method=f.type.toLowerCase();f.timeout&&(g.timeout=f.timeout);if(f.contentType){g.urlEncoded=false;g.headers={"Content-Type":f.contentType}}g.withCredentials=true;g.onSuccess=function(){};g.onFailure=function(i){f.error(i,"ajax error","request failed")};h=new Request(g);if(!h.abort){h.abort=h.cancel}h.success=function(j){if(f.dataType==="json"){try{j=JSON.parse(j)}catch(i){f.error(h,"parsererror","invalid JSON received");return}}f.success(j)};h.send();return h}function a(u){u=u||{};var r=new b("update");var j=null;var h=null;var s=null;var g=null;var q=this;var m=0;var t=u.ajaxFunc||(window.z&&window.z.ajax)||(c.jquery&&c.jquery.ajax)||(window["$"]&&window["$"].ajax)||e;var f=u.transformer||d;var l=u.dataType||"html";var p=!!u.holdData;var i=void (0);this.dataVersion=0;function n(){return(s!==null||g!==null)}function k(){var v=n();var y=j;var w=g;j=null;s=null;g=null;if(w!==null){try{w.abort()}catch(x){}}if(y!==null){clearTimeout(y)}return v}function o(){var v=s;s=null;if(!v){return}var w;v.success=function(x){if(g==w){g=null;if(p){i=x}q.data=x;q.error=void (0);q.dataVersion=++m;f(q,w,v.data);r.emit("update")}};v.error=function(z,y,x){if(g==w){g=null;q.data=i;q.dataVersion=++m;q.error={type:y,error:x,status:z.status,responseText:z.responseText};f(q,w,v.data);r.emit("update")}};w=t(v);g=w;r.emit("update")}this.on=r.on.bind(r);this.off=r.off.bind(r);this.removeListener=r.removeListener.bind(r);this.isDone=function(){return !n()};this.isBusy=function(){return n()};this.clear=function(){var v=n()||typeof(this.data)!=="undefined"||typeof(this.error)!=="undefined";k();i=void (0);q.data=void (0);q.error=void (0);q.dataVersion=0;f(q);if(v){r.emit("update")}};this.refresh=function(z,v,y,w,x){k();if(!w||w<0){w=0}s={type:z,url:v,data:y,dataType:l,xhrFields:{withCredentials:true}};if(typeof x!=="undefined"){s.timeout=x}j=setTimeout(o,w);q.error=void (0);if(!p){q.data=void (0);f(q)}r.emit("update")};this.postJson=function(v,y,w,x){k();w=w||0;if(w<0){w=0}s={beforeSend:function(z){z.setRequestHeader("Content-Type","application/json")},type:"POST",url:v,contentType:"application/json",data:JSON.stringify(y),dataType:l,xhrFields:{withCredentials:true}};if(typeof x!=="undefined"){s.timeout=x}j=setTimeout(o,w);q.error=void (0);if(!p){q.data=void (0);f(q)}r.emit("update")}}return a});define("overlays/ajaxUtil",["ta","api-mod","dom-lib","utils/objutils","utils/AjaxData","mixins/Events","overlays/utils"],function(j,m,f,u,d,l,r){var c={};var e={};var q=10;var g=[];var n={};var i=q;var a=false;var t;var s=r.loadingSpinnerHtml();function k(A,w){var v=[];var z;for(z in w){v.push(z)}v.sort();var x=A;var B=x.indexOf("?")>=0?"&":"?";for(var y=0;y<v.length;++y){z=v[y];x+=B+encodeURIComponent(z)+"="+encodeURIComponent(String(w[z]));B="&"}return x}function p(){var v=0;var w={};var z=[];for(var y=g.length-1;y>=0;--y){var x=g[y];var A=n[x];if(A&&!w[x]){if(A.hasClients()||(++v<=q)){w[x]=A;z.push(x)}}}z.reverse();n=w;g=z;i=g.length+q;return g}function b(D){var C;var z;var y;function w(){C==y.length&&z()}function A(){try{if(navigator.userAgent.match(/ Safari[/]/)&&!navigator.userAgent.match(/ Chrom/)&&navigator.userAgent.match(/ Version\/5\./)){return false}var F=navigator.userAgent.match(/\ AppleWebKit\/(\d+)\.(\d+)/);if(F){F.shift();var E=parseInt(F[0]),G=parseInt(F[1]);if(E<535||(E==535&&G<23)){return false}}return"onload" in document.createElement("link")}catch(H){return false}}function v(G){var F=[];var E=function(H){if(H&&!(H in D)){if(H&&H.splice){H.forEach(E)}else{F.push(H)}}};E(G);return F}function x(E){C++;D[E]=1;w()}function B(E){if(E.match(/\.css$/)){if(A()){new Asset.css(E,{async:true,onLoad:x.bind(null,E)})}else{new Asset.css(E,{async:true});x(E)}}else{if(E.match(/\.js$/)){new Asset.javascript(E,{async:true,onLoad:x.bind(null,E)})}else{j.util.error.record(null,"overlays/options/ajax: unknown file type for ["+E+"]");x.bind(null,E)}}}this.load=function(E,F){C=0;z=F;y=v(E||[]);if(!y||y.length==0){setTimeout(F,1)}else{y.forEach(B)}}}function o(J,D){var L=this;var w=new d({dataType:"html"});var E=new l("update","data-targetEvent");var v=D.loadingContent||s;var F=false;var N=!!D.sendTravelInfo;var C=void (0);var x=v;var I=w.dataVersion;var z=[];var M=0;var A;var G;function H(){var Q=j.page.datesToQueryString("STAYDATES");if(Q&&t!==Q){t=Q;p();for(var O=g.length-1;O>=0;--O){var P=n[g[O]];if(P.needsTravelInfo){P.invalidate()}}}}function K(V,Q,T,S,O,P){S=S&&j.page&&j.page.usingUnifiedDates;if(S){var U=j.page.datesToQueryString("STAYDATES");if(U){Q+="&"+U}if(!a){a=true;t=U;j.page.on("dateSelected",H)}}if(O>1){if(O>20){return}Q+="&reqNum="+O;if(!(P>=0)){P=2000}}else{P=0}if(!T){V.refresh("GET",Q,void (0),P)}else{V.refresh("POST",Q,T,P)}var R=new b(e);R.load(A,function(){G=true;y()})}function y(){if(w.isBusy()||!G){if(C){clearTimeout(C)}C=void (0);return}if(!w.data){if(w.dataVersion!==0){if(!L.error||L.error!==w.error){L.error=w.error||"no content";C=C||setTimeout(B,0)}}else{if(I!==0){x=v;I=w.dataVersion;z=[];if(E.hasListeners("update")){C=C||setTimeout(B,0)}}}return}if(I===w.dataVersion){return}try{var R=document.createElement("div");R.innerHTML=w.data;var P=F;var O=document.head||document.getElementsByTagName("head")[0];z=[];f("script:not(src)",R).each(function(){if(P){var S=document.createElement("script");S.setAttribute("type","text/javascript");S.text=this.text;O.appendChild(S);O.removeChild(S)}m.destroy(this)});f("style",R).each(function(){if(P){O.appendChild(this)}else{m.destroy(this)}});f("[data-targetEvent]",R).each(function(){z.push(this);m.destroy(this)});if(P){F=false;c[D.inlineResourceId]=true}x=R.innerHTML;I=w.dataVersion;w.data=void (0)}catch(Q){L.error="invalid HTML"}C=C||setTimeout(B,0)}function B(){var O=!E.hasListeners("update");var T;C=void (0);L.data=x;L.dataVersion=I;E.emit("update");while((T=z.shift())){var S=T.getAttribute("data-targetEvent");if(S==="repoll-required"){if(O){z=[];L.data=x=v;L.dataVersion=I=0;return}if(!(++M>1)){M=2}var Q=Number(T.getAttribute("data-delay"));K(w,J,D.reqParams,N,M,Q)}else{if(S==="offerClickTrackingTree"){try{var P=require("commerce/offerclick");if(P){P.onTrackingTreeElement(T)}}catch(R){}}else{E.emit("data-targetEvent",S,T)}}}}this.error=void (0);this.loadingData=v;this.data=x;this.dataVersion=I;this.needsTravelInfo=N;this.on=E.on.bind(E);this.off=E.off.bind(E);this.removeListener=E.removeListener.bind(E);this.init=function(){w.on("update",y.bind(this))};this.isBusy=function(){return w.isBusy()||C};this.isDone=function(){return !w.isBusy()&&!C};this.invalidate=function(){w.clear();M=0;if(this.hasClients()){K(w,J,D.reqParams,N,0,0)}};this.hasClients=function(){return(E.hasListeners("update"))};this.load=function(){if(w.isBusy()){return}else{if(w.dataVersion!==0){setTimeout(function(){E.emit("update")},1);return}}var V=D.reqParams;var T=!D.isWidget||!D.inlineResourceId||!c[D.inlineResourceId];if(T){var S=[];var U=[];var P=document.head||document.getElementsByTagName("head")[0];var R;var Q=m.select('link[type="text/css"][rel=stylesheet][data-rup]',document.head);for(var O=0;O<Q.length;O++){R=Q[O].getAttribute("data-rup");if(R){S.push(R)}}Q=m.select("script[data-rup]");for(O=0;O<Q.length;O++){R=Q[O].getAttribute("data-rup");if(R){U.push(R)}}F=true;V=(V?u.shallowCopy(V):{});V.haveJses=String(U);V.haveCsses=String(S);if(D.isWidget){V.Action="install"}}A=D.resources;M=0;K(w,J,V,N,0,0)}}function h(x,w){var y=k(x,w.reqParams);if(y.length<128){x=y;w.reqParams=void (0)}var v=n[y];if(!v){v=new o(x,w);v.init();if(!w.noCache){n[y]=v}}if(!w.noCache){g.push(y);if(g.length>i){p()}}return v}return{loadData:function(w,v){!v&&(v={});var x=h(w,v);x.load();return x},cleanCache:p}});define("overlays/options/ajax",["ta","dom-lib","overlays/ajaxUtil"],function(a,e,c){function b(f){return f&&f.match(/^((https?:)?(\/\/)?([\da-z\.\-\u00a1-\uffff]+)\.([a-z\.\u00a1-\uffff]{2,6}))?(\/[\w]+)*(\?[\/\w\.+%=\-#&\/!\u00a1-\uffff]+)?$/)}function d(g,f){if(!f){f={}}function h(){if(this.sourceElement){g=g||e(this.sourceElement).attr("data-url");if(f.noCache===undefined){f.noCache=e(this.sourceElement).attr("data-ajaxNoCache")}if(!f.resources){f.resources=e(this.sourceElement).attr("data-resources");if(f.resources){f.resources=f.resources.replace(/[\[\]]/g,"").split(/[ ,]+/)}}}if(!g){return}var k;var n=0;var m=(function(){if(k.dataVersion!==n){this.contentElement.innerHTML=k.data;n=k.dataVersion;if(a.prwidgets){a.prwidgets.initWidgets(this.contentElement)}}this.reposition();setTimeout(this.reposition.bind(this),1);this.emit("contentLoaded")}).bind(this);var l;var j=(function(){if(l==g){this.reposition();return}k&&k.invalidate();l=g;k=c.loadData(g,f);this.contentElement.innerHTML=k.data;this.reposition();n=k.dataVersion;if(a.prwidgets){a.prwidgets.initWidgets(this.contentElement)}k.on("update",m);k.on("data-targetEvent",i)}).bind(this);var i=this.emit.bind(this,"data-targetEvent");this.on("show",j);this.on("hide",function(){if(k){k.off("update",m);k.off("data-targetEvent",i);k=void (0)}});var o=this.updateContent;this.updateContent=function(p){if(!p){g="";p=e(this.sourceElement).attr("data-url");return p?this.updateContent(p):o.apply(this,arguments)}if(!b(p)){g="";return o.apply(this,arguments)}g=p;if(this.isOpen()){j()}return this}}return h}return d});define("ta/common/Flyout",["overlays/Overlay","overlays/styles/modal","overlays/position","overlays/options/closeOnEscape","overlays/options/autoReposition","overlays/styles/windowshade","overlays/options/ajax"],function(c,b,a,d,h,f,g){var e;return{showRecentLocationSaveOverlay:function(){setPID(3832);new Request({url:"/RecentlyViewedAjax",onSuccess:function(i){if(!i.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(i,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"save_overlay"},evalScripts:true,method:"get"}).send()},submitRecentLocationEmail:function(){var i=ta.retrieve("overlays.current");if($("rvEmailSend")){$("rvEmailSend").hide()}if($("rvEmailProgress")){$("rvEmailProgress").show()}setPID(4470);new Request({url:"/RecentlyViewedAjax",onSuccess:function(j){i.hide();if(!j.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(j,{style:"dg s4 RecentlyViewedOverlay"})}},data:$("rvEmailForm"),evalScripts:true}).send()},submitRecentLocationSave:function(){var i=ta.retrieve("overlays.current");if($("rvEmailSend")){$("rvEmailSend").hide()}if($("rvEmailProgress")){$("rvEmailProgress").show()}setPID(4469);new Request({url:"/RecentlyViewedAjax",onSuccess:function(j){i.hide();if(!j.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(j,{style:"dg s4 RecentlyViewedOverlay"})}},data:$("rvEmailForm"),evalScripts:true}).send()},showEmailHotelOverlay:function(k,l,i,j){new Asset.css(emailHotelCSS);new Request({url:"/EmailHotel",onSuccess:function(m){ta.run("ta.overlays.showInLightbox",{},m,{style:"dg s4"});if(ta.has("emailOwnerShowCaptcha")){ta.t4b.emailhotel.showRecaptcha()}},data:{detail:k,isOfferEmail:l,overrideOfferEmail:i,contactColumn:j},evalScripts:true,method:"get"}).send()},rvInquiryPrivacy:function(j,i){j.stop();i.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,content:$("rvPrivacyBox").innerHTML},i)},rvClearDefault:function(k,i){var j=$(k);if(j&&j.value==i){j.value="";j.removeClass("rvDefault")}},destinationsPopup:function(j,i){j.stop();i.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:"/vpages/destinationsFly.html?lt=evt"},i)},funStuffPopup:function(j,i){j.stop();i.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:"/vpages/funStuffFly.html?lt=evt"},i)},bestValue:function(j,i){j.stop();i.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,remoteContent:"/vpages/bestValueFly.html?log=false"},i);return false},amenities:function(m,k,i,l){if(m){new Event(m).stop()}k.onclick=null;if(i&&i>0){setPID(i);new Request({url:"/ActionRecord?excludeFromVS=false&action=HRAmenitiesFlyout"}).send()}var j="/LocationTab?tab=amenities&from="+location.pathname.replace(/^[/]|-.*$/g,"")+"&suppressLinks="+!!l;if(k.id.indexOf("amenity_")==0){j+="&d="+k.id.substring(8)}e=e||new c(k,[b(k,"center","small",""),a.center([0,0]),d,h,f(),g(j,{resources:[amenityOverlayCss]})]);e.show();return false}}});ta.common.sendmessage={getMessageCode:function(){var e=new Date().getTime();var b="ABCDEFGHIJKLMNOPQRSTUVWXYZ123456";var f=[];for(var a=0;a<32;a++){f[a]=((e&(1<<a))!=0)?1:0}var c=[[],[],[],[],[],[]];for(var a=0;a<30;a++){c[a%(c.length)].push(f[f.length-1-a])}var d="";for(var a=0;a<c.length;a++){d+=b.substr(parseInt(c[a].reverse().join(""),2),1)}return d},communityLightbox:function(e,d){if(!communityEnabled){window.callback_communityLightboxEnable=function(){communityEnabled=true;var g=ta.retrieve("overlays.sendmessage");if(g){g.hide()}ta.common.sendmessage.communityLightbox(e,d)};var a=new StringBuffer();a.append('<p id="inviteStatusField" style="display: none; color: red;"></p>');a.append("<p>"+JS_mem_travelnet_friends_disabledM2M+".</p>");a.append('<p><a href="javascript:void(0)" onclick="ta.common.sendmessage.enableCommunity(window[\'callback_communityLightboxEnable\'], true); return false;">'+JS_common_Clickhere+"</a> "+JS_mem_travelnet_friends_turnOn+".</p>");var f=ta.overlays.showInLightbox(a.toString(),{backdrop:ta.overlays.BACKDROP_NEVER,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});f.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){f.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",f);return}if(d){var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h);var i=window[d];if(i&&typeOf(i)=="function"){i()}}}else{var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9998");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h)}}var c={url:e,onSuccess:b,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:communityLightbox")};new Request(c).send()},enableCommunity:function(c,a){var b=c;if(!a){b=function(d){ta.common.sendmessage.enableCommunityResponse(d,c)}}if(typeof(JS_SECURITY_TOKEN)=="undefined"){JS_SECURITY_TOKEN=""}new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeM2M",set:"on",token:JS_SECURITY_TOKEN},onSuccess:b,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:enableCommunity")}).send()},enableCommunityResponse:function(res,callback){if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){document.getElementById("inviteStatusField").innerHTML=data.ERROR;document.getElementById("inviteStatusField").style.display="block"}}else{document.getElementById("inviteStatusField").innerHTML=JS_community_on;document.getElementById("inviteStatusField").style.display="block"}},submitSendMessage:function(h,b){h.stop();b.onclick=function(i){ta.stopEvent(i)};var a=b.className.match(/LSO_(\w+)/)[1];$("LsoId").value=footprintGetWithSet(a);$("screenWidth").value=screen.width;$("screenHeight").value=screen.height;if(!b.className.match(/\bform_(\w+)\b/)){return}var e=$(RegExp.$1);var d={url:b.href,data:e,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:submitSendMessage")};var g=window["callback_"+e.name];if(b.className.match(/method_(\w+)\b/)){d.method=RegExp["$1"]}if(b.className.match(/\btgt_(\w+)\b/)){d.update=RegExp["$1"]}else{d.onComplete=function(k,i){if(ta.retrieve("messaging.isiframe")&&ta.id("PAGE")){ta.id("PAGE").set("html",k);if(ta.id("SUCCESS")){window.top.location.href="/Messages?f=512&o=0&cnt=25&j=-3&oo=0&oj=-3"}}else{var j=ta.retrieve("overlays.sendmessage");if(j&&j.inner&&j.newOverlays){j.inner.innerHTML=k}else{var j=ta.overlays.showInLightbox(k,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});ta.store("overlays.sendmessage",j)}}if(g&&typeOf(g)=="function"){g()}}}var c=window["validate"+e.id];if(c&&typeOf(c)=="function"&&c.apply(e)==false){return}if(b.className.match(/\bevalScripts\b/)){d.evalScripts=true}var f=ta.retrieve("overlays.sendmessage");if(f&&f.options&&f.options.permanent){f.options.permanent=false}new Request(d).send()},cancel:function(a){if(a){return}var b=ta.retrieve("overlays.sendmessage");if(b){ta.remove("overlays.sendmessage")}if(ta.has("community.needsReload")){window.location.reload()}},closeSendMessage:function(c,a){if(c&&c.stop){c.stop()}if(a){a.onclick=null}var b=ta.retrieve("overlays.sendmessage");if(b){b.hide(c)}if($("vrWideOverview")&&ta.has("vrShowCaptcha")){ta.vr.showRecaptcha()}}};ta.servlet.Inspiration={sortPopularity:function(b,a){sort("popularity")},sortAlphabetical:function(b,a){sort("alphabetical")}};define("pages/inappropriate_vote_stub",["ta","overlays/Overlay","overlays/styles/modal","overlays/position","overlays/options/closeOnEscape","overlays/options/autoReposition","overlays/styles/windowshade","overlays/options/ajax"],function(h,c,j,e,k,b,f,d){var g={};var i;g.open=function(p,n,m){m.elmt=m.elmt||n;m.direction=m.direction||"below";h.store("iapFlyoutOptions",m);if(h.retrieve("registration_web_flow_iap")){var o={flow:"CORE_COMBINED",pid:39841,userRequestedForce:true,loggedInBypass:true,onSuccess:a.bind(null,m)};h.call("ta.registration.RegOverlay.show",{type:"dummy"},m.elmt,o)}else{var l="__iapreg"+Math.floor(Math.random()*1000000);window[l]=function(){a(m);delete window[l]};if(h.registration.register({popup:true,product:"IAP_VOTE",successAction:l})){window[l]()}}};function a(m){if(!h.util.element.isScrolledIntoView(m.elmt)){h.util.element.scrollIntoView(m.elmt)}var l="/ReportIAP?token="+window.JS_SECURITY_TOKEN+"&step=START&voteContentType="+m.voteContentType;if(m.owner){l+="&action=explain&reason=21&reviewid="+m.reviewid+"&isGeo="+m.isGeo+"&locationid="+m.locationid}else{l+="&action=reportIAP&contentId="+m.contentId}if(i){i.updateContent(l);i.sourceElement=m.elmt;i.show()}else{i=new c(m.elmt,[j(m.elmt,m.direction,"iapFlyout small"),e[m.direction]([0,0]),k,b,f(),d(l)]);i.show();h.store("iapFlyout",i)}}return g});define("overlays/styles/popover",["api-mod","dom-lib","overlays/utils"],function(c,e,a){function d(f,g,h){this.container=c.createElement("span",{"class":"ui_overlay ui_popover arrow_"+a.getArrowDir(f,this.sourceElement,this.domParent)+" "+g,style:h});this.arrow=c.createElement("div",{"class":"arrow"});this.container.appendChild(this.arrow);this.header=c.createElement("div",{"class":"header_text"});this.container.appendChild(this.header);this.inner=c.createElement("div",{"class":"body_text"});this.container.appendChild(this.inner);this.contentElement=this.inner;this.close=c.createElement("div",{"class":"ui_close_x"});this.container.appendChild(this.close)}var b=function(j,g,f,m,l){j=e(j);f=f||j.attr("data-popover")||"";m=m||j.attr("data-header")||"";l=l||j.attr("data-content")||"";var i=j.attr("data-style")||"";var k=j.attr("data-header-element");var h=j.attr("data-header-copy");return function(){d.call(this,g,f,i);this.updateContent(l);if(m){a.injectContent(this.header,j,m,k,h)}c.addEvent(this.close,"click",c.bind(function(){this.hide.apply(this,arguments)},this,"close-button"))}};return b});define("overlays/options/pinnable",["ta"],function(a){return function(){var e=this;var b;this.pinned=false;function c(){if(e.pinned&&a.inDocument(e.container)&&!b){b=a.createElement("div",{"class":"ui_backdrop dark"});b.setAttribute("style","z-index:499");a.addEvent(b,"click",function(){e.hide()});e.domParent.appendChild(b)}}function d(){e.pinned=true;c()}this.pin=d;this.on("show",function(){c();ta.addEvent(e.sourceElement,"click",d)});this.on("hide",function(){if(b){e.domParent.removeChild(b);b=void (0);ta.removeEvent(e.sourceElement,"click",d)}})}});define("overlays/options/closeOnWindowshadeClick",["api-mod"],function(a){return function(){var b=this;a.addEvent(this.shade,"click",function(){b.hide("windowshade")})}});define("overlays/widgetoverlays",["ta","overlays/Overlay","overlays/styles/popover","overlays/styles/modal","overlays/styles/windowshade","overlays/position","overlays/options/ajax","overlays/options/pinnable","overlays/options/closeOnWindowshadeClick","overlays/options/repositionOnEvent"],function(f,e,p,a,r,d,n,k,l,c){function o(u,v){var t=u.prwidget_ovl||(u.prwidget_ovl={key:v});if(t.key!==v){if(t.showtimer){clearTimeout(t.showtimer);delete t.showtimer}if(t.overlay){t.overlay.destroy();delete t.overlay}t.key=v}return t}function i(){var v=this;var u=v.prwidget_ovl;if(!u){return}if(u.showtimer){clearTimeout(u.showtimer);delete u.showtimer}if(f.page&&f.page.usingUnifiedDates&&f.find&&f.find(".ui_modal.date_picker_modal",document.body)){return}var t=u.overlay;if(t&&!t.pinned&&!t.prw_leaveTimer){t.prw_leaveTimer=setTimeout(function(){t.pinned||t.hide()},250)}}function s(){var t=this;if(t){t.prw_entered=true;if(t.prw_leaveTimer){clearTimeout(t.prw_leaveTimer);delete t.prw_leaveTimer}}}function g(){if(f.page&&f.page.usingUnifiedDates&&f.find&&f.find(".ui_modal.date_picker_modal",document.body)){return}var t=this;if(t&&!t.pinned&&!t.prw_leaveTimer){t.prw_leaveTimer=setTimeout(function(){t.pinned||t.hide()},250)}}function b(v,w){var u=!v.pinned&&s.bind(v);var x=!v.pinned&&g.bind(v);var t=function(){u&&f.removeEvent(v.container,"mouseenter",u);x&&f.removeEvent(v.container,"mouseleave",x);v.off("hide",t);delete w.overlay};u&&f.addEvent(v.container,"mouseenter",u);x&&f.addEvent(v.container,"mouseleave",x);v.on("hide",t)}function h(v,u){var t=u.url||"/OverlayWidgetAjax?Mode="+encodeURIComponent(v);if(typeof(crPageServlet)==="string"){t+="&metaReferer="+encodeURIComponent(crPageServlet)}return t}function m(w,A,G,H,I){var u=o(w,G);if(u.showtimer){clearTimeout(u.showtimer);delete u.showtimer}if(u.overlay){return}var y=(I.position||"wideside").split(" ").filter(function(J){return !!J.length});var F=y.shift();if(F==="wideside"){try{var v=f.getPosition(w).x;var x=f.getSize(w).x;var C=f.getSize(document.body).x;F=(v>(C-v-x)?"leftEvenInRtl":"rightEvenInRtl")}catch(E){F="right"}}var z=I.classes|"";var t=h(G,I);I.reqParams=H;I.inlineResourceId=G;I.isWidget=true;var D=[p(w,F,z,""),n(t,I),d[F](y,false),k];if(I.mixins&&I.mixins.length>0){D.push.apply(D,I.mixins)}var B=new e(w,D);if(A==="click"){B.pin()}B.show();u.overlay=B;b(B,u)}function j(y,u,x){x=x||{};var z=(x.position||"center").trim().split(" ")[0];var w=h(y,x);x.reqParams=u;x.inlineResourceId=y;x.isWidget=true;var t=[a(null,null,x.classes),n(w,x),d[z](void (0),true),r(),l,c(window,"resize")];if(x.mixins&&x.mixins.length>0){t.push.apply(t,x.mixins)}var v=new e(null,t);v.show();return v}function q(z,w,y,t,u){z=z||window.event;w=w||z.currentTarget;var x=(z&&z.type)||"click";if(z){f.stopEvent(z)}var v=o(w,y);if(x==="click"){if(!v.overlay){m(w,x,y,t,u)}}else{if(v.overlay){if(v.overlay.prw_leaveTimer){clearTimeout(v.overlay.prw_leaveTimer);delete v.overlay.prw_leaveTimer}return false}if(v.showtimer){return false}if(!v.hasLeaveHandler){f.removeEvent(w,"mouseleave",i);f.addEvent(w,"mouseleave",i);v.hasLeaveHandler=true}v.showtimer=setTimeout(function(){m(w,x,y,t,u)},u.delay||300)}return false}return{triggerFlyout:q,showLightbox:j}});define("members/sendMessageLightbox",["ta","overlays/widgetoverlays"],function(a,c){function b(k,e,f){a.stopEvent(k);if(!f){return false}var g=a.retrieve("overlays.sendmessage");if(g){if(typeof(g.hide)==="function"){g.hide()}a.store("overlays.sendmessage",null);g=null}var j=f+"&Mode=owa";var l=typeof(footprintGet)!="undefined"?footprintGet():null;if(l){j+="&LsoId="+l}if(a.retrieve("registration_web_flow_messaging")){if(!a.registration.isAuthorized("SEND_MESSAGE")){var i={flow:"CONTENT_SUBMISSION",pid:473,userRequestedForce:true,onSuccess:function(){b(null,e,f)}};a.call("ta.registration.RegOverlay.show",{type:"dummy"},e,i);return false}}else{var m={popup:true,product:"SEND_MESSAGE",successAction:"ta.registration.popup.options.successCallback",successCallback:b.bind(this,k,e,f)};if(!a.registration.register(m)){return false}}var h;if(!communityEnabled){window.callback_communityLightboxEnable=function(){window.callback_communityLightboxEnable=void (0);communityEnabled=true;h&&h.hide();b(k,e,f)};h=c.showLightbox("COMMUNITY_LIGHTBOX");return false}var d=c.showLightbox("SEND_MESSAGE_LIGHTBOX",{},{url:j});if(d){d.newOverlays=true;a.store("overlays.sendmessage",d)}}return{showSendMessage:b}});define("members/memberOverlay",["ta","overlays/widgetoverlays"],function(b,c){var d="members_memberOverlay_init";function a(h,k,t,m,p){if(!h||(h.type!=="click"&&h.type!=="mouseenter"&&h.type!=="mouseover")){return}if(h.type==="click"){b.stopEvent(h)}var s="";var f="";var q="";var r=false;var j=false;var n=t.split("-");for(var o=0;o<n.length;o++){var l=n[o];if(l.match(/\bUID_([0-9A-F]+)\b/)){s=RegExp.$1}else{if(l.match(/\bSRC_(\d+)\b/)){f=RegExp.$1}else{if(l.match(/\bCATID_(\d+)\b/)){q=RegExp.$1}else{if(l.match("FUS")){r=true}else{if(l.match("PATT")){j=true}}}}}}var u="";if(typeof(window.footprintGet)!="undefined"){u=window.footprintGet()}var g="/MemberOverlay?Mode=owa&uid="+s+"&c="+q+"&src="+f+"&fus="+r+"&partner="+j+"&LsoId="+u;c.triggerFlyout(h,k,"MEMBER_OVERLAY",{},{url:g,mixins:[function(){if(m&&p){b.trackEventOnPageOnce(m,"show_reviewer_info_window",p)}}]});return false}function e(h,f,i,g,j){if(f[d]){return false}f[d]=true;b.addEvent(f,"click",function(k){a(k||window.event,this,i,g,j)});b.addEvent(f,"mouseenter",function(k){a(k||window.event,this,i,g,j)});if(h){a(h,f,i,g,j)}return false}return{initMemberOverlay:e}});define("overlays/options/closeOnDocClick",["api-mod"],function(d){function b(e){if(this.sourceElement&&d.containsElement(this.sourceElement,e.target)){return}if(d.containsElement(this.container,e.target)){return}if(e.target&&e.target.tagName=="option"){return}if(d.checkBrowser("ie")&&e.target&&e.target.tagName=="select"&&d.containsEvent(e.target,e)&&d.select(this.container,"input").indexOf(e.target)){return}this.hide("doc-click")}function a(e){return function(){var f=d.bind(b,this);this.on("show",function(){setTimeout((function(){if(this.isOpen()){d.addEvent(document,"click",f);e&&d.addEvent(document,"touchstart",f)}}).bind(this),1)}).on("hide",function(){d.removeEvent(document,"click",f);e&&d.removeEvent(document,"touchstart",f)})}}var c=a(true);c.withoutTouchEvents=a(false);return c});define("ta/servlet/Reviews",["pages/inappropriate_vote_stub","members/sendMessageLightbox","members/memberOverlay","overlays/Overlay","overlays/styles/modal","overlays/position","overlays/options/closeOnEscape","overlays/options/closeOnDocClick","overlays/options/autoReposition","overlays/styles/windowshade","overlays/options/ajax"],function(n,k,j,c,l,g,m,i,b,h,f){ta.keep("facebook.onAvail",function(){FB.Event.subscribe("edge.create",function(s,u){try{var v=false;if(u){v=ta.id(u)}var p="";var r=s||"";if(v){if(v.className){var q=false;if(q=v.className.match(/track_(\w+)/)){p=q[1]}if(v.hasClass("expanded")){p+="_expanded"}}}new Request({url:"/ActionRecordPlus?action=LIKE&from="+p+"&url="+r}).send()}catch(t){ta.util.error.record(t,"FB like review tracking error")}})});var o,a;ta.servlet.Reviews={expandCount:0,PAGING_HEIGHT:1000,expandReview:function(C,s,r){var p=0;if(ta.retrieve("expand_"+r)){return}ta.store("expand_"+r,true);p++;var q=ta.id(r);var B=new Event(C);try{p++;if(!q){ta.util.error.record(null,"expandReview - no container",B,{revId:r});return}var x,z,v=false;if(q.getElement){x=q.getElement(".dyn_full_review");z=q.getElement(".basic_review");v=q.getElement(".revBotContent")}if(!z||!z.hasClass){ta.util.error.record(null,"expandReview - no basic_rev",B,{revId:r});return}p++;var w=z.hasClass("first");if(v&&v.getElement){var u=v.getElement(".fb_like_button")}var y=z.getElement(".helpful");p++;if(x){x.setStyle("display","block");if(u){ta.servlet.Reviews.injectFBLikeIntoFull(u,x)}if(ta.servlet.Reviews.translationRatings.contains(expandedReviewId)){ta.servlet.Reviews.injectTranslationRating(z,x)}z.setStyle("display","none");ta.remove("expand_"+r)}else{p++;ta.servlet.Reviews.expandCount++;var A=z.getElement(".partnerRvw span.linkItem");p++;if(A){A.getElement("img.textArrow_more").setStyle("display","none");new Asset.image(CDNHOST+"/img2/spinner.gif",{"class":"anim_loop"}).inject(A)}p++;new Request({url:"/SingleUserReview-g"+modelGeoId+"-d"+modelLocId+"?review="+r+"&servlet="+pageServlet+"&expand="+ta.servlet.Reviews.expandCount,onSuccess:function(G,H){try{var F=0;x=new Element("div");x.addClass("dyn_full_review");x.set("html",G);x.inject(z,"after");F++;var I=x.getElement(".collapse");if(I){I.addEvent("click",function(){ta.servlet.Reviews.collapseReview(q)})}F++;if(w){x.getElement(".basic_review").addClass("first")}F++;setupTranslationRatingSlider(x);F++;if(typeof processLinks!=="undefined"){processLinks(x)}F++;ta.servlet.Reviews.fixMTHelpfulUrl(x,r);if(z){var L=z.getElement("img.anim_loop");L.dispose()}F++;if(A){var E=A.getElement("img.textArrow_more");if(typeof(E)!="undefined"&&E!=null){E.setStyle("display","inline")}}F++;var J=ta.retrieve("facebook.data.handlers.FRIEND_NAMES");var D=ta.retrieve("facebook.data.handlers.HIGHLIGHT_FRIENDS");if(J&&typeof(J)=="function"){J()}if(D&&typeof(J)=="function"){D({expanded:true})}if(u){ta.servlet.Reviews.injectFBLikeIntoFull(u,x)}if(y){helpfulVotingKey=y.id.match(/(helpful\w+)_\w+/);if(helpfulVotingKey){helpfulVotingKey=helpfulVotingKey[1];if(ta.retrieve(helpfulVotingKey)){var N=x.getElement(".helpful");if(N){N.innerHTML=y.innerHTML}}}}F++}catch(K){ta.util.error.record(K,"expandReview - post AJAX",null,{postProg:F})}if(z&&z.setStyle){z.setStyle("display","none")}if(v&&v.setStyle){v.setStyle("display","none")}ta.remove("expand_"+r);var M=ta.retrieve("ta.servlet.Reviews.callback");if(M!=null){M()}},evalScripts:true}).send()}}catch(t){ta.util.error.record(t,"expandReview",B,{revId:r,prog:p});ta.remove("expand_"+r)}},expandReviews:function(v,y,w,F,D){if(ta.retrieve("expand_"+w)){return}if(ta.has("hr_below_the_fold_redesign.enabled")){ta.common.ads.refreshAllAdsPolitely(true)}ta.store("expand_"+w,true);var A=ta.id(w);var C=new Event(v);try{if(!A){ta.util.error.record(null,"expandReviews - no container",C,{revId:w});return}var x,G,M=false;if(A.getElement){x=A.getElement(".dyn_full_review");G=A.getElement(".basic_review");M=A.getElement(".revBotContent")}if(!G||!G.hasClass){ta.util.error.record(null,"expandReviews - no basic_rev",C,{revId:w});return}if(x){ta.servlet.Reviews.showExpandedReview(w,true);ta.remove("expand_"+w)}else{ta.servlet.Reviews.expandCount++;var H=G.getElement(".partnerRvw span.moreLink");if(H){var r=H.getParent().getElement("img.textArrow_more");if(r){r.setStyle("display","none");new Asset.image(CDNHOST+"/img2/spinner.gif",{"class":"anim_loop"}).inject(H,"after")}}var L=$$("#REVIEWS .reviewSelector");var p;for(var I=0;I<L.length;I++){if(L[I].id==w){p=L.slice(I)}}var K=0;var z=[];if(p&&p.length>0){for(var I=0;I<p.length;I++){var E=p[I].id;if(E&&E.indexOf("review_")===0){var J=p[I].getElement(".dyn_full_review");if(!J){var u=p[I].getElement(".basic_review");if(u){z[z.length]=E.split("_")[1];if(u.getElement(".ownerFav")){K=z[z.length-1]}}else{ta.util.error.record(null,"expandReviews - basic_review content missing",null,{revId:E},"WARN")}}}}}if(z.length>0){var B=z[0];var q=0;if(F){q=F}var t=z.join(",");new Request({url:"/ExpandedUserReviews-g"+modelGeoId+"-d"+modelLocId+"?target="+B+"&context="+q+"&reviews="+t+"&servlet="+pageServlet+"&expand="+ta.servlet.Reviews.expandCount+(K>0?"&favorite="+K:""),trackEvent:{module:"Reviews",action:"expand"},onSuccess:function(U,Q){try{var V=[];var N=new Element("div");N.set("html",U);var ac=N.getChildren();var T=[];for(var ab=0;ab<ac.length;ab++){var R=ac[ab];var X=R.id.split("_")[2];var ae=ta.id("review_"+X);if(ae&&ae.getElement){T.push(ae.getProperty("id"));var aa=ae.getElement(".basic_review");if(aa){V.push(X);R.erase("id").addClass(aa.className.replace("basic_review","dyn_full_review")).inject(aa,"after").hide();var af=R.getChildren()[0];if(af){af.removeClass("review")}var W=R.getElement(".collapse");if(W){W.addEvent("click",ta.servlet.Reviews.getCollapseCallback(ae))}setupTranslationRatingSlider(R);if(typeof processLinks!=="undefined"){processLinks(R)}if(ta.servlet.Reviews.translationRatings.contains(X)){ta.servlet.Reviews.injectTranslationRating(aa,R)}ta.servlet.Reviews.fixMTHelpfulUrl(R,"review_"+X);if(X===B){var O=aa.getElement("img.anim_loop");if(O){O.dispose()}ta.servlet.Reviews.refreshSidebarAds();ta.servlet.Reviews.injectInlineBanner(ae);window.fireEvent("HRReviewExpanded");var Z=aa.getElement(".partnerRvw span.moreLink");if(Z){var P=Z.getParent().getElement("img.textArrow_more");if(typeof(P)!="undefined"&&P!=null){P.setStyle("display","inline")}}}}}}var S=true;for(var ab=0;ab<V.length;ab++){if(ab==1){S=false}var Y="review_"+V[ab];ta.servlet.Reviews.showExpandedReview(Y,S)}if(lazyImgs!=null){window.setupLazyLoad()}}catch(ag){ta.util.error.record(ag,"expandReviews - post AJAX",null,{});var O=G.getElement("img.anim_loop");if(O){O.dispose()}var Z=G.getElement(".partnerRvw span.moreLink");if(Z){var P=Z.getParent().getElement("img.textArrow_more");if(typeof(P)!="undefined"&&P!=null){P.setStyle("display","inline")}}}if(Browser.ie&&Browser.version<8){var ad=function(){for(var ah=0;ah<T.length;++ah){var ai=ta.id(T[ah]);if(ai!==null){ai.addClass("dummy")}}};setTimeout(ad,0)}ta.remove("expand_"+w)},onFailure:function(N,O){ta.util.error.record(null,"ExpandedUserReviews ajax call failed",null,{reviewIds:t},"WARN");var Q=G.getElement("img.anim_loop");if(Q){Q.dispose()}var R=G.getElement(".partnerRvw span.moreLink");if(R){var P=R.getParent().getElement("img.textArrow_more");if(typeof(P)!="undefined"&&P!=null){P.setStyle("display","inline")}}},evalScripts:true}).send()}}}catch(s){ta.util.error.record(s,"expandReviews",C,{revId:w});ta.remove("expand_"+w)}},filterReviews:function(r,B){if(ta.page&&ta.page.applyReviewFiltersForm){return ta.page.applyReviewFiltersForm(r,B)}var s=arguments.callee;B=B||{};var x=ta.id("REVIEWS");var q=x.getElement(".loadingContainer");if(q){var u=x.getStyle("position");if(u!=="relative"&&u!=="absolute"&&u!=="fixed"){x.setStyle("position","relative")}var z=0;var t=B.whiteBoxTopElmt?ta.id(B.whiteBoxTopElmt):undefined;if(t){z=t.getPosition(x).y}q.setStyles({display:"block",top:z+"px",height:(x.getSize().y-z)+"px"});var w=q.getElement(".loadingBox");if(w){w.setStyle("top",B.loadingBoxTopElmt?(ta.id(B.loadingBoxTopElmt).getPosition(x).y-z)+"px":undefined)}}var p=location.pathname;var A=false;if(!B.ignoreOffset){if(window.pageServlet==="ShowUserReviews"){var y=window.onhashchange;window.onhashchange=undefined;location.hash="#or0";(function(){window.onhashchange=y}).delay(0)}else{p=location.pathname.replace(/-or\d+/,"");A=location.pathname!==p}}if(!history.replaceState&&A){r.submit()}else{if(s.request){s.request.cancel()}if(A){history.replaceState(history.state,document.title,p)}var v=B.scrollToElmt?ta.id(B.scrollToElmt):undefined;if(v){window.scrollTo(0,v.getPosition().y)}s.request=new Request({url:p,data:"mode=filterReviews&"+r.toQueryString(),evalScripts:true,onSuccess:function(F){var D=new Element("div",{html:F});var E=D.getChildren();if(E.length>0){E[0].getElements("[data-targetEvent]").each(function(G){ta.fireEvent(G.getAttribute("data-targetEvent"),G)});var C=x.getElement(":focus");ta.util.element.copyAjaxPreserves(x,E[0]);E[0].replaces(x);if(C&&C.getParent(".ajax_preserve")){C.focus()}ta.prwidgets.initWidgets(E[0])}else{ta.util.error.record(e,"filterReviews got invalid response");q.setStyle("display","none")}},onFailure:function(){if(!B.reqNum){return s(r,Object.merge({reqNum:1},B))}ta.util.error.record(undefined,"filterReviews");q.setStyle("display","none")}}).send()}},injectInlineBanner:function(p){try{if(p){if(ta.has("ads.gptEnabled")){if(!ta.has("ads.inlineReviewAd.injected")){ta.store("ads.inlineReviewAd.injected",true);ta.common.ads.queueForInjection(["gpt-ad-468x60"])}else{var q=p.getElement(".iab_inlineBanner");if(q){q.destroy()}}}else{injectAdsTargeted(p)}}else{throw new Error("Review parent element is null")}}catch(r){ta.util.error.record(r,"unable to inject inline banner on review expansion")}},refreshSidebarAds:function(){try{if(ta.has("ads.gptEnabled")){ta.common.ads.refreshSidebarAds()}else{ta.common.ads.refreshSideBarAdsWithRefreshOrdKey()}}catch(p){ta.util.error.record(p,"unable to refresh sidebar ads on review expansion")}},refreshGutterAd:function(p){try{ta.common.ads.refreshAjaxAds(p)}catch(q){ta.util.error.record(q,"unable to refresh gutter ad on More click")}},getCollapseCallback:function(p){return function(){ta.servlet.Reviews.collapseReview(p)}},showExpandedReview:function(p,q){try{if(typeof(p)==="undefined"){ta.util.error.record(null,"showExpandedReview - reviewId is undefined");return}var t=ta.id(p);if(t){var w,y,u=false;if(t.getElement){w=t.getElement(".dyn_full_review");y=t.getElement(".basic_review");u=t.getElement(".revBotContent")}else{ta.util.error.record(null,"showExpandedReview - recContainer missing getElement attribute",null,{revId:p});return}if(!y){ta.util.error.record(null,"showExpandedReview - basic_rev is null",null,{revId:p});return}if(!y.hasClass){ta.util.error.record(null,"showExpandedReview - basic_rev missing hasClass attribute",null,{revId:p});return}if(u&&u.getElement){var s=u.getElement(".fb_like_button")}var x=y.getElement(".helpful");if(!w){ta.util.error.record(null,"showExpandedReview - no full");return}if(x){var v=x.id.match(/(helpful\w+)_\w+/);if(v){v=v[1];if(ta.retrieve(v)){var z=w.getElement(".helpful");if(z){z.innerHTML=x.innerHTML}}}}if(s){ta.servlet.Reviews.injectFBLikeIntoFull(s,w)}w.show();y.hide()}else{ta.util.error.record(null,"showExpandedReview - revContainer is null",null,{revId:p});return}}catch(r){ta.util.error.record(r,"showExpandedReview")}},fixMTHelpfulUrl:function(r,p){var s=r.getElement("input[name=returnTo]");if(s){var q=document.location.href;if(q.indexOf("#")>=0){q=q.substring(0,q.indexOf("#"))}s.value=q+"#mtreview_"+p}},injectFBLikeIntoFull:function(r,p){try{if(r){var t=r.getFirst();if(t){t.addClass("expanded")}var q=p.getElement(".helpful");if(q){r.inject(q,"after")}}}catch(s){ta.util.error.record(s,"expandReview - like button")}},injectTranslationRating:function(r,q){if(r&&q){var p=r.getElement(".translation"),s=q.getElement(".translation");if(p&&s){s.set("html",p.get("html"))}}},translationRatings:[],collapseReview:function(p){try{p=ta.id(p);var t=p.getElement(".dyn_full_review");var r=p.getElement(".basic_review");var s=p.getElement(".revBotContent");var q=t.getElement(".fb_like_button");if(r&&r.setStyle){r.setStyle("display","block")}if(s&&s.setStyle){s.setStyle("display","block")}if(q){var w=q.getFirst();if(w){w.addClass("expanded")}if(s){q.inject(s,"inside")}}var v=p.id.replace("review_","");if(ta.servlet.Reviews.translationRatings.contains(v)){ta.servlet.Reviews.injectTranslationRating(t,r)}t.setStyle("display","none")}catch(u){ta.util.error.record(u,"collapseReview")}},findLink:function(q,p){if(/\bt(r[\d]+)\b/.test(p.className)){window.location=$(RegExp.$1).href}},mtSubmitOnClick:function(q,p){if(p.value==="true"){ta.util.cookie.setPIDCookie(25173)}else{if(p.value==="false"){ta.util.cookie.setPIDCookie(25172)}}p.form.submit()},openMTEdit:function(p,q,r){if(a){a.updateContent("/MachineTranslationEdit?r="+r)}else{a=new c(null,[l(null,"center","mtedit_overlay"),g.center([0,0]),b,m,i,h(),f("/MachineTranslationEdit?r="+r)]);ta.store("translationEditOverlay",a);a.on("contentLoaded",function(){try{var s=ta.id("mtedit_mt").getElements(".mtedit_text")[0];s.style.height=ta.id("mtedit_english").clientHeight+ta.id("mtedit_mt").offsetTop-s.offsetTop+"px"}catch(t){ta.util.error.record(t,"openMTEdit:onLoad")}})}a.show()},validateMTEdit:function(s,r){var q=ta.id("mtedit_mt");var p=q.getElements(".mtedit_orig_title")[0].value;var v=q.getElements(".mtedit_title")[0].value;var u=q.getElements(".mtedit_orig_text")[0].value;var t=q.getElements(".mtedit_text")[0].value;return v&&t&&(v!=p||t!=u)},enableMTEditSubmit:function(r,q){var p=ta.id("mtedit_submit");if(p.disabled&&ta.servlet.Reviews.validateMTEdit(r,q)){p.disabled=false}},submitMTEdit:function(u,s,p,t){var q=ta.id("mtedit_submit");q.disabled=true;ta.select(".mtedit_error").each(function(x){x.hide()});if(ta.servlet.Reviews.validateMTEdit(u,s)){var r=ta.id("mtedit_mt");var w=r.getElements(".mtedit_title")[0].value;var v=r.getElements(".mtedit_text")[0].value;new Request({url:"/MachineTranslationEditSubmit?r="+p,data:{title:w,body:v,token:t},onSuccess:function(){try{ta.id("mtedit").hide();ta.id("mtedit_received").show();a.reposition();var x=ta.id("mtForm"+p);x.getElement(".mtRateLabel").hide();x.getElement(".mtImproveButton").hide();x.getElement(".mtEditThanksLabel").show()}catch(y){ta.util.error.record(y,"submitMTEdit:onSuccess")}},onFailure:function(x){try{if(x.status>=400&&x.status<=499){ta.id("mtedit_404").show()}else{q.disabled=false;ta.id("mtedit_500").show()}}catch(y){ta.util.error.record(y,"submitMTEdit:onFailure")}}}).send()}else{ta.id("mtedit_nochange").show()}},rateMTReview:function(p,s){var r=ta.id(s.form);var w=r.getElement("input[name=translateRating]:checked");if(w){var t=w.value;var u=r.elements.userId.value;var q=r.elements.reviewId.value;ta.servlet.Reviews.translationRatings.push(q);var v=r.action+"?at=true&rateValue="+q+","+u+","+t;new Request({url:v}).send();var x=r.getElement(".thanks").innerHTML;r.getElement(".translationRatingForm").innerHTML=x}},rateMTReviewNew:function(p,s,q,t){var r=ta.id("mtForm"+q);if(r){var w=r.elements.userId;if(w){ta.servlet.Reviews.translationRatings.push(q);var x=r.action+"?at=true&rateValue="+q+","+w.value+","+t;new Request({url:x}).send();var u=document.getElement(".mtRatingOverlay");if(u){u.hide()}var v=r.getElement(".mtRatingButton");if(v){v.hide()}var y=r.getElement(".thanks");if(y){y.show()}}}},popSocialShare:function(q,p){if(q&&q.href){var r="toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1,width=800,height=400,left=40,top=40,screenx=40,screeny=40";window.open(q.href,"SocialShare",r)}new Request({url:"/ActionRecord?action=shareOn"+p}).send();return false},resizeHelpfulVote:function(u){var q=document.querySelectorAll(u),v=document.querySelector(".helpful.redesigned"),t=document.querySelector(".isHelpful"),r=document.querySelector(".tooltips"),w=(ifdefNN(v)?v.parentNode.clientWidth:336)-20,s,x,p;if(ifdefNN(t)){w-=t.clientWidth}if(ifdefNN(r)){w-=r.clientWidth}for(s=0;s<q.length;s++){x=12;p=q[s];p.style.fontSize=x+"px";while(p.clientWidth>w&&x>8){p.style.fontSize=x+"px";x--}}},helpfulVoteHandlerOb:(function(){var p={};return function(s,r,t){if(p[r]){return}p[r]=true;new Event(s).preventDefault();var u=r.className.match(/\btgt_(\w+)\b/);if(!u){return}u=u[1];var q=u.match(/\d+/);if(ifdefNN(q)){q=q[0]}t=ta.util.ASDF.asdfDcd(t);new Request({url:t,onSuccess:function(v,x){var z=ta.id(u+"_expanded");var w=ta.id(u+"_collapsed");if(z){z.innerHTML=v}if(w){w.innerHTML=v;ta.store(u,true)}var y=ta.id("postVoteMessage_"+q);if(ifdefNN(y)){setTimeout(function(){y.addClass("seen")},500)}},onComplete:function(){delete p[r]}}).send()}})(),recordUnattached:function(q,p){new Request({url:"/ActionRecord?action=START_UNATTACHED_RVW_SEARCH"}).send();p.removePropertyEvent("keyup","ta.servlet.Reviews.recordUnattached")},changeSearchType:function(E,s){if(window.searchType){$$("span."+window.searchType.id).hide()}window.searchType=s;ta.select("span."+s.id).setStyle("display","inline");var v=s.getAttribute("data-type")||s.value;ta.find('input[name="type"]').value=v;var G=ta.id("query");var y=G.retrieve("typeahead");if(G&&y){var F=ta.servlet.Reviews.poiTypeIdMap[v];y.options.search=TypeAhead.utils.query(false,F,null,null,true,10);y.options.minChars=F=="al"?2:3;y.search()}var r=ta.find(".poiSearch");if(r){if(s.id=="type_rental"){ta.select(".poiSearchForm, #UR_SELECT, #SRCH_RSLT").hide();ta.select(".vrSearchForm").show();var A=ta.id("reviewGeo");if(A){A.focus();A.select()}}else{var C={type_hotel:"hotel",type_attraction:"attr",type_restaurant:"eat",type_airline:"al",type_location:"geo"};ta.store("tpAhdType",C[s.id]);ta.select(".vrSearchForm, #SRCH_RSLT_VR, #MAIN_COL, #POST_PHOTOS_FORM").hide();ta.select(".poiSearchForm, #UR_SELECT").show();if(G.value.length>0){searchByType()}G.focus();G.select();var D=ta.id("queryGeo");if(D){var w=D.retrieve("typeAhead");if(w){var t="GEO";if(s.id=="type_attraction"){t="ATTRGEO"}else{if(s.id=="type_restaurant"){t="RESTGEO"}}w.changeUrl("/TypeAheadJson?action="+t);w.query();w.updateChoices()}}}ta.select("#SRCH_RSLT, .tips").hide();ta.store("searchResultFlag",true)}else{var z="GEO";if(s.id!="type_rental"){switch(s.id){case"type_hotel":ta.store("tpAhdType","hotel");break;case"type_attraction":ta.store("tpAhdType","attr");z="ATTRGEO";break;case"type_restaurant":ta.store("tpAhdType","eat");z="RESTGEO";break;case"type_location":ta.store("tpAhdType","geo");break}if($("SRCH_BOX_VR")){$("SRCH_BOX_VR").hide()}if($("SRCH_RSLT_VR")){$("SRCH_RSLT_VR").hide()}if($("MAIN_COL")){$("MAIN_COL").hide()}if($("POST_PHOTOS_FORM")){$("POST_PHOTOS_FORM").hide()}$("SRCH_BOX").show();$("UR_SELECT").show();var p=ta.id("query");var u=p.retrieve("typeAhead");var B=ta.id("SEARCH_GEO");if(u){var x="/TypeAheadJson?action=SINGLELOCTYPE&types="+ta.retrieve("tpAhdType")+"&global=true";if(ifdefNN(B)&&ifdefNN(B.value)){x+="&parentids="+B.value}u.changeUrl(x);if(ifdefNN(p.value)&&p.value.trim().length!==0){u.query();u.updateChoices()}}p.focus();p.select();var D=ta.id("queryGeo");if(D){var w=D.retrieve("typeAhead");if(w){w.changeUrl("/TypeAheadJson?action="+z);w.query();w.updateChoices()}}}else{$("SRCH_BOX_VR").show();$("SRCH_BOX").hide();$("UR_SELECT").hide();var A=$("reviewGeo");A.focus();A.select()}ta.store("searchResultFlag",true);ta.id("SRCH_RSLT").hide()}},unattachedSearchOnFocus:function(t,r,q){var s=ta.retrieve("tpAhdType");var p={xargs:"&types="+s};if(q){p.geo=q}ta.run("ta.widgets.typeahead.factory.global_mutable",{},t,r,"SINGLELOCTYPE","ta.widgets.typeahead.events.onSelectUnattached",p);r.removePropertyEvent("focus","ta.servlet.Reviews.unattachedSearchOnFocus")},unattachedSearchGeoOnFocusAttach:function(s,p){var q=ta.retrieve("tpAhdType"),r=p.retrieve("typeAhead");ta.run("ta.widgets.typeahead.factory.global_mutable",{},s,p,"GEOGRAPHICONLY","ta.widgets.typeahead.events.onSelectGeoUnattached",{xargs:"&types="+q,minLength:1,noSearchPrompt:true});p.removePropertyEvent("focus","ta.servlet.Reviews.unattachedSearchGeoOnFocus")},unattachedSearchGeoOnFocus:function(r,p){var q=ta.id("SEARCH_GEO");q.value=1;p.value=""},unattachedSearchGeoOnBlur:function(v,q){var u=ta.id("SEARCH_GEO"),r=ta.id("query"),s=q.retrieve("typeAhead"),p=r.retrieve("typeAhead");if(!s.selected){var t=s.choices.getFirst();if(q.value==""||!t||!t.responseObj||t.responseObj.notFound){u.value=1;q.value=""}else{u.value=t.responseObj.value;q.value=t.responseObj.name}p.changeUrl("/TypeAheadJson?action=SINGLELOCTYPE&types="+ta.retrieve("tpAhdType")+"&global=true&parentids="+u.value)}},ratingFlyoutScroll:function(q){try{var r=q.getScroll().y,p=q.getScrollSize().y;if(q.retrieve("canFetchMore",true)&&r>p-ta.servlet.Reviews.PAGING_HEIGHT){q.store("canFetchMore",false);ta.servlet.Reviews.fetchRatingPage(q)}}catch(s){ta.util.error.record(s,"ratingFlyoutScroll")}},fetchRatingPage:function(q){var p=q.getElement(".ratingVal").innerHTML,r=q.getElement(".locId").innerHTML,t=q.getElement(".revId"),s=t.innerHTML;if(s!=0){new Request({url:"/RatingPagingAjax",data:{locId:r,ratingVal:p,revId:s},method:"get",onSuccess:function(u,v){t.destroy();q.innerHTML+=u;q.store("canFetchMore",true)}}).send()}},toggleOnRecentReview:function(w,u,p){if(!w||!u||!p){return}var t=ta.id(w.target||w.srcElement);var s=ta.id("RECENT_REVIEW_QUOTE_"+p);if(s&&t&&t.id==u.id){var v=s.getElement(".speechBubble");if(v){v.addClass("highlight")}var r=s.getElement(".recentReview_meta_content");if(r){r.addClass("highlight")}}if(!s||!s.hasClass("hidden")){return}var q=ta.id("RECENT_REVIEW_ATTRIBUTION_"+p);if(!q){return}ta.select("#HR_HACKATHON_CONTENT .recentReviewQuote").each(function(x){if(x.get("id")!="RECENT_REVIEW_QUOTE_"+p){if(!x.hasClass("hidden")){x.addClass("hidden")}}else{x.removeClass("hidden")}});ta.select("#HR_HACKATHON_CONTENT .recentReviewAttribution").each(function(x){if(x.get("id")!="RECENT_REVIEW_ATTRIBUTION_"+p){if(!x.hasClass("hidden")){x.addClass("hidden")}}else{x.removeClass("hidden")}})},toggleOffRecentReview:function(v,t,p){if(!v||!t||!p){return}var r=ta.id("RECENT_REVIEW_QUOTE_"+p);if(!r){return}var s=ta.id(v.target||v.srcElement);if(s&&s.id==t.id){var u=r.getElement(".speechBubble");if(u){u.removeClass("highlight")}var q=r.getElement(".recentReview_meta_content");if(q){q.removeClass("highlight")}}},onClickRecentReview:function(s,r,p){if(!s||!r||!p){return}var q=ta.id("RECENT_REVIEW_QUOTE_"+p);if(!q){return}var t=q.getElement(".quoteLnk");if(t){t.click()}},toggleReview:function(p,r,q,t){if(!p||!r||!q){return}var v=ta.id("review_"+q);var u=ta.id("UR"+q);var x;if(u){x=u}else{if(v){x=v}else{return}}var w=x.getElement(".col2of2");var s=x.getElement(".innerBubble");if(w&&s){if(t){w.addClass("highlight");s.addClass("highlight")}else{w.removeClass("highlight");s.removeClass("highlight")}}},scrollToReview:function(q,s,r){var x=document.getElements(".persistent_tabs_header");var t=0;if(x&&x.length!=0){t=x.getHeight()}var v=ta.id("review_"+r);if(v){window.scrollTo(0,v.getPosition().y-t)}else{var u=ta.retrieve("location.helpful_review_highlight.full."+r);if(u){var w=ta.select("#REVIEWS .reviewSelector");var p=Elements.from(u);w.some(function(y){if(!y.getParent("#FRIENDS_LOCATION_CONTENT_SUMMARY")){p.inject(y,"before");v=ta.id("review_"+r);window.scrollTo(0,v.getPosition().y-t);return true}return false})}}},poiTypeIdMap:{2:"hotel",7:"eat",5:"attr",15:"al"},selectPoiType:function(s,p){ta.select(".poiTypes li").removeClass("selected");p.addClass("selected");var q=p.id.replace("type_","");ta.ReviewTracking.trackEvent("TYPE",q);var r=ta.find(".unattachedTypeahead");r&&r.toggleClass("hidden",p.id=="type_rental");ta.servlet.Reviews.changeSearchType(s,p)},selectPoiIcon:function(s,p){ta.select(".poiTypes li").addClass("collapsed");p.removeClass("disabled");p.getSiblings().addClass("disabled");var q=p.id.replace("type_","");ta.ReviewTracking.trackEvent("TYPE",q);var r=ta.find(".unattachedTypeahead");r&&r.toggleClass("hidden",p.id=="type_rental");ta.servlet.Reviews.changeSearchType(s,p)},createUnattachedTypeahead:function(t,r){r.onfocus=null;var q=ta.find('input[name="type"]').value;var s=ta.servlet.Reviews.poiTypeIdMap[q];var u=TypeAhead.utils.query(false,s,null,null,true,10,null,null,null,null,["no_closed"]);var p={name:"UnattachedWarLander",minChars:s=="al"?2:3,maxResults:10,containerParent:ta.id("PAGE"),containerClass:"typeaheadResults",search:u,itemTemplate:TypeAhead.views.itemTemplate(),itemSelector:"li",width:348,positionRelative:false,selectInputText:false,selectOnBlur:false,assumeOnBlur:false,cacheResults:false,autopopulateHighlighted:false,forceProcessResults:true,shouldSubmit:function(){searchByType(r);v.hide();return false},onSelect:function(w){var x=ta.find('input[name="type"]').value;ta.trackEventOnPage("Unattached_search","action",ta.servlet.Reviews.poiTypeIdMap[x]);var y=ta.id("UR_SELECT");if(y&&w){y.appendChild(new Element("input",{type:"hidden",name:"detail",value:w.value}));y.submit()}},resolveSelection:function(w){return w.name.stripTags()},onShow:function(w){w.container.addClass("visible")},onHide:function(w){w.container.removeClass("visible")}};TypeAhead.views.configureTypeAheadForSegmentedResults(p);var v=new TypeAhead(r,p);r.store("typeahead",v)},initializeMap:function(r,v,s,q){var u=r;var t=v;function p(){var w=new ta.servlet.Reviews.Map();w.initialize(u,t,s,q);ta.store("reviews.map."+r,w)}if(document.readyState==="complete"){p()}else{google.maps.event.addDomListener(window,"load",p)}},addDraggableMarker:function(p){var q=ta.retrieve("reviews.map."+p);if(q){q.addMarker();q.userMarker.setDraggable(true)}},makeMarkerDraggable:function(p){var q=ta.retrieve("reviews.map."+p);if(q&&q.userMarker){q.userMarker.setDraggable(true)}},restoreDefaultMarker:function(p){var q=ta.retrieve("reviews.map."+p);if(q){q.resetMap();if(q.userMarker){q.userMarker.setDraggable(false)}if((ta.retrieve("reviews.pinRedist"))!="true"){q.userMarker.setVisible(false)}}},mapPinConfirmationOverlay:function(r,q){var p=ta.retrieve("map_pin_confirmation_overlay");if(!p){p=new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_NEVER,showArrow:true,arrowClass:"arrow arrowLeft",showCloseButton:true,style:"tooltip ttGreen small",mirrorIfRtl:true,offsetRight:3,offsetTop:77},q);ta.store("map_pin_confirmation_overlay",p)}p.show()},trackMapPinConfirmationEvent:function(p,r){var q=ta.retrieve("reviews.map."+p);if(q){ta.trackEventOnPage("WAR_Optional",q.trackingPrefix+r)}},pinVoteNo:function(r,q,p){ta.servlet.Reviews.trackMapPinConfirmationEvent(p,"no");ta.id("PIN_YES").removeClass("selected");ta.id("PIN_NOTSURE").removeClass("selected");ta.id("PIN_NO").addClass("selected");ta.id("pinVote").value="no";if((ta.retrieve("reviews.pinRedist"))=="true"){ta.servlet.Reviews.makeMarkerDraggable(p);ta.servlet.Reviews.mapPinConfirmationOverlay(r,ta.id("MAP_CONTAINER"))}else{ta.servlet.Reviews.restoreDefaultMarker(p)}},pinVoteNotSure:function(r,q,p){ta.servlet.Reviews.trackMapPinConfirmationEvent(p,"unsure");ta.id("PIN_YES").removeClass("selected");ta.id("PIN_NO").removeClass("selected");ta.id("PIN_NOTSURE").addClass("selected");ta.id("pinVote").value="unsure";ta.servlet.Reviews.restoreDefaultMarker(p)},pinVoteYes:function(r,q,p){ta.servlet.Reviews.trackMapPinConfirmationEvent(p,"yes");ta.id("PIN_NO").removeClass("selected");ta.id("PIN_NOTSURE").removeClass("selected");ta.id("PIN_YES").addClass("selected");ta.id("pinVote").value="yes";if((ta.retrieve("reviews.pinRedist"))!="true"){ta.servlet.Reviews.addDraggableMarker(p);ta.servlet.Reviews.makeMarkerDraggable(p);ta.servlet.Reviews.mapPinConfirmationOverlay(r,ta.id("MAP_CONTAINER"))}else{ta.servlet.Reviews.restoreDefaultMarker(p)}},showReviewOverlay:function(){ta.find("#TOP_REVIEW_OVERLAY_HEADING_TITLE").innerHTML=ta.find(".altHeadInline a").innerHTML;var q=ta.find("#OVERLAY_REVIEW");if(q){var p=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true,style:"reviewMsgOverlay"}).loadRemoteSuccess(q.innerHTML);ta.store("userreview.overlayReview",p);ta.trackEventOnPage("UserReviewSearch","overlay_open","")}},initUserReviewOnTopTracking:function(){var q=ta.find(".writeAnotherReviewCta");if(q==null){return}ta.util.element.doIfElementIsVisible(q,ta.trackEventOnPage,["User_review_top","inView"]);var r;var s=function(){r=t.delay(500,q)};var p=function(){clearTimeout(r)};var t=function(){ta.trackEventOnPage("User_review_top","Impression","");q.removeEvent("mouseenter",s);q.removeEvent("mouseleave",p)};q.addEvent("mouseenter",s);q.addEvent("mouseleave",p)},initOwnersFavoriteReviewTracking:function(p){var r=function(){new Request({url:"/BLImpRecord",trackEvent:{module:servletName,action:"FAVORITE_VIEW",context:modelLocId},data:{blImps:JSON.stringify([{locationId:modelLocId,servlet:servletName,tab:"Reviews",display:"FavoriteReview",details:"REVIEW",position:1}])}}).send()};var q=ta.id("review_"+p);if(q){ta.util.element.doIfElementIsVisible(q,r);ta.select(q,".helpful_text").addEvent("click",function(){ta.trackEventOnPage(servletName,"FAVORITE_HELPFUL",modelLocId)});ta.select(q,".reportTxt").addEvent("click",function(){ta.trackEventOnPage(servletName,"FAVORITE_REPORT",modelLocId)});ta.select(q,"#rn"+p).addEvent("click",function(){ta.setEvtCookie(servletName,"FAVORITE_REVIEW_TITLE",modelLocId,0,this.href)});ta.select(q,".moreLink").addEvent("click",function(){ta.trackEventOnPage(servletName,"FAVORITE_MORE",modelLocId)});ta.select(q,".ownerFavHeader").addEvent("mouseover",function(){ta.trackEventOnPage(servletName,"FAVORITE_TOOLTIP",modelLocId);ta.id(this).removeEvents("mouseover")})}},iapFlyout:function(r,q,p){n.open(r,q,{voteContentType:"USERREVIEW",contentId:p})},iapOwnerFlyout:function(r,q,p){p.owner=true;n.open(r,q,p)},showSendMessage:function(p,r,q){k.showSendMessage(p,r,q)},openTranslation:function(q,p){ta.util.cookie.setPIDCookie(16009);if(o){o.sourceElement=q;o.updateContent(p)}else{o=new c(q,[l(q,"center",""),g.center([0,0]),b,m,i,h(),f(p,{resources:[window.conceptCss]})]);ta.store("translationOverlay",o);o.container.style.maxWidth="90%";o.container.style.width="800px"}o.show()},showRoomTips:function(q){var p=new c(null,[l(null,"center","small no_padding"),g.center(),b,m,i,f("/AccommodationTips?d="+window.modelLocId+(q?"&filterLang="+q:""))]);p.on("contentLoaded",function(){if(ta.find("#emptyTips",p.contentElement)){setTimeout(p.hide.bind(p),1)}});p.show()}};ta.servlet.Reviews.Map=function d(){this.mapId=null;this.isInteractive=false;this.isZoomInitialized=false;this.googleMap=null;this.streetField=null;this.localStreetField=null;this.street1_local=null;this.street1=null;this.city=null;this.state=null;this.country=null;this.defaultLat=null;this.defaultLng=null;this.hasDefault=false;this.redistributable=false;this.userMarker=null;this.userMarkerMoved=false;this.userMarkerZoom=-1;this.resetPinButton=null;this.trackingPrefix=null;this.trackingInteractivePrefix=null;this.updateTimeout=null};ta.servlet.Reviews.Map.prototype.initialize=function(r,w,t,q){this.mapId=r;this.isInteractive=w;this.streetField=ta.id(t);this.localStreetField=ta.id(q);this.populateMapInfoFromServlet();ta.trackEventOnPage("WAR_Optional",this.trackingPrefix+"load");var p={center:this.hasDefault?{lat:this.defaultLat,lng:this.defaultLng}:{lat:13.081,lng:80.274},zoom:this.hasDefault?this.streetLevelZoom+1:2,streetViewControl:w,draggable:w,scrollwheel:w,disableDefaultUI:!w,disableDoubleClickZoom:!w};this.googleMap=new google.maps.Map(document.getElementById(r),p);var s,u;if(w){s=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pinSearchCustom.png");u=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pinSearchCustomOver.png")}else{s=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pin_v2_CurrentCenter.png");u=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pin_v2_CurrentCenterOver.png")}this.userMarker=new google.maps.Marker({visible:false,icon:s,zIndex:10,optimized:false,draggable:false,title:w?ta.retrieve("reviews.userMarkerTooltip"):""});this.userMarker.setMap(this.googleMap);this.userMarker.setVisible(this.redistributable);this.userMarker.setPosition(this.googleMap.getCenter());this.removeReportAnErrorButton(this.googleMap);if(w){this.addListeners(s,u);this.addMapControls()}this.clearMapWarnings();var v=this;google.maps.event.addListenerOnce(this.googleMap,"tilesloaded",function(){v.setupGeoCodes()})};ta.servlet.Reviews.Map.prototype.addListeners=function(q,p){Element.NativeEvents.input=2;var r=this.userMarker;var s=this;[this.streetField,this.localStreetField].forEach(function(v){if(v){var u="mapChangeEvent."+s.mapId+"."+v.id;var t=function(x){s.updateGeoCodes()};var w=ta.retrieve(u);["change","input"].forEach(function(x){v.removeEvent(x,w);v.addEvent(x,t)});ta.store(u,t)}});google.maps.event.addListener(r,"mouseover",function(){r.setIcon(p)});google.maps.event.addListener(r,"mouseout",function(){r.setIcon(q)});google.maps.event.addListener(this.googleMap,"bounds_changed",function(){if(s.isZoomInitialized){ta.trackEventOnPage("WAR_Optional",s.trackingPrefix+"map_zoom")}if(s.userMarker.getVisible()&&s.googleMap.getBounds().contains(s.userMarker.getPosition())){s.userMarkerZoom=Math.max(s.googleMap.getZoom(),s.userMarkerZoom)}s.validateMap()});google.maps.event.addListener(r,"dragend",function(){ta.trackEventOnPage("WAR_Optional",s.trackingInteractivePrefix+"pin_move");s.resetTimeout();s.userMarkerMoved=true;s.userMarkerZoom=s.googleMap.getZoom();s.validateMap();ta.id("newLat").value=r.getPosition().lat();ta.id("newLng").value=r.getPosition().lng()})};ta.servlet.Reviews.Map.prototype.removeReportAnErrorButton=function(s){var p={name:"Dummy Style"};var q=[{featureType:"road",elementType:"all",stylers:[{visibility:"on"}]}];var r=new google.maps.StyledMapType(q,p);s.mapTypes.set("Dummy Style",r);s.setMapTypeId("Dummy Style")};ta.servlet.Reviews.Map.prototype.populateMapInfoFromServlet=function(){this.streetLevelZoom=parseInt(ta.retrieve("reviews.street_level_zoom"))||15;this.redistributable=(ta.retrieve("reviews.pinRedist"))=="true";this.defaultLat=parseFloat(ta.retrieve("reviews.pinLat"));this.defaultLng=parseFloat(ta.retrieve("reviews.pinLng"));this.hasDefault=!!(this.defaultLat&&this.defaultLng);this.city=ta.retrieve("reviews.address_city");this.state=ta.retrieve("reviews.address_state");this.country=ta.retrieve("reviews.address_country");this.street1=ta.retrieve("reviews.address_street1");this.street1_local=ta.retrieve("reviews.address_street1_local");if(this.redistributable){this.trackingPrefix="map_confirm_";this.trackingInteractivePrefix="map_confirm_no_"}else{if(this.hasDefault){this.trackingPrefix="map_addpin_noregc_";this.trackingInteractivePrefix="map_addpin_noregc_yes_"}else{this.trackingPrefix="map_addpin_nogc_";this.trackingInteractivePrefix="map_addpin_nogc_yes_"}}};ta.servlet.Reviews.Map.prototype.handleNewGeoCodes=function(t,r){var u=null;var s=null;var q=false;if(r==google.maps.GeocoderStatus.OK){if(t&&t[0]&&t[0].geometry&&t[0].geometry.location){q=true;var p=t[0].geometry.location;this.googleMap.fitBounds(t[0].geometry.viewport);this.userMarker.setPosition(this.googleMap.getCenter());if(this.street1||this.street1_local){u=p.lat();s=p.lng();this.googleMap.setZoom(this.streetLevelZoom+1)}}}else{if(r==google.maps.GeocoderStatus.ZERO_RESULTS){q=true}}if(q){this.defaultLat=u;this.defaultLng=s;this.hasDefault=!!(u&&s);this.userMarker.setVisible(this.hasDefault);this.userMarkerMoved=false}this.validateMap()};ta.servlet.Reviews.Map.prototype.resetTimeout=function(){if(this.updateTimeout){clearTimeout(this.updateTimeout);this.updateTimeout=null}};ta.servlet.Reviews.Map.prototype.updateGeoCodes=function(q){if(this.updateTimeout){clearTimeout(this.updateTimeout)}var r=this;var p=function(){r.updateTimeout=null;r.street1=r.streetField?r.streetField.value:null;r.street1_local=r.localStreetField?r.localStreetField.value:null;var v=r.googleMap;var t=[];t.push(r.street1_local||r.street1);t.push(r.city);t.push(r.state);t.push(r.country);var s=t.join(", ");var u=new google.maps.Geocoder();u.geocode({address:s},function(x,w){r.handleNewGeoCodes(x,w)})};if(q){p()}else{this.updateTimeout=setTimeout(p,500)}};ta.servlet.Reviews.Map.prototype.setupGeoCodes=function(){if(this.hasDefault){this.userMarker.setPosition(new google.maps.LatLng(this.defaultLat,this.defaultLng));this.userMarker.setVisible(this.redistributable);this.googleMap.setCenter(this.userMarker.getPosition());this.googleMap.setZoom(this.streetLevelZoom+1);this.validateMap();this.isZoomInitialized=true}else{this.updateGeoCodes(true);var p=this;google.maps.event.addListenerOnce(this.googleMap,"tilesloaded",function(){p.isZoomInitialized=true})}};ta.servlet.Reviews.Map.prototype.resetMap=function(){this.resetTimeout();if(this.hasDefault){var p=new google.maps.LatLng(this.defaultLat,this.defaultLng);this.userMarker.setPosition(p);if(!this.googleMap.getBounds().contains(p)){this.googleMap.setCenter(p)}ta.id("newLat").value="";ta.id("newLng").value=""}else{this.userMarker.setVisible(false)}this.userMarkerMoved=false;this.validateMap()};ta.servlet.Reviews.Map.prototype.addMarker=function(){this.resetTimeout();this.userMarker.setPosition(this.googleMap.getCenter());this.userMarkerZoom=this.googleMap.getZoom();this.userMarker.setVisible(true);this.validateMap()};ta.servlet.Reviews.Map.prototype.addMapControls=function(){var t=this;var r=document.createElement("div");var q=ta.retrieve("reviews.resetPinText");var s=ta.retrieve("reviews.resetPinTooltip");var p=function(){return function(){ta.trackEventOnPage("WAR_Optional",t.trackingInteractivePrefix+"pin_reset");t.resetMap()}};t.resetPinButton=ta.servlet.Reviews.Map.prototype.createButton("resetPinButton",q,s,p());r.appendChild(t.resetPinButton);r.index=0;this.googleMap.controls[google.maps.ControlPosition.RIGHT_TOP].push(r)};ta.servlet.Reviews.Map.prototype.createButton=function(v,t,u,q){var p=document.createElement("div");p.id=v;p.className="mapButton";var s=document.createElement("div");s.className="mapButtonBorder";s.title=u;p.appendChild(s);var r=document.createElement("div");r.className="mapButtonText";r.innerHTML=t;s.appendChild(r);if(q!=null){google.maps.event.addDomListener(s,"click",q)}return p};ta.servlet.Reviews.Map.prototype.addMapWarning=function(r){var q=ta.id("warningMessages");var p=ta.id("warningMessageContainer");if(p){ta.id(p).show()}if(q){if(q.innerHTML.length>0){q.innerHTML+="<br />"}q.innerHTML+=r}};ta.servlet.Reviews.Map.prototype.clearMapWarnings=function(){var q=ta.id("warningMessages");var p=ta.id("warningMessageContainer");if(p){ta.id(p).hide()}if(q){q.innerHTML=""}};ta.servlet.Reviews.Map.prototype.validateMap=function(){if(!this.isInteractive){return}this.clearMapWarnings();if(!this.checkZoom()){this.addMapWarning(ta.retrieve("reviews.zoomInWarningMsg"))}if(!this.userMarkerMoved){ta.id(this.resetPinButton).hide()}else{ta.id(this.resetPinButton).show()}};ta.servlet.Reviews.Map.prototype.checkZoom=function(){return this.userMarkerZoom>this.streetLevelZoom||!this.userMarkerMoved}});ta.servlet.Location={distanceUnitsCookieName:"TAdistanceCookie",showMi:function(){$$("#NEARBY .milesOption").each(function(b,a){b.checked=true});$$("#NEARBY .milesLabel").each(function(b,a){$(b).addClass("selected")});$$("#NEARBY .kmLabel").each(function(b,a){$(b).removeClass("selected")});$$("#NEARBY .distanceMiles").show();$$("#NEARBY .distanceKm").hide();Cookie.write(this.distanceUnitsCookieName,0)},showKm:function(){$$("#NEARBY .kmOption").each(function(b,a){b.checked=true});$$("#NEARBY .milesLabel").each(function(b,a){$(b).removeClass("selected")});$$("#NEARBY .kmLabel").each(function(b,a){$(b).addClass("selected")});$$("#NEARBY .distanceMiles").hide();$$("#NEARBY .distanceKm").show();Cookie.write(this.distanceUnitsCookieName,1)},reportClosedVote:function(b,a,c){if(c&&c>0){c=encodeURIComponent(c);new Request({method:"get",url:"/ReportIAP?token="+window.JS_SECURITY_TOKEN+"&action=geocodeclosed&id="+c,onSuccess:function(d){ta.overlays.showInLightbox(d,{style:"mg s4",delayedPosition:true})}}).send()}},reportGeoCode:function(d,c,e,b,a){if(e&&e>0){e=encodeURIComponent(e);new Request({method:"get",url:"/ReportIAP?token="+window.JS_SECURITY_TOKEN+"&action=geocodebad&id="+e,onSuccess:function(f){ta.overlays.showInLightbox(f,{style:"mg s4",delayedPosition:true})}}).send()}if(ta.trackEventOnPage&&b&&a){ta.trackEventOnPage(b,a,e)}},reportCorrectAddr:function(c,f,k,n,d,i,l,o){if(k&&k>0){k=encodeURIComponent(k);var h=document.getElementById("street").value;var j=document.getElementById("city").value;var b=document.getElementById("state").value;var e=document.getElementById("zip").value;var g=document.getElementById("country").value;var m=document.getElementById("phone").value;var a=document.getElementById("website").value;if(n==h&&d==j&&i==e&&l==m&&o==a){new Request({method:"post",url:"/ReportIAP?token="+window.JS_SECURITY_TOKEN+"&action=geocodecorrect&updated=false&id="+k,onSuccess:function(p){ta.overlays.showInLightbox(p,{style:"mg s4",delayedPosition:true})}}).send()}else{h=encodeURIComponent(h);j=encodeURIComponent(j);b=encodeURIComponent(b);e=encodeURIComponent(e);g=encodeURIComponent(g);m=encodeURIComponent(m);a=encodeURIComponent(a);new Request({method:"post",url:"/ReportIAP?token="+window.JS_SECURITY_TOKEN+"&action=geocodecorrect&updated=true&id="+k+"&street="+h+"&city="+j+"&state="+b+"&zip="+e+"&country="+g+"&phoneNumber="+m+"&webSite="+a,onSuccess:function(p){ta.overlays.showInLightbox(p,{style:"mg s4",delayedPosition:true})}}).send()}}},reportGeoCodeDialog:function(d,c,e,b,a){if(typeof(incorrectLocation)!="undefined"&&!this.incorrectLocationLink){this.incorrectLocationLink=Asset.css(incorrectLocation)}if(e&&e>0){e=encodeURIComponent(e);new Request({method:"get",url:"/ReportIAP?token="+window.JS_SECURITY_TOKEN+"&id="+e+"&action=geocodedialog",onSuccess:function(f){ta.overlays.showInLightbox(f,{style:"mg s4",delayedPosition:true})},evalScripts:true}).send()}if(ta.trackEventOnPage&&b&&a){ta.trackEventOnPage(b,a,e)}},updateListingInformation:function(a,c,e,i,f,b,h,g){if(e&&e>0){if(g){window.location.href=g}else{var d={style:"glnew_lightbox",closeButtonClass:"innerClose",delayedPosition:true,attachCloseEvent:false,permanent:true,showCloseButton:true};new Request({url:"/GetListedUpdate"+b+"?id="+e,onSuccess:function(k){var j=ta.overlays.showInLightbox(k,Object.merge(d,{title:h}));j.closeBtn.addEvent("click",function(){ta.GetListedNew.closeOverlay()})},evalScripts:true}).send()}}if(ta.trackEventOnPage&&i&&f){ta.trackEventOnPage(i,f,e)}},reportClosedVoteNew:function(d,c,f,b,a,e){if(f&&f>0){new Request({method:"post",url:"/"+e+"?action=closedareyousure&id="+f,onSuccess:function(g){ta.overlays.showInLightbox(g,{style:"glnew_update_areyousure mg s4",delayedPosition:true,isChild:true,showCloseButton:false})},evalScripts:true}).send()}},recordOpenVote:function(d,c,f,b,a,e){if(f&&f>0){new Request({method:"post",url:"/"+e+"?action=voteopen&id="+f,onSuccess:function(g){ta.overlays.showInLightbox(g,{style:"mg s4",delayedPosition:true,showCloseButton:false})},evalScripts:true}).send()}},requestListingWithLightbox:function(b,c,a,h,k,e,l){l=l||{};var f={};var i=document.getElementById("query");if(i&&i.value){f.query=i.value}var d={style:"glnew_lightbox",closeButtonClass:"innerClose",delayedPosition:true,attachCloseEvent:false,permanent:true,showCloseButton:true};var j={showthanks:k,fromWARToDo:e,placetype:a,reviewID:l.reviewID};var g="/GetListedLightbox?"+Object.toQueryString(j);new Request({method:"post",url:g,data:f,onSuccess:function(n){var m=ta.overlays.showInLightbox(n,Object.merge(d,{title:h}));m.closeBtn.addEvent("click",function(){ta.GetListedNew.closeOverlay()});if(l.onHide){m.addEvent("hide",function(){l.onHide({display:"form"})})}m.container.store("onhide",l.onHide);ta.select(".overlayBG").setStyle("height",Math.max(window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),document.body.scrollHeight))},evalScripts:true}).send()},showReportForm:function(b,a,c){if(c&&c>0){c=encodeURIComponent(c);new Request({method:"get",url:"/ReportIAP?token="+window.JS_SECURITY_TOKEN+"&id="+c+"&action=geocodeform",onSuccess:function(d){ta.overlays.showInLightbox(d,{style:"mg s4",delayedPosition:true})},evalScripts:true}).send()}},setTrackPID:function(c,b,a){if(a==10022){ta.util.cookie.setPIDCookie(17138)}else{if(a==10021){ta.util.cookie.setPIDCookie(17137)}}},closeLightbox:function(){var a=ta.retrieve("overlays.current");if(a){a.hide()}},activateReportButton:function(){var a=ta.id("REPORT_LOCATION").getElements(".button")[0];a.removeClass("inactive");a.removeProperty("disabled")}};ta.servlet.Popup={index:0,open:function(a,b,c,p,l,k,g,o){try{if(isNaN(parseInt(c))){c=600}else{c=parseInt(c)}if(isNaN(parseInt(p))){p=400}else{p=parseInt(p)}if(isNaN(parseInt(l))){l=0}else{l=parseInt(l)}if(isNaN(parseInt(k))){k=0}else{k=parseInt(k)}if(a.indexOf("p=HotelsCom")>-1){c=Math.max(c,960);p=Math.max(p,window.getHeight(),600)}if(Browser.chrome){g=true}var f=1;if(g){f=0}var j=1;if(ta.browser.isIE9orHigher()){var j=0}var i=false;if(b&&typeof b=="string"){i=b}if(!i){var q=ta.servlet.Popup.index++;i="TripPop"+q}var d="";if(o){d="toolbar=1,resizable=1,location=1,status=1"}else{j=0;d="toolbar=0,resizable=1,location=0,status=0"}d+=",menubar="+j;d+=",scrollbars="+f;d+=",width="+c;d+=",height="+p;d+=",screenX="+l+",left="+l;d+=",screenY="+k+",top="+k;var m=window.open(a,i,d);if(m!=null){try{m.focus();m.opener=self}catch(n){}return m}}catch(h){ta.util.error.record(h,"Popup.open",null,{name:b,width:c,height:p,x:l,y:k,noScroll:g,allOptions:o})}},openExternalWithDefaultOptions:function(a){try{var b=475;var n=390;var k=210;var j=5;if(screen.width>=1024&&screen.height>=768){b=900;n=768;k=240}else{if(screen.width>1024){b=800;n=600;k=240}else{if(screen.width>800){b=620;n=500;k=240}}}if(a.indexOf("p=HotelsCom")>-1){b=Math.max(b,960);n=Math.max(n,window.getHeight(),600)}var f=false;if(Browser.chrome){f=true}var d=1;if(f){d=0}var i=1;if(ta.browser.isIE9orHigher()){var i=0}var o=ta.servlet.Popup.index++;var h="TripPop"+o;var c="toolbar=1,resizable=1,location=1,status=1";c+=",menubar="+i;c+=",scrollbars="+d;c+=",width="+b;c+=",height="+n;c+=",screenX="+k+",left="+k;c+=",screenY="+j+",top="+j;var l=window.open(a,h,c);if(l!=null){try{l.focus();l.opener=self}catch(m){}return l}}catch(g){ta.util.error.record(g,"Popup.open - openExternalWithDefaultOptions",null,{name:name,width:b,height:n,x:k,y:j,noScroll:f})}},openSizedPopup:function(e,b,d){new Event(e).preventDefault();var c=600;var a=400;if(sz=b.className.match(/sz(\d+)x(\d+)/)){c=sz[1];a=sz[2]}ta.servlet.Popup.open(b.href,"photoTPW",c,a,false,false,((typeof d!="undefined")?d:true),true)},checkrates:function(b,a){b.preventDefault();if(a.get("tag")!="a"){a=a.getParent("a")}ta.servlet.Popup.open(a.href,"cr",245,610,5,5);if(ta.trackEventOnPage){ta.trackEventOnPage("map_pin_overlay","check_rates_click")}},sponsorCheckRates:function(d,b){d.preventDefault();if(b.get("tag")!="span"){b=b.getParent("span")}var a=b.className.match(/id_(\d+)/)[1];var c="/HotelDateSearch?d="+a+"&fromPop=false&sponsid="+ta.retrieve("sponsor.id")+"&area=QC_Button_Map&from=HACSearchButton&returnTo=__2F__GMapsLocationController&sponsdet=mapsHacBottom";ta.servlet.Popup.open(c,"cr",245,610,5,5)},termsPopup:function(b,a){popup.apply(a,[b,"terms",300,300,30,25]);return false},openInParent:function(e,d,c){var a=false;if(window.top&&window.top.opener){a=window.top}else{if(window.opener){a=window}}if(!a){return true}var b="";if(d.get("tag")=="form"){b=d.action+"?"+d.toQueryString()}else{if(d.get("tag")=="a"){b=d.href}else{d=d.getParent("a");b=d.href}}if(b!=""){if(e){e.preventDefault()}a.opener.location=b;if(!(typeof c!="undefined"&&c)){a.close()}else{window.blur()}}},openInParentOrSelf:function(d,c){var a=false;if(window.top&&window.top.opener){a=window.top}else{if(window.opener){a=window}}var b="";if(c.get("tag")=="form"){b=c.action+"?"+c.toQueryString()}else{if(c.get("tag")=="a"){b=c.href}else{c=c.getParent("a");b=c.href}}if(b!=""){if(d){d.preventDefault()}if(!a||(typeof a.opener=="undefined")||!a.opener||(typeof a.opener.closed=="undefined")||a.opener.closed){window.location=b}else{a.opener.location=b;a.close()}}},photoGallery:function(a,d){try{if(!d){return false}if(!d.get||!d.getParentBySelector){d=$(d)}if(!d.get||!d.getParentBySelector){ta.util.error.record(j,"photoGallery - elmt not wrapped");return false}if(d.get("tag")!="a"){d=d.getParentBySelector("a")}}catch(j){ta.util.error.record(j,"photoGallery - get anchor elmt");return false}var b="";var c="1";if(d.className){b=d.className.match(/u_([^ ]*)/)[1];c=d.className.match(/#([0-9]+)/)[1]}try{if(typeof cookieDomain=="undefined"){var g=window.location.hostname.split("."),f=0,l;while(g[f]&&g[f]!="tripadvisor"){f++}l=g.slice(f).join(".");if(l){cookieDomain="."+l}}Cookie.write("PhotoPop",c,{domain:cookieDomain})}catch(j){ta.util.error.record(j,"photoGallery - cookie set")}try{var k="";if(b){k=ta.servlet.Popup.open(b,"media",780,800)}else{}try{if(k&&k.showImage){k.showImage(c)}}catch(j){}}catch(j){ta.util.error.record(j,"photoGallery - pop window")}return false},openAIMLink:function(d,c){new Event(d).preventDefault();var b;if(c.get("tag")=="span"&&c.hasClass("fkASDF")){b=c.className.match(/u_([^ ]*)/)[1]}else{if(c.getParent("div.fkASDF")){b=c.getParent("div.fkASDF").className.match(/u_([^ ]*)/)[1]}else{if(c.get("tag")=="a"){b=c.href}else{if(c.getParent().get("tag")=="a"){b=c.getParent().href}else{return}}}}b=b.replace("%7Cnavarea%7C",ta.meta.link.getPhotoNavArea(c));var a=c.className.match(/win(.+)/);if(a&&a.length>1){a=a[1]}else{a=null}ta.store("commerce.AIMWindow",ta.servlet.Popup.open(b,a,980,800,240,5,false,true))},openProviderWindow:function(b,a){new Event(b).preventDefault();ta.servlet.Popup.open(a.href,"photoTPW",1260,922,false,false,true,true)}};ta.servlet.Hotel={detailsTabClicked:function(b,a){showTab(locationId,"tabDetails")},photosTabClicked:function(b,a){showTab(locationId,"tabPhotos")},mapTabClicked:function(b,a){showTab(locationId,"tabMap")},ratingsTabClicked:function(b,a){showTab(locationId,"tabRatings")},anchorAtHotelsSortingHeader:function(){var a=ta.id("hotels_list_sorting_header");if(a){new Fx.Scroll(document.body,{offset:{x:0,y:a.getPosition().y}}).toTop()}},setPid:function(a){ta.util.cookie.setPIDCookie(a)},setConceptCookie:function(){if(ta.has("topconcepts.lastconcept")){var a=ta.retrieve("topconcepts.lastconcept");Cookie.write("CONCEPT",a,{domain:cookieDomain,time:5})}return true},voteRecorded:false,recordVote:function(b,g,e,c,a){if(a.checked&&!ta.servlet.Hotel.voteRecorded){ta.servlet.Hotel.voteRecorded=true;new Request({url:"/ActionRecord-g"+b+"-d"+g+"?action=TopConceptsHelpful_"+e}).send();var d=$("preVote");var f=$("postVote");if(d&&f){d.style.display="none";f.style.display="inline"}else{ta.util.error.record(null,"recordVote - cannot find voting spans")}}return true},isHotelsServlet:function(a){if(ta.has("is_hotels_serv")){return ta.retrieve("is_hotels_serv")}var b=ta.id("PAGE");if(b&&typeof b!="undefined"){if(b.hasClass("hotels_like")){ta.store("is_hotels_serv",true);return true}else{if(b.hasClass("non_hotels_like")){ta.store("is_hotels_serv",false);return false}}}if(typeof a!="undefined"){return a}return false},selectLanguage:function(d,b,e){var c=ta.id("LANG_FORM");var a=ta.id("filterLang");if(c&&a){ta.setEvtCookie("Reviews_Controls","language_sort","",0,window.location.href);a.value=e;c.submit()}},selectSeason:function(a,f,i,b,d,e){var g=ta.find("#MONTH_FORM .seasonLabel");if(ta.util.localstorage&&ta.util.localstorage.canUseLocalStore()){var h=new Date();h.setHours(h.getHours()+12);if(d!=0){localStorage.setItem("season_memory_expiry_time",h);localStorage.setItem("season_memory_loc_id",i);localStorage.setItem("season_memory_geo_id",b)}else{localStorage.removeItem("season_memory_expiry_time");localStorage.removeItem("season_memory_popup_shown");localStorage.removeItem("season_memory_loc_id");localStorage.removeItem("season_memory_new_popup_shown");localStorage.removeItem("season_memory_geo_id")}}if(g&&e){g.set("text",e)}var c=ta.id("MONTH_FORM");var k=ta.id("filterSeasons");if(c&&k){k.value=d;ta.trackEventOnPage("Reviews_Controls","season","",d);function j(){var l=ta.select(".seasonList .spinner img");l.forEach(function(n){n.remove()});var m=ta.find(".spinner",f);if(m){new Asset.image(CDNHOST+"/img2/spinner.gif").inject(m)}}j();c.submit()}}};(function(){ta.servlet||(ta.servlet={});var a=ta.servlet.ShowSpecialOffer;if(!a){a=ta.servlet.ShowSpecialOffer={}}a.open=function(){var c=Array.prototype.slice.call(arguments);var b=a.openCoupon;if(b){b.apply(a,c)}else{ta.run.apply(ta,["ta.overlays.Factory.createCouponAnnouncementOverlay",null].append(c))}}})();define("utils/cookieutils",["dom-lib"],function(e){var a=function(f){return typeof(f)!=="undefined"&&f!==null},c=function(f){return f.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},b=function(){var f=window.location.host.match(/\.tripadvisor\..*/);if(f!=null){f=f[0];return f}else{return null}},d=function(h,i,g){if(!(a(g.doNotEscape)&&g.doNotEscape)){i=encodeURIComponent(i)}if(g.domain){i+="; domain="+g.domain}else{i+="; domain="+b()}if(g.path){i+="; path="+g.path}if(g.duration){var f=new Date();f.setTime(f.getTime()+g.duration*1000);i+="; expires="+f.toGMTString()}if(g.secure){i+="; secure"}var j="%1%";if(a(g.ignoreVersion)&&g.ignoreVersion){j=""}document.cookie=h+"="+j+i};return{addPidToCookie:function(f){if(a(f)&&0!==f.length){d("NPID",f,{path:"/",duration:(5),ignoreVersion:true})}},roybatty:function(){var f=b(),i=window.taSecureToken,j,k;if(window.taEarlyRoyBattyStatus){if(window.taEarlyRoyBattyStatus>1&&ta&&ta.trackEventOnPage){ta.trackEventOnPage("early_roy_batty","confirm","",0,true)}}else{k=this.getCookie("roybatty");if(!k){document.setCookie("roybatty",i+",1",{domain:f,ignoreVersion:true,path:"/"});e.ajax({type:"POST",url:"/CookiePingback"})}else{var h=k.split(",");if(h&&h.length==2){var g=parseInt(h[1],10);document.setCookie("roybatty",i+","+g,{domain:f,ignoreVersion:true,path:"/"})}}}},getCookie:function(f){var g=document.cookie.match("(?:^|;)\\s*"+c(f)+"=([^;]*)");if(g){g=g[1];if(g.indexOf("%1%")===0){g=g.substring(3)}return decodeURIComponent(g)}return null},setCookieInSeconds:d}});ta.widgets.calendar={multiDateFormatter:function(f,g,e,c,d){var b={cname:"",contents:f.getDate()};var a="";if(!e){a="invalid"}else{if(f.getTime()==this.today.getTime()){if(this.newInDate&&f.getTime()==this.newInDate.getTime()){a="today inDate"}else{if(!g){a="today disabled"}else{a="today"}}}else{if(this.newInDate&&f.getTime()==this.newInDate.getTime()){a=d.inDateClass}}}b.cname=a;return b},calendarSingleSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.singleDaySelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarSingleSelect issue")}},calendarMCSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.multiCitySelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarMCSelect issue")}},dateFromString:function(d){d=d.replace(/\n/g,"");var a=ta.widgets.calendar.getDatePickerFormat("classic");var c=a.replace(/\w/g,"")[0];a=a.replace(/ /g,"").split(c);var b=d.replace(/ /g,"").split(c);if(a.contains("MM")&&a.contains("dd")&&a.contains("yyyy")){var h=a.indexOf("MM"),f=a.indexOf("dd"),g=a.indexOf("yyyy");var e=new Date(b[g],b[h]-1,b[f]);if(ta.retrieve("thai_buddhist_era_year")){e.setFullYear(e.getFullYear()-ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)}if(e!="Invalid Date"){return e}}return undefined},lastDateBefore:function(b,c){if(b.multiCityFlight&&c>1){var a;var d=c;while((!a||a.trim()==="")&&d>1){--d;a=ta.id("date_picker_in_"+d).innerHTML}if(a&&a.trim()!==""){return ta.widgets.calendar.dateFromString(a)}}return this.getPageInDate()},calendarMultiSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.multiSelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarMultiSelect issue")}},calendarMouseOver:function(f,e,a,c,b){ta.id(b).getParent(".overlay").overlay.calendar.dayOver(f,ta.util.date.create(e,a,c),b)},calendarPrev:function(c,b){var a=ta.id(b);if(a&&a.hasClass("sprite-date_picker-btnLeftInactive")){return}if(ta.util.i18n.isRtl()&&a&&a.hasClass("sprite-date_picker-btnRightInactive")){return}a.getParent(".overlay").overlay.calendar.prev()},calendarNext:function(c,b){var a=ta.id(b);if(a&&a.hasClass("sprite-date_picker-btnRightInactive")){return}if(ta.util.i18n.isRtl()&&a&&a.hasClass("sprite-date_picker-btnLeftInactive")){return}a.getParent(".overlay").overlay.calendar.next()},adultsOver:function(c,b){var a=document.getElements(".date_picker_adults_option");if(a){Array.each(a,function(d){ta.id(d).removeClass("adults_selected")})}ta.id(b).addClass("adults_selected")},removeMetaCalendarFromSync:function(c){if(!ta.has("metaDatePickerEnabled")){return}var b="avail.data."+c+"._met";var a=ta.retrieve("avail.data.objects");if(a){a.erase(b)}ta.store("avail.data.objects",a);ta.remove(b)},getCalendarObjectKey:function(d,b,a){var c="avail.data";if(a){c=c+"."+a}c=c+"."+d;if(b){c=c+"."+b}return c},trackCalendarObject:function(d){var a=d.calendar?d.calendar.options.pickerOption:null;var b=ta.widgets.calendar.getCalendarObjectKey(d.locId,d.ext,a);ta.store(b,d);var c=ta.retrieve("avail.data.objects");if(!c){c=[]}c.include(b);ta.store("avail.data.objects",c)},trackCalendarFlyout:function(d,c,e){var f="date.picker.calendarflyout";var b=ta.retrieve(f);if(!b){b=[]}var a={};a.elmt=d;a.overlay=c;a.overlaySrc=e;b.push(a);ta.store(f,b);ta.remove("date.picker.calendarflyout.allCleared")},clearCalendarFlyouts:function(){var b="date.picker.calendarflyout";var a=ta.retrieve(b);if(a){a.each(function(c){var e=c.elmt;var d=c.overlay;var f=c.overlaySrc;if(e&&d&&f){e.removeEvent("mouseenter",d.showWithDelay);e.removeEvent("mouseleave",d.hideWithDelay);e.removeEvent("mouseenter",d.show);e.removeEvent("mouseleave",d.hide);e.removeEvent("click",d._pin);e.adopt(f)}});ta.store("date.picker.calendarflyout.allCleared",true)}},getDateBefore:function(b){var a=new Date(b.getTime());a.setDate(a.getDate()-1);return a},getDateAfter:function(b){var a=new Date(b.getTime());a.setDate(a.getDate()+1);return a},setPageInDate:function(b,a){if(b&&b.getDate){ta.store("date.picker.pageInDate",b)}if(ta.has("date.picker.pageOutDate")){ta.store("meta.page_dates",true)}if(!a&&ta.page&&ta.page.setDates){ta.page.setDates("CHECKIN",[b]);ta.page.emit("dateSelected",null,"CHECKIN",[b])}},setPageOutDate:function(b,a){if(b&&b.getDate){ta.store("date.picker.pageOutDate",b)}if(ta.has("date.picker.pageInDate")){ta.store("meta.page_dates",true)}ta.widgets.calendar.updateCalendarPropertiesOnDateSet();if(!a&&ta.page&&ta.page.setDates){ta.page.setDates("CHECKOUT",[b]);ta.page.emit("dateSelected",null,"CHECKOUT",[b])}},setTimeoutPageDates:function(){var b=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDateTimeout"));if(b){ta.widgets.calendar.setPageInDate(b)}var a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDateTimeout"));if(a){ta.widgets.calendar.setPageOutDate(a)}},clearPageDates:function(a){ta.store("data.picker.cachedDateCleared",true);ta.remove("date.picker.pageInDate");ta.remove("date.picker.pageOutDate");ta.remove("multiDP.inDate");ta.remove("multiDP.outDate");ta.remove("meta.page_dates");ta.remove("meta.session_dates");ta.remove("multiDP.priorDates");if(ta.isMetaHotelsRequest()||ta.has("meta.mini_meta_on_accommodations")){ta.store("dates.datesCleared",true)}if(!a&&ta.page&&ta.page.clearDates){ta.page.clearDates("STAYDATES");ta.page.emit("dateSelected",null,"STAYDATES",[null,null])}},clearPageInDate:function(a){ta.remove("date.picker.pageInDate");ta.remove("multiDP.inDate");ta.remove("meta.page_dates");if(!a&&ta.page&&ta.page.setDates){ta.page.setDates("CHECKIN",[null]);ta.page.emit("dateSelected",null,"CHECKIN",[null])}},clearPageOutDate:function(a){ta.remove("date.picker.pageOutDate");ta.remove("multiDP.outDate");ta.remove("meta.page_dates");if(!a&&ta.page&&ta.page.setDates){ta.page.setDates("CHECKOUT",[null]);ta.page.emit("dateSelected",null,"CHECKOUT",[null])}},updateCalendarPropertiesOnDateSet:function(){var a=ta.retrieve("avail.data.objects");if(a){Array.each(a,function(c){var b=ta.retrieve(c);if(b&&b.calendar){b.calendar.setPermanent(false)}})}},setPageAdultsCount:function(a){if(a){ta.store("date.picker.adultsCount",a)}},getPageInDate:function(){var a=false;if(ta.has("date.picker.pageInDate")){a=ta.retrieve("date.picker.pageInDate")}if(!a&&ta.has("multiDP.inDate")){a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDate"));if(a){ta.widgets.calendar.setPageInDate(a)}}if(a){return new Date(a.getTime())}return false},getPageOutDate:function(){var a=false;if(ta.has("date.picker.pageOutDate")){a=ta.retrieve("date.picker.pageOutDate");if(!ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageOutDate();return false}if(a){return new Date(a.getTime())}}if(!a&&ta.has("multiDP.outDate")){a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDate"));if(a){ta.widgets.calendar.setPageOutDate(a)}if(!ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates();return false}if(a){return new Date(a.getTime())}}return false},haveDatesChanged:function(){var a=ta.widgets.calendar.getPageInDate(),b=ta.widgets.calendar.getPageOutDate(),d=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDate")),c=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDate"));return(!d||a.getTime()!=d.getTime())||(!c||b.getTime()!=c.getTime())},isValidStayLength:function(b){var c=ta.widgets.calendar.getPageInDate();if(!c||!b){return true}var d=0,a=0;if(ta.retrieve("allowLongTrips")){d=b-new Date();a=ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT}else{d=b-c;a=ta.util.date.MAX_STAY_DURATION_DAYS}d=Math.round(d/1000/60/60/24);if(d>a){return false}return true},getPageAdultsCount:function(){if(ta.has("date.picker.adultsCount")){return ta.retrieve("date.picker.adultsCount")}if(ta.has("multiDP.adultsCount")){ta.store("date.picker.adultsCount",ta.retrieve("multiDP.adultsCount"));return ta.retrieve("multiDP.adultsCount")}return"2"},getGuestsRoomsPickerData:function(){var b=ta.retrieve("guests.rooms.object"),i,a,j;if(!b){try{var f=require("utils/cookieutils").getCookie("TATravelInfo");var h=ta.widgets.calendar.getGuestsRoomsValue(f,"A");if(h&&h!==""){i=parseInt(h,10)}var g=ta.widgets.calendar.getGuestsRoomsValue(f,"RS");if(g&&g!==""){a=parseInt(g,10)}var d=ta.widgets.calendar.getGuestsRoomsValue(f,"CA");if(d&&d!==""){j=d}if(i&&i>0&&a&&a>0){b={rooms:a,guests:i,child_rm_ages:j};ta.store("guests.rooms.object",b);ta.fireEvent("onLegacyGuestsChanged",b)}}catch(c){ta.util.error.record(c,"ta.widgets.calendar.getGuestsRoomsPickerData")}}if(!b){b={rooms:1,guests:2,child_rm_ages:""};ta.store("guests.rooms.object",b)}return b},getCheckRatesData:(function(){function b(){var d=ta.widgets.calendar.getPageInDate(),c=ta.widgets.calendar.getPageOutDate();if(!d||!c||!d.getMonth||!c.getMonth){return false}return{inMonth:(d.getMonth()+1)+" "+d.getFullYear(),inDay:d.getDate(),outMonth:(c.getMonth()+1)+" "+c.getFullYear(),outDay:c.getDate()}}function a(c){c=c||"STAYDATES";return ta.page.datesToQueryJson(c)}return function(d){var c=(ta.page&&ta.page.datesToQueryJson)?a(d):b();c.adults=ta.widgets.calendar.getPageAdultsCount();if(ta.has("guests_rooms_picker.enabled")){var e=ta.widgets.calendar.getGuestsRoomsPickerData();c.adults=e.guests;c.rooms=e.rooms;c.child_rm_ages=e.child_rm_ages}return c}})(),_parseDatePickerDate:function(c){try{if(c&&c.split&&c.split(" ").length>1){var a=c.split(" ");var b=new Date();ta.util.date.normalize(b);b.setFullYear(a[0]);b.setDate(1);b.setMonth(parseInt(a[1],10)-1);b.setDate(a[2]);return b}}catch(d){return false}},hasPageDates:function(){if(!ta.has("metaDatePickerEnabled")){return false}if(ta.has("meta.page_dates")){return true}ta.widgets.calendar.getPageInDate();ta.widgets.calendar.getPageOutDate();return ta.has("meta.page_dates")},oneDayMill:(24*60*60*1000),updateDateWidgetDisplay:function(a){if(!a){return}ta.id(a).removeClass("date_picker_error");var c=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();ta.widgets.calendar.updateDateDisplay(a,c,b);var d=document.getElements(".adults");if(d){d.each(function(e){ta.widgets.calendar.updateAdultsDisplay(e)})}},getPageInCalendarField:function(b,a){return ta.id("date_picker_in_"+b+a)},getPageOutCalendarField:function(b,a){return ta.id("date_picker_out_"+b+a)},getErrorDates:function(){var c="no dates";try{var a=ta.widgets.calendar.getDatePickerFormat("classic");if(ta.widgets.calendar.hasPageDates()){c=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),a);c=c+" - "+ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageOutDate(),a)}}catch(b){}return c},updateDateDisplay:function(b,c,g){var d,a,f,i,e,h,j;if(c&&g&&c.getTime()>g.getTime()){d=c;c=g;g=d}a=ta.widgets.calendar.getDatePickerFormat("classic");if(ta.id(b).getParent(".dual_date")){b.innerHTML=c?ta.widgets.calendar.dateToString(c,a):ta.retrieve("multiDP.checkIn");f=b.id.replace("date_picker_in","date_picker_out");if(f&&ta.id(f)){ta.id(f).innerHTML=g?ta.widgets.calendar.dateToString(g,a):ta.retrieve("multiDP.checkOut")}}else{i=b.innerHTML=ta.retrieve("multiDP.enterDatesText");e=ta.widgets.calendar.getSingleDateFieldDatesText(c,g,a);if(e){i=e}b.innerHTML=i;h=ta.id(b).getParent();if(h){j=h.getElement(".date_picker_calendar_nights");ta.widgets.calendar.updateNightsDisplay(j,c,g)}}},getSingleDateFieldDatesText:function(d,b,a){var c="";var e=ta.retrieve("multiDP.dateSeparator")||" - ";if(d){c=ta.widgets.calendar.dateToString(d,a)+e;if(b){c=c+ta.widgets.calendar.dateToString(b,a)}}return c},updateNightsDisplay:function(d,c,a){if(!d){return}if(!a){d.innerHTML="";return}var b=ta.widgets.calendar.getNumberOfNightsFromDates(c,a);if(b==1){d.innerHTML=ta.retrieve("multiDP.singleNightText")}else{d.innerHTML=ta.retrieve("multiDP.multiNightsText").replace(/\d+/,b)}},getNumberOfNights:function(){var b=ta.widgets.calendar.getPageInDate(),a=ta.widgets.calendar.getPageOutDate();return ta.widgets.calendar.getNumberOfNightsFromDates(b,a)},getNumberOfNightsFromDates:function(b,a){if(b&&a){return Math.round(Math.abs((b.getTime()-a.getTime())/ta.widgets.calendar.oneDayMill))}else{return 0}},updateAdultsDisplay:function(b){if(!b){return}var a=ta.widgets.calendar.getPageAdultsCount();if(a=="1"){b.innerHTML=ta.retrieve("multiDP.singleAdultsText")}else{b.innerHTML=ta.retrieve("multiDP.multiAdultsText").replace(/\d+/,a)}},syncAllDatePickers:function(){var c=document.getElements(".date_picker.date");if(c){Array.each(c,function(g){if(g&&!ta.id(g).hasClass("out_date")&&!ta.id(g).hasClass("multiCity")&&!ta.id(g).hasClass("oneWay")){ta.widgets.calendar.updateDateWidgetDisplay(g)}})}var a=$$(".tablet_date_label");if(a&&ta.widgets.calendar.hasPageDates()){a.addClass("showLabels")}a=document.getElements(".dateLabel");if(a){var f=ta.widgets.calendar.getDatePickerFormat("short");var b=ta.widgets.calendar.getDatePickerFormat("classic");var e=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),b);if(ta.has("guests_rooms_picker_3.enabled")){e=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),f)}var d=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageOutDate(),b);Array.each(a,function(g){var h=ta.id(g);if(h){if(h.hasClass("inDate")){h.innerHTML=e?e:ta.retrieve("multiDP.checkIn")}else{if(h.hasClass("outDate")){h.innerHTML=d?d:ta.retrieve("multiDP.checkOut")}}}})}},getDatePickerFormat:function(a){if(a==="classic"&&typeof DATE_PICKER_CLASSIC_FORMAT!="undefined"){return DATE_PICKER_CLASSIC_FORMAT}else{if(a==="short"&&typeof DATE_PICKER_SHORT_FORMAT!="undefined"){return DATE_PICKER_SHORT_FORMAT}else{if(a==="days_and_slashes"&&typeof DATE_PICKER_DAY_AND_SLASHES_FORMAT!="undefined"){return DATE_PICKER_DAY_AND_SLASHES_FORMAT}else{if(typeof DATE_PICKER_META_FORMAT!="undefined"){return DATE_PICKER_META_FORMAT}}}}if(typeof a!="string"){a="not_a_string"}return""},dateToString:function(d,e){var b,j,a,h,c,k,i,f,g;if(!d.getDate||!e){return""}if(e==ta.widgets.calendar.getDatePickerFormat("classic")){b=new Date(d);if(ta.retrieve("thai_buddhist_era_year")){b.setFullYear(b.getFullYear()+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)}j="MM";a="yyyy";h="dd";f=b.getDate()+"";if(f&&f.length===1){f="0"+f}g=(b.getMonth()+1)+"";if(g&&g.length===1){g="0"+g}e=e.replace(j,g).replace(h,f).replace(a,b.getFullYear()).replace(/'/g,"");return e}else{if(e==ta.widgets.calendar.getDatePickerFormat("short")){b=new Date(d);j="MM";h="dd";f=b.getDate()+"";if(f&&f.length==1){f="0"+f}g=(b.getMonth()+1)+"";if(g&&g.length==1){g="0"+g}e=e.replace(j,g).replace(h,f).replace(/'/g,"");return e}else{if(e==ta.widgets.calendar.getDatePickerFormat("days_and_slashes")){b=new Date(d);i="EEE";j="MM";a="yyyy";h="dd";k=d.getDay();if(ta.retrieve("multiDP.isMondayFirstDayOfWeek")){k=k-1}if(k==-1){k=6}f=b.getDate()+"";if(f&&f.length===1){f="0"+f}g=(b.getMonth()+1)+"";if(g&&g.length===1){g="0"+g}if(e.indexOf(i)!=-1){e=e.replace(i,jsGlobalDaysAbbrev[k])}else{if(e.indexOf("EE")!=-1){e=e.replace("EE",jsGlobalDaysAbbrev[k])}else{e=e.replace("E",jsGlobalDaysAbbrev[k])}}e=e.replace(j,g).replace(h,f).replace(a,b.getFullYear()).replace(/'/g,"");return e}}}c=ta.retrieve("multiDP.abbrevMonthList");k=d.getDay();if(ta.retrieve("multiDP.isMondayFirstDayOfWeek")){k=k-1}if(k==-1){k=6}i="EEE";j="MMM";if(e=="EEEE d MMMM"){i="EEEE";j="MMMM"}e=e.replace(i,jsGlobalDaysAbbrev[k]).replace(j,c[d.getMonth()]).replace(/\bd\b/,d.getDate()).replace(/'/g,"");return e},showCalendarByLocId:function(b,a){if(!/^\d+$/.test(b)){ta.util.error.record(null,"Cannot show calendar due to missing/invalid location ID: "+b);return}a=a||"";var c={id:"",className:"id_"+b+a,"data-date_suffix":a,toString:function(){return"[showCalendarSrc: "+b+a+"]"}};ta.widgets.calendar.setErrorStyling(c)},clickCalendarEvent:function(b){if(document.createEvent){var a=document.createEvent("HTMLEvents");a.initEvent("click",true,true);b.dispatchEvent(a)}else{b.click()}},setErrorStyling:function(d){var c=false,g=d["data-date_suffix"]||null;var b=d.id.match(/CHECK_RATE_([a-zA-Z]+)/);if(b&&b.length>1&&(b[1]=="mnf"||b[1]=="mnl"||b[1]=="photoviewer"||b[1]=="albumMeta")){g="_"+b[1]}try{c=d.className.match(/\bid_(\d+)/)[1]}catch(f){}if(c){var a=false;var h="date_picker_in_";if(!a&&g){a=ta.id(h+c+g)}if(!a){a=ta.id(h+c+"_met")}if(!a){a=ta.id(h+c+"_cro")}if(!a){a=ta.id(h+c+"_per")}if(!a){a=ta.id(h+c+"_pop")}if(!a){a=ta.id(h+c+"_mnl")}if(!a){a=ta.id(h+c+"_mnm")}if(!a){a=ta.id(h+c+"_smt")}if(!a){a=ta.id(h+c+"_pto")}if(!a){a=ta.id(h+c+"_pal")}if(!a){a=ta.id(h+c+"_amo")}if(!a&&d.id.slice(-4)=="_inm"){a=ta.id(h+c+"_inm")}if(!a){a=ta.id(h+c)}if(a){setTimeout(function(){ta.widgets.calendar.clickCalendarEvent(a)},100)}}},launchInlineMeta:function(a){ta.widgets.calendar._crBtnOnclick("#CHECK_RATE",a)},launchMetaLightboxUpdate:function(){},launchCRLBUpdate:function(){ta.commerce.meta.clearStoredMiniData();ta.overlays.Factory.updateMiniMetaPlacements()},_crBtnOnclick:function(b,c){ta.store("meta.calendarCR",true);var a=document.getElement(b);if(a){document.getElement(b).onclick(c)}ta.remove("meta.calendarCR")},onShowPricesClick:function(a,b){if(!ta.widgets.calendar.hasPageDates()){return}ta.trackEventOnPage("GuestRoomSelector","ShowPrices_Calendar_click");if(b==="Hotels"){ta.servlet.HACSearch.doMetaDateSearch();ta.commerce.meta.updateHeaderDates()}else{if(b==="HotelHighlight"){ta.widgets.calendar.onCalendarRangeSelect(a)}else{window.fireEvent("newInlinePageDates",[a])}}ta.widgets.calendar.closeCalendarWidgets();if(ta.has("guests_rooms_picker_3.enabled")){this.displayStayInfoPicker()}},displayStayInfoPicker:function(){$$(".stayInfoHeader").removeClass("hidden");$$(".changeStayInfoButton").removeClass("hidden");$$(".date_control_wrapper").addClass("hidden")},closeCalendarWidgets:function(){var b=document.getElements(".date_picker_calendar");if(b){Array.each(b,function(e){if(e&&e.overlay){var d=true;var c=e.overlay.source;if(c&&(c.hasClass("isPreDatesPermanent")||c.getParent(".isPreDatesPermanent"))){d=false}if(d){e.overlay.hide()}}})}var a=document.getElement(".dp.overlay");if(a&&a.overlay){a.overlay.hide()}},getInOutTrackingKey:function(b){var a="avail.data.dateClicked";if(b){return a+".in"}else{return a+".out"}},removeInOutCalendarSelected:function(a){ta.remove(ta.widgets.calendar.getInOutTrackingKey(a))},trackInOutCalendarSelected:function(a){ta.store(ta.widgets.calendar.getInOutTrackingKey(a),true)},inOutCalendarSelected:function(a){return ta.retrieve(ta.widgets.calendar.getInOutTrackingKey(a))},trackCalendarEvent:function(c,d,b,g){try{var a=ta.has("multiDP.priorDates")?ta.retrieve("multiDP.priorDates"):ta.widgets.calendar.hasPageDates();b+=a?"|CHANGE":"|PRE";ta.trackEventOnPage(c,d,b,g,true)}catch(f){}},cancelAllExistingHAC:function(){if(ta.hac.filters&&ta.hac.filters.removeProcessingForExistingHACQuery){ta.hac.filters.removeProcessingForExistingHACQuery()}if(ta.meta.update&&ta.meta.update.cancelAllMetaCurrentQuery){ta.meta.update.cancelAllMetaCurrentQuery()}if(ta.commerce.metajson&&ta.commerce.metajson.cancelCurrentBulkFetch){ta.commerce.metajson.cancelCurrentBulkFetch()}},submitHacSearch:function(d,c,f){if(typeof(f)=="undefined"){f=false}if(ta.has("useHotelsFilterState")){return ta.widgets.calendar.submitHotelsForm(d,c,f)}var b="";c=ta.id(c);if(c.get("tag")=="form"){var e=c.getElement("input[name=q]");if(e){e.name=""}b=c.action+"?"+c.toQueryString()}else{if(c.get("tag")=="a"){b=c.href}else{c=c.getParent("a");b=c.href}}if(b!==""){if(ta.widgets.calendar.hasPageDates()){if(!b.match(/\?/)){b=b+"?"}var a=ta.widgets.calendar.getCheckRatesData();if(a){b=b+"&"+Object.toQueryString(a)}}if(d){new Event(d).preventDefault()}if(f){window.open(b)}else{window.location=b}}},clearSessionDates:function(b,a){new Request({url:"/UpdateSessionDatesAjax?clear=true",onSuccess:function(){ta.widgets.calendar.clearDates();if(b){document.location.href="./"+b}if(a&&typeof a==="function"){a()}}}).send()},clearAllDatePickers:function(){var c=ta.retrieve("avail.data.objects");if(c){Array.each(c,function(d){var e=ta.retrieve(d);if(e){e.clear()}})}var b=document.getElements(".date_picker.date");if(b){Array.each(b,function(d){ta.widgets.calendar.updateDateWidgetDisplay(d);ta.widgets.calendar.showEnterDates(d)})}var a=$$(".tablet_date_label");if(a){a.removeClass("showLabels")}},showEnterDates:function(a){if(!a){return}if(ta.id(a).getParent(".dual_date")){if(ta.id(a).hasClass("out_date")){a.innerHTML=ta.retrieve("multiDP.checkOut")}else{a.innerHTML=ta.retrieve("multiDP.checkIn")}}else{a.innerHTML=ta.retrieve("multiDP.enterDatesText")}},clearDates:function(){ta.widgets.calendar.clearPageDates();ta.widgets.calendar.clearAllDatePickers();var a=document.getElement(".clear_dates_button")||document.getElement(".clearDates");var j=document.getElement(".clear_dates_wrapper")||document.getElement(".clearDatesWrapper");var c=document.getElement(".showPriceButton");var b=document.getElement(".change_dates_button");var h=document.getElement(".date_picker_post_dates");var e=document.getElement(".date_picker_pre_dates");var f=document.getElement(".show_prices_button");var i=ta.id("ANIMATED_DATE_CTA");var d=ta.id("BC_PHOTOS");var g=document.getElement("#BC_PHOTOS .photo_slideshow");var k=document.getElement("#BC_PHOTOS .ug_thumbs");if(ta.retrieve("animate_date_reformat")){i=ta.id("ANIMATED_DATE_CTA_REFORMAT")}if(e){e.show()}if(h){h.hide()}if(a){a.hide()}if(j){j.hide()}if(b){b.hide()}if(f){f.show()}if(i){ta.servlet.HACSearch.loadAnimatedDateCTA()}if(c){c.hide()}if(d){d.style.opacity=1}if(g){g.style.opacity=1}if(k){k.style.opacity=1}if(ta.servlet.HACSearch&&ta.has("hac_timezone_awareness")){ta.servlet.HACSearch.clearDateFieldHighlighting()}},clearDatesAndRedirect:function(){var a=window.location.hash;var b=false;var c=window.location.href.match(/geo=\d+/g);if(c&&c[0]){b=c[0]}if(!b){c=window.location.href.match(/-g\d+/g);if(c&&c[0]){b="geo="+c[0].substring(2)}}if(b){var d="HACSearch?"+b+a;ta.widgets.calendar.clearSessionDates(d)}},storePriorDates:function(){ta.store("multiDP.priorDates",ta.retrieve("multiDP.priorDates")||ta.widgets.calendar.hasPageDates())},datesExist:function(){var b=ta.widgets.calendar.getPageInDate();var a=ta.widgets.calendar.getPageOutDate();return b&&a},datesInRange:function(){var c=ta.widgets.calendar.getPageInDate();var a=ta.widgets.calendar.getPageOutDate();if(!ta.widgets.calendar.datesExist()){return false}var b=Math.round(Math.abs((c.getTime()-a.getTime())/ta.widgets.calendar.oneDayMill));return b>=1&&b<=ta.util.date.MAX_STAY_DURATION_DAYS},openFirstDatePicker:function(b){new Event(b).stopPropagation();var a=$$(".date_picker_calendar_wrap");if(a&&a.length>0){a[0].click()}ta.trackEventOnPage("price_filter_dates_link","click","")},justUpdateSessionDates:function(b,c,a){if((c&&!ta.widgets.calendar.haveDatesChanged())||(ta.util.date.getDaysApart(this.inDate,this.outDate)>ta.util.date.MAX_STAY_DURATION_DAYS)||(this.inDate&&this.outDate&&ta.util.date.normalize(this.inDate)==ta.util.date.normalize(this.outDate))){if(b&&typeof(b)=="function"){b()}return}new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",async:(a!==true),onSuccess:function(){if(b&&typeof(b)==="function"){b()}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}ta.fireEvent("hotels.sessionDatesUpdated")}}).send();return true},justUpdateSessionAdults:function(a){var b=ta.widgets.calendar.getPageAdultsCount();if(b<=0){return}new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString({adults:b,onlyAdults:true}),method:"post",onSuccess:function(){if(a&&typeof(a)==="function"){a()}}}).send()},getGuestsRoomsValue:function(d,c){if(!d){return}var a=d.split("*");for(var b=0;b<a.length;b++){var e=a[b].split(".");if(e.length!=2){continue}if(e[0]===c){return e[1]}}},updateGuestsRoomsPickerDataFromCookie:function(){var g=require("utils/cookieutils").getCookie("TATravelInfo"),h,b,e,c,a,f;a=ta.widgets.calendar.getGuestsRoomsValue(g,"A");if(a&&a!==""){e=parseInt(a,10)}f=ta.widgets.calendar.getGuestsRoomsValue(g,"RS");if(f&&f!==""){b=parseInt(f,10)}var d=ta.widgets.calendar.getGuestsRoomsValue(g,"CA");if(d&&d!==""){c=d}if(e>=1&&b>=1&&e.toFixed&&b.toFixed){h={rooms:b,guests:e,child_rm_ages:c};ta.store("guests.rooms.object",h);ta.fireEvent("onLegacyGuestsChanged",h)}},updateGuestsRoomsPickerUI:function(){var b=ta.widgets.calendar.getGuestsRoomsPickerData();var a=document.getElements(".grp-rooms-value");a.each(function(c){if(c){c.innerHTML=b.rooms}});a=document.getElements(".grp-guests-value");a.each(function(c){if(c){c.innerHTML=b.guests}})},updateGuestsRoomsButtonLabelsPluralization:function(b,c){var a=$$(b);a.each(function(d){if(c>1){d.addClass("multiple")}else{d.removeClass("multiple")}})},checkDatesMakeHacCallHR:function(a){if(ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.handleNewDates(a)}},checkDatesMakeHacCallHotels:function(a){if(ta.widgets.calendar.hasPageDates()){ta.servlet.HACSearch.doMetaDateSearch(a)}},updateSDCalendar:function(){new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",onSuccess:function(){var c,b,a=document.getElement("#STATIC_DATE_PICKER_BAR .filterControls");window.fireEvent("sd_hh_datesChanged");if(ta.id("SDDatesHeaderCenter")){c=ta.id("SDDatesHeaderCenter");c.addClass("hide")}if((ta.id("SD_DATEBAR_TOOLTIP"))){c=ta.id("SDDatePickerBarStaticButton");c.addClass("hide");b=ta.id("SDDatePickerBarStaticChangeDates");b.removeClass("hide")}if(a){if(ta.widgets.calendar.datesExist()){a.removeClass("noDatesSelected");a.addClass("datesSelected")}else{a.removeClass("datesSelected");a.addClass("noDatesSelected")}}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}if(ta.retrieve("sd_progress_bar")){ta.servlet.SmartDeals.initProgressBar()}}}).send()},updateHLCalendar:function(){new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",onSuccess:function(){var h,a,d;window.fireEvent("sd_hh_datesChanged");a=ta.id("BODYCON");if(a){h=a.getElement("#HLDatePickerBar .metaDatePicker.moreProminent");d=a.getElement("#STATIC_DATE_PICKER_BAR .filterControls");if(d){if(ta.widgets.calendar.datesExist()){d.removeClass("noDatesSelected");d.addClass("datesSelected")}else{d.removeClass("datesSelected");d.addClass("noDatesSelected")}}}if(h){var f=document.getElement(".overlayBG");var c=document.getElement(".rgba_flyout.gray.overlay.relative");var g=document.getElement(".baseHotelInfoLeft");var b=document.getElement(".baseHotelInfoRight");var e=document.getElement(".HLBaseDisclaimer");if(f){f.destroy()}if(c){c.destroy()}if(g&&b){b.inject(g,"before")}if(e&&e.hasClass("hide")){e.removeClass("hide")}}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}}}).send()},updateSessionDates:function(a,b){new Request({url:"/UpdateSessionDatesAjax",data:b,method:"post",onSuccess:function(){if(a){if(ta.retrieve("smartDealsSearchIframe")){window.open(a,"_blank")}else{window.location=a}}},onFailure:function(){if(a){if(ta.retrieve("smartDealsSearchIframe")){window.open(a,"_blank")}else{window.location=a}}}}).send()},redirectToHotelOverview:function(a){this._redirectToHotelOverview(a,function(b){window.location=b})},openTabToHotelOverview:function(a){this._redirectToHotelOverview(a,function(b){window.open(b)})},_redirectToHotelOverview:function(b,c){if(b){b=JSON.decode(b);var a=b.url;if(ta.retrieve("is_from_sdprospect")&&a.contains("Hotels")){a=a.replace("Hotels","SmartDeals")}c(a)}else{c("/Hotels")}},submitHotelsForm:function(e,b,d){b=ta.id(b);if(typeof(d)=="undefined"){d=false}var c=b.toQueryString();if(ta.widgets.calendar.hasPageDates()){var a=ta.widgets.calendar.getCheckRatesData();if(a){c=c+"&"+Object.toQueryString(a)}}new Request({url:"/FilterState",data:c,method:"post",onSuccess:function(f){d?ta.widgets.calendar.openTabToHotelOverview(f):ta.widgets.calendar.redirectToHotelOverview(f)},onFailure:function(){d?ta.widgets.calendar.openTabToHotelOverview(null):ta.widgets.calendar.redirectToHotelOverview(null)}}).send();if(e){new Event(e).preventDefault()}return false},getPlacement:function(h){if(!h||!h.id){return null}var e=/date_picker_[0-9]*_([a-z]*)/;var i=/date_picker_in_[0-9]*_([a-z]*)/;var g=/date_picker_out_[0-9]*_([a-z]*)/;var f=/date_picker_adults_[0-9]*_([a-z]*)/;var a=h.id;var d=e.exec(a);if(!d){d=i.exec(a)}if(!d){d=g.exec(a)}if(!d){d=f.exec(a)}if(d){d=d[1]}if(!d){var b=h.getParent(".HotelDateSearch");if(b&&b.id){var c=(b.id).split("_");if(c.length>1){d=c[(c.length-1)]}}}return d},handleNewDates:function(k,n){if(ta.retrieve("hotel_review_low_price_message")){var e=document.getElement("#PRICE_ALERT_RIBBON");if(e){e.hide();ta.fireEvent("priceAlertBannerHidden")}ta.remove("hidePriceAlertRibbon")}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}if(ta.retrieve("tablet_maps_v1")&&n){var b=n.getParent(".flexCard");if(b){b.addClass("withMeta")}}ta.store("meta.requestFromArea","");if(ta.retrieve("origHTMLForUserReviews")){var h=ta.id("noAvailRHS");if(h){h.innerHTML=ta.retrieve("origHTMLForUserReviews")}}var j=document.getElement(".seeMoreHotels");if(j){j.hide()}var d=ta.id("BC_PHOTOS");if(d){d.style.opacity=1}var g=document.getElement("#BC_PHOTOS .photo_slideshow");if(g){g.style.opacity=1}var m=document.getElement("#BC_PHOTOS .ug_thumbs");if(m){m.style.opacity=1}var c=ta.widgets.calendar.getPlacement(n);if(c=="geo"){ta.widgets.calendar.justUpdateSessionDates();return}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){if(pageServlet=="Hotel_Review"||pageServlet=="ShowUserReviews"||pageServlet=="LocationPhotoDirectLink"){ta.store("meta.isFromDatesChange",true)}}ta.store("hotels.datesChanged",true);if(ta.commerce.datepickerpersist){ta.commerce.datepickerpersist.update()}var f="property_"+k;var i=ta.id(f);var a=ta.retrieve("overlay.lastElmt.className");var l=(c=="pop")&&(pageServlet=="Hotels")&&i&&a&&a.match(/custom_area_QC_Hotels_Meta/);if(ta.meta&&ta.meta.update&&!l){if(pageServlet==="Hotels"){ta.servlet.HACSearch.displayPostDatesLinks()}ta.overlays.Factory&&ta.overlays.Factory.tryToHideCROverlayPostDatesClose();window.fireEvent("newInlinePageDates",[k,c]);return}else{if(!l&&ta.util&&ta.util.error){ta.util.error.record(null,"handleNewDates - no meta js");return}}ta.store("hotels.datesChanged",true);ta.servlet.HACSearch.displayPostDatesLinks();ta.store("meta.redirectingToHR",true);ta.remove("overlay.lastElmt.className");ta.widgets.calendar.justUpdateSessionDates(false,false,true);ta.hac.filters.updateResultsFromDateSearch();window.open(i.href);document.getElements(".overlay").each(function(o){if(o.overlay&&o.overlay.hide){o.overlay.hide()}})},trackCRButtonClick:function(a){var c=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();var d=[a];if(c){d.push("CHECKIN")}if(b){d.push("CHECKOUT")}ta.trackEventOnPage("CRBUTTON","CLICK",d.join("|"))},setupNewDatesEvent:function(){try{ta.util.customEvent.addListener("newInlinePageDates",window,ta.widgets.calendar.inlineCalendarOnDateSelection)}catch(a){ta.util.error.record(a,"trouble building event - newInlinePageDates")}},inlineCalendarOnDateSelection:function(){ta.widgets.calendar.onCalendarChangeDates();var a=window.modelLocId;if(a){ta.widgets.calendar.onCalendarRangeSelect(a)}},onCalendarChangeDates:function(){ta.commerce.meta.tracking.resetAllTimingLocks();ta.commerce.meta.tracking.clearSuppressedAreas();ta.commerce.meta.polling.clearAllPollingInfo();if(ta.isHacMap()){ta.servlet.hotelsMap.map.cleanupOverlays()}},onCalendarRangeSelect:function(c,b){if(ta.commerce.metajson){ta.commerce.metajson.refetchAll()}if(typeof oxapp!="undefined"&&oxapp&&oxapp.context){var a=oxapp.context.has("TravelDates")&&oxapp.context.get("TravelDates");if(a){a.save()}}if(c&&ta.has("checkrates.meta_af")&&!(ta.retrieve("tablet_maps_v1")&&ta.retrieve("maps_v2_open"))){ta.commerce.meta.loadMetaAF(c,"AV_ABOVE_FOLD_META",false)}ta.store("ta.calRangeSelectCtx",{locId:c,ext:b});ta.fireEvent("onCalendarRangeSelect");ta.store("ta.calRangeSelectCtx",null)},trackCalendarSelect:function(c){var i=document.getElement(".inline_calendar");if(i){i=i.getParent()}if(!i){return}var f=i.getElement(".meta_date_field.first .date_picker");if(c){f=i.getElement('.meta_date_field:not([class="first"]) .date_picker')}if(!f){return}var d=ta.id(f).get("id");d=d.substring(d.length-3,d.length);var b="START";var g="DATES";var a=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();if(d=="upt"){g="Interrupter"}if(c){b="SELECT";if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){g="PRICE_CALENDAR"}else{if(a&&e){var h=ta.util.date.getDaysInRange(a,e)-1;if(h>ta.util.date.MAX_STAY_DURATION_DAYS){g="DATES_OVER_30_DAYS"}}}}if(ta.retrieve("meta.prof_photo_lb.post_date_close.overlay")){g="CalendarLightbox"}ta.widgets.calendar.trackCalendarEvent(ta.widgets.calendar.getTrackingString(),b,g)},setFirstDisplayMonth:function(c){var a=document.getElement(".month");if(!a){return false}var b=ta.widgets.calendar.getDateFromElem(a);if(!b){b=new Date(ta.util.date.normalize(new Date()))}if(c){b.setDate(1);b.setDate(32);b.setDate(1)}else{b.setDate(1);b.setDate(-1);b.setDate(1)}return b},updateCalendarMonths:function(a,g){try{if(!ta.has("ta.calendar.date.clickFunction")){ta.widgets.calendar.setClickMouseOverFunctions()}if(!a){return}a=ta.id(a);if(!g){if(ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonRight")){return}else{if(!ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonLeft")){return}}}else{if(ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonLeft")){return}else{if(!ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonRight")){return}}}var c=ta.widgets.calendar.setFirstDisplayMonth(g);var b=document.getElement(".inline_calendar");var d=b.getElements(".month");if(d){Array.each(d,function(e){e.dispose()})}var f=ta.widgets.calendar.createMonth(c);ta.widgets.calendar.injectMonth(f.elmt,b,true);ta.widgets.calendar.updatePrevNext(b,f)}catch(h){ta.util.error.record(h,"update calendar months")}},updatePrevNext:function(b,g){var c=g.date;var e=g.date;if(!ta.has("ta.calendar.firstDate")){ta.widgets.calendar.setFirstLastDates()}var i=ta.util.date.inSameMonth(c,ta.retrieve("ta.calendar.firstDate"));var a=ta.util.date.inSameMonth(e,ta.retrieve("ta.calendar.lastDate"));var f=ta.util.i18n.isRtl()?"sprite-date_picker-arrowButtonRight":"sprite-date_picker-arrowButtonLeft";var h=ta.util.i18n.isRtl()?"sprite-date_picker-arrowButtonLeft":"sprite-date_picker-arrowButtonRight";b.getElement(".prev").addClass(i?"":f).removeClass(i?f:"");b.getElement(".next").addClass(a?"":h).removeClass(a?h:"");var d=b.getElement(".prevText");if(d){if(i||!g.date){d.innerHTML=""}else{d.innerHTML=jsGlobalMonthsAbbrev[(g.date.getMonth()-1)%12]}}d=b.getElement(".nextText");if(d){if(a||!g.date){d.innerHTML=""}else{d.innerHTML=jsGlobalMonthsAbbrev[(g.date.getMonth()+1)%12]}}},dayClick:function(l,j,c,h,b){try{b=ta.id(b);if(!b||b.getParent(".disabled")){return}var k=ta.util.date.create(j,c,h);var a=ta.widgets.calendar.getPageOutDate();if(k){if(!ta.has("ta.first.date.selected")){if(a&&ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates()}ta.widgets.calendar.setPageInDate(k);ta.widgets.calendar.setFirstDateSelected(true);ta.widgets.calendar.trackCalendarSelect(false,b)}else{var i=ta.widgets.calendar.getPageInDate();if(!i){if(a&&ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates()}ta.widgets.calendar.setPageInDate(k);ta.widgets.calendar.setFirstDateSelected(true);return}else{if(i.getTime()==k.getTime()){return}else{if(i.getTime()>k.getTime()){ta.widgets.calendar.setPageInDate(k);ta.widgets.calendar.setPageOutDate(i)}else{ta.widgets.calendar.setPageOutDate(k)}}}ta.widgets.calendar.setFirstDateSelected(false);var f=1;if(typeof modelLocId!="undefined"){f=modelLocId}ta.widgets.calendar.handleNewDates(f);ta.widgets.calendar.showInlineCalendar(false);ta.widgets.calendar.trackCalendarSelect(true,b)}ta.widgets.calendar.updateSelectedDays(l,k,b);ta.widgets.calendar.syncAllDatePickers()}}catch(g){ta.util.error.record(g,"dayClick")}},setFirstDateSelected:function(a){if(a){ta.store("ta.first.date.selected",true);ta.widgets.calendar.addFirstDateFlag()}else{ta.remove("ta.first.date.selected");ta.widgets.calendar.removeFirstDateFlag();ta.widgets.calendar.removeHoverDateFlag()}ta.widgets.calendar.setMaxLengthOfStayStyling();ta.widgets.calendar.setInDateInputSelectState(a)},clearCalendarSelections:function(){ta.widgets.calendar.clearSelectedDays();ta.widgets.calendar.clearDates();ta.widgets.calendar.setFirstDateSelected(false)},addFirstDateFlag:function(){var a=ta.widgets.calendar.getPageInDate();var d=ta.widgets.calendar.getDayElemFromDate(a);var b=ta.retrieve("calendar.checkInText");if(b){var c=new ta.widgets.ArrowLabel(d,b);ta.store("ta.calendar.firstDateFlag",c)}},removeFirstDateFlag:function(){if(ta.has("ta.calendar.firstDateFlag")){var a=ta.retrieve("ta.calendar.firstDateFlag");if(a){a.remove();ta.remove("ta.calendar.firstDateFlag")}}},addHoverDateFlag:function(c,f,b){var a=ta.widgets.calendar.getPageInDate();if(a.getTime()==c.getTime()){ta.widgets.calendar.removeHoverDateFlag();return}if(ta.has("ta.calendar.hoverDateFlag")){var e=ta.retrieve("ta.calendar.hoverDateFlag");if(e){e.setParentElem(f);e.setText(b)}return}var d=new ta.widgets.ArrowLabel(f,b,{labelArrowBaseClass:"calendarDateStyling hoverDateStyling"});ta.store("ta.calendar.hoverDateFlag",d)},removeHoverDateFlag:function(){if(ta.has("ta.calendar.hoverDateFlag")){var a=ta.retrieve("ta.calendar.hoverDateFlag");if(a){a.remove();ta.remove("ta.calendar.hoverDateFlag")}}},addChooseDatesFlag:function(){if(!ta.has("ta.calendar.chooseDateFlag")){var a=ta.retrieve("calendar.enterDatesText");var b=document.getElement(".metaContentSection .largeOpenCalCRButton");var c=new ta.widgets.ArrowLabel(b,a,{labelArrowBaseClass:"calendarDateStyling enterDatesArrowElem",arrowSpriteClass:"sprite-date_picker-orangeArrowUp"});ta.store("ta.calendar.chooseDateFlag",c)}},removeChooseDatesFlag:function(){if(ta.has("ta.calendar.chooseDateFlag")){var a=ta.retrieve("ta.calendar.chooseDateFlag");if(a){a.remove();ta.remove("ta.calendar.chooseDateFlag")}}},onDateInputClick:function(a,b){var c=document.getElement(".inline_calendar");if(c&&c.hasClass("hidden")){ta.widgets.calendar.showInlineCalendar(true,!b.getParent(".meta_date_field.first"))}else{if(c&&ta.has("ta.first.date.selected")&&b&&b.getParent(".meta_date_field.first")){ta.widgets.calendar.clearCalendarSelections()}}},onDateInputOver:function(){if(!ta.widgets.calendar.hasPageDates()&&!ta.has("ta.first.date.selected")){ta.widgets.calendar.addChooseDatesFlag()}},onDateInputOut:function(){ta.widgets.calendar.removeChooseDatesFlag()},getDayElemFromDate:function(a){if(!a||!a.getTime){return false}return document.getElement(".date_"+a.getDate()+".month_"+a.getMonth()+".year_"+a.getFullYear())},getDateFromElem:function(c){var a,b=1,f=false,d=false,e;if(!c){return false}c=ta.id(c);a=c.className;if(!a){return false}e=a.match(/date_(\d+)/);if(e&&e[1]){b=e[1]}e=a.match(/month_(\d+)/);if(e&&e[1]){f=e[1]}e=a.match(/year_(\d+)/);if(e&&e[1]){d=e[1]}if(f===false||d===false){return false}return ta.util.date.create(d,f,b)},setMaxLengthOfStayStyling:function(){var e=ta.has("ta.first.date.selected");var f=document.getElements(".month td");if(e){var a=ta.widgets.calendar.getPageInDate();var c=ta.widgets.calendar.getPageInDate();c.setDate(c.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS);if(f&&a){Array.each(f,function(h){var g=ta.widgets.calendar.getDateFromElem(h);if(g&&(g.getTime()<a.getTime()||c.getTime()<g.getTime())){h.addClass("disabled")}})}}else{if(f){var b=new Date(ta.util.date.normalize(new Date()));if(!ta.has("ta.calendar.lastDate")){ta.widgets.calendar.setFirstLastDates()}var d=ta.retrieve("ta.calendar.lastDate");Array.each(f,function(h){var g=ta.widgets.calendar.getDateFromElem(h);if(g&&(b.getTime()<=g.getTime()&&g.getTime()<=d.getTime())){h.removeClass("disabled")}})}}},setInDateInputSelectState:function(b,d){var c=document.getElements(".metaContentSection .date_picker_calendar_wrap");var a=ta.widgets.calendar.getSelArrowElem();if(c){Array.each(c,function(e){if(!d){if(e.getParent()&&e.getParent().hasClass("first")){if(b){e.removeClass("selectionStyle")}else{e.addClass("selectionStyle");e.getParent().adopt(a)}}else{if(b){e.addClass("selectionStyle");if(e.getParent()){e.getParent().adopt(a)}}else{e.removeClass("selectionStyle")}}}else{e.removeClass("selectionStyle");a.dispose()}})}},getSelArrowElem:function(){var a=document.getElement(".selectionUpArrow");if(!a){if(document.getElement(".inline_calendar")){a=new Element("div",{"class":"sprite-date_picker-pointer-orange-ac selectionUpArrow"})}else{a=new Element("div",{"class":"sprite-date_picker-pointer selectionUpArrow"})}}return a},showInlineCalendar:function(f,d){var h=document.getElement(".inline_calendar");if(h){if(f){var c=h.hasClass("hidden");h.removeClass("hidden");var b=document.getElement("#HR_HACKATHON_CONTENT .postShowMetaCR");if(b){b.dispose()}if(d){if(!ta.has("date.picker.pageInDate")){d=false}}ta.widgets.calendar.setFirstDateSelected(!!d);if(c){ta.widgets.calendar.trackCalendarEvent(ta.widgets.calendar.getTrackingString(),"OPEN","DATES")}}else{h.addClass("hidden");ta.widgets.calendar.setInDateInputSelectState(false,true);var g=document.getElement(".largeOpenCalCRButton");if(g){g.dispose()}var a=document.getElement(".open_calendar_legend");if(a){a.addClass("miniMetaHideHdr").removeClass("miniMetaShowHdr")}var e=document.getElement(".open_calendar_highlight_bg");if(e){e.removeClass("open_calendar_highlight_bg")}}}},dayOver:function(f,e,a,c,b){if(typeof(isIPad)!="undefined"&&isIPad){ta.widgets.calendar.dayClick(f,e,a,c,b);return}ta.widgets.calendar.updateSelectedDays(f,ta.util.date.create(e,a,c),b)},updateSelectedDays:function(p,l,m){var n,f="prevSel",j="start",b="end",h=false,e,k,c,o,g,a,i;if(!ta.has("ta.first.date.selected")){return}if(!m){ta.widgets.calendar.removeHoverDateFlag();return}m=ta.id(m).getParent();n=l;ta.widgets.calendar.clearSelectedDays();e=ta.widgets.calendar.getPageInDate();k=ta.widgets.calendar.getPageOutDate();h=false;c=false;if(e){h=document.getElement(".month_"+e.getMonth()+".date_"+e.getDate());c=e}else{if(k){h=document.getElement(".month_"+k.getMonth()+".date_"+k.getDate());c=k}}a=h;i=m;if(!a){a=document.getElement(".month td");if(a){a.addClass(f)}}else{a.addClass(j).addClass(f)}if(n.getTime()<c.getTime()){ta.widgets.calendar.removeHoverDateFlag();return}if(!i){i=document.getElement(".month_"+n.getMonth()+".date_"+ta.util.date.getLastDayOfMonth(n));i.addClass(f)}else{i.addClass(b)}ta.widgets.calendar.updateSelectedDaysHelper(a,i,true,f);if(m.hasClass("disabled")){ta.widgets.calendar.removeHoverDateFlag()}else{o=ta.retrieve("calendar.singleNightText");g=ta.util.date.getDaysInRange(c,n)-1;if(1<g){o=ta.retrieve("calendar.multiNightsText");o=o.replace(/\d+/,g)}ta.widgets.calendar.addHoverDateFlag(n,m,o)}},updateSelectedDaysHelper:function(e,j,g,h){if(!e||e==j){return}var f="nextSibling";var k="firstChild";if(!g){f="previousSibling";k="lastChild"}var d=false;if(ta.widgets.calendar.isValidDateElem(e.getNext())){d=e.getNext()}else{var a=ta.id(e.parentNode);if(a&&a.getNext()){d=a.getNext()[k]}else{if(a&&ta.id(a).getParent(".month")){var c=ta.id(a).getParent(".month");if(ta.util.i18n.isRtl()){f=(f=="previousSibling")?"nextSibling":"previousSibling"}var i=c.getNext();if(!i){return}var b=ta.id(i).getElements("td");if(!g){b.reverse()}b.some(function(l){if(ta.widgets.calendar.isValidDateElem(l)){d=l;return true}return false},this)}}}if(d){ta.id(d).addClass(h);ta.widgets.calendar.updateSelectedDaysHelper(d,j,g,h)}},isValidDateElem:function(b){if(!b||b.tagName!="TD"){return false}var a=b.className;if(a.match(/other/)||a.match(/disabled/)){return false}return true},clearSelectedDays:function(){var a=["prevSel","selected","start","end","inDate","inDate_DP7"];Array.each(a,function(c){var b=document.getElements(".inline_calendar .month td."+c);if(b){Array.each(b,function(d){d.removeClass(c)})}})},injectMonth:function(d,b,f){var c=b,a="top",e=b.getElement(".navCal");if(f&&e){c=e;a="after"}else{if(!f){a="bottom"}}d.inject(c,a);ta.widgets.calendar.setMaxLengthOfStayStyling();ta.widgets.calendar.removeFirstDateFlag();if(ta.has("ta.first.date.selected")){ta.widgets.calendar.addFirstDateFlag()}},setFirstLastDates:function(){var c=11;var b=new Date();b=new Date(ta.util.date.normalize(b));ta.store("ta.calendar.firstDate",b);var f=new Date(b.getTime());f.setDate(1);var a=f.getMonth();var e=a+c;f.setFullYear(f.getFullYear()+e/12);f.setMonth(e%12);f=new Date(ta.util.date.normalize(f));ta.store("ta.calendar.lastDate",f)},setClickMouseOverFunctions:function(){ta.store("ta.calendar.date.clickFunction","ta.widgets.calendar.dayClick");ta.store("ta.calendar.date.mouseOverFunction","ta.widgets.calendar.dayOver")},buildDayClass:function(a){var f="";var e=ta.widgets.calendar.getPageInDate();var c=ta.widgets.calendar.getPageOutDate();var b=new Date(ta.util.date.normalize(new Date()));if(!ta.has("ta.calendar.lastDate")){ta.widgets.calendar.setFirstLastDates()}var d=ta.retrieve("ta.calendar.lastDate");if(e&&e.getTime()==a.getTime()){f="inDate_DP7 start prevSel"}else{if(e&&c&&e.getTime()<a.getTime()&&c&&a.getTime()<c.getTime()){f="prevSel"}else{if(c&&c.getTime()==a.getTime()){f="inDate_DP7 end prevSel"}else{if(a.getTime()<b.getTime()||d.getTime()<a.getTime()){f="disabled"}}}}if(a.getTime()==b.getTime()){f="today "+f}return f},createMonth:function(l){var k={date:l},g,c="",o,m,b,p,a,e=-1,j,n,f,q,r,h;if(!ta.has("ta.calendar.firstDate")){ta.widgets.calendar.setFirstLastDates()}g=new Date(l.getTime());g.setDate(1);ta.util.date.normalize(g);o=l.getFullYear();m=l.getMonth();b;p=new Date(ta.util.date.normalize(new Date()));a=ta.retrieve("ta.calendar.lastDate");j=ta.widgets.calendar.getPageInDate();if(j&&g.getMonth()==j.getMonth()){e=j.getDate()}if(j){b=new Date(j.getTime());b.setDate(b.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS+1)}n=o;if(ta.retrieve("thai_buddhist_era_year")){n=n+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}c+='<table cellspacing="0" cellpadding="0" border="0"><thead><tr><th class="caption" colspan="7">';if(typeof DATE_FORMAT_MMM_YYYY!="undefined"){c+=DATE_FORMAT_MMM_YYYY.replace(/MMM/,jsGlobalMonths[m]).replace(/YYYY/,n)}c+="</th></tr><tr>";for(f=0;f<jsGlobalDaysShort.length;f++){c+="<th>";c+=jsGlobalDaysShort[f];c+="</th>"}c+="</tr></thead><tbody><tr>";q=new Date(g.getTime());q.setDate(1);r=1-q.getDay();q.setDate(r);for(f=1;f<=42;f++){if(q.getDay()===0){c+="</tr><tr>"}h=ta.widgets.calendar.buildDayClass(q)+" "+ta.widgets.calendar.buildCalendarFrameClass(f);c+='<td class="month_'+q.getMonth()+" date_"+q.getDate()+" year_"+q.getFullYear()+" "+h+'">';if(q.getTime()<p.getTime()||a.getTime()<q.getTime()){c+=q.getDate()}else{c+=ta.widgets.calendar.buildDayAnchorTag(q)}c+="</td>";q.setDate(q.getDate()+1)}c+="</tr></tbody></table>";k.elmt=new Element("div",{"class":"month month_"+k.date.getMonth()+" year_"+k.date.getFullYear()}).set("html",c);return k},buildCalendarFrameClass:function(b){var a="";if(b%7===1){a="leftCalFrame"}else{if(b%7===0){a="rightCalFrame"}}if(b<8){a=a+" topCalFrame"}else{if(35<b){a=a+" bottomCalFrame"}}return a},buildDayAnchorTag:function(a){var b="";if(ta.has("checkrates.add_holding_windows")){b+='<a href="javascript:void(0);" class="no_cpu" '}else{b+='<a href="javascript:void(0);"'}if(ta.has("ta.calendar.date.clickFunction")){b+=' onmouseover="';b+=ta.retrieve("ta.calendar.date.mouseOverFunction");b+="(event,";b+=a.getFullYear();b+=",";b+=a.getMonth();b+=",";b+=a.getDate();b+=',this);"'}if(ta.has("ta.calendar.date.clickFunction")){b+=' onclick="';b+=ta.retrieve("ta.calendar.date.clickFunction");b+="(event,";b+=a.getFullYear();b+=",";b+=a.getMonth();b+=",";b+=a.getDate();b+=',this)";'}b+=">";b+=a.getDate();b+="</a>";return b},addCustomDayStyleString:function(g,f,d,h,c){var i="";var a=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();var b="";if(a&&e){b=" inDate_DP7 prevSel";if(c.getTime()>a.getTime()&&c.getTime()<e.getTime()){i=i+" prevSel"}}if(a&&d.date.getMonth()==a.getMonth()&&h==a.getDate()){i=i+" start"+b}if(e&&d.date.getMonth()==e.getMonth()&&h==e.getDate()){i=i+" end"+b}return i},getDateArgsObject:function(){try{var b=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();var h=ta.widgets.calendar.getPageAdultsCount();if(!b||!e||!h){return null}var i=b.getDate();var k=b.getMonth()+1;var g=b.getFullYear();var c=e.getDate();var f=e.getMonth()+1;var a=e.getFullYear();var j={inDay:i,inMonth:k+" "+g,outDay:c,outMonth:f+" "+a,adults:h};return j}catch(d){ta.util.error.record(d,"Unable to create calendar date args object");return null}},loadDateEnteredMonikers:function(){ta.common.ads.loadMonikers.delay(2000)},getTrackingString:function(){return ta.retrieve("multiDP.trackString")||"DATEPICKER"},clickDatepickerThroughBackdrop:function(f,c,a){if(!f){return}f=new Event(f);var g=f.page.x;var d=f.page.y;var b=false;Array.from([c,a]).each(function(i){if(!b){var j=i.getPosition();var h=i.getSize();if(g>=j.x&&g<=(j.x+h.x)&&d>=j.y&&d<=(j.y+h.y)){b=true;var e=new MouseEvent("click",{view:window,bubbles:true,cancelable:true});i.dispatchEvent(e);f.stopPropagation()}}})},datesExplicitlySetByUser:function(){return ta.has("date.picker.pageInDate")&&ta.has("date.picker.pageOutDate")},updateAllGuestsRoomsButtons:function(){var a=ta.widgets.calendar.getGuestsRoomsPickerData();ta.select(".roomsButton .grp-rooms-value").each(function(b){b.set("html",a.rooms)});ta.select(".guestsButton .grp-guests-value").each(function(b){b.set("html",a.guests)});ta.widgets.calendar.syncAllDatePickers()}};ta.widgets.ArrowLabel=new Class({Implements:Options,Binds:["shiftLeft","shiftRight"],options:{charWidth:7,sidePadding:0,labelArrowBaseClass:"calendarDateStyling",arrowElemClass:"defaultArrowElemStyling",textElemClass:"arrowTextElemStyling",arrowSpriteClass:"sprite-date_picker-grayDownArrow",arrowIconClass:"arrowIconStyling",arrowIconWidth:16},initialize:function(f,d,i){this.setOptions(i);if(!f||!d){return false}this.labelText=d;this.parentElem=f;var a=d.length+1;var h=(a*this.options.charWidth);var b=0;if(this.parentElem.getCoordinates&&this.parentElem.getCoordinates().width){b=this.parentElem.getCoordinates().width;if(b%2==1){b=b+1}}var c=0;if(h){if(h%2==1){h=h+1}c=(-1)*((h/2)-(b/2))}var g="left";if(ta.util.i18n.isRtl()){g="right"}this.inlineRelElem=new Element("div",{"class":this.options.labelArrowBaseClass+" inlineRelElemStyling"});this.arrowElem=new Element("div",{"class":this.options.arrowElemClass,styles:{width:h,padding:"0 "+this.options.sidePadding+"px"}});this.arrowElem.setStyle(g,c);this.arrowTextElem=new Element("div",{html:this.labelText,"class":this.options.textElemClass});this.arrowIconElem=new Element("div",{"class":this.options.arrowSpriteClass+" "+this.options.arrowIconClass});var e=0;if(this.options.arrowIconWidth){e=(-1)*((this.options.arrowIconWidth/2)-(b/2))}else{if(b){e=b/2}}this.arrowIconElem.setStyle(g,e);this.arrowTextElem.inject(this.arrowElem);this.arrowElem.inject(this.inlineRelElem);this.arrowIconElem.inject(this.inlineRelElem);this.inlineRelElem.inject(f)},setParentElem:function(a){if(a&&this.inlineRelElem){this.parentElem=a;this.parentElem.adopt(this.inlineRelElem)}},setText:function(a){this.labelText=a;this.arrowTextElem.innerHTML=this.labelText},remove:function(){if(this.inlineRelElem){this.inlineRelElem.destroy()}}});ta.widgets.Calendar=new Class({Binds:["addCustomDayStyleString","getCreatorElement"],Implements:[Options,Events],options:{selectedDate:null,firstDate:null,lastDate:null,dualCalendar:true,invalidDates:null,useLinks:true,dayNames:false,formatter:null,offsetOther:0,choiceLink:null,prevAction:null,nextAction:null,monthHeadingFormat:"",monthspan:11,indicateTurnoverDays:false,monthChangeDuration:500,postContent:null,prevStyle:false,nextStyle:false,showRange:false,isFirstCal:null,creatorElem:null,includeTodayInRange:false,holidaysOnCalendar:false,stableTableHeight:false,treatInvalidAsOutOfRange:false,useInoutMonth:true},initialize:function(b){this.setOptions(b);if(!this.options.firstDate){var c=ta.retrieve("calendar.serverTime");if(ta.has("hac_timezone_awareness")&&ta.has("ta.hac.locationTimezoneOffset")){var e=ta.retrieve("ta.hac.locationTimezoneOffset");var a=c?new Date(c):new Date();var d=a.getTime();d+=(a.getTimezoneOffset()*60000);var f=d+e;this.options.firstDate=new Date(f)}else{this.options.firstDate=c?new Date(c):new Date()}}if(!this.options.lastDate){this.setLastDate(this.options.monthspan)}this.today=new Date();this.selectedDate=this.options.selectedDate;if(b.oneWayFlight){this.options.choiceLink="ta.widgets.calendar.calendarSingleSelect"}if(b.multiCityFlight){this.options.choiceLink="ta.widgets.calendar.calendarMCSelect"}ta.util.date.normalize(this.today);if(this.options.firstDate){ta.util.date.normalize(this.options.firstDate)}if(this.options.lastDate){ta.util.date.normalize(this.options.lastDate)}if(this.selectedDate){ta.util.date.normalize(this.selectedDate)}this.container=new Element("div",{"class":"calendar"});this.addPrevNext();if(this.options.postContent){if(typeof(this.options.postContent)==="function"){this.options.postContent=this.options.postContent()}this.container.adopt(this.options.postContent)}if(this.options.wrapper){if(typeof(this.options.wrapper)==="function"){this.options.wrapper=this.options.wrapper()}this.options.wrapper.getElement(".wrapper_inner").adopt(this.container);this.container=this.options.wrapper}if(this.options.monthHeadingFormat==""&&DATE_FORMAT_MMM_YYYY){this.options.monthHeadingFormat=DATE_FORMAT_MMM_YYYY}},setLastDate:function(b){if(b==null||b<1){b=11}var e=new Date();e.setDate(1);var a=e.getMonth();var c=a+b;e.setFullYear(e.getFullYear()+c/12);e.setMonth(c%12);this.options.lastDate=e},getFirstDate:function(){return this.selectedDate||(this.theOtherCal&&this.theOtherCal.selectedDate)||this.today},update:function(){if(this.currentMonth){this.removeTable(null,this.currentMonth)}if(this.nextMonth){this.removeTable(null,this.nextMonth)}var c=this.getFirstDate();if(this.options.useInoutMonth){if(ta.widgets.calendar.getPageInDate()){c=new Date(ta.widgets.calendar.getPageInDate());if(ta.has("datepicker_autoadvance_fday")){c=ta.retrieve("datepicker_autoadvance_fday")}}if(ta.widgets.calendar.getPageOutDate()&&(!ta.widgets.calendar.getPageInDate()||(this.options.flights&&!this.isIn))){c=new Date(ta.widgets.calendar.getPageOutDate());c.setDate(0)}}if(this.options.firstDate&&c<this.options.firstDate){c=this.options.firstDate}if(this.options.dualCalendar){var f=new Date(c);f.setDate(ta.util.date.DAYS_IN_MONTH[f.getMonth()]);ta.util.date.normalize(f);if(f>=this.options.lastDate){c=new Date(c);if(c.getMonth()==0){c.setFullYear(c.getFullYear()-1,11,1)}else{c.setMonth(c.getMonth()-1,1)}}}this.currentMonth=this.createMonth(c);this.injectMonth(this.currentMonth.elmt,true);if(this.options.dualCalendar){var e=new Date(this.currentMonth.date);var a=e.getDate();var b=e.getMonth()+1;if(a>ta.util.date.DAYS_IN_MONTH[b]){a=ta.util.date.DAYS_IN_MONTH[b]}e.setMonth(b,a);this.nextMonth=this.createMonth(e);this.injectMonth(this.nextMonth.elmt,false)}this.updatePrevNext();return this},injectMonth:function(c,d){if(ta.util.i18n.isRtl()){d=!d}var b=this.container,a="top";if(!d&&ta.id(this.container).getElement(".wrapper_inner .calendar")){b=ta.id(this.container).getElement(".wrapper_inner .calendar")}if(d&&this.nav){b=this.nav;a="after"}else{if(!d){if(this.options.postContent){b=this.options.postContent;a="before"}else{a="bottom"}}}c.inject(b,a)},reposition:function(){this.currentMonth.elmt.setStyle("left","0px");if(this.options.dualCalendar){if(!ta.util.i18n.isRtl()){this.nextMonth.elmt.setStyle("left",this.currentMonth.elmt.getCoordinates().width+this.options.offsetOther+"px")}else{this.nextMonth.elmt.setStyle("left","0px");this.currentMonth.elmt.setStyle("left",this.nextMonth.elmt.getCoordinates().width+this.options.offsetOther+"px")}}return this},updatePrevNext:function(){var b=this.currentMonth.date;var a=this.options.dualCalendar?this.nextMonth.date:this.currentMonth.date;var d=ta.util.date.inSameMonth(b,this.options.firstDate);var c=ta.util.date.inSameMonth(a,this.options.lastDate);getChildByClass(this.container,"prev").style.display=(d?"none":"block");getChildByClass(this.container,"next").style.display=(c?"none":"block")},createPagingElement:function(a,b,c){return'<span class="'+a+'"><a style="display: block;" onclick="'+b+'(event, this);">'+c+"</a></span>"},addPrevNext:function(){if(!(this.options.prevAction&&this.options.nextAction)){return}var a=[],b=this.nav=new Element("div",{"class":"navCal"}).inject(this.container);a.push(this.createPagingElement("prev"+(this.options.prevStyle?" "+this.options.prevStyle:""),this.options.prevAction,"Previous Month"));a.push(this.createPagingElement("next"+(this.options.nextStyle?" "+this.options.nextStyle:""),this.options.nextAction,"Next Month"));b.set("html",a.join(""))},getHolidays:function(f,c,d,b){var e;if(f){var a=c+"-"+(d+1)+"-"+b;e=f[a]}return e},createMonth:function(D){var F={date:D};var o=new Date(D);o.setDate(1);ta.util.date.normalize(o);var q=(o.getDay()-jsGlobalDayOffset+7)%7;var B=new Date(D);B.setDate(0);this.prevDayValid=(this.isInvalidDate(B)?0:1);if(B<this.options.firstDate||B>this.options.lastDate){this.prevDayValid=-1}var t=2;if(this.options.multiCityFlight&&this.crId>t){this.options.firstDate=ta.widgets.calendar.lastDateBefore(this.options,this.crId)}var c=[];var s=D.getFullYear();var v=D.getMonth();var h=new Date();var w;var C=ta.util.date.inSameMonth(h,D)?h.getDate():-1;var p=-1;if(this.selectedDate&&this.selectedDate.getMonth()==v&&this.selectedDate.getFullYear()==s){p=this.selectedDate.getDate()}var E;if(this.options.showRange&&this.theOtherCal&&this.theOtherCal.selectedDate){E=this.theOtherCal.selectedDate;ta.util.date.normalize(E)}if(this.options.singleSelect){if(this.options.pickerOption=="out"&&ta.widgets.calendar.getPageInDate()){if(!this.options.flights){w=new Date(ta.widgets.calendar.getPageInDate());w.setDate(w.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS)}else{w=new Date();ta.util.date.normalize(w);w.setDate(w.getDate()+ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT)}}}var u=s;if(ta.retrieve("thai_buddhist_era_year")){u=u+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}c.push('<table cellspacing="0" cellpadding="0" border="0"><thead><tr><th class="caption" colspan="7">');c.push(this.options.monthHeadingFormat.replace(/MMM/,jsGlobalMonths[v]).replace(/YYYY/,u));c.push("</th></tr><tr>");for(var z=0;z<jsGlobalDaysShort.length;z++){c.push("<th>");c.push(this.options.dayNames?jsGlobalDaysAbbrev[z]:jsGlobalDaysShort[z]);c.push("</th>")}c.push("</tr></thead><tbody><tr>");var g=0;for(var z=0;z<q;z++){c.push('<td class="other">&nbsp;</td>');g++}q--;var y=0;var b=ta.util.date.DAYS_IN_MONTH[F.date.getMonth()];if(F.date.getMonth()==1&&F.date.getYear()%4==0){b+=1}var k=b;while(y<b){q=(q+1)%7;y++;o.setDate(y);var A=y;var e=null;var r=this.getHolidays(this.options.holidaysOnCalendar,s,v,y);if(this.options.includeTodayInRange){var a=!(o<=this.options.firstDate||o>this.options.lastDate||(w&&o>w))}else{var a=!(o<this.options.firstDate||o>this.options.lastDate||(w&&o>w))}var x=!this.isInvalidDate(o);var n=this.options.choiceLink;var m=!((this.selectedDate&&this.selectedDate.getTime()<o.getTime())||(E&&E.getTime()<o.getTime()));if(this.options.formatter){this.options.selectedDay=p;this.options.otherDate=E;var f=this.options.formatter.call(this,o,a,x,q,this.options);e=f.cname;A=f.contents;n=f.link||n}else{if(!x){e="invalid"}else{if(y==C){if(y==p||(E&&o.getTime()===E.getTime())){e="today selected "+(m?"start":"end");m=!m;if(this.selectedDate&&E){e+=" rngDt"}}else{if(!a){e="today disabled"}else{e="today"}}}else{if(y==p||(E&&o.getTime()===E.getTime())){e="selected "+(m?"start":"end");m=!m;if(this.selectedDate&&E){e+=" rngDt"}}else{if(this.selectedDate&&E&&((this.selectedDate.getTime()<o.getTime()&&o.getTime()<E.getTime())||(this.selectedDate.getTime()>o.getTime()&&o.getTime()>E.getTime()))){e="rngDt"}}}}}if(this.options.indicateTurnoverDays){if(x){if(this.prevDayValid==0){if(e){e+=" depart"}else{e="depart"}}this.prevDayValid=1}else{if(this.prevDayValid==1){if(e){e+=" arrive"}else{e="arrive"}}this.prevDayValid=0}if(!a){this.prevDayValid=-1}}if(q==0){c.push("</tr><tr>")}if(!a||(this.options.treatInvalidAsOutOfRange&&!x)){c.push('<td class="');c.push(e||"disabled");c.push('">');if(r){c.push(r)}else{c.push(A||y)}c.push("</td>")}else{if(this.options.singleSelect){var j=this.date;if(j&&j.getDate()==y&&j.getMonth()==v){e=e+" selected"}}var l=this.addCustomDayStyleString(n,s,F,y,o,A);if(l){e+=l}if(e){c.push('<td class="');c.push(e);c.push('">')}else{c.push("<td>")}c.push(this.buildDayAnchorTag(n,s,v,y,A,o));c.push("</td>")}}while(++q<7){c.push("<td class='other'>&nbsp;</td>");g++}if(this.options.stableTableHeight){while((b+g)<42){c.push("</tr><tr>");var z=0;for(z=0;z<7;z++){c.push("<td class='other'>&nbsp;</td>");g++}}}c.push("</tr></tbody></table>");F.elmt=new Element("div",{"class":"month"}).set("html",c.join(""));return F},addCustomDayStyleString:function(d,b,f,a,e,c){},buildDayAnchorTag:function(f,c,e,b,d,g){var a=[];if(this.options.useLinks&&f){if(ta.has("checkrates.add_holding_windows")){a.push('<a href="javascript:void(0);" class="no_cpu" ondragstart="return false;" onclick="')}else{a.push('<a href="javascript:void(0);" ondragstart="return false;" onclick="')}a.push(f);a.push("(event,");a.push(c);a.push(",");a.push(e);a.push(",");a.push(b);a.push(',this)"');if(this.options.dayMouseOver){a.push(' onmouseover="');a.push(this.options.dayMouseOver);a.push("(event,");a.push(c);a.push(",");a.push(e);a.push(",");a.push(b);a.push(',this)"')}if(this.options.dayMouseOut){a.push(' onmouseout="');a.push(this.options.dayMouseOut);a.push("(event,");a.push('this)"')}a.push(">");a.push(d);a.push("</a>")}else{a.push(d)}return a.join("")},isInvalidDate:function(a){return ta.util.date.inDateSet(a,this.options.invalidDates)},isValid:function(){if(!this.selectedDate){return true}return this.selectedDate.getTime()>=this.options.firstDate.getTime()&&this.selectedDate.getTime()<=this.options.lastDate.getTime()},prev:function(){if(this.animating){return}var k=this.options.dualCalendar;this.animating=true;var h=new Date(this.currentMonth.date);var g=h.getMonth()-1;if(g<0){g=g+12;h.setFullYear(h.getFullYear()-1)}var i=h.getDate();if(i>ta.util.date.DAYS_IN_MONTH[g]){i=ta.util.date.DAYS_IN_MONTH[g]}h.setMonth(g,i);var j=this.currentMonth.elmt.getCoordinates().width;var f=j+(k?this.nextMonth.elmt.getCoordinates().width:0);var b=this.createMonth(h);if(!ta.util.i18n.isRtl()){b.elmt.style.left="-"+j+"px"}else{b.elmt.style.left=f+"px"}this.injectMonth(b.elmt,true);var e=this.container.getElements("div.month");var a;if(!ta.util.i18n.isRtl()){a={"0":{left:[-j,0]},"1":{left:[0,j+this.options.offsetOther]}};if(k){a["2"]={left:[j+this.options.offsetOther,j*2+this.options.offsetOther]}}}else{a={"0":{left:[0,-j]},"1":{left:[j+this.options.offsetOther,0]}};if(k){a["2"]={left:[j*2+this.options.offsetOther,j+this.options.offsetOther]}}}var c=new Fx.Elements(e,{onComplete:this.doneAnimating.bind(this).partial(Function._,this.nextMonth||this.currentMonth),duration:this.options.monthChangeDuration});if(k){this.nextMonth=this.currentMonth}this.currentMonth=b;this.updatePrevNext();c.start(a)},next:function(){if(this.animating){return}var k=this.options.dualCalendar;this.animating=true;var h=new Date(this.currentMonth.date);var g=h.getMonth()+(k?2:1);if(g>11){g=g-12;h.setFullYear(h.getFullYear()+1)}var i=h.getDate();if(i>ta.util.date.DAYS_IN_MONTH[g]){i=ta.util.date.DAYS_IN_MONTH[g]}h.setMonth(g,i);var j=this.currentMonth.elmt.getCoordinates().width;var f=j+(k?this.nextMonth.elmt.getCoordinates().width:0);var b=this.createMonth(h);if(!ta.util.i18n.isRtl()){b.elmt.style.left=f+"px"}else{b.elmt.style.left="-"+j+"px"}this.injectMonth(b.elmt,false);var e=this.container.getElements("div.month");var a;if(!ta.util.i18n.isRtl()){a={"0":{left:[0,-j]},"1":{left:[j+this.options.offsetOther,0]}};if(k){a["2"]={left:[j*2+this.options.offsetOther,j+this.options.offsetOther]}}}else{a={"0":{left:[-j,0]},"1":{left:[0,j+this.options.offsetOther]}};if(k){a["2"]={left:[j+this.options.offsetOther,j*2+this.options.offsetOther]}}}var c=new Fx.Elements(e,{onComplete:this.doneAnimating.bind(this).partial(Function._,this.currentMonth),duration:this.options.monthChangeDuration});if(k){this.currentMonth=this.nextMonth;this.nextMonth=b}else{this.currentMonth=b}this.updatePrevNext();c.start(a)},removeTable:function(b,a){a.elmt.dispose()},doneAnimating:function(b,a){this.removeTable(b,a);this.animating=false},select:function(a,b){this.selectedDate=b;this.fireEvent("onSelect",[this,a])},clear:function(a){this.selectedDate=null;this.fireEvent("onClear",[this,a])},nearbyMonth:function(b,a){var c=b+a;if(c>11){c-=12}else{if(c<0){c+=12}}return c},getCreatorElement:function(){return this.options.creatorElem}});(function(){ta.widgets.SingleDateCalendar=new Class({Extends:ta.widgets.Calendar,Implements:[Options,Events],Binds:["onOutDateCalShow","updateInputStyling","updateDualDateInputStyling","showCalendarOverlay","setPositionElement","hashHack","getCalendarTopOffset","getCalendarLeftOffset","callOnSelect","setPageDates","getPageInDate","getPageOutDate"],options:{singleSelect:true,pickerOption:"in",autoAdvance:true,dualCalendar:true,dayMouseOver:"ta.widgets.calendar.calendarMouseOver",choiceLink:"ta.widgets.calendar.calendarMultiSelect",prevAction:"ta.widgets.calendar.calendarPrev",nextAction:"ta.widgets.calendar.calendarNext",selectedHoverClass:"rngDt",previousSelectedClass:"prevSel",inDateClass:"inDate",outDateClass:"outDate",selectionStartClass:false,selectionEndClass:false,captureKeyEvents:true,autoShow:false,displayCalendarInOverlay:true,formatter:ta.widgets.calendar.multiDateFormatter,monthChangeDuration:150,submitOnEnter:true,useClassicSkin:false,classicStyling:false},inDate:false,newInDate:false,oldInDate:false,startRangeElem:false,outDate:false,oneSelected:false,monthOffset:0,initialize:function(f,m,o,t,u){this.isIn=u;this.parent(f,this.input);this.crId=m;this.setPositionElement();if(typeof o==="function"){this.onSelect=o.bind(this)}this.argArray=t;if(this.options.displayCalendarInOverlay){var d=this.onCalendarOverlayShow.bind(this);var a=this.onCalendarOverlayHide.bind(this);var k=this.onCalendarOverlayShow.bind(this);var h=this.positionElement.getParent(".overlay");if(h){this.parentOverlay=h.overlay}var y=ta.overlays.ACTIVATE_CLICK;var l=this.options.offsetLeft?this.options.offsetLeft:this.getCalendarLeftOffset();var s=this.options.offsetTop?this.options.offsetTop:this.getCalendarTopOffset();var w="date_picker_calendar";if(this.options.useClassicSkin){w="typeO"}if(this.options.classicStyling){w=w+" classicStyling"}if(this.options.oneWayStyling){w=w+" oneWayStyling"}if(!this.options.dualCalendar){w=w+" singleWidth"}if(!ta.widgets.calendar.hasPageDates()){w=w+" predates"}var q=ta.retrieve("tablet_calendar_update.enabled")?ta.overlays.BACKDROP_ALWAYS:ta.overlays.BACKDROP_NEVER;var c=ta.retrieve("tablet_calendar_update_v2.enabled")?0.01:0.6;var x=null;if(ta.retrieve("tablet_calendar_update_v2.enabled")){var e=ta.id("date_picker_in_"+this.crId+this.options.ext);var g=ta.id("date_picker_out_"+this.crId+this.options.ext);x=function(z){ta.widgets.calendar.clickDatepickerThroughBackdrop(z,e,g)}}var r=ta.overlays.RelativeOverlayBelow;var v={style:w,noPadding:true,autoShow:false,noCpu:true,backdrop:q,backdropOpacity:c,onBackdropClick:x,offsetLeft:l,offsetTop:s,activate:y,onShow:d,onHide:a,onFocus:k,zIndex:1001,showCloseButton:false,parentContainer:this.options.parentContainer,fontSize:this.options.fontSize};if(ta.has("hr_meta_focus_with_dates")||ta.has("sd_datepicker_focus")||ta.has("hotels_meta_focus")){v.zIndex=10001}if(f&&f.isGuestsRoomsCalendar){v.useTransparentOverlayPadding=true;v.transparentOverlayPaddingValue=80}if(ta.isTabletAlbumViewer()||ta.retrieve("tablet_maps_v1")){var j=document.getElement(".footerPocketWithInsert");if(j&&j.isVisible()){if(this.positionElement&&this.positionElement.getParent(".footerPocketWithInsert")){v.parentContainer=j}else{v.positionType="fixed"}var p=v.onShow;v.onShow=function(z){if(p){p(z)}window.addEvent("orientationchange",this.hide)};var n=v.onHide;v.onHide=function(z){if(n){n(z)}window.removeEvent("orientationchange",this.hide)}}}this.calendarOverlay=new r(v,this.positionElement);var b=ta.id(this.positionElement).getParent();if(b&&b.hasClass("date_picker_calendar_wrap")){b.onclick=function(){};ta.id(this.positionElement).removeEvents("click");ta.id(this.positionElement).getParent().addEvent("click",this.showCalendarOverlay.bind(this))}if(b&&!window.tabletOnFullSite){b.addEvent("focus",this.showCalendarOverlay.bind(this))}if(this.outDateField){ta.id(this.outDateField).getParent().onclick=function(){};ta.id(this.outDateField).getParent().addEvent("click",this.onOutDateCalShow.bind(this));if(!window.tabletOnFullSite){ta.id(this.outDateField).getParent().addEvent("focus",this.onOutDateCalShow.bind(this))}}this.calendarOverlay.inner.adopt(this.container);this.calendarOverlay.calendar=this;if(this.positionElement&&(this.positionElement.hasClass("isPreDatesPermanent")||this.positionElement.getParent(".isPreDatesPermanent"))){this.calendarOverlay.options.permanent=true;this.calendarOverlay.options.pinnable=ta.overlays.PINNABLE_ALWAYS}this.calendarOverlay.container.addEvent("click",function(z){if(z||window.event){z=new Event(z||window.event);z.stopPropagation()}});this.update();this.reposition()}var i=this.onDocumentClick.bind(this);document.addEvent("click",i)},addCustomDayStyleString:function(k,j,h,l,g,c){var m="";var b=this.getPageInDate();var i=this.getPageOutDate();var f="";if(b&&i){f=" prevSel inDate_DP7";if(g.getTime()>b.getTime()&&g.getTime()<i.getTime()){m=m+" prevSel"}}if(b&&h.date.getMonth()==b.getMonth()&&l==b.getDate()){m=m+" inDate start"+f}if(i&&h.date.getMonth()==i.getMonth()&&l==i.getDate()){m=m+" inDate end"+f}if(ta.retrieve("cal_xsell")&&(this.today.getMonth()==g.getMonth()||((this.today.getMonth()+1)%12)==g.getMonth())){var e=ta.util.date.getDaysInRange(this.today,g)-1;if(!this.isIn){e-=1}var a=ta.retrieve("cal_xsell");if(e>=0&&e<a.availability.length){var d=a.availability[e];if(!d){m+=" calXSellUnAvail"}}}return m},buildDayAnchorTag:function(g,d,f,b,e,h){var a=[];var c=this.getHolidays(this.options.holidaysOnCalendar,d,f,b);if(this.options.useLinks&&g){if(ta.has("checkrates.add_holding_windows")){a.push('<div href="javascript:void(0);" class="day no_cpu')}else{a.push('<div href="javascript:void(0);" class="day')}if(c){a.push(" hld")}a.push(" day_"+b);a.push('" onclick="');a.push(g);a.push("(event,");a.push(d);a.push(",");a.push(f);a.push(",");a.push(b);a.push(',this)"');if(window.FastClick){a.push(' ontouchend="');a.push(g);a.push("(event,");a.push(d);a.push(",");a.push(f);a.push(",");a.push(b);a.push(',this)"')}if(this.options.dayMouseOver){a.push(' onmouseover="');a.push(this.options.dayMouseOver);a.push("(event,");a.push(d);a.push(",");a.push(f);a.push(",");a.push(b);a.push(',this)"')}a.push(' value="');a.push(h.valueOf());a.push('"');a.push(">");if(c){a.push(c)}else{a.push(e)}a.push("</div>")}else{a.push(e)}return a.join("")},callOnSelect:function(){if(this.onSelect){this.fireEvent("onChangeDates");if(this.argArray&&this.argArray.length>0){this.onSelect.apply(this,this.argArray)}else{this.onSelect.call(this,this.crId,this.positionElement);if(ta.has("guests_rooms_picker_3.enabled")){ta.store("calendarClosedByDocClick",false)}}}},clear:function(b){this.date=null;ta.widgets.calendar.clearPageDates();if(this.positionElement&&!(this.positionElement.hasClass("tab0")&&this.positionElement.hasClass("header_tab"))){var a="";if(this.isIn){if(this.options.classicDateFormat&&typeof JS_DateFormat!="undefined"){a=JS_DateFormat}else{a=ta.retrieve("multiDP.checkIn")}}else{if(this.options.classicDateFormat&&typeof JS_DateFormat!="undefined"){a=JS_DateFormat}else{a=ta.retrieve("multiDP.checkOut")}}this.positionElement.innerHTML=a}this.fireEvent("onClear",[this,b]);if(this.calendarOverlay){this.calendarOverlay.hide()}},clearPrevSelectedDays:function(){if(!this.calendarTop){this.calendarTop=this.calendarOverlay.container.getElement(".calendar")}var a=this.calendarTop.getElements("td."+this.options.previousSelectedClass);a.removeClass(this.options.previousSelectedClass);this.options.selectionStartClass&&a.removeClass(this.options.selectionStartClass);this.options.selectionEndClass&&a.removeClass(this.options.selectionEndClass)},clearSelectedDays:function(){if(!this.calendarTop){this.calendarTop=this.calendarOverlay.container.getElement(".calendar")}var a=this.calendarTop.getElements("td."+this.options.selectedHoverClass);a.removeClass(this.options.selectedHoverClass);this.options.selectionStartClass&&a.removeClass(this.options.selectionStartClass);this.options.selectionEndClass&&a.removeClass(this.options.selectionEndClass)},createPagingElement:function(a,b,c){return'<span class="'+a+'" onclick="'+b+'(event, this);"></span>'},dayOver:function(b,c,a){ta.util.date.normalize(c);if(!this.oneSelected){this.updateHoverElem(a);return}this.hoverDay=c;this.updateSelectedDays(c,a)},ensureValidDates:function(){var c=this.getPageInDate();var b=this.getPageOutDate();if(this.options.firstDate&&c){if(c<this.options.firstDate){ta.util.date.normalize(this.options.firstDate);c=this.options.firstDate;ta.widgets.calendar.setPageInDate(c);this.bypassSecondCal=true;var a=ta.widgets.calendar.getDateAfter(c);if(b&&b<a){b=a;ta.widgets.calendar.setPageOutDate(b)}}}if(b&&!c){c=ta.widgets.calendar.getDateBefore(b)}if(c&&!b){b=ta.widgets.calendar.getDateAfter(c)}ta.widgets.calendar.setPageInDate(c);ta.widgets.calendar.setPageOutDate(b)},focusOtherCalendar:function(){var a;if(this.isIn){a=ta.widgets.calendar.getPageOutCalendarField(this.crId,this.options.ext)}else{a=ta.widgets.calendar.getPageInCalendarField(this.crId,this.options.ext)}var b=document.getElement("#PERSISTENT_DATE_PICKER:not(.hidden)")||document;if(a===null&&ta.has("guests_rooms_picker_3.enabled")){if(this.isIn){a=b.getElement(".stayInfoHeaderDateTrigger.outDateTrigger")}else{a=b.getElement(".stayInfoHeader.inDateTrigger")}}if(a){if(a.click){ta.store("overlay.dontCloseOnClick",true);a.click();ta.store("overlay.dontCloseOnClick",false)}else{if(document.createEvent&&a.dispatchEvent){var c=document.createEvent("MouseEvent");c.initEvent("click",true,true);a.dispatchEvent(c)}}}},getCalendarLeftOffset:function(){var a=1;if(ta.util.i18n.isRtl()){a=127}if(ta.isMetaHomepageIntegration2013()){a=2;if(ta.util.i18n.isRtl()){a=121}}if(ta.retrieve("ta.calendar.isOutDateTrigger")&&ta.retrieve("ta.calendar.isPriceOverlayCalendar")){a=138}if(ta.has("hotels_left_filters_redesign")){return 0}return a},getCalendarTopOffset:function(){if(ta.has("hotels_left_filters_redesign")){return -7}if(ta.isMetaHomepageIntegration2013()){return -1}return -4},getFirstDate:function(){var b=this.getPageInDate();var a=this.getPageOutDate();if(this.options.multiCityFlight&&this.crId>1){return ta.widgets.calendar.lastDateBefore(this.options,this.crId)}if(this.isSecondCalShown()){if(!this.isIn&&b){return b}else{if(this.isIn&&a){return a}}}else{if((this.isIn)&&b){return b}else{if(!this.isIn&&a){return a}}}return this.today},getPageInDate:function(){return ta.widgets.calendar.getPageInDate()},getPageOutDate:function(){return ta.widgets.calendar.getPageOutDate()},getState:function(){var c=this.inDate,b=this.outDate,a={};if(c instanceof Date){Object.append(a,{inMonth:(c.getMonth()+1)+" "+c.getFullYear(),inDay:c.getDate()})}if(b instanceof Date){Object.append(a,{outMonth:(b.getMonth()+1)+" "+b.getFullYear(),outDay:b.getDate()})}return a},hashHack:function(){var a=ta.id(this.positionElement).get("id");if(a){a=a.substring(a.length-3,a.length);if(a=="olb"||a=="bin"||a=="som"){window.location.hash=" ";window.location.hash="#MetaPricesTab"}}},includeElemInRange:function(b,a){b.className=b.className+" "+a},isSecondCalShown:function(){if(!this.options.autoAdvance){return true}var a=ta.widgets.calendar.inOutCalendarSelected(!this.isIn);return a},isValidDateElem:function(b){if(!b||b.tagName!="TD"){return false}var a=b.className;if(a.match(/other/)||a.match(/disabled/)){return false}return true},initTracking:function(){if(!ta.remove("meta.datepicker_tracked")){var c=ta.id(this.positionElement).get("id")||this.options.ext||"_owl";var d=c.indexOf("_persist")>0;c=c.substring(c.length-3,c.length);var b=this.isIn?"CheckIn|":"CheckOut|";if(d){b+="Persistent|"}if(ta.retrieve("cal_xsell")){b+="CalXSell|"}switch(c){case"pto":b+="PHOTOS_LIGHTBOX";break;case"amo":b+="AMENITIES_LIGHTBOX";break;case"pop":b+="DHTML_FLYOUT";break;case"cro":b+="CalendarLightbox";break;case"inm":b+="DATES_INLINE|Tabs";ta.store("isPricesTabDatePicker",true);break;case"bin":b+="DATES_INLINE_FLEXIBLE";break;case"met":b+="DATES_LIGHTBOX";break;case"olb":b+="DATES_LIGHTBOX_FLEXIBLE";break;case"som":b+="DATES_State-Optimized-Modal_FLEXIBLE";break;case"cmp":b+="footer";break;case"hpt":b+="HOMEPAGE_PYPT";break;case"thc":b+="HAC_TOURISM";break;case"gnv":b+="GLOBAL_NAV";break;case"ond":b+="RoomTab";break;default:b+="DATES"}var a=this.getTrackingPrefix()+ta.widgets.calendar.getTrackingString();ta.widgets.calendar.trackCalendarEvent(a,"OPEN",b);ta.store("multiDP.trackString",false)}},singleDaySelect:function(g,i,f){if(g){new Event(g).stop()}ta.util.date.normalize(i);if(!i||!i.getTime){return}this.date=i;var c=new Date(i);c.increment("week",1);if(this.options.flights){var h=(new Date()).increment("day",ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);if(c>h){c=h}}this.setPageDates(i,c);var a=ta.widgets.calendar.getDatePickerFormat("classic");i=ta.widgets.calendar.dateToString(i,a);var b=ta.id(f).getParent(".overlay");b.overlay.calendar.options.creatorElem.innerHTML=i;if(this.calendarOverlay){this.calendarOverlay.hide()}},multiCitySelect:function(l,m,f){if(l){new Event(l).stop()}ta.util.date.normalize(m);if(!m||!m.getTime){return}var b=ta.widgets.calendar.getDatePickerFormat("classic");var o=ta.id(f).getParent(".overlay");var c=2;if(o.overlay.calendar.crId===c){var n=undefined;if(typeof NE!=="undefined"){n=new Date(m);n.increment("week",1);if(this.options.flights){var j=(new Date()).increment("day",ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);if(n>j){n=j}}}this.setPageDates(m,n)}if(typeof NE!=="undefined"){NE.checkMultiCityFields(o.overlay.calendar.crId,m)}else{var a=parseInt(o.overlay.calendar.crId);var g=4;for(var k=a;k<=g+1;k++){if(ta.id("date_picker_in_"+k)&&ta.id("date_picker_in_"+k).innerHTML.length>1){var h=ta.widgets.calendar.dateFromString(ta.id("date_picker_in_"+k).innerHTML);if(m>h){ta.id("date_picker_in_"+k).innerHTML=""}}}}m=ta.widgets.calendar.dateToString(m,b);o.overlay.calendar.options.creatorElem.innerHTML=m;o.setStyles({left:"-999em",top:"-999em"}).dispose();o.overlay.visible=false},multiSelect:function(g,h,b){if(g){new Event(g).stop()}ta.util.date.normalize(h);if(!h||!h.getTime){return}this.date=h;var a=null;var i=null;a=this.getPageInDate();i=this.getPageOutDate();var f=!a&&!i;var l=true;this.closedByDocOrDateClick=true;var k=false;if((!ta.widgets.calendar.getPageInDate()&&!ta.widgets.calendar.getPageOutDate())||(ta.retrieve("enteredDatesInPreDates")&&!ta.widgets.calendar.hasPageDates())){ta.store("enteredDatesInPreDates",true)}else{ta.store("enteredDatesInPreDates",false)}var j=!ta.has("hotels_left_filters_redesign")&&ta.has("guests_rooms_picker_3.enabled")&&this.isIn;if(j&&!f){ta.widgets.calendar.cancelAllExistingHAC();this.bypassSecondCal=false;if(this.isIn){a=h;if(i&&h.getTime()>=i.getTime()){i=false;k=true;ta.widgets.calendar.clearPageOutDate(this.crId,this.options.ext);ta.widgets.calendar.removeInOutCalendarSelected(false)}if(!i){if(h.getDate()<=23){ta.store("datepicker_autoadvance_fday",this.currentMonth.date)}else{ta.remove("datepicker_autoadvance_fday")}}}else{i=h;if(a&&h.getTime()<(new Date()).getTime()){a=new Date();i=ta.widgets.calendar.getDateAfter(a)}else{if(a&&h.getTime()<=a.getTime()){a=false;k=true;ta.widgets.calendar.clearPageInDate(this.crId,this.options.ext);ta.widgets.calendar.removeInOutCalendarSelected(true)}else{if(a){ta.widgets.calendar.trackInOutCalendarSelected(true);this.bypassSecondCal=true}}}}}else{if(this.isIn){var c=i&&(h.getTime()==i.getTime()&&!this.options.flights);if(i&&(h.getTime()>i.getTime()||c)){a=this.date;i=false;k=true;ta.widgets.calendar.clearPageOutDate(this.crId,this.options.ext)}else{a=h;if(i){this.bypassSecondCal=true}}}else{var c=a&&(h.getTime()==a.getTime()&&!this.options.flights);if(a&&h.getTime()<(new Date()).getTime()){a=new Date();i=ta.widgets.calendar.getDateAfter(a)}else{if(a&&(h.getTime()<a.getTime()||c)){i=this.date;a=false;k=true;ta.widgets.calendar.clearPageInDate(this.crId,this.options.ext)}else{i=h;if(a){this.bypassSecondCal=true}}}}}this.inDate=a;this.outDate=i;if(ta.has("guests_rooms_picker_3.enabled")){this.setPredatesState()}this.setPageDates(a,i);if(ta.has("guests_rooms_picker_3.enabled")&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.syncAllDatePickers();ta.commerce.meta.updateHeaderDates()}this.hoverDay=false;if(!this.bypassSecondCal&&((!this.getPageOutDate()||!this.getPageInDate())&&!k)){this.bypassSecondCal=true}this.updateNumNights();if(this.calendarOverlay){this.calendarOverlay.hide()}if(this.bypassSecondCal&&!f&&(!this.getPageInDate()||!this.getPageOutDate())){this.bypassSecondCal=false}ta.overlays.Factory.destroyAnimatedDateCTA();if(!this.isSecondCalShown()&&!this.bypassSecondCal||(f&&ta.retrieve("metaUI.isMetaCalendarAutoadvancePredates"))){ta.widgets.calendar.trackInOutCalendarSelected(this.isIn);this.focusOtherCalendar()}else{this.hashHack()}this.removeErrorState();if(this.getPageInDate()&&this.getPageOutDate()){this.fireEvent("onRangeSelect",[this.crId,this.options.ext])}this.fireEvent("onSelect",[this,g])},next:function(){this.parent();this.resetStartRangeElem(true);var a=(this.currentMonth&&this.currentMonth.date?this.currentMonth.date.get("month"):"");ta.trackEventOnPage("DATEPICKER","NEXT_MONTH",(this.isIn?"Checkin":"Checkout"),a)},onCalendarOverlayKeyDown:function(a){if(this.options.submitOnEnter&&"enter"===a.key&&ta.isMetaHomepageIntegration2013()){var c=this.positionElement.getParent("form "),b="function"!==typeof this.options.submitOnEnter||this.options.submitOnEnter(a,c);if(b){c&&c.submit()}else{this.calendarOverlay.hide()}}if(a.key=="esc"||(ta.isMetaHomepageIntegration2013()&&!ta.retrieve("freeform_datepicker")&&a.key=="tab")){this.calendarOverlay.hide()}},onCalendarOverlayHide:function(b){if(this.isSecondCalShown()||ta.widgets.calendar.hasPageDates()){this.ensureValidDates()}ta.widgets.calendar.syncAllDatePickers();if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}if(this.options.captureKeyEvents&&this.keyEventListener){document.removeEvent("keydown",this.keyEventListener)}this.updateInputStyling(false);var g=this.getPageInDate();var e=this.getPageOutDate();var d=g&&g.getDate&&e&&e.getDate;if(this.isSecondCalShown()&&d){this.bypassSecondCal=true}var a=false;if((this.shouldFireOnSelect()||this.bypassSecondCal||(this.closedByDoc&&ta.has("guests_rooms_picker_3.enabled")))&&d&&this.closedByDocOrDateClick){var c=false;if(this.closedByDoc&&ta.has("guests_rooms_picker_3.enabled")){ta.store("calendarClosedByDocClick",true);c=true}this.fireEvent("onChangeDates");if(c){this.fireEvent("onRangeSelect",[this.crId,this.options.ext])}this.callOnSelect();this.trackSelect(true);if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){a=true}if(ta.commerce.persistentdatepicker){ta.commerce.persistentdatepicker.update()}if(ta.has("price_finder")){var f=document.getElements(".roomGuestsInfoWrap");if(f){f.forEach(function(h){h.removeClass("hidden")})}}}else{if(!this.closedByDoc){this.trackSelect(false)}}if(this.resetFireOnSelectCriteria&&this.isSecondCalShown()&&this.closedByDocOrDateClick){this.resetFireOnSelectCriteria()}if(a){this.parentOverlay.hide()}if(ta.has("guests_rooms_picker_3.enabled")&&!ta.has("hotels_left_filters_redesign")&&d){ta.widgets.calendar.displayStayInfoPicker()}},onCalendarOverlayShow:function(){ta.widgets.calendar.storePriorDates();this.inDate=this.getPageInDate();this.outDate=this.getPageOutDate();this.cursorLeftInitSel=false;this.bypassSecondCal=false;this.date=this.isIn?this.getPageInDate():this.getPageOutDate();if(ta.has("guests_rooms_picker_3.enabled")){this.setPredatesState();ta.widgets.calendar.updateGuestsRoomsPickerUI()}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.update();this.reposition();this.closedByDocOrDateClick=false;this.closedByDoc=false;var a=ta.id(this.positionElement).getParent("#hotels_lf_header_bar_wrap");if(ta.id(this.positionElement).getParent("#PERSISTENT_DATE_PICKER, #STATIC_DATE_PICKER_BAR.sticky")){ta.commerce.persistentdatepicker&&ta.commerce.persistentdatepicker.initCalendar(this)}else{if(ta.id(this.positionElement).getParent("#PERSISTENT_CHECK_RATES")||(a&&a.hasClass("fixed"))){var b=ta.id(this.positionElement).getCoordinates().top+29;if(typeof(isIPad)=="undefined"||!isIPad){b=b-window.getScrollTop()}if(a){b=this.positionElement.getCoordinates().bottom+7-(window.isTabletOnFullSite?0:window.getScrollTop())}ta.id(this.calendarOverlay.container).setStyles({position:"fixed",top:b,zindex:9997})}else{ta.id(this.calendarOverlay.container).setStyle("position","absolute")}}if(ta.retrieve("tablet_calendar_update.enabled")&&this.container){if(ta.retrieve("tablet_calendar_update_v2.enabled")){var f=window.innerWidth/document.documentElement.clientWidth;var c=Math.max(Math.min(Math.floor(150*f),150),100);this.container.setStyle("zoom",c+"%")}else{this.container.setStyle("zoom","150%")}if(this.calendarOverlay&&this.calendarOverlay.position){this.calendarOverlay.position()}}if(this.options.captureKeyEvents){try{this.keyEventListener=this.onCalendarOverlayKeyDown.bind(this);document.addEvent("keydown",this.keyEventListener)}catch(d){}}ta.id(this.positionElement).removeClass("date_picker_error");this.positionElement.blur();this.initTracking();this.updateInputStyling(true);window.fireEvent("onCalendarOverlayShow",this)},onDocumentClick:function(a){this.closedByDocOrDateClick=true;this.closedByDoc=true},onOutDateCalShow:function(a){ta.store("ta.calendar.isOutDateTrigger",true);this.calendarOverlay.show(a)},prev:function(){this.parent();this.resetStartRangeElem(false);var a=(this.currentMonth&&this.currentMonth.date?this.currentMonth.date.get("month"):"");ta.trackEventOnPage("DATEPICKER","PREV_MONTH",(this.isIn?"Checkin":"Checkout"),a)},removeErrorState:function(){if(ta.id("NO_DATES_ERROR")){ta.id("NO_DATES_ERROR").hide()}if(ta.id("calPnt")){ta.id("calPnt").removeClass("errorState")}var a=ta.find("#CHECK_RATES_CONT .date_picker_calendar_wrap");if(a){a.removeClass("errorState")}},resetDatepickerOnHover:function(){var d=this.getPageInDate();var c=this.getPageOutDate();var a=this.positionElement;if(!this.isIn){a=a.id.replace("date_picker_out","date_picker_in");if(a){a=ta.id(a)}}ta.widgets.calendar.updateDateDisplay(a,d,c);this.updateHoverElem();if(d){d=d.valueOf()}if(c){c=c.valueOf()}var b=document.getElements(".date_picker_calendar.overlay .calendar .today");var e=document.getElements(".date_picker_calendar.overlay .calendar .day");e.forEach(function(f){var g=f.getAttribute("value");if(g){g=parseInt(g);f=f.getParent();f.className="";if(d&&d==g){f.addClass("start")}else{if(c&&c==g){f.addClass("end")}}if(d&&c&&d<=g&&g<=c){f.addClass("prevSel")}}}.bind(this));b.addClass("today")},resetFireOnSelectCriteria:function(){ta.widgets.calendar.removeInOutCalendarSelected(this.isIn);ta.widgets.calendar.removeInOutCalendarSelected(!this.isIn)},resetStartRangeElem:function(e){if(!this.oneSelected){return}this.startRangeElem=false;this.clearSelectedDays();if(ta.util.i18n.isRtl()){e=!e}e?this.monthOffset++:this.monthOffset--;var b=this.calendarOverlay.container.getElements(".month");if(e){b.shift()}else{b.pop()}b.some(function(g,f){if(g){var h=ta.id(g).getElement("."+this.options.inDateClass);if(h){this.startRangeElem=h;return true}}return false},this);if(!this.startRangeElem){var a=false;if(this.monthOffset>0){var d=0;a=ta.id(b[d]).getElements("td");if(ta.util.i18n.isRtl()){a.reverse()}}else{var c=b.length-1;a=ta.id(b[c]).getElements("td");if(!ta.util.i18n.isRtl()){a.reverse()}}if(a){a.some(function(g,f){if(this.isValidDateElem(g)){this.startRangeElem=g;return true}return false},this)}}},selectLeftRightButtons:function(){var a={};if(this.options.useClassicSkin){a.leftIdle="classicLeftBtn";a.leftInactive="";a.rightIdle="classicRightBtn";a.rightInactive=""}else{a.leftIdle="sprite-date_picker-btnLeftIdle";a.leftInactive="sprite-date_picker-btnLeftInactive";a.rightIdle="sprite-date_picker-btnRightIdle";a.rightInactive="sprite-date_picker-btnRightInactive"}return a},setPageDates:function(b,a){ta.widgets.calendar.storePriorDates();if(b){ta.widgets.calendar.setPageInDate(b)}if(a){ta.widgets.calendar.setPageOutDate(a)}},setPermanent:function(b){if(this.calendarOverlay){this.calendarOverlay.options.permanent=b;this.calendarOverlay.options.pinnable=(b?ta.overlays.PINNABLE_ALWAYS:ta.overlays.PINNABLE_NEVER);var a=this.positionElement;if(this.positionElement&&!this.positionElement.hasClass("isPreDatesPermanent")){a=this.positionElement.getParent(".isPreDatesPermanent")}if(a){a.removeClass("isPreDatesPermanent")}}},setPositionElement:function(){if((ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")&&!ta.has("hotels_left_filters_redesign"))&&this.options.creatorElem&&!this.options.creatorElem.getParent(".geoChkRates")&&!this.options.creatorElem.getParent("#PERSISTENT_DATE_PICKER")&&(this.options.creatorElem.getParent(".filterControls")||this.options.creatorElem.getParent(".jfy_header_dates_holder")||this.options.creatorElem.getParent(".meta_chevron_module_2014")||this.options.creatorElem.getParent("#HotelDateSearch")||(this.options.creatorElem.getParent(".baseHotelInfoLeft")))){this.positionElement=$$(".miniMetaShowHdr")[0];if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".hr_pre_date_minimalist .title")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".legend.metaDatesChosen")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".p13n_header_tab_wrap .tab0")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$("#STYLE2HEADER_V3 h1")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$("#HLDatesHeader")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".change_dates_button")[0];if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".changeStayInfoButton")[0]}}}else{var a="date_picker_in_";if(!this.isIn){a="date_picker_out_"}this.positionElement=ta.id(a+this.crId+this.options.ext);if(!this.positionElement&&this.options.creatorElem.getParent("#PERSISTENT_DATE_PICKER")){this.positionElement=$$("#PERSISTENT_DATE_PICKER .bestPricesMsg")[0]}}if(!this.positionElement){ta.util.error.record(null,"ta.widgets.SingleDateCalendar.setPositionElement - this.positionElement is undefined",null,{},"WARN")}},setPredatesState:function(){if(this.inDate&&this.outDate){this.calendarOverlay.container.removeClass("predates")}else{this.calendarOverlay.container.addClass("predates")}},shouldFireOnSelect:function(){if(!this.onSelect){return false}return this.isSecondCalShown()&&this.calendarOverlay&&this.calendarOverlay.closedByDocClick},showCalendarOverlay:function(a){if(!this.calendarOverlay){return}if(this.parentOverlay&&this.parentOverlay.container&&ta.id(this.parentOverlay.container).hasClass("persistentCR")){this.calendarOverlay.options.activate=ta.overlays.ACTIVATE_CLICK}this.calendarOverlay.show(a);ta.fireEvent("calendarShown")},trackSelect:function(c){var e=ta.id(this.positionElement).get("id");if(!e){var d="date_picker_in_";if(!this.isIn){d="date_picker_out_"}e=d+this.crId+this.options.ext}var i=e.indexOf("_persist")>0;e=e.substring(e.length-3,e.length);var b="START";var f="DATES";var h=-1;if(e=="ond"){f="RoomTab"}if(c){b="SELECT";if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){f="PRICE_CALENDAR"}else{if(this.inDate&&this.outDate){var g=ta.util.date.getDaysInRange(this.inDate,this.outDate)-1;if(g>ta.util.date.MAX_STAY_DURATION_DAYS){f="DATES_OVER_30_DAYS"}}}}if(this.isIn&&this.today&&this.inDate){h=ta.util.date.getDaysInRange(this.today,this.inDate)-1}else{if(!this.isIn&&this.inDate&&this.outDate){h=ta.util.date.getDaysInRange(this.inDate,this.outDate)-1}}if(ta.retrieve("meta.prof_photo_lb.post_date_close.overlay")){f="CalendarLightbox"}if(ta.retrieve("cal_xsell")){f="CalXSell"}if(f){f="|"+f}if(i){f="|Persistent"+f}if(ta.retrieve("isPricesTabDatePicker")){ta.remove("isPricesTabDatePicker");f+="|Tabs"}if(this.isIn){f="CheckIn"+f}else{f="CheckOut"+f}var a=this.getTrackingPrefix()+ta.widgets.calendar.getTrackingString();ta.widgets.calendar.trackCalendarEvent(a,b,f,h)},getTrackingPrefix:function(){return this.options.isVR?"VR_":""},updateDatepickerOnHover:function(d){var f=this.getPageInDate();var e=this.getPageOutDate();var b;if(this.isIn){f=d;if(e&&d.getTime()>=e.getTime()){e=null}b=this.positionElement}else{e=d;if(f&&d.getTime()<=f.getTime()){f=null}b=this.positionElement.id.replace("date_picker_out","date_picker_in");if(b){b=ta.id(b)}}ta.widgets.calendar.updateDateDisplay(b,f,e);f=this.getPageInDate();if(f){f=f.valueOf()}e=this.getPageOutDate();if(e){e=e.valueOf()}d=d.valueOf();var a=this.isIn?"end":"start";var c=document.getElements(".date_picker_calendar.overlay .calendar .today");var g=document.getElements(".date_picker_calendar.overlay .calendar .day");g.forEach(function(h){var i=h.getAttribute("value");if(i){i=parseInt(i);h=h.getParent();if(h.hasClass(a)){h.className="";h.addClass(a);if(this.isIn&&i<d||!this.isIn&&i>d){h.addClass("invalidPrevSel")}}else{h.className=""}if((this.isIn&&e&&e>=i&&i>=d&&e!=d)||(!this.isIn&&f&&f<=i&&i<=d&&f!=d)){h.addClass("prevSel")}}}.bind(this));c.addClass("today")},updateHoverElem:function(b){if(!this.calendarOverlay){return}var a="msdp_hover";var c=this.calendarOverlay.container.getElement("."+a);if(c){c.removeClass(a)}if(b&&b.getParent()){b.getParent().addClass(a)}},updateInputStyling:function(b){var a=this.positionElement.getParent();if(a){b?a.addClass("dualFieldOn"):a.removeClass("dualFieldOn")}},updateNumNights:function(){if(!ta.has("guests_rooms_picker_3.enabled")||!ta.widgets.calendar.hasPageDates()){return}var a=ta.widgets.calendar.getNumberOfNights(),b=$$(".grp-nights-value");if(b&&b.length>0){b.each(function(c){c.set("html",a)});ta.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.nights",a)}},updatePrevNext:function(){var d=this.currentMonth.date;var c=this.options.dualCalendar?this.nextMonth.date:this.currentMonth.date;var g=ta.util.date.inSameMonth(d,this.options.firstDate);var f=ta.util.date.inSameMonth(c,this.options.lastDate);var b=ta.id(getChildByClass(this.container,"prev"));var a=ta.id(getChildByClass(this.container,"next"));if(ta.util.i18n.isRtl()){b=ta.id(getChildByClass(this.container,"next"));a=ta.id(getChildByClass(this.container,"prev"));g=ta.util.date.inSameMonth(c,this.options.lastDate);f=ta.util.date.inSameMonth(d,this.options.firstDate)}var e=this.selectLeftRightButtons();if(g){b.addClass(e.leftInactive).removeClass(e.leftIdle).setStyle("cursor","default")}else{b.addClass(e.leftIdle).removeClass(e.leftInactive).setStyle("cursor","pointer")}if(f){a.addClass(e.rightInactive).removeClass(e.rightIdle).setStyle("cursor","default")}else{a.addClass(e.rightIdle).removeClass(e.rightInactive).setStyle("cursor","pointer")}},updateSelectedDays:function(c,b){this.clearSelectedDays();var a=this.startRangeElem;this.includeElemInRange(a,this.options.selectedHoverClass);if(c.getTime()>this.newInDate.getTime()){this.updateSelectedDaysHelper(a,b.parentNode,true,this.options.selectedHoverClass);this.options.selectionStartClass&&ta.id(a).addClass(this.options.selectionStartClass);this.options.selectionEndClass&&ta.id(b.parentNode).addClass(this.options.selectionEndClass)}else{this.updateSelectedDaysHelper(a,b.parentNode,false,this.options.selectedHoverClass);this.options.selectionStartClass&&ta.id(a).addClass(this.options.selectionEndClass);this.options.selectionEndClass&&ta.id(b.parentNode).addClass(this.options.selectionStartClass)}},updateSelectedDaysHelper:function(e,j,g,h){if(!e||e==j){return}var f="nextSibling";var k="firstChild";if(!g){f="previousSibling";k="lastChild"}var d=false;if(this.isValidDateElem(e[f])){d=e[f]}else{var a=e.parentNode;if(a&&a[f]){d=a[f][k]}else{if(a&&ta.id(a).getParent(".month")){var c=ta.id(a).getParent(".month");if(ta.util.i18n.isRtl()){f=(f=="previousSibling")?"nextSibling":"previousSibling"}var i=c[f];if(!i){return}var b=ta.id(i).getElements("td");if(!g){b.reverse()}b.some(function(m,l){if(this.isValidDateElem(m)){d=m;return true}return false},this)}}}this.includeElemInRange(d,h);this.updateSelectedDaysHelper(d,j,g,h)}})})();ta.widgets.tabContainer=function(d,i){var a=d.getElements(".current");if(a.length!=1){throw new Error("You must have exactly one tab with a class of 'current'.")}else{a=a[0]}var g=a.className.match(/tab(\d+)/);if(g!=null&&g.length>=2){var b=Number(g[1])}else{return}if($("HOMEPAGE")&&window.location.hash){var h=window.location.hash.match(/t(\d)/);if(h&&h.length>0){b=parseInt(h[1]);a.removeClass("current");d.getElements(".tab")[b].addClass("current")}}var c=d.getElements(".tabContainerHead .tab");if(c.length==0){return}var f=d.getElements(".tabContainerBody .tabContent");return new TabSet(c,f,{show:b,onActive:function(l,m,j){var n=m.hasClass("xhr");if(n&&!m.hasClass("xhrComplete")){var e=m.getElement("a").href;if(e){var k=m;j.addEvent("onContentReplaced",function(){k.addClass("xhrComplete")});ta.util.element.replaceContent(l,j,e)}}if(m.hasClass("recordAction")){new Request({url:"/ActionRecord?action="+m.id}).send()}m.addClass("current");if(n&&l){l.stop()}},onBackground:function(j,k,e){k.removeClass("current")}})};ta.widgets.Carousel=new Class({Implements:Options,Binds:["shiftLeft","shiftRight"],options:{width:50,height:50,padding:5,num:7,offset:0,horizontal:true},initialize:function(a,b){this.setOptions(b);this.container=a;this.viewport=this.container.getElement(".viewport");this.leftKnob=this.container.getElement(".shiftLeft");this.rightKnob=this.container.getElement(".shiftRight");this.images=this.viewport.getElements("img");this.offset=this.options.offset;if(this.options.horizontal){this.viewport.setStyles({width:this.options.width*this.options.num+this.options.padding*(this.options.num-1),height:this.options.height})}else{this.viewport.setStyles({width:this.options.width+this.options.padding*2,height:this.options.height*this.options.num+this.options.padding*(this.options.num-1)})}this.leftKnob.addEvent("click",this.shiftLeft);this.rightKnob.addEvent("click",this.shiftRight);this.render()},render:function(){var a=this.offset+this.options.num;for(var b=this.images.length-1;b>=0;b--){if(b<this.offset||b>=a){this.images[b].setStyle("left",-999)}else{if(this.options.horizontal){this.images[b].setStyle("left",(this.options.width+this.options.padding)*(b-this.offset))}else{this.images[b].setStyles({top:(this.options.height+this.options.padding)*(b-this.offset),left:0})}}}if(this.offset==0){this.leftKnob.addClass("disabled")}else{this.leftKnob.removeClass("disabled")}if(this.offset==this.images.length-this.options.num){this.rightKnob.addClass("disabled")}else{this.rightKnob.removeClass("disabled")}},shiftLeft:function(){var a=this.offset;this.offset=Math.max(0,this.offset-this.options.num);if(this.offset!=a){this.render()}},shiftRight:function(){var a=this.offset;this.offset=Math.min(this.offset+this.options.num,this.images.length-this.options.num);if(this.offset!=a){this.render()}}});(function(b){b.util.action={record:function a(i,g,e){var f=null;if(b.util.Deferred){f=new b.util.Deferred()}var h=Object.merge({url:"/ActionRecord",data:{action:i},onSuccess:function(j){if(f){f.resolve(j)}},onFailure:function(j){if(f){f.reject(j)}}},g);e&&(h.trackEvent=e);new Request(h).get();if(f){return f.promise()}},recordPlus:function c(i,g,e){var f=null;if(b.util.Deferred){f=new b.util.Deferred()}var h=Object.merge({url:"/ActionRecordPlus",data:{action:i},onSuccess:function(j){if(f){f.resolve(j)}},onFailure:function(j){if(f){f.reject(j)}}},g);e&&(h.trackEvent=e);new Request(h).get();if(f){return f.promise()}},recordPid:function d(e){new Request({url:"/ActionRecord?pid="+e}).send()}}}(ta));ta.util.partials={requestTimeout:1000,maxDataRequests:12,dataRequestCount:0,incompleteDataRegex:/<\!-- incomplete\: ([\w, ]*) -->/,failedDataRegex:/<\!-- failed\: ([\w, ]*) -->/,partialsErrorRegex:/<\!-- error -->/,noOauthTokenRegex:/<\!-- no Oauth Token -->/,finishedInitialMPASequence:false,_resetPolling:function(){ta.util.partials.dataRequestCount=0},_newSeriesArgs:[],_runNextSeries:function(){var a=ta.util.partials._newSeriesArgs.shift();if(a){ta.util.partials.requestPartials.apply(this,a)}},requestMorePartials:function(a,d,b,c){ta.util.partials._newSeriesArgs.push(arguments);if(ta.util.partials.dataRequestCount===0&&ta.util.partials.finishedInitialMPASequence){ta.util.partials._runNextSeries()}},requestPartials:function(b,e,c,d){if(ta.util.partials.dataRequestCount>ta.util.partials.maxDataRequests||b.length==0){ta.util.partials.finishMPASequence();return}ta.util.partials.dataRequestCount++;if(ta.has("fb.partial.extraJS")){ta.retrieve("fb.partial.extraJS").each(function(g){new Asset.javascript(g)})}if(ta.has("fb.partial.extraCSS")){ta.retrieve("fb.partial.extraCSS").each(function(g){new Asset.css(g)})}var a=ta.remove("facebook.authcode.param");var f=Object.merge({parts:b.join(","),requestUrl:ta.retrieve("page.urlSafe")},e);if(a!=null){f=Object.merge(f,{FBAuthCode:a})}new Request({url:"/MultiPartAjax",method:"post",data:f,keepScripts:true,onRequest:function(){},onSuccess:function(g){ta.util.partials.dataAvailable(e,b,c,d,null,null,g)}}).send()},handlePartialPaging:function(h,e,f){var g=f||{};ta.util.partials.dataRequestCount=0;if(!e||e.href==null){ta.util.error.record(null,"handlePartialPaging elmt.href null:"+e,null,null);return false}/parts=([\w,]+)/.test(e.href);var d=RegExp.$1.split(",");ta.store("partial.event.element",e);ta.store("partial.event.params",f);var c=ta.remove("facebook.authcode.param");var a=Object.merge({requestUrl:ta.retrieve("page.urlSafe")},g);var b=Object.clone(a);if(c!=null){a=Object.merge(a,{FBAuthCode:c})}new Request({url:e.href,method:"post",data:a,keepScripts:true,onSuccess:function(i){ta.store("fb.partial.isHandlePartialPaging",true);ta.util.partials.dataAvailable(b,d,"facebook",false,h,e,i)}}).send();return false},dataAvailable:function(d,j,i,f,o,c,g){if(f){var e=ta.util.partials.dataAvailable.pass([d,j,i,false,o,c,g]);f(e,g,j,d,i,f);return}if(g.match(ta.util.partials.noOauthTokenRegex)){if(ta.remove("fb.partial.isHandlePartialPaging")){ta.support.Facebook.pageDataAvailable(o,c,d,g)}return}if(g.match(ta.util.partials.partialsErrorRegex)){if(ta.has(i+".onPartialsError")){ta.remove(i+".onPartialsError").each(function(p){p()})}return}var m=[];var h=[];if(g.match(ta.util.partials.incompleteDataRegex)){m=RegExp.$1.split(",")}if(g.match(ta.util.partials.failedDataRegex)){h=RegExp.$1.split(",")}if(ta.has(i+".onDataAvail")){ta.remove(i+".onDataAvail").each(function(p){p()})}var n=[];var b=null;var l=/<style[^>]*>([\s\S]*?)<\/style>/gi;while((b=l.exec(g))){n.push(b[1])}if(n.length>0){n=n.join("\n");var k=document.createElement("style");k.type="text/css";document.getElementsByTagName("head")[0].appendChild(k);if(Browser.ie&&Browser.version<11){k.styleSheet.cssText=n}else{k.appendChild(document.createTextNode(n))}}g=g.stripScripts(true);g=g.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi,"");var a=ta.id("PARTIAL_DATA")||new Element("div",{id:"PARTIAL_DATA",styles:{display:"none"}}).inject(document.body);a.adopt(Elements.from(g));setTimeout(function(){ta.util.partials.notifyListeners(j,i,m,h,a,d)},0)},notifyListeners:function(d,e,c,b,a,f){d.each(function(l){var p=e+".data.onAvail."+l;var n=c.contains(l);var k=b.contains(l);var q=ta.remove(p);if(q){for(var o=0,m=q.length;o<m;o++){if(q[o](a,n,k)===false){q[o]=null}}q=q.erase(null);if(n){if(q.length>0){ta.store(p,q)}else{c.erase(l)}}}if(!c.contains(l)&&!k){ta.keep("partials.pageProperties",l)}});var h="partials.data.onPage";var g=ta.remove(h);if(g){g.each(function(i){i()})}if(c.length>0){ta.util.partials.requestPartials.invokeLater(ta.util.partials.requestTimeout,null,[c,f,e])}else{ta.util.partials.finishMPASequence()}},finishMPASequence:function(){if(!ta.util.partials.finishedInitialMPASequence){ta.util.partials.recordGAEvent();ta.util.partials.finishedInitialMPASequence=true}ta.util.partials._resetPolling();ta.util.partials._runNextSeries()},recordGAEvent:function(){var b=ta.remove("partials.pageProperties");if(!b||b.length==0){return}var a="-"+b.sort().join("-")+"-";ta.trackEventOnPage("social","show",a)}};ta.util.partials.handleLightbox=ta.util.partials.handlePartialPaging;if(!ta.util){ta.util={}}ta.util.customEvent={_register:function(a){if(!Element.Events[a]){Element.Events[a]={}}},addListener:function(b,c,a){ta.util.customEvent._register(b);c=ta.id(c);if(c&&c.addEvent){c.addEvent(b,a)}},removeListener:function(b,c,a){c=ta.id(c);if(c&&c.addEvent){c.removeEvent(b,a)}}};ta.support.Facebook={ready:false,queue:[],defaultRequestedPermissions:["email","user_hometown","user_friends","user_likes","user_location","user_status","user_photos"],enqueueForFBReady:function(a){if(ta.support.Facebook.ready){a()}else{ta.support.Facebook.queue.push(a)}},dequeueForFBReady:function(){try{ta.support.Facebook.queue.each(function(b){b()})}catch(a){ta.util.error.record(a,"Error calling dequeueForFBReady")}ta.support.Facebook.queue=[]},ipRevoke:function(a){setTimeout(function(){ta.util.pending.lock("fb.revoke.lb",function(){ta.util.pending.unlock("fb.revoke")})},a)},enqueueForFBAvailable:function(a){if(ta.retrieve("facebook.session.available")){a()}else{ta.keep("facebook.onSessionAvail",a)}},init:function(){if(ta.has("facebook.available")){return}ta.util.pending.multilock("facebook.data.canDisplay",ta.support.Facebook.showData,2);var a=ta.support.Facebook.timing=new ta.support.IPTiming();if(!ta.retrieve("facebook.invalidFBCreds")){ta.support.Facebook.initData(true)}ta.support.Facebook.markAvailable();FB.init({appId:ta.retrieve("facebook.appId"),status:true,cookie:true,xfbml:true,version:ta.retrieve("facebook.apiVersion"),frictionlessRequests:true,oauth:true});ta.support.Facebook.ready=true;ta.support.Facebook.dequeueForFBReady();if(!ta.retrieve("facebook.disableLogin")){if(ta.retrieve("facebook.skip.session.check")=="true"){ta.support.Facebook.sessionAvailable()}else{FB.getLoginStatus(ta.support.Facebook.onLoginStatus)}}else{if(!ta.has("facebookuserid")){ta.support.Facebook.sessionUnavailable()}}},transformToAuthResponse:function(c){var a=ta.retrieve("facebook.authFailed");var d=ta.retrieve("facebook.authSuccess");var b=c.authResponse;if(!b){if(a){a()}return null}if("connected"===c.status){b.uid=ta.store("fb.auth.userId",b.userID);b.token=ta.store("fb.auth.token",b.accessToken);if(d){d()}return b}if(a){a()}return null},onLoginStatus:function(b){var a=ta.support.Facebook.transformToAuthResponse(b);if(a){if(ta.has("cached.facebookuid")&&ta.retrieve("cached.facebookuid")!==""+a.uid){ta.util.error.record(null,"Mismatched Facebook uid between cached value and authResponse. cached: "+ta.retrieve("cached.facebookuid")+", response: "+a.uid);ta.store("facebook.preFailed",true);ta.store("facebook.AuthCode.onAvail.needsReload",function(){window.location.reload()});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a));return}if(ta.retrieve("facebook.invalidFBCreds")&&!ta.retrieve("facebook.signout.process")){ta.store("facebook.AuthCode.onAvail",ta.support.Facebook.sessionAvailable);ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a))}else{ta.support.Facebook.sessionAvailable()}}else{if(!ta.retrieve("facebook.invalidFBCreds")){ta.store("facebook.preFailed",true);setOneTimeCookieOnFQDN("FacebookAuthCode2","NoFBSessionAvailable");new Request({url:"/ActionRecord?action=fb_cached_token_no_session"}).send()}ta.support.Facebook.sessionUnavailable()}},initData:function(a){if(ta.remove("facebook.data.initialRequest.failed")){ta.support.Facebook.loadData({pre:a})}else{ta.util.pending.lock("facebook.data.initialRequest",ta.support.Facebook.loadData.partial({pre:a}))}},loadData:function(b){if(!ta.has("facebook.data.request")){return}ta.support.Facebook.timing.setBeginPartials();var a=ta.retrieve("facebook.data.request");ta.util.partials.requestPartials(a,Object.merge({},b,ta.retrieve("facebook.data.params")),"facebook",ta.support.Facebook.dataAvailable)},receiveCode:function(d){var a=ta.retrieve("facebook.AuthCode.onAvail");if(a!=null){ta.store("facebook.authcode.param",d);setOneTimeCookieOnFQDN("FacebookAuthCode2",d);a()}var c=ta.retrieve("facebook.AuthCode.onAvail.needsReload");if(c!=null){setOneTimeCookieOnFQDN("FacebookAuthCode2","ConflictedFBAccount");if("function"!==typeof c){ta.util.error.record(null,"needsReload was not a function.")}c();return}var b=ta.retrieve("facebook.AuthCode.onAvail.paging");if(b!=null){ta.store("facebook.authcode.param",d);setOneTimeCookieOnFQDN("FacebookAuthCode2",d);b()}},getCodeFromOAuthResponse:function(b){var d=ta.support.Facebook.parseFBSignedRequest(b.signedRequest).code;var c=ta.remove("facebook.taServerTime");var a=c-3600;var e=null;if(d&&!isNaN(a)){e=d.split(".")}if(e!=null&&e.length>3&&!isNaN(e[3])&&e[3]<a){ta.util.error.record(null,"Facebook sending up expired Code: ",null,{code:d,serverTime:c})}return d},parseFBSignedRequest:function(c){if(!c){return null}var a=c.split(".",2);var d=a[1];if(d){var b=ta.util.decoder.base64Decoder(d);try{return JSON.decode(b)}catch(f){ta.util.error.record(null,"couldn't parse Facebook SignedRequest to JSON object after decode ",null,{signedRequest:c,decoded:b})}}else{ta.util.error.record(null,"Facebook SignedRequest TA received doesn't contain data",null,{signedRequest:c})}},preemptiveRegex:/<\!-- PREEMPTIVE RESPONSE -->/,noOauthTokenRegex:/<\!-- no Oauth Token -->/,limitOfTry:4,dataAvailable:function(a,b,c,f,d,e){if(b.match(ta.support.Facebook.preemptiveRegex)&&ta.remove("facebook.preFailed")){return}if(b.match(ta.support.Facebook.noOauthTokenRegex)){delete f.pre;var g=ta.util.partials.requestPartials.partial(c,f,d,e);ta.store("facebook.AuthCode.onAvail",g);ta.support.Facebook.tryRegetOauthToken()}ta.store("facebook.data.handler",a);if(ta.retrieve("facebook.data.isShowDataOnce")){ta.support.Facebook.showData()}else{ta.util.pending.unlock("facebook.data.canDisplay")}},tryRegetOauthToken:function(){var a=ta.retrieve("fb.noOauthToken.counter");if(a==null){a=0}if(a<ta.support.Facebook.limitOfTry){ta.store("fb.noOauthToken.counter",a+1);FB.getLoginStatus(ta.support.Facebook.checkStatusAndGetCode)}},checkStatusAndGetCode:function(b){var a=ta.support.Facebook.transformToAuthResponse(b);if(a){if(ta.has("cached.facebookuid")&&ta.retrieve("cached.facebookuid")!==""+a.uid){ta.util.error.record(null,"Mismatched Facebook uid between cached value and authResponse. cached: "+ta.retrieve("cached.facebookuid")+", response: "+a.uid);ta.store("facebook.AuthCode.onAvail.needsReload",function(){window.location.reload()})}ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a))}},pageDataAvailable:function(e,b,d,a){var c=ta.util.partials.handlePartialPaging.partial(e,b,d);ta.store("facebook.AuthCode.onAvail.paging",c);ta.support.Facebook.tryRegetOauthToken()},showData:function(){ta.remove("facebook.data.handler")();if(!ta.retrieve("facebook.data.isShowDataOnce")){ta.store("facebook.data.isShowDataOnce",true);ta.support.Facebook.timing.recordEndTimes()}},markAvailable:function(){ta.store("facebook.available",true);if(ta.has("facebook.onAvail")){ta.remove("facebook.onAvail").each(function(a){a()})}},sessionAvailable:function(){var a=ta.retrieve("facebook.session.available");ta.store("facebook.session.available",true);ta.support.Facebook.timing.recordLoadTime();if(ta.has("facebook.onSessionAvail")){ta.remove("facebook.onSessionAvail").each(function(b){b()})}if(!a){ta.util.pending.unlock("facebook.data.canDisplay")}ta.support.Facebook.initData(false)},sessionUnavailable:function(){ta.store("facebook.session.available",false);ta.support.Facebook.timing.recordLoadTime();if(ta.has("facebook.onSessionUnavail")){ta.remove("facebook.onSessionUnavail").each(function(a){a()})}$$("#HEAD .FB_login_button").forEach(function(a){a.addEvent("click",function(){new Request({url:"/ActionRecord?action=FBC_Masthead"}).send()})});$$("#WoF_SigninLander .fbcBtnsmall").forEach(function(a){a.addEvent("click",function(){new Request({url:"/ActionRecord?action=WoF_SigninLander"}).send()})})},havePermission:function(b,d,c){var a=ta.retrieve("facebook.permissions");if(a){if(a.indexOf(b)==-1){return c?c():null}return d?d():null}else{FB.api("/me/permissions",function(e){var f=false;e.data.each(function(g){if(g.permission==b&&g.status==="granted"){f=true}});if(f&&d){d()}else{if(!f&&c){c()}}})}},requirePermission:function(a,c,b){ta.support.Facebook.login([a],c,b)},ifLoggedIn:function(b,a){if(ta.retrieve("facebook.session.available")&&b){b()}else{if(a){a()}}},loginButton:function(b,a){ta.support.Facebook.login()},login:function(n,a,e,c,b,l,p){var l=!!l;n=Array.from(n||[]);if(b!=null&&b.length>0){ta.store("facebook.flow",b)}else{ta.store("facebook.flow","FBC")}var f=userLoggedIn?"Connect":"Login";var g=f=="Login"?"":ta.retrieve("facebook.isFBC")=="true"?"Upgrade":"New";var k=(p&&p.pid)||ta.retrieve("facebook.trackingpid");ta.util.cookie.setPIDCookie(k);function d(i,q){return Object.merge({module:i,action:q},k&&{value:k}||{})}ta.util.action.record("FacebookConnect",null,d("social",f+"Attempt"+g));var o=function(){ta.util.cookie.setPIDCookie(k);ta.util.action.record("FacebookConnect",null,d("social",f+"Success"+g));var i={action:f,userType:g};if(a){a(i)}};if(!userLoggedIn||!userFbConnected||c){ta.support.Facebook._doLogin(n,o,e,c,l,p);return}var m=[];for(var j=0;j<n.length;j++){m.push(ta.support.Facebook.havePermission.partial(n[j]))}function h(){if(o){o()}}Function.executeContinuations([ta.support.Facebook.ifLoggedIn].concat(m).concat([h]),ta.support.Facebook._doLogin.partial(n,o,e,l,p))},addEmailLogin:function(b,a){var d={};var c=document.getElement("."+b).get("value");if(!c||!c.match(/.+\@.+\..+/)){document.getElement("."+a).removeClass("hidden");return}if(c){d.email=c}ta.support.Facebook.fbcRegistration(null,null,false,d)},basicLogin:function(d,a,g){if(!ta.support.Facebook.ready){return}var f=function(i){try{var h=ta.support.Facebook.transformToAuthResponse(i);if(!h||!h.token){a&&a(h);return}var j=ta.support.Facebook.getCodeFromOAuthResponse(h);if(j){setOneTimeCookieOnFQDN("FacebookAuthCode2",j);d&&d(h)}else{a&&a(h)}}catch(k){ta.util.error.record(k,"fb.basicLogin callback failed")}};try{var b=g||{scope:ta.support.Facebook.defaultRequestedPermissions.join(",")};FB.login(f,b)}catch(c){ta.util.error.record(c,"fb.basicLogin failed")}},_doLogin:function(c,g,a,f,b,e){var d=f;FB.login(function(i){var h=ta.support.Facebook.transformToAuthResponse(i);if(h&&h.token){ta.support.Facebook.setResultPID();ta.store("facebook.AuthCode.onAvail",function(){ta.store("facebook.uid",h.uid);ta.support.Facebook.fbcRegistration(d,g,b,e)});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(h))}else{if(a){a()}}},{scope:ta.support.Facebook.defaultRequestedPermissions.join(",")})},setResultPID:function(){var a=ta.retrieve("facebook.trackingpid");if(a){ta.util.cookie.setPIDCookie(a)}},fbcRegistration:function(d,g,b,c){var e=!ta.retrieve("facebook.session.available")||!userLoggedIn||!userFbConnected;c||(c={});var a=c.pid;if(d!=null){e=e||d}if(e){var f={flow:ta.retrieve("facebook.flow"),noreload:b};a&&Object.merge(f,{pid:a});ta.store("facebook.session.available",true);ta.store("registration.action","FB_CONNECT");ta.run("ta.overlays.registration.logAndPost",{},f,"FBC-start",Object.merge(c,{action:"FB_CONNECT"}))}if(g){g()}},loginWithFlow:function(a,b){ta.store("facebook.flow",a);ta.support.Facebook.login(null,null,null,b)},logout:function(){FB.logout(function(){window.location.reload()})},logoutNoRefresh:function(a){FB.logout(function(b){userLoggedIn=false;ta.store("facebook.session.available",false);ta.store("facebook.isFBC",false);if(a){a(b)}})},restart:function(){FB.logout(function(){ta.overlays.registration.post({action:"FB_LOGIN"})})},revoke:function(){FB.api({method:"Auth.revokeAuthorization"})},postWall:function(h,f,j,e,c,m,g,d,k,a,i,l,b){FB.ui({method:"feed",message:h,picture:m,link:f,name:j,to:k,caption:e,description:c,display:a,properties:i,actions:[{name:g,link:d}]},function(n){if(n&&n.post_id){if(l){l(n)}}else{if(n&&!n.post_id){ta.util.error.record(null,"Facebook postWall error response from facebook",null,null)}else{if(b){b(n)}}}})},publishStream:function(e,a,g,h,c,f,b,d){FB.login(function(j){var i=ta.support.Facebook.transformToAuthResponse(j);if(i){if(i.token){new Request({url:"/ActionRecord?action=POSTTOWALL_GRANTED"}).send();ta.support.Facebook.postWall(e,a,g,h,c,f,b,d)}}},{scope:"publish_stream"})},loginRequestSpecificPermission:function(b,c,a){FB.login(function(e){var d=ta.support.Facebook.transformToAuthResponse(e);if(d){if(d.token){ta.store("facebook.AuthCode.onAvail",function(){ta.support.Facebook.fbcRegistration(null,c)});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(d))}else{if(a){a()}}}},{scope:b})},loginWithFlowAndRequest:function(b,c,d,a){ta.store("facebook.flow",b);ta.support.Facebook.loginRequestSpecificPermission(c,d,a)},signOutComplete:function(){try{ta.support.Facebook.ifLoggedIn(function(){ta.support.Facebook.logout()},function(){window.location.reload()})}catch(a){ta.util.error.record(a,"signoutAction - fb signout failed");window.location.reload()}},enqueueListenForFBAuthChange:function(a){ta.support.Facebook.enqueueForFBReady(function(){FB.Event.subscribe("auth.statusChange",a)})},googleClick:function(c,a){new Request({url:"/ActionRecord?action=Google404Test&pid="+a}).send();if(c){c.onclick=null}var b=ta.id("GOOG_SORRY");if(b){b.show()}}};ta.support.IPTiming=new Class({initialize:function(){this.active=ta.has("facebook.iptiming");if(this.active){this.timers=ta.retrieve("facebook.iptiming")}else{}},recordLoadTime:function(){if(this.active){this.sendActionRecord("LoadPage",this.timers.loaded-this.timers.started)}},setBeginPartials:function(){if(this.active&&!this.timers.partials){this.timers.partials=new Date().getTime()}},recordEndTimes:function(){if(this.active){var a=new Date().getTime();this.sendActionRecord("GetPartials",a-this.timers.partials);this.sendActionRecord("LoadAll",a-this.timers.started)}},sent:{},sendActionRecord:function(c,a){if(this.sent[c]){return}this.sent[c]=true;a=Math.round(a/1000);var b;if(a<=10){b=a.toString()}else{if(a>10&&a<=15){b="11-15"}else{if(a>15&&a<=20){b="16-20"}else{b="21+"}}}c+="_";c+=ta.retrieve("facebook.session.available")?"IP_":"NonIP_";c+=b+"_"+this.timers.servletName;if(this.timers.firstPage){c+="_FirstPage"}ta.util.action.record(c)}});(function(){window.ta||(window.ta={});window.ta.util||(window.ta.util={});var a=function(b){this.constructor=b};window.ta.util.extend=function(f){var c={};var g,h,e,d,b;for(d=1,b=arguments.length;d<b;d++){h=arguments[d];for(e in h){if(h.hasOwnProperty(e)){c[e]=h[e]}}if(h.hasOwnProperty("constructor")){c.constructor=h.constructor}}g=c.hasOwnProperty("constructor")?c.constructor:function(){return f.apply(this,arguments)};a.prototype=f.prototype;g.prototype=new a(g);g.prototype.__super__=f.prototype;for(e in c){g.prototype[e]=c[e]}return g}}());(function(d){d.fb||(d.fb={});var b=new RegExp(["User is already associated","Permissions error"].join("|"));var a=new RegExp(["Timeline is not activated","Requires extended permission","An unexpected error has occurred","An unknown error has occurred","load-error: unknown","Error validating access token","Object at URL.*requires an object of og:type","Could not retrieve data from URL","^unknown error"].join("|"));var c=/Temporarily Blocked/;d.fb.graph={api:function(i,k,j,g){var f=Array.prototype.slice.call(arguments);var e=d.util.Deferred();k||(k="get");j||(j={});g||(g={});g.recordErrors=(g.recordErrors!==false);(function h(l){FB.api(i,k,j,function(n){if(n&&!n.error){e.resolve(n)}else{var o={name:"None",message:"No FB.api response"};var m="ERROR";if(n&&n.error){o.name=n.error.type;o.message=(typeof n.error==="string")?n.error:n.error.message}if(l&&o.message.match("has og:type of '(?:tripadvisortravelmap|civ)")){j.scrape=true;h(false);return}if(a.test(o.message)){m="WARN"}if(g.recordErrors&&!b.test(o.message)){this.recordError(o,{FB_API_ARGS:f,FB_API_RESPONSE:n,FB_AUTH_RESPONSE:FB.getAuthResponse()},m)}e.reject(o)}}.bind(this))}.call(this,true));return e.promise()},remove:function(f,e){e||(e={});e.method="delete";return this.api("/"+f,"delete",e)},recordError:function(g,h,e){var f="ta.fb.graph.api";if(c.test(g.message)){f+=" blocked feature"}if(d.util.error){d.util.error.record(g,f,null,h,e)}return this}}}(ta));(function(a){a.fb.graph.Base=a.util.extend(Object,{constructor:function b(d,c){this.set(d);this.options=c||{};this.connections||(this.connections={})},set:function(d){for(var c in d){d.hasOwnProperty(c)&&(this[c]=d[c])}return this},api:function(c,f,e){if(!(this.id&&this.accessToken)){var d={name:"Missing auth credentials",message:"Facebook Graph object API calls require an id and access token"};a.fb.graph.recordError(d,{FB_ID:this.id,FB_ACCESS_TOKEN:this.accessToken,FB_API_ARGS:arguments},"WARN");return a.util.Deferred().reject(d)}c||(c="");if(/^\//.test(c)){c=c.slice(1)}e||(e={});e.access_token=this.accessToken;return a.fb.graph.api("/"+this.id+"/"+c,f,e)},getConnection:function(c){if(this.connections[c]){return new a.util.Deferred().resolve(this.connections[c])}return this.api(c).success(function(d){this.connections[c]=d.data;return a.util.Deferred().resolve(d.data)},this)},getClientConnection:function(c){if(!this.connections[c]){this.connections[c]=[];this.connections[c].all=false;this.connections[c].clientCount=0}return this.connections[c]},evictConnection:function(c){if(this.connections[c]){delete this.connections[c]}}})}(ta));ta.fb.graph.Application=ta.util.extend(ta.fb.graph.Base);(function(){ta.fb.openFeedDialog=function(b){var a=new ta.util.Deferred();b||(b={});b.method="feed";FB.ui(b,function(c){if(c&&c.post_id){a.resolve(c)}else{a.reject(c)}});return a.promise()}}());(function(a){a.fb.graph.mixin||(a.fb.graph.mixin={});var e=true;var b=true;var d=new RegExp(["Timeline is not activated","Requires extended permission"].join("|"));var c=300;a.fb.graph.mixin.OpenGraph={recordOpenGraph:function(g){var f=this.options.MapAction;if(f){Math.random()>0.2||f.record(g)}return this},getActions:function(f,g){f=this.options.appName+":"+f;var h=this.getClientConnection(f);if(h.all||(!g&&h.length>h.clientCount)){return a.util.Deferred().resolve(h)}return this.api(f,"get",{offset:h.length,limit:c}).success(function(i){Array.prototype.push.apply(h,i.data);if(!i.paging||(i.paging.previous&&!i.paging.next)){h.all=true}return a.util.Deferred(h)})},publishAction:function(g,j,i,h){if(!(a.retrieve("feature.ogPublish")&&e&&b)){return a.util.Deferred().reject("Publishing open graph actions is disabled.")}var f=this.options.appName;var k=this.options.ref;g=f+":"+g;h||(h={});h[j]=(!(/^http/).test(i)?"http://"+this.options.hostname:"")+i;if(k){h.ref=k+(h.ref?"__"+h.ref:"")}if(!a.retrieve("feature.openGraphLocationTagging")){delete h.place}var l=this.api(g,"POST",h).success(function(m){var o=this.getClientConnection(g);var n={id:m.id,data:{}};n.data[j]={url:h[j]};o.splice(o.clientCount,0,n);o.clientCount++;this.recordOpenGraph("OpenGraph_"+g)},this).failure(function(m){if(d.test(m.message)){e=false}});return l},publishLocatedAction:function(i,h,g,f){f||(f={});f.place=(!(/^http/).test(g)?"http://"+this.options.hostname:"")+g;return this.publishAction(i,h,g,f)},deleteActionsByObject:function(h,j,i){var g=this;if(+i!=i){i=(!(/^http/).test(i)?"http://"+this.options.hostname:"")+i}var k=Array.prototype.each?"each":"forEach";return(function f(l){return g.getActions(h,{next:l}).success(function(r){if(!r.all){return f(true)}var m=a.util.Deferred();var q=[];var p,n,o;for(o=0;o<r.length;o++){p=r[o];n=p.data[j];if(n&&(n.url==i||n.id==i)){q.push(p)}}if(!q.length){return m.resolve()}q[k](function(s){a.fb.graph.api(s.id,"delete").success(function(){q.splice(q.indexOf(s),1);var t=r.indexOf(s);r.splice(t,1);if(t<r.clientCount){r.clientCount--}if(!q.length){m.resolve()}}).failure(function(){m.reject()})});return m.promise()},this)}(false))},scrape:function(f){return a.fb.graph.api("/","post",{id:f,scrape:true})},setPublishState:function(f){e=!!f;b=!!f}}}(ta));(function(a){a.fb.graph.mixin||(a.fb.graph.mixin={});a.fb.graph.mixin.Feed={postLink:function(){},postStatus:function(){},postCheckin:function(){},postPhoto:function(){},postVideo:function(){},postFeed:function(b){return this.api("feed","POST",b)}}}(ta));(function(a){a.fb.graph.User=a.util.extend(a.fb.graph.Base,a.fb.graph.mixin.OpenGraph,a.fb.graph.mixin.Feed)}(ta));ta.fb.graph.User.prototype.inviteFriends=(function(b){var d=50;function a(e,f,i,h,g){var j=e.splice(0,d);g||(g=[]);FB.ui({method:"apprequests",message:f||"",title:i||"",new_style_message:true,to:j.join(",")},function(k){if(k&&k.to&&k.to.length){g.push.apply(g,k.to);if(!e.length){a(e,f,i,h,g)}else{h.resolve(g,k)}}else{h.reject(g,k)}})}return function c(f,g,h){var e=b.util.Deferred();a(f,g,h,e);return e.promise()}}(ta));ta.fb.graph.User.prototype.getAppRequests=function(a){if(!a&&this.appRequests){return ta.util.Deferred().resolve(this.appRequests)}return this.api("apprequests").success(function(b){this.appRequests=b},this)};ta.fb.graph.User.prototype.recordAndDeleteAppRequests=function(d,c,f){var a=this;d||(d=[]);if(!c){var b=window.location.search.match(/[?&](?:ref|fb_source)=([^&]*)/);c=b&&b[1]}function e(h){var j=[];var i=0;var g=ta.util.Deferred();h.each(function(l){var k="";ta.fb.graph.api("/"+l,"get").success(function(m){if(m&&m.from&&m.from.id){k=m.from.id}}).always(function(){ta.fb.graph.api("/"+l,"delete",null,{recordErrors:false});j.push((f?f+"_":"")+"AppRequestId_"+l+"_"+k);i++;if(i==h.length){if(a.options.MapAction&&j.length){a.options.MapAction.record(j.join(",")).success(function(){g.resolve()}).failure(function(){g.reject()})}else{g.resolve()}}})});return g.promise()}if(c=="bookmarks"){return this.getAppRequests().success(function(g){g.data.each(function(h){var i=h.id.split("_")[0];~d.indexOf(i)||d.push(i)})}).always(function(){return e(d)})}return e(d)};(function(a){var b=10000;a.fb.graph.TAUser=a.util.extend(a.fb.graph.User,{locationToOgType:function(c){return/^g(?:eo)?|10004/.test(c)?"city":/^a(?:ttraction)?|10021/.test(c)?"attraction":/^e(?:atery)?|10022/.test(c)?"restaurant":/^h(?:otel)?|^lodging|10023/.test(c)?"hotel":null},pin:function(c,f,m){m||(m={});var k=a.util.Deferred();var e=false;var d,h,i,l;if(c){d=this.locationToOgType(c.type);h=c.url}if(!(d&&c.url&&f&&f.length)){return k.reject()}i=!!(this.location&&this.location.latitude&&this.location.longitude);l=!!(this.hometown&&this.hometown.latitude&&this.hometown.longitude);var j=Array.prototype.each?"each":"forEach";var g=0;f[j](function(o){var q=o=="been"?"pin":o;var p={};var r=false;if(a.retrieve("feature.ogRefContainsFbid")){p.ref="fbid="+this.id}if(q=="pin"){var n={};var s;if(i){n.lat=this.location.latitude;n.lng=this.location.longitude}else{if(l){n.lat=this.hometown.latitude;n.lng=this.hometown.latitude}}s=a.travelmap.util.getDistance(c,n,this.locale);if(s){p.distance=s.value;p.distance_unit=s.unit;p.cur_loc_used=i}}else{if(q=="going"){p.end_time="5000-01-01"}}if(m.suppressFeed||(q=="pin"&&f.length>1)){p.no_feed_story=1}if(m.suppressMap||d!="city"||q=="going"||!c.redistributable||q=="pin"&&f.length>1){r=true}this[r?"publishAction":"publishLocatedAction"](q,d,h,p).failure(function(){e=true}).always(function(){if(++g==f.length){k[e?"reject":"resolve"]()}})},this);return k.promise()},visit:function(e,h,g,d){var c=a.util.Deferred();var f={};var i=h.join(",");f.tags=i;if(g){f["fb:explicitly_shared"]=true}this.publishLocatedAction("visit","city",e,f);return c.promise()},removePin:function(e,j){var c=a.util.Deferred();var d=false;var g,f;if(e){g=this.locationToOgType(e.type);f=e.url}if(!(g&&e.url&&j&&j.length)){return c.reject()}var i=Array.prototype.each?"each":"forEach";var h=0;j[i](function(k){var l=k=="been"?"pin":k;var m={};this.deleteActionsByObject(l,g,f).failure(function(){d=true}).always(function(){if(++h==j.length){c[d?"reject":"resolve"]()}})},this);return c.promise()},removeBadge:function(c){var d=false;var f,e;if(c){var f="badge";var e="/MemberTravelMap?ns=badge&badgeId="+c.id}if(!(f&&e)){return new a.util.Deferred().reject()}return this.deleteActionsByObject("earn",f,e)},rate:function(c){var g="rate";var f="attraction";var e=c.url;var d={};if(a.retrieve("feature.ogRefContainsFbid")){d.ref="fbid="+this.id}return this[c.redistributable?"publishLocatedAction":"publishAction"](g,f,e,d)},review:function(e,h,c){var g="review";var f="";if(e.indexOf("/Attraction")==0){f="attraction"}else{if(e.indexOf("/Hotel")==0){f="hotel"}else{if(e.indexOf("/Restaurant")==0){f="restaurant"}}}var d={title:h,body:c};d["fb:explicitly_shared"]=true;return this.publishAction(g,f,e,d)},earnBadge:function(c,f,i){var h="earn";var g="badge";var e="/MemberTravelMap?ns=badge&badgeId="+c;var d={};if(f){d["fb:explicitly_shared"]=true;e+="&story_type=badge_explicit_og"}if(i){d.no_feed_story=true}return this.publishAction(h,g,e,d)},endorseFriend:function(d,c){var h="endorse";var g="friend";var f="/MemberTravelMap?ns=friend&serial="+d;var e={city:"http://"+this.options.hostname+c};return this.publishAction(h,g,f,e)},updateMap:function(c){this._needToScrapeMap=true;if(this._intervalID&&!c){return a.util.Deferred().resolve()}this._intervalID||(this._intervalID=window.setInterval(this.scrapeMap.bind(this),b));return this.options.MapAction.getTravelMapMetaData().always(function(d){var h="publish";var g="map";var f="/MemberTravelMap?ns=map&uid="+this.options.guid;var e={};if(d&&d.tmTotalDistance){e={total_distance:Math.round(d.tmTotalDistance),distance_unit:d.tmDistanceUnit}}if(a.retrieve("feature.ogRefContainsFbid")){e.ref="fbid="+this.id}if(c){e["fb:explicitly_shared"]=true;f+="&story_type=map_explicit_og"}return this.publishAction(h,g,f,e)},this)},shareMapLink:function(){var c={};c.name=tm.hub.messages.myTravelMap;c.link="http://"+this.options.hostname+"/MemberTravelMap?ns=map&uid="+this.options.guid+"&story_type=map_link";c.picture="http://"+this.options.hostname+"/img2/facebook/dlRecentPinned.jpg";return this.postFeed(c)},scrapeMap:function(c){if(this._needToScrapeMap||c){this._needToScrapeMap=false;return this.scrape("http://"+this.options.hostname+"/MemberTravelMap?ns=map&uid="+this.options.guid)}return a.util.Deferred().resolve()}})}(ta));ta.common.wisdomoffriends={reloadASAP:function(){window.location.reload()},showWelcome:function(){ta.store("wof.showWelcome",true)}};if(!ta.popups){ta.popups={}}ta.popups.PopUtil={windowType:{CHECK_RATE:0,PROV_WIN:1,HOLDING:2,COMMERCE:3,VFM:4,COOKIE:5},taPopunderSlots:null,taPopupSlots:null,taHoldingWindowCap:2,taPopWindowSet:[],taWindowCount:0,maxPopunders:4,hwClosed:false,getAndUpWindowCount:function(){return this.taWindowCount++},tryHoldingWindows:function(a,b){try{var g=true;for(var c=0;c<b;c++){var f=this.launchHoldingWindow(a);if(!f.windowObject){g=false}}if(g){return true}}catch(d){ta.util.error.record(d,"try two hw")}return false},getPopunderSlots:function(){if(this.taPopunderSlots===null){this.taPopunderSlots=new ta.popups.PopunderSlotSet()}return this.taPopunderSlots},getPopupSlots:function(){if(this.taPopupSlots===null){this.taPopupSlots=new ta.popups.PopupSlotSet()}return this.taPopupSlots},createCheckRatesWindow:function(a){return this.buildNewWindow(this.windowType.CHECK_RATE,a)},createHoldingWindow:function(b){var a=this.buildNewWindow(this.windowType.HOLDING,b);if(a&&ta.has("checkrates.belligerent_hw")&&Browser.version>22){ta.store("checkrates.popunder",a)}return a},createVFMWindow:function(a){return this.buildNewWindow(this.windowType.VFM,a)},createCookieConsentWindow:function(a){return this.buildNewWindow(this.windowType.COOKIE,a)},buildNewWindow:function(b,d){var a=new ta.popups.TAPopWindow(b,d);if(!a){return false}if(!a.errorOpening&&!a.errorMoving&&a.windowObject){try{if(ta.has("checkrates.add_holding_windows")&&d.windowHook&&d.windowHook.location&&d.windowHook.location.href.test(/RuleBasedPopunder/)){this.taPopWindowSet.unshift(a)}else{this.taPopWindowSet[this.taPopWindowSet.length]=a}if(!d.windowHook&&b==this.windowType.HOLDING){this.trackPopunder(d.url,this.numPopundersCheck())}return a}catch(c){ta.util.error.record(c,"Window Popup - could not register new window")}}return false},getHoldingWindowSet:function(){var e=[];for(var b=0;b<this.taPopWindowSet.length;b++){var a=this.taPopWindowSet[b];if(a&&a.type==this.windowType.HOLDING){var c=a.windowObject;if(c&&"closed" in c){if(!c.closed){e[e.length]=a}else{if(ta.has("checkrates.add_holding_windows")&&c.closed){this.hwClosed=true;var d=window.cookieDomain;if(d){Cookie.write("CommercePopunder","SuppressAll",{domain:d,duration:0})}}}}}}return e},attemptHoldingWindowFromGeoCR:function(){},attemptHoldingWindowWNumChecked:function(){},openCloseTab:function(){var c,d;if(ta.has("popunder.popunder_by_self_closing_tab")){try{d=document.createElement("a");d.href="http://"+window.location.hostname+"/vpages/tab.html";document.body.appendChild(d);c=document.createEvent("MouseEvents");c.initMouseEvent("click",false,true,window,0,0,0,0,0,true,false,false,true,0,null);d.dispatchEvent(c);d.parentNode.removeChild(d)}catch(h){ta.util.error.record(h,"self-closing tab blur method failed")}}else{if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){try{d=document.createElement("a");d.href="about:blank";d.target="popunderwindowhelper";document.body.appendChild(d);c=document.createEvent("MouseEvents");var f=true;var b=true;c.initMouseEvent("click",f,b,window,0,0,0,0,0,true,false,false,true,0,null);d.dispatchEvent(c);d.parentNode.removeChild(d);window.open("about:blank","popunderwindowhelper").close()}catch(h){ta.util.error.record(h,"shift-ctrl blur method failed")}}else{var a=ta.retrieve("checkrates.popunder");if(ta.has("checkrates.belligerent_hw")&&a&&Browser.version>22){var g=window.open("about:blank");if(g){g.close()}ta.remove("checkrates.popunder");try{if(a.windowObject&&a.isTAWindow()){a.moveBehindMain(a.windowObject)}}catch(h){ta.util.error.record(h,"holding window blur")}}}}},attemptHoldingWindow:function(a){if(this.useShiftClick()){return}if(ta.has("checkrates.add_holding_windows")){var b=this.numPopundersCheck();if(b>=this.maxPopunders){return}else{this.launchHoldingWindow(a)}}else{if(this.taHoldingWindowCap>this.getHoldingWindowSet().length){this.launchHoldingWindow(a)}}},launchHoldingWindow:function(a){if(!a){return false}var b=ta.retrieve("checkrates.holdingWindowURI");if(ta.has("checkrates.avlb_popup_win")){b="http://"+window.location.hostname+"/AlsoViewedLB?checkRatesType=checkRates&avlbType=popup&d="+a}if(b){ta.store("checkrates.HWtracking","date");var c={url:b};return this.createHoldingWindow(c)}return false},launchAddHoldingWindow:function(c,a){var b=a||{};b.url=c;return this.createHoldingWindow(b)},popunderReminder:function(b){var a={windowHook:b};this.createHoldingWindow(a)},numPopundersCheck:function(){try{var f=this.getHoldingWindowSet();var b=0;var a=new Cookie("CommercePopunder").readRaw();var d=a?a.match(/\d+/):null;if(!a||!d){b=f.length}else{b=Math.max(f.length,parseInt(d[0],10))}return b}catch(c){ta.util.error.record(c,"CommercePopunder - numPopundersCheck")}},trackPopunder:function(i,h){try{if(!h||!i){return}var c="CommerceEnhancedPopunder";if(i.match(/AlsoViewedLB/)){c="AlsoViewedLB"}else{var a=i.match(/RuleBasedPopunder\?Rule=\d+/);if(a){var d=a[0].match(/\d+/);c="RuleBasedPopunder_"+d[0]}}var b="OpenWindow";var g=ta.retrieve("checkrates.HWtracking");if(g){b="OpenWindow_"+g;ta.remove("checkrates.HWtracking")}ta.trackEventOnPage("CommercePopunder",b,c,h,true)}catch(f){ta.util.error.record(f,"CommercePopunder - trackPopunder")}},trackPopup:function(f){try{if(!f){return}var b="DHTMLOverlay";var g=f.match(/RuleBasedPopup/);if(g){var a=f.match(/Rule=\d+/);if(a){var c=a[0].match(/\d+/);b="RuleBasedPopup_"+c[0]}}ta.trackEventOnPage("Popup","OpenPopup",b,1,true)}catch(d){ta.util.error.record(d,"Popup - trackPopup")}},hasMTPU:function(){try{var c=false;var f=this.getHoldingWindowSet();for(var a=f.length;a--;){var b=f[a].windowObject;if(b&&b.location.href.match(/RuleBasedPopunder/)){c=true;break}}return c}catch(d){ta.util.error.record(d,"CommercePopunder - hasMTPU")}},getProviderWindowDims:function(a,d){var b=null;var f=null;var e=null;var c=null;if(a=="hotels.com"){b=975}if(screen.width>=1280){b=1000;f=897;if(!d){e=0;c=0;if(Browser.chrome){f-=50}else{if(Browser.firefox){f-=87}else{if(Browser.ie){b-=12;f-=179}}}}}return{customWidth:b,customHeight:f,widthOffset:e,heightOffset:c}},useShiftClick:function(){if(ta.has("checkrates.chrome_provider_on_shift_click")){var b=this.getProviderWindowDims();var a=66;if(((window.outerHeight>b.customHeight)||(window.outerWidth>b.customWidth))&&((window.outerHeight<(screen.height-a))&&(window.outerWidth<(screen.width-a)))){ta.store("checkrates.use_chrome_provider_on_shift_click",true);return true}}if(!ta.has("checkrates.cr_provider_on_mousedown")){ta.remove("checkrates.use_chrome_provider_on_shift_click")}return false},expandSidebarWindow:function(c,a,b){if(ta.trackEventOnPage){ta.trackEventOnPage("traffic_acquisition_sidebar","any",a,1)}if(b=="true"){window.moveTo(0,0);window.resizeTo(screen.width,screen.height)}document.getElementById("SliderHolder").style.display="none";document.getElementById("PAGE").style.marginLeft="0px"},cookieSettingsPanel:function(d){if(d){d.stop()}var a={};a.en=451;a.en_UK=834;a.en_IE=835;a.en_ZA=2635;a.sv=720;a.no=721;a.da=1199;a.fr=1197;a.fr_BE=6409;a.fr_CH=6410;a.de=1201;a.de_AT=2719;a.de_CH=6431;a.el=1198;a.it=1202;a.it_CH=6432;a.es=1200;a.pl=1208;a.nl=1209;a.nl_BE=6411;a.fi=2968;a.hu=3049;a.cs=3128;a.sk=3233;a["default"]=451;var b;if(posLocale in a){b="http://info.evidon.com/pub_info/"+a[posLocale]+"?v=1&nt=0"}else{b="http://info.evidon.com/pub_info/"+a["default"]+"?v=1&nt=0"}var c={customWidth:830,customHeight:620,name:"Cookie Consent Tool",url:b,scrollbars:1,menubar:0,toolbar:0,left:0,top:0};ta.popups.PopUtil.createCookieConsentWindow(c)},newWindowFromExitPop:function(b,a){var c=window.open(a,"_blank","height="+screen.height+",width="+screen.width+",toolbar=yes,menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes");if(window.focus){c.focus()}},pollForPartnerLoad:function(a,b,c,d){if(a){setTimeout(function(){var g=null;var f=new Date().getTime()-b.getTime();try{g=a.document}catch(h){}if(!g){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_LOADED",(window.pageServlet||"")+"|"+(d||"")+"|"+(c||""),f)}else{if(f>20000){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_TIMEOUT",(c||""),f)}else{if(a.closed){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_CLOSED",(c||""),f)}else{ta.popups.PopUtil.pollForPartnerLoad(a,b,c,d)}}}},100)}},extractSlotFromCommerceUrl:function(b){if(!b){return 0}var a=b.match("[&|\\?]slot=([^&]*)");return a?a[1]:0},redirectToUrl:function(a,c){if(a){if(ta.retrieve("commerce_history_injection.enabled")&&a.history&&a.history.pushState){try{a.history.pushState({fromBackClick:true},"",window.location.href);ta.trackEventOnPage("COMMERCE_HISTORY_INJECT","history_injected","")}catch(b){ta.util.error.record(b,"commerce history injection failed",null,null,"WARN")}}a.location=c}else{window.location=c}},beforePopTargetBlankIE:function(c){var b,d,a;if(!c||!c.href){return true}b=ta.id(c);if(!b||!b.getProperty||b.getProperty("target")!=="_blank"){return true}if(!ta.browser||!ta.browser.isIE10Metro()){if(ta.browser&&!ta.browser.isIE9orHigher()){a=window.getSize();if(a){d=window.open(c.href,"_blank","location=yes,resizable=yes,menubar=yes,scrollbars=yes,toolbar=yes,width="+a.x+",height="+a.y)}}else{d=window.open(c.href,"_blank")}}if(!d||d.closed||typeof d.closed==="undefined"){b.removeProperty("target");if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38821)}return true}else{return false}},attemptOpenUrlNewTab:function(b){var c;if(!ta.browser||!ta.browser.isIE10Metro()){if(ta.browser&&window.isIE&&!ta.browser.isIE9orHigher()){var a=window.getSize();if(a){c=window.open(b,"_blank","location=yes,resizable=yes,menubar=yes,scrollbars=yes,toolbar=yes,width="+a.x+",height="+a.y)}}else{c=window.open(b,"_blank")}}if(!c||c.closed||typeof c.closed==="undefined"){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38821)}window.location=b;return false}return c}};ta.popups.TAPopWindow=new Class({Implements:Options,options:{name:"TAWin",url:"",windowHook:false,customWidth:false,customHeight:false,toolbar:1,location:1,directories:1,status:1,menubar:ta.browser.isIE9orHigher()?0:1,resizable:1,copyhistory:1,scrollbars:1,alwaysRaised:false,alwaysLowered:false,widthOffset:8,heightOffset:164,delayLoad:false},initialize:function(g,j){var c,i,b;this.setOptions(j);this.type=g;this.assignSlot();if(this.options.customWidth){this.width=this.options.customWidth}if(this.options.customHeight){this.height=this.options.customHeight}if(this.options.widthOffset!=null){this.widthOffset=this.options.widthOffset}if(this.options.heightOffset!=null){this.heightOffset=this.options.heightOffset}if(this.options.delayLoad){this.delayLoad=this.options.delayLoad}if(this.options.windowHook){this.windowObject=this.options.windowHook;if(!ta.has("checkrates.add_holding_windows")){this.windowObject.refresh()}return true}if(ta.has("checkrates.chrome_dates_entry_holding")){this.options.scrollbars=0}this.url=this.options.url;this.assignWinArgs();try{if(this.type==ta.popups.PopUtil.windowType.HOLDING){ta.util.cookie.setPIDCookie(28962)}if(Browser.chrome&&this.options.inTab){var f=Math.random().toString(36).substring(7);if(this.options.popunder){c=document.createElement("a");c.href=this.url;c.target=f;document.body.appendChild(c);i=document.createEvent("MouseEvents");i.initMouseEvent("click",false,true,window,0,0,0,0,0,true,false,false,true,0,null);c.dispatchEvent(i);c.parentNode.removeChild(c);this.windowObject=window.open(this.url,f);return}else{this.windowObject=window.open(this.url,f);return}}if(ta.has("checkrates.use_chrome_provider_on_shift_click")){c=document.createElement("a");c.href=this.url;document.body.appendChild(c);i=document.createEvent("MouseEvents");i.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,true,false,0,null);this.windowObject=c.dispatchEvent(i);c.parentNode.removeChild(c)}else{if(this.type==ta.popups.PopUtil.windowType.HOLDING&&ta.has("popunder.popunder_by_self_focus")){window.open("javascript:window.focus()","_self","")}var a=Browser.chrome&&Browser.version>31;if(a){this.windowObject=window.open("","_blank")}else{if(this.options.popunder){if(Browser.ie8||Browser.ie9||Browser.ie10||Browser.ie11){this.windowObject=window.open("pages/blank.html","_blank",this.winArgs);window.document.focus()}else{if(Browser.safari&&Browser.Platform.name!=="ios"){this.windowObject=window.open("","_blank",this.winArgs);if(this.windowObject){var h=window.open("","_blank");h.close()}window.focus()}else{if(Browser.firefox){this.windowObject=window.open("","_blank",this.winArgs);window.open("","_self","");window.focus()}else{this.windowObject=window.open("","_blank",this.winArgs)}}}}else{this.windowObject=window.open("","_blank",this.winArgs)}}b=this.windowObject;if(b&&this.isTAWindow()){if(this.type==ta.popups.PopUtil.windowType.CHECK_RATE){ta.popups.PopUtil.pollForPartnerLoad(b,new Date(),this.options.name,ta.popups.PopUtil.extractSlotFromCommerceUrl(this.options.url))}if(!this.delayLoad){ta.popups.PopUtil.redirectToUrl(this.windowObject,this.url)}}else{if(!b&&Browser.ie&&this.type===ta.popups.PopUtil.windowType.CHECK_RATE&&this.url&&ta.has("ta.ie_commerce_popup_block_fix")){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38822)}window.location=this.url}}}}catch(d){this.errorOpening=d;ta.util.error.record(this.errorOpening,"pop window opening failure",null,{type:this.type,url:this.url})}try{b=this.windowObject;if(b&&this.isTAWindow()){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.moveBehindMain(b)}}}catch(d){this.errorMoving=d;ta.util.error.record(this.errorMoving,"popunder window moving",null,{type:this.type,url:this.url})}},repurpose:function(d,b,f){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.type=ta.popups.PopUtil.windowType.CHECK_RATE;this.slot.occupied=false;this.assignSlot();this.url=d;if(b){this.width=b;this.options.widthOffset=0}if(f){this.height=f;this.options.heightOffset=0}var a=this.windowObject;if(a&&this.isTAWindow()){try{if(!this.options.inTab){a.moveTo(0,0);a.resizeTo(this.width+this.options.widthOffset,this.height+this.options.heightOffset);a.moveTo(this.x,this.y)}if(!this.delayLoad&&!this.options.keepFocus){a.focus()}if(!this.delayLoad){a.location=this.url}}catch(c){ta.util.error.record(this.errorMoving,"repurpose popunder fail",null,{type:this.type,url:this.url})}}return this}return false},assignWinArgs:function(){this.winArgs="toolbar="+this.options.toolbar;this.winArgs+=",location="+this.options.location;this.winArgs+=",directories="+this.options.directories;this.winArgs+=",status="+this.options.status;this.winArgs+=",menubar="+this.options.menubar;this.winArgs+=",resizable="+this.options.resizable;this.winArgs+=",copyhistory="+this.options.copyhistory;this.winArgs+=",scrollbars="+this.options.scrollbars;this.winArgs+=",width="+this.width;this.winArgs+=",height="+this.height;this.winArgs+=",left="+this.x;this.winArgs+=",top="+this.y;this.winArgs+=",screenx="+this.x;this.winArgs+=",screeny="+this.y;if(this.options.alwaysRaised){this.winArgs+=",alwaysRaised"}if(this.options.alwaysLowered){this.winArgs+=",alwaysLowered"}},assignSlot:function(){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.slot=ta.popups.PopUtil.getPopunderSlots().getOpenSlot();this.width=this.slot.tw;this.height=this.slot.th;this.x=this.slot.tx;this.y=this.slot.ty}else{this.slot=ta.popups.PopUtil.getPopupSlots().getOpenSlot();this.width=this.slot.w+this.options.widthOffset;this.height=this.slot.h+this.options.heightOffset;this.x=this.slot.x;this.y=this.slot.y}this.slot.occupied=this},moveBehindMain:function(c){if(!ta.has("popunder.popunder_by_self_focus")||ta.has("popunder.popunder_by_self_focus_shift_ctrl")){if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){ta.popups.PopUtil.openCloseTab()}else{if(ta.has("checkrates.chrome_dates_entry_holding")&&!(ta.has("checkrates.belligerent_hw")&&Browser.version>22)){try{var a=window.open("about:blank");if(a){a.focus();a.close()}}catch(b){ta.util.error.record(b,"holdingWindow - Chrome blur failed")}}}}c.blur();c.opener=self;c.moveTo(this.slot.x,this.slot.y);c.resizeTo(this.slot.w,this.slot.h);if(!this.delayLoad){c.location=this.url}window.focus();if(!document.activeElement.hasClass("globalNav2011_reset")){ta.trackEventOnPage("checkrates","no_focus_on_main",Browser.version,1)}},isTAWindow:function(){var c=true;try{var a=this.windowObject.location;this.windowObject.status="";if(a===null||a===""){c=false}}catch(b){c=false}return c}});ta.popups.Slot=new Class({initialize:function(c,b,d,a){this.x=c;this.y=b;this.w=d;this.h=a;this.occupied=null}});ta.popups.SlotSet=new Class({initialize:function(){this.nW=525;this.nH=460;this.nXI=24;this.nYI=24;this.totalSlots=20;this.slots=[];try{if(screen.width>1024){this.nW=800;this.nH=600;this.nXI=80;this.nYI=40}else{if(screen.width>800){this.nW=620;this.nH=500;this.nXI=60;this.nYI=30}}}catch(a){this.error=a;ta.util.error.record(this.error,"slot set",null,{"slot set":"general"})}},getUsedCount:function(){var b=0;if(this.slots){for(var a=0;a<this.slots.length;a++){if(this.slots[a].occupied&&!this.slots[a].occupied.closed){b++}}}return b},getOpenSlot:function(f){if(!f||f<0||f>this.totalSlots){f=0}var d=function(l){try{var h=false;var j=false;try{j=this.slots[l].occupied}catch(k){}if(!j){h=true}else{try{var g=j.windowObject;if(!g||g.closed){h=true}}catch(k){h=true}}}catch(k){ta.util.error.record(k,"get open slot - get pop slot",null,{totalSlots:this.totalSlots,slotNumber:l})}if(h){this.slots[l].occupied=null;var i=this.slots[l];i.slotPos=l;return i}return false}.bind(this);try{for(var a=f-1;a>=0;a-=1){var c=d(a);if(c){return c}}for(var a=f;a<this.slots.length;a++){var c=d(a);if(c){return c}}}catch(b){ta.util.error.record(b,"get open slot",null,{totalSlots:this.totalSlots})}return false}});ta.popups.PopunderSlot=new Class({Extends:ta.popups.Slot,initialize:function(b,i,d,f,c,a,e,g){this.parent(b,i,d,f);this.tx=c;this.ty=a;this.tw=e;this.th=g}});ta.popups.PopupSlotSet=new Class({Extends:ta.popups.SlotSet,initialize:function(){this.parent();this.nX=500;var b=1160;try{if(screen.width<1660){if(screen.width>1024&&screen.width<1280){b=960}else{if(screen.width<=1024){b=740}}this.nX=screen.width-b}this.nY=!isNaN(window.screenTop)?window.screenTop:!isNaN(window.screenY)?window.screenY:0}catch(c){this.error=c;this.nY=0;ta.util.error.record(this.error,"slot set",null,{"slot set":"popup"})}for(var a=0;a<this.totalSlots;a++){this.slots[a]=new ta.popups.Slot(this.nX,this.nY,this.nW,this.nH);this.nX=this.nX+this.nXI;this.nY=this.nY+this.nYI}}});ta.popups.PopunderSlotSet=new Class({Extends:ta.popups.PopupSlotSet,initialize:function(){this.parent();try{this.nX=(window.screenLeft||window.screenX);this.nY=(window.screenTop||window.screenY)}catch(b){this.error=b;this.nX=200;this.nY=200}this.w=1;this.h=1;this.x=5000;this.y=5000;this.totalSlots=4;try{if(Browser.ie7){this.w=250;this.h=100}if(Browser.safari||Browser.chrome){this.w=85;this.h=100}if(typeof(this.nX)=="undefined"){this.nX=0;this.nY=0;this.x=this.nX+window.screen.availWidth-this.w;this.y=this.nY+window.screen.availHeight-this.h}else{this.x=this.nX+window.getWidth()-this.w;this.y=this.nY+window.getHeight()-this.h}if(Browser.ie7){this.y=this.y-95;this.x=this.x+13}else{if(Browser.safari||Browser.chrome){this.y=this.y-16}}}catch(b){this.error=b}if(this.error){ta.util.error.record(this.error,"slot set",null,{"slot set":"popunder"})}for(var a=0;a<this.totalSlots;a++){this.slots[a]=new ta.popups.PopunderSlot(this.nX,this.nY,this.nW,this.nH,this.x,this.y,this.w,this.h);this.nX=this.nX+this.nXI;this.nY=this.nY+this.nYI}}});window.setupLazyLoad=function(){var a=new LazyLoad({range:200},lazyImgs,lazyHtml);return a};var LazyLoad=new Class({Implements:[Options,Events],options:{range:200,fireScroll:true,mode:"vertical"},initialize:function(n,l,o){this.setOptions(n);this.container=window;var b=(this.options.mode=="vertical"?"y":"x");this.containerDimension=this.container.getSize()[b];this.start=0;var k=this.containerDimension+this.options.range;var j=ta.retrieve("ta.commerce.obf");if(j){try{var h=j.given.split("");var f=j.replace.split("");var d=j.token}catch(i){ta.util.error.record(i,"obfuscation object corrupted")}}var m=0;this.htmlBlocks=o.filter(function(r){var q=ta.id(r.id);if(q&&(q.getPosition()[b]>k&&r.scroll)){m++;return true}else{if(q){try{var u=r.data.indexOf(d);if(j&&u==0){var s=r.data.substr(d.length).split("");for(var p=s.length;p--;){var t=s[p];var u=f.indexOf(t);if(u!=-1){s[p]=h[u]}}q.innerHTML=s.join("")}else{q.innerHTML=r.data}}catch(v){ta.util.error.record(v,"lazy html",null,{id:r.id})}return false}else{return false}}},this);var c=0;this.images=l.filter(function(p){var e=ta.id(p.id);if(e){e.oSRC=p.src||p.data;e.priority=p.priority||1000;if(p.logerror){e.onerror=function(){ta.util.error.record(new Error("lazy img did not load from "+e.src),null,null,null,"WARN")}}if(!this.preferredImage(e)){return false}if((!e.isVisible()||e.getPosition()[b]>k)&&p.scroll){c++;return true}else{ta.queueLazyImg(e);return false}}else{return false}},this);ta.processLazyImages();var a=function(e){var p=this.getScroll();if(e=="force"||p>this.start){this.load();this.start=p}this.fireEvent("scroll");if(!this.images.length){this.container.removeEvent("scroll",a);this.fireEvent("complete")}}.bind(this);this.load=function(){this.htmlBlocks=this.htmlBlocks.filter(function(q){try{var p=ta.id(q.id);if((p&&p.getPosition&&((this.getScroll()+this.options.range+this.containerDimension)>=p.getPosition()[b]))||(p&&!p.getPosition)){p.innerHTML=q.data;return false}}catch(r){ta.util.error.record(r,"lazy",null,{id:q.id})}return true},this);this.images=this.images.filter(function(q){try{var p=ta.id(q.id);if(p&&!this.preferredImage(p)){return false}if((p&&p.getPosition&&((this.getScroll()+this.options.range+this.containerDimension)>=p.getPosition()[b]))||(p&&!p.getPosition)){ta.queueLazyImg(p);return false}}catch(r){ta.util.error.record(r,"lazy",null,{src:q.src})}return true},this);ta.processLazyImages()}.bind(this);var g=function(){var e=this.container.getSize()[b];if(e>this.containerDimension){this.containerDimension=e;this.load()}}.bind(this);this.container.addEvent("scroll",a);this.container.addEvent("resize",g);if(this.options.fireScroll){this.container.fireEvent("scroll")}},getScroll:function(){if(this.container&&this.container.getScroll){return this.container.getScroll()[this.options.mode=="vertical"?"y":"x"]}else{return 9000}},preferredImage:function(b){if(!b.hasClass("hasImage2x")&&!b.hasClass("image2x")){return true}var a=window.devicePixelRatio&&window.devicePixelRatio>=1.5;var c=(!a&&b.hasClass("hasImage2x"))||(a&&b.hasClass("image2x"));b.toggleClass("hidden",!c);return c}});var TypeAhead=(function(f){var F={results:null,showOnEmpty:false,integrate:false,highlight:false,maxItems:5,types:["geo","eatery","hotel","attraction"],linkType:"url",predicate:null,minChars:null,sort:null,shouldReplace:true,getMatchingKey:function(W){return W.value},bottom:false};var R={minChars:1,search:null,itemTemplate:function(W){return W&&W.value},listTemplate:function(X){var W=X.results?X.results:X;return'<div class="typeahead-choices">'+W.map(function(Z,Y){return'<div class="typeahead-choice">'+Z.rendered+"</div>"}).join("")+"</div>"},errorTemplate:function(W){return'<div class="message">'+W+"</div>"},resolveSelection:function(W){return W&&W.value},equal:function(X,W){return X.value==W.value},shouldSubmit:function(){return true},validator:null,containerClass:"typeahead-container",itemSelector:".typeahead-choice",errorClass:"error",defaultTextClass:false,defaultValue:null,width:true,showOnFocus:true,searchOnFocus:true,onUserFocus:null,autoSelectFirst:false,selectOnBlur:true,assumeOnBlur:true,onUserBlur:null,restoreOnFocus:false,cycleInput:true,autopopulateHighlighted:true,selectInputText:true,onSelect:null,onRestore:null,onSync:null,onRender:null,onShow:null,onHide:null,onError:null,nextField:null,offsetY:0,offsetX:0,syncro:null,containerParent:document.body,positionRelative:false,unselectOnEscape:false,cacheResults:false,autoHighlightFirst:false,ignoreKeysWhenInvisible:false,name:"unknown",geoId:undefined,startEventOn:"focus",queryLengthLimit:100,postResultsFnList:null,jpFirefoxIME:false,jpFirefoxIMEInterval:500,clearDefaultTextOnFocus:true,focusOnCreation:false,searchParams:null,errorOnSearchFailure:"error",enableQueryDelay:false,throttleRequests:false,doSelectionBeforeLogging:false,highlightInputOnFocus:false,staticResults:null},T=8,P=9,I=13,q=16,l=17,n=18,G=20,o=27,y=37,Q=38,C=39,E=40,z=46,A=91,e="click",t="enter",u="tab";var a=function(W){return(W&&W.searchSessionId)?W.searchSessionId:"no_search_session_id"};var j;var D=function(){if(j){if(typeof j.abort==="function"){j.abort()}j=null}};var p=function(W){j=W};var K=function(X){D();var W=ta.util.Deferred();var aa=this.getSearchParams();var Y=this;aa.query=X;aa.action="API";aa.uiOrigin=this.options.name;aa.source=this.options.name;aa.startTime=this.options.startTime;aa.searchSessionId=a(this.options);var Z={method:"GET",url:"/TypeAheadJson",data:aa};if(this.options.throttleRequests){Z.onRequestCreated=function(ab){p(ab)}}new ta.util.ajax(Z).always(function(ab){if(ab){if(ab.status!=="error"&&ab.code!==0){W.resolve(ab)}}else{W.reject(Y.options.errorOnSearchFailure)}});return W.promise()};var M=function(){return this.source.value};var h=function(Y){var W=0;for(var X=this.source.value.length-1;X>=0;X--){W++;var Z=this.source.value.charCodeAt(X);if((Z>=19968&&Z<=40959)||(Z>=12352&&Z<=12543)||(Z>=44032&&Z<=55295)){W++}if(!Y&&W>=this.options.minChars){return true}}return Y?W:false};var s=function(){var X=this.source;var W=undefined;if(this.hasDefaultText()){if(this.options.clearDefaultTextOnFocus===true){W=X.value.length}else{W=0}}else{if(this.options.highlightInputOnFocus){W=X.value.length}}if(W!==undefined){window.setTimeout(function(){if(document.activeElement==X){X.setSelectionRange(0,W)}},0)}};var k=function(Y){if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus!==true){f.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}if(this.options.startEventOn==="type"){m.call(this)}if(this.options.ignoreKeysWhenInvisible&&!this.visible){return}switch(Y.keyCode){case I:Y.preventDefault();Y.stopPropagation();if(this.selectedIndex>=0){this.select(true,t,Y);B.call(this)}else{if(this.options.assumeOnBlur&&this.results&&this.results.length){if(typeof this.options.assumeOnBlur=="function"){this.setSelectedIndex(this.options.assumeOnBlur(this))}else{this.setSelectedIndex(0)}S.call(this);this.select(true,t,Y);B.call(this)}if(this.options.shouldSubmit()){if(!this.options.validator||this.options.validator(Y)){if(this.options.onSubmit){var X=ta.common.search.getUrlFromForm(this.source.form);var W=event?event.type:"";this.options.onSubmit(this,X,true,W)}this.abortSearch();this.hide();this.source.form.submit()}}}break;case E:this.highlightNextChoice();Y.preventDefault();Y.stopPropagation();break;case Q:this.hightlightPreviousChoice();Y.preventDefault();Y.stopPropagation();break;case o:this.restore();this.hide();break;case P:if(this.options.selectOnTab&&this.selectedIndex>=0){Y.preventDefault();Y.stopPropagation();this.select(true,u,Y);B.call(this)}else{this.tabPressed=true}break}if(this.options.onKeyDown){this.options.onKeyDown(Y,this)}};var O=function(W){setTimeout(L.bind(this),0)};var c=function(W){if(W){switch(W.keyCode){case P:case q:case l:case n:case G:case y:case Q:case C:case E:case A:case I:case o:return}}L.call(this)};var g=function(){var W=this.source.value;if(this.intervalHandler){window.clearTimeout(this.intervalHandler)}if(!this.options.enableQueryDelay||this.lastQueryTime+500<=new Date().getTime()){this.intervalHandler=null;this.search()}else{this.intervalHandler=setTimeout(function(){if(!this.aborted&&this.source.value===W){this.search()}}.bind(this),this.options.throttleRequests?50:300)}};var x=function(){var W=this.results&&this.results.length===0;return !this.hasDefaultText()&&h.call(this)&&this.source.value!==this.query&&(this.selectedIndex<0||!this.results||W||this.source.value!==this.results[this.selectedIndex].value)};var L=function(){D();if(!x.call(this)&&h.call(this,true)<this.options.minChars){this.selected&&f.removeClass(this.selected,"selected");f.removeClass(this.source,this.options.errorClass);this.results=null;this.error=null;this.setSelectedIndex(-1);this.selected=null;this.query=null;this.staticResultsShown=null;var W=this.source&&(!this.source.value||J(this.source.value).trim().length==0);if(this.shouldShowStaticResults()&&(W||this.hasDefaultText())){this.showStaticResultsIfEnabled()}else{this.hide()}}else{g.call(this,this.query)}};var N=function(W){if(!(this.results&&this.results.length)){return}this.setSelectedIndex(this.selectedIndex+W);if(this.selectedIndex>=this.results.length){this.setSelectedIndex(this.options.cycleInput?-1:0)}else{if(this.selectedIndex<(this.options.cycleInput?-1:0)){this.setSelectedIndex(this.results.length-1)}}S.call(this)};var S=function(){this.selected&&f.removeClass(this.selected,"selected");if(-1===this.selectedIndex){this.selected=null;this.options.autopopulateHighlighted&&this.query&&(this.source.value=this.query);this.options.selectInputText&&this.source.select(false)}else{this.selected=this.items[this.selectedIndex];f.addClass(this.selected,"selected");this.options.autopopulateHighlighted&&this.results&&(this.source.value=this.options.resolveSelection(this.results[this.selectedIndex]))}};var d=function(Y,X){if(!X){return false}for(var W=0;W<X.length;++W){var Z=X[W];if(Z&&Z.match(Y)){return true}}return false};var w=function(af,ap,ah,an,ad,am,ae,al,aq,ai,aa,aj,ak,ab,X,ag,ac,Z,W){var ao={action:"RECORD",eventType:af,uiOrigin:aq,global:al<=1,scope:al>1?al:undefined,fromHistory:aj,hadHistory:ak,type:ag.type,value:ap,indexInType:ag.indexInType?ag.indexInType:0,tagId:ag.tagId?ag.tagId:0,source:aq,startTime:ai,selDepth:ah,isChild:ag.isChild,totalNum:an,userInteractionType:am,errors:ae,query:aa,dataType:ag.data_type,url:ag.url,searchSessionId:Z};var Y;if(typeof ad==="function"){if(ac){ad();if(typeof X==="function"){Y=X}}else{Y=function(){ad();if(typeof X==="function"){X()}}}}if(typeof ab==="function"){ao=ab(ao,ag,W)}new Request({method:"GET",url:"/TypeAheadJson",data:ao,onSuccess:Y,onFailure:Y}).send()};var m=function(){if(!this.startNotificationSent){this.startNotificationSent=true;var W=new Date();this.options.startTime=W.getTime();var X=this.options.geoId;var Y=this.options.name;var Z=this.options.staticResults&&this.options.staticResults.history&&this.options.staticResults.history.results&&this.options.staticResults.history.results.length;new Request({method:"GET",data:{action:"RECORD",eventType:"start",uiOrigin:this.options.name,startTime:this.options.startTime,source:Y,linkedTypeAhead:this.options.linkedTypeAhead?this.options.linkedTypeAhead.options.startTime:void 0,global:X?false:true,hadHistory:Z,scope:X,searchSessionId:a(this.options)},url:"/TypeAheadJson"}).send();if(this.options.trackingName&&ta.tracking.typeahead.entryEventRecorded==false){ta.tracking.typeahead.entryEventRecorded=true;ta.trackEventOnPage("desktop_typeahead","typeahead_entry",this.options.trackingName)}}};var H=function(X){if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus===true){f.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}s.call(this);if(!this.autoFocusing){if(this.options.onUserFocus){this.options.onUserFocus(this)}var W=this.lastSuccessfulQuery!==this.query;if(this.options.showOnFocus&&(!W)){this.show()}if(this.options.restoreOnFocus){this.restore()}if(this.options.showOnFocus&&this.options.searchOnFocus&&this.query&&!this.results&&!this.error&&h.call(this)){this.search()}if(this.options.jpFirefoxIME){V.call(this)}this.showStaticResultsIfEnabled()}if(this.options.startEventOn==="focus"){m.call(this)}this.autoFocusing=false};var V=function(){if(this.source==document.activeElement){var W=function(){L.call(this);if(this.jpTypeAheadTimerId){clearTimeout(this.jpTypeAheadTimerId)}this.jpTypeAheadTimerId=setTimeout(W.bind(this),this.options.jpFirefoxIMEInterval)};W.call(this)}};var v=function(aa,W){if(this.checkMenuInteraction()){return}this.hide();var X=this.tabPressed;this.tabPressed=false;if(!this.options.restoreOnFocus&&!this.query){this.results=null;this.error=null;this.setSelectedIndex(-1);this.selected=null;this.items=[];this.container&&this.container.empty()}var Z=this.options.selectOnBlur&&-1!==this.selectedIndex;if(Z){this.select(X,X?u:undefined,aa)}var Y=this.options.autoSelectFirst?0:-1;if(this.options.assumeOnBlur&&Y===this.selectedIndex&&this.results&&this.results.length){if(typeof this.options.assumeOnBlur=="function"){this.setSelectedIndex(this.options.assumeOnBlur(this))}else{this.setSelectedIndex(0)}S.call(this);!Z&&this.select(X,X?u:undefined,aa)}if(this.source&&this.source.value===""){this.source.value=this.options.defaultValue;if(this.options.defaultTextClass){f.addClass(this.source,this.options.defaultTextClass)}}if(this.options.onUserBlur){this.options.onUserBlur(this,aa)}if(this.jpTypeAheadTimerId){clearTimeout(this.jpTypeAheadTimerId)}};var b=function(Y){var X=Y.target;if(X.getParent(this.options.itemSelector)){X=X.getParent(this.options.itemSelector)}if(this.selected&&this.selected===X){return}for(var W=this.items.length-1;W>=0;W--){if(this.items[W]===X){this.setSelectedIndex(W);S.call(this);return}}};var B=function(){var W=this.source.tabIndex,Y;if(false===this.options.nextField){return}if(this.options.nextField){if(typeof this.options.nextField==="string"){this.options.nextField=f.find(this.options.nextField)}else{if(typeof this.options.nextField==="function"){Y=this.options.nextField(this)}else{Y=this.options.nextField}}}if(false===Y){return}if(!Y&&W){W=parseInt(W,10)+1;Y=f.find("[tabindex="+W+"]",this.source.form)}if(!Y){for(var X=this.source.form.elements.length-1;X>=0;X--){var Z=this.source.form.elements[X];if(this.source===Z){Y=this.source.form.elements[X+1];break}}}Y&&Y.focus()};var r=function(){this.options.syncro&&this.options.syncro.sync(this,{query:this.query,value:this.source.value,result:this.selectedIndex>=0&&this.results[this.selectedIndex]})};var U=function(){(document.activeElement===this.source&&!this.aborted&&this.show())||v.call(this)};var i=function(X,af){this.setSource(X);this.lastQueryTime=0;var W=false;this.checkMenuInteraction=function(){return W};if(!R.containerParent){R.containerParent=document.body}this.options=f.extend({},R,af);this.options.postResultsFnList=this.options.postResultsFnList||[];if(this.options.postResultsFn){this.options.postResultsFnList.unshift(this.options.postResultsFn);delete this.options.postResultsFn}if(this.options.staticResults){for(var ad in this.options.staticResults){if(!this.options.staticResults.hasOwnProperty(ad)){continue}var ac=this.options.staticResults[ad];this.addStaticResults(ad,ac)}}this.staticResultsShown=null;this.setSelectedIndex(-1);this.selected=null;this.visible=false;this.lastSuccessfulQuery="";if(!this.options.defaultValue&&this.options.defaultValue!=""){this.options.defaultValue=this.source.getAttribute("data-defaultValue")||this.source.defaultValue}var ae="position: absolute";if(f.find("body").hasClass("rtl")){ae+="; right: -999em"}else{ae+="; left: -999em"}ae+="; "+(typeof this.options.positionRelative==="string"?this.options.positionRelative:"top")+":-999px";this.container=f.createElement("div",{"class":this.options.containerClass,style:ae});this.options.containerParent.appendChild(this.container);var Z=function(ag){W=true;ag.stopPropagation();ag.preventDefault()};var ab=function(ag){W=false;ag.stopPropagation();ag.preventDefault();this.select(true,e,ag);B.call(this)};this.containerHandlers={mousedown:f.bind(Z,this),click:f.bind(ab,this)};if(window.FastClick){this.containerHandlers.touchstart=f.bind(b,this);this.containerHandlers.touchend=f.bind(ab,this)}for(var aa in this.containerHandlers){f.addEvent(this.container,aa,this.containerHandlers[aa])}if(true===this.options.width){this.container.style.width=f.getSize(this.source).x+"px"}f.bindAll(this,"cleanUp","show","hide","processResults","renderResults","renderError");this.options.syncro&&this.options.syncro.add(this);var Y=document.activeElement===this.source;if(this.options.showOnFocus&&Y){if(this.hasDefaultText()){if(this.options.clearDefaultTextOnFocus===true){f.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}else{f.addClass(this.source,this.options.defaultTextClass)}}if(this.options.searchOnFocus&&this.source.value!==this.options.defaultValue&&h.call(this)){if(this.source.value!==this.query){this.highlightResult=this.source.value}this.query&&(this.source.value=this.query);this.search()}}if(!Browser.ie11){if(window.onpagehide||null===window.onpagehide){window.addEventListener("pagehide",this.cleanUp,false)}else{f.addEvent(window,Browser.ie?"unload":"beforeunload",this.cleanUp)}}if(this.options.jpFirefoxIME){V.call(this)}if(this.options.startEventOn==="creation"||(this.options.startEventOn==="focus"&&Y)){m.call(this)}if(this.options.focusOnCreation===true){this.autoFocusing=true;this.source.focus()}s.call(this)};i.prototype.getInputText=M;i.prototype.getInputLength=h;i.prototype.searchFn=K;i.prototype.setGeoId=function(W){this.options.geoId=W;this.clearCache();this.lastSuccessfulQuery=""};var J=function(W){return W&&W.replace(/\s+/g," ")};i.prototype.setSource=function(W,Y){if(!W||(this.source&&!Y)){return}this.source=W;this.source.autocomplete="off";this.handlers={keyup:f.bind(c,this),focus:f.bind(H,this),blur:f.bind(v,this)};if(window.FastClick){this.handlers.touchstart=f.bind(b,this)}this.handlers[f.checkBrowser("ie","safari","chrome")?"keydown":"keypress"]=f.bind(k,this);for(var X in this.handlers){f.addEvent(this.source,X,this.handlers[X])}this.source.addEventListener&&this.source.addEventListener("paste",O.bind(this));this.source.addEventListener&&this.source.addEventListener("cut",O.bind(this))};i.prototype.getNormalizedQuery=function(){if(this.query){return J(this.query)}else{return this.query}};i.prototype.reset=function(){if(this.options.defaultTextClass){f.addClass(this.source,this.options.defaultTextClass)}f.removeClass(this.source,this.options.errorClass);this.error=null;this.container&&this.render("");this.source.value=this.options.defaultValue||""};i.prototype.getChosenResult=function(){var X=null;if(this.source&&this.source.value&&this.results){var Z=this.source.value;for(var Y=0;Y<this.results.length;Y++){var W=this.results[Y];if(Z.toLowerCase()===ta.util.string.stripHTMLFromText(W.name).toLowerCase()){X=W;break}}}return X};i.prototype.clearResults=function(){this.query="";this.render("")};i.prototype.search=function(Z,ad){this.selected=null;this.lastQueryTime=new Date().getTime();this.setSelectedIndex(-1);this.query=this.source.value;var ab=this.getNormalizedQuery();this.aborted=false;if(this.options.cacheResults&&this.resultsCache&&this.resultsCache[ab]){this.processResults(this.resultsCache[ab],true);if(false!==Z){U.call(this)}ad&&ad()}else{var ac;if(this.query.length<=this.options.queryLengthLimit){if(this.options.search){ac=this.options.search(this.query,this)}else{ac=K.call(this,this.query)}}else{var W=ta.util.Deferred();var aa={results:[],query:{query:this.query}};W.resolve(aa);ac=W.promise()}ac=ac.success(this.integrateStaticResults.bind(this));var X=this.options.postResultsFnList;for(var Y=0;Y<X.length;Y++){ac=ac.success(X[Y])}ac=ac.success(this.processResults).failure(this.renderError);if(false!==Z){ac.always(f.bind(U,this))}ad&&ac.always(ad)}};i.prototype.processResults=function(ac,Y){var ab=this.options.itemTemplate,X=this;Y=this.options.forceProcessResults||Y;var W=!!ac.results;if(!W){ac={results:ac,query:{query:this.query}}}var Z=ac.results;if(this.options.cacheResults&&W){var aa=J(ac.query&&ac.query.query?ac.query.query:this.getNormalizedQuery());if(!this.resultsCache){this.resultsCache={}}this.resultsCache[aa]=ac}if(Y||this.getNormalizedQuery()!==J(this.lastSuccessfulQuery)){this.results=Z;this.error=null;this.setSelectedIndex(-1);if(this.options.autoHighlightFirst){this.setSelectedIndex(0)}Z.forEach(function(ae,ad){ae.index=ad;ae.rendered=ab(ae);if(X.highlightResult&&X.highlightResult===X.options.resolveSelection(ae)){X.setSelectedIndex(ad)}if(X.options.onProcessResult){X.options.onProcessResult(ae,ad,X)}})}this.renderResults(ac,null,Y)};i.prototype.renderResults=function(ac,Z,Y){if(Y||this.getNormalizedQuery()!==J(this.lastSuccessfulQuery)){var X=this;var ab=ac.results?ac.results:ac;this.lastSuccessfulQuery=ac.query&&ac.query.query?ac.query.query:null;f.removeClass(this.container,this.options.errorClass);f.removeClass(this.source,this.options.errorClass);var W=this.options.listTemplate(ac);if(Z){var ad=new Element("div");var aa=[Elements.from(this.options.errorTemplate(Z))];if(typeOf(W)=="string"){W=Elements.from(W)}aa.push(W);aa.flatten();ad.adopt(aa);W=ad}this.render(W);this.items=f.select(this.options.itemSelector,this.container);this.items.forEach(function(ae){f.addEvent(ae,"mouseover",f.bind(b,X))});if(this.selectedIndex>=0){S.call(this)}else{this.options.autoSelectFirst&&this.highlightNextChoice()}this.options.onRender&&this.options.onRender(this,ab)}};i.prototype.setSelectedIndex=function(W){this.selectedIndex=W;if(this.options&&this.options.onSetSelectedIndex){this.options.onSetSelectedIndex(W,this)}};i.prototype.renderError=function(W,X){if(X&&this.results){this.renderResults(this.results,W)}else{this.results=null}this.error=W;f.addClass(this.container,this.options.errorClass);f.addClass(this.source,this.options.errorClass);!X&&this.render(this.options.errorTemplate(W));this.options.onError&&this.options.onError(this,W)};i.prototype.render=function(W){if(!this.container){return}if(typeOf(W)=="string"){this.container.innerHTML=W}else{if(typeOf(W)=="element"){this.container.empty();this.container.appendChild(W)}}};i.prototype.show=function(){if(!this.container||this.visible||!this.container.childNodes.length){return this}var Y=f.getPosition(this.source),W=f.getSize(this.source);if(this.options.positionRelative){if(f.find("body").hasClass("rtl")){this.container.style.right="auto"}else{this.container.style.left=(this.options.offsetX||0)+"px"}if(typeof this.options.positionRelative==="string"){this.container.style[this.options.positionRelative]=(W.y+(this.options.offsetY||0))+"px"}else{this.container.style.top=(W.y+(this.options.offsetY||0))+"px"}}else{this.container.style.right="auto";this.container.style.left=Y.x+(this.options.offsetX||0)+"px";if(this.options.positionAbove){var X=f.getSize(this.container);this.container.style.top=(Y.y-X.y+(this.options.offsetY||0))+"px"}else{this.container.style.top=(Y.y+W.y+(this.options.offsetY||0))+"px"}}this.visible=true;this.hasBeenShown=true;this.options.onShow&&this.options.onShow(this);if(this.options.onResize){this._resizeCb=this.options.onResize.bind(null,this);window.addEvent("resize",this._resizeCb)}return this};i.prototype.hide=function(){if(!this.visible||!this.container){return false}if(f.find("body").hasClass("rtl")){this.container.style.right="-999em"}else{this.container.style.left="-999em"}this.container.style[typeof this.options.positionRelative==="string"?this.options.positionRelative:"top"]=-999;this.visible=false;this.options.onHide&&this.options.onHide(this);if(this._resizeCb){window.removeEvent("resize",this._resizeCb);this._resizeCb=null}return this};i.prototype.highlightNextChoice=function(){N.call(this,1)};i.prototype.hightlightPreviousChoice=function(){N.call(this,-1)};i.prototype.select=function(W,Z,ai){this.hide();if(this.selectedIndex<0||!this.results){return}this.source.value=this.options.resolveSelection(this.results[this.selectedIndex]);if(this.error){f.removeClass(this.container,this.options.errorClass);f.removeClass(this.source,this.options.errorClass);this.error=null;this.renderResults(this.results)}var ad;if(this.options.onSelect){ad=this.options.onSelect.bind(this.options,this.results[this.selectedIndex],this.source.value,this,W,Z,ai)}if(W){var aj=this.results[this.selectedIndex];var ah=0;if(this.results){ah=this.results.length}var ae=this.lastSuccessfulQuery?this.lastSuccessfulQuery:this.query;var ag=aj.scope==="history";var ab=this.options.loggingOverride;if(ab){ab=ab.bind(this)}var ac=this.options.onSelectNavigate;if(ac){ac=ac.bind(this)}var af=this.staticResultsShown&&this.staticResultsShown.history;var aa=this.options.doSelectionBeforeLogging;var Y=a(this.options);var X=ta.common.search.getUrlFromForm(this.source.form);if(aj.type==="SEARCH"){w("search_bttn",undefined,undefined,undefined,ad,Z,null,this.options.geoId,this.options.name,this.options.startTime,ae,ag,af,ab,ac,aj,aa,Y,X)}else{w("select",aj.value,this.selectedIndex+1,ah,ad,Z,null,this.options.geoId,this.options.name,this.options.startTime,ae,ag,af,ab,ac,aj,aa,Y,X)}}else{if(ad){ad()}}r.call(this);return this};i.prototype.restore=function(){this.query&&this.query.length&&(this.source.value=this.query);this.setSelectedIndex(-1);if(this.selected){f.removeClass(this.selected,"selected");this.selected=null}this.options.autoSelectFirst&&this.highlightNextChoice();this.options.onRestore&&this.options.onRestore(this.query);r.call(this);return this};i.prototype.sync=function(Y){var W=this;if(this.query&&this.query!==Y.query){this.results=null;this.error=null}this.query=Y.query;Y.value&&(this.source.value=Y.value);this.setSelectedIndex(-1);this.selected&&f.removeClass(this.selected,"selected");var X=function(){if(W.results&&W.results.length){var Z=W.results.some(function(ab,aa){if(W.options.equal(ab,Y.result)){W.setSelectedIndex(aa);return true}return false});if(!Z&&W.options.assumeOnBlur){W.setSelectedIndex(0)}if(W.selectedIndex>=0){W.selected&&f.removeClass(W.selected,"selected");W.selected=W.items[W.selectedIndex];f.addClass(W.selected,"selected");W.source.value=W.options.resolveSelection(W.results[W.selectedIndex]);W.options.onSelect&&W.options.onSelect(W.results[W.selectedIndex],W.source.value,W,false)}}W.options.onSync&&W.options.onSync(W.query,W.source.value,W.selectedIndex>=0&&W.results[W.selectedIndex])};if(!this.results){this.query&&(this.source.value=this.query);this.search(false,X)}else{X()}};i.prototype.cleanUp=function(){this.container=null;this.item=null;this.selected=null;this.source=null;this.setSelectedIndex(-1);this.query=null;this.staticResultsShown=null;this.results=null;this.error=null;this.timeoutHandler=null;this.clearCache()};i.prototype.clearCache=function(){this.resultsCache=null};i.prototype.abortSearch=function(){this.aborted=true;if(this.timeoutHandler){window.clearTimeout(this.timeoutHandler)}};i.prototype.hasDefaultText=function(){return this.source&&this.source.value===this.options.defaultValue};i.prototype.integrateStaticResults=function(at){var ak=at.results||at;if(!f.isArray(ak)){ak=[]}var ab=(at.query&&at.query.query)||this.query;var Y=false;if(at.normalized&&at.normalized.query){ab=at.normalized.query;Y=true}var X=ak.length>0&&ak[ak.length-1];if(X&&X.type=="SEARCH"){ak.length-=1}else{X=null}var ap=this.getStaticResultsMatchingQuery(ab,Y);if(!ap||!ap.length){return ak}var aj={};for(var ao=0;ao<ap.length;ao++){var ad=ap[ao];var ai=[];for(var an=0;an<ad.results.length;an++){var ae=ad.results[an];var av=ad.getMatchingKey(ae);if(!aj.hasOwnProperty(av)){ai.push(ae);aj[av]=[ao,ai.length-1]}}ad.results=ai}for(var am=0;am<ak.length;am++){var ar=ak[am];var ah=false;for(var aq=0;aq<ap.length&&!ah;aq++){var ac=ap[aq];var av=ac.getMatchingKey(ar);var aa=aj[av];if(aa&&aa[0]==aq){if(ac.shouldReplace&&!ar.isChild){ar.scope=ac.results[aa[1]].scope}ac.results[aa[1]]=null;ah=true}}}var Z=[];for(var aq=0;aq<ap.length;aq++){var ac=ap[aq];if(!ad.bottom){for(var am=0;am<ac.results.length;am++){var al=ac.results[am];al&&Z.push(al)}}}Z.push.apply(Z,ak);for(var aq=0;aq<ap.length;aq++){if(ad.bottom){var ac=ap[aq];for(var am=0;am<ac.results.length;am++){var al=ac.results[am];al&&Z.push(al)}}}var W=Z;if(X){W.push(X)}if(at.results){at.results=W}else{at=W}var af={};for(var ag in ap){if(ap.hasOwnProperty(ag)){var ad=ap[ag];if(ad.results&&ad.results.filter(function(aw){return aw!=null}).length){af[ag]=true}}}this.staticResultsShown=af;var au=ta.util.Deferred();au.resolve(at);return au.promise()};i.prototype.getStaticResultsMatchingQuery=function(ad,af){if(!ad||!ad.length){return[]}var X=[];var Y=new RegExp("\\b"+String.escapeRegExp(ad),"i");var ae=function(ak){return"<b>"+ak+"</b>"};var ab=this;for(var aj in this.options.staticResults){if(!this.options.staticResults.hasOwnProperty(aj)){continue}var ag=this.options.staticResults[aj];if(ad.length<ag.minChars||!ag.integrate){continue}var ac=ag.results;var ai=[];for(var Z=0;Z<ac.length&&(!ab.options.maxResults||ai.length<ab.options.maxResults)&&ai.length<ag.maxItems;Z++){var ah=ac[Z];if(!ah){continue}var W=ah.name;if(af&&ah.normalized_name){W=ah.normalized_name}if(W&&W.match(Y)||d(Y,ah.aliases)){if(ag.highlight){ah=f.extend({},ah);ah.name=ah.name.replace(Y,ae)}ai.push(ah)}}if(ai.length){var aa=f.extend({},ag);aa.results=ai;X.push(aa)}}return X};i.prototype.shouldShowStaticResults=function(){var X=!!this.query&&this.query.length>0;var W=this.lastSuccessfulQuery!==this.query;if(this.options.showOnFocus&&(!X||W)){for(var Z in this.options.staticResults){if(!this.options.staticResults.hasOwnProperty(Z)){continue}var Y=this.options.staticResults[Z];if(Y.showOnEmpty){return true}}}return false};i.prototype.getSearchParams=function(){if(this.options.searchParams){if(typeof this.options.searchParams==="function"){return this.options.searchParams(this)}else{return this.options.searchParams}}else{return{}}};i.prototype.showStaticResultsIfEnabled=function(){if(!this.shouldShowStaticResults()){return}var W={};var Y=[];for(var ad in this.options.staticResults){if(!this.options.staticResults.hasOwnProperty(ad)){continue}var ab=this.options.staticResults[ad];if(ab.showOnEmpty){var Z=ab.results.slice(0,ab.maxItems);if(ab.sort){Z=Z.sort(ab.sort)}W[ad]=true;Y=Y.concat(Z)}}this.staticResultsShown=W;var ae=ta.util.Deferred(true);setTimeout(function(){ae.resolve({results:Y})},0);var af=ae.promise();var aa=this.options.postResultsFnList;for(var X=0;X<aa.length;X++){af=af.success(aa[X])}var ac=this;af=af.success(this.processResults.partial(Function._,true));af.always(function(){ac.show()})};i.prototype.addStaticResults=function(W,aa){this.options.staticResults=this.options.staticResults||{};if(!aa||!aa.results){delete this.options.staticResults[W];return}var X=function(ab,ad){var ac=f.extend({},ab);if(ab.urls){ab.urls.some(function(ae){if(ae.url_type==ad.linkType){ac.url=ae.url;return true}return false})}return ac};var Z=f.extend({},F,aa);var Y=[];Y.append(Z.results.filter(function(ab){return !Z.types||!Z.types.length||ab.type&&Z.types.contains(ab.type.toLowerCase())}).map(function(ab){return X(ab,Z)}).filter(function(ab){return !Z.predicate||Z.predicate(ab)}));if(!Y.length){delete this.options.staticResults[W];return}Z.results=Y;if(!Z.minChars){Z.minChars=this.options.minChars}this.options.staticResults[W]=Z};if(!ta.tracking){ta.tracking={}}if(!ta.tracking.typeahead){ta.tracking.typeahead={}}if(ta.tracking.typeahead.entryEventRecorded==undefined){ta.tracking.typeahead.entryEventRecorded=false}return i}(api));(function(b){if(window.IS_DEBUG){window.onerror=function(){}}var a=window.ta||(window.ta={});a.backbone||(a.backbone={});a.backbone.ModuleLoader=b(window,a)})(function(e,b,d){var a=false;function f(i,h){if(a||e.bbapp){i();return true}if(jsDesktopBackboneAsset===d){h();return false}b.loadInOrder(jsDesktopBackboneAsset,function(){a=true;i()})}function g(h){this._module=h;this._stepIdx=0;this._steps=["backbone","parseParams","bootstrap","assets","checkResponse","app","login","refetch","init"];this.resolve=this.resolve.bind(this);this.reject=this.reject.bind(this)}g.prototype.log=function(h){var i=Array.from(arguments).slice(1);var j="ModuleLoader:"+this._module+":"+(h?this._steps[this._stepIdx]+":"+h:"run");i.unshift(j);e.IS_DEBUG&&console.log.apply(console,i);b.fireEvent(j,this._el)};g.prototype._backbone=function(){f(this.resolve)};g.prototype._parseParams=function(){if(typeof this._params=="function"){this._params=this._params();this.resolve()}else{if(typeof this._params=="string"){var h=this._params.split("::");var i=h.pop();h=h.shift();require&&require([h],function(j){j[i]&&j[i](function(k){this._params=k;this.resolve()}.bind(this))}.bind(this))}else{this.resolve()}}};g.prototype._bootstrap=function(){var h=b.mixin({modules:this._module,token:JS_SECURITY_TOKEN,authenticator:"DEFAULT",d:e.modelLocId,g:e.modelGeoId},this._params);new b.util.ajax({method:"POST",url:"/ModuleBootstrap",evalScripts:true,data:h,aplus:true}).then(function(i){if(!i||i.code!==200){this.reject();return}if(i.text.indexOf("_modulesResponseData")<0){b.util.error.ajaxFailure("Invalid ModuleBootstrap response",i,{contentLength:i.text.length});this.reject();return}this._root=document.createElement("div");this._root.innerHTML=i.text;this.resolve()}.bind(this),this.reject)};g.prototype._assets=function(){var m=this._root.getElementsByTagName("script");var h=[];for(var l=m.length-1;l>=0;l--){var n=m[l].getAttribute("src");if(n){h.unshift(n);m[l].parentNode.removeChild(m[l])}}b.loadInOrder(h,this.resolve);m=this._root.getElementsByTagName("link");for(var k=m.length-1;k>=0;k--){new Asset.css(m[k].href)}};g.prototype._checkResponse=function(){this._appName=e._backboneAppName;this._data=e._modulesResponseData;delete e._backboneAppName;delete e._modulesResponseData;if(!this._data){this.reject();return}this._needLogin=false;this._actions={};this._data.actions.forEach(function(h){if(h.status=="FAILURE.AUTHORIZATION_MEMBER"){this._needLogin=true;this._actions[h.resource]=h.params}},this);this.resolve()};g.prototype._app=function(){require([this._appName,"Logging"],function(i,h){h.debug("initializing app",this._appName);var j=new Date().getTime();if(!e.bbapp){e.bbapp=new i();e.bbapp.init({token:JS_SECURITY_TOKEN},this._data);h.debug("Initialized modules/backbone in "+(new Date().getTime()-j)+"ms")}else{e.bbapp.context.patch(this._data)}this.resolve()}.bind(this))};g.prototype._login=function(){if(!this._needLogin){this.resolve();return}b.registration.RegOverlay.show(null,null,{flow:"CORE_COMBINED",pid:-1,userRequestedForce:true,onSuccess:this.resolve,onClose:function(h){h.trigger&&this.reject()}.bind(this)})};g.prototype._refetch=function(){if(!this._needLogin){this.resolve();return}var i;for(var h in this._actions){i=this._actions[h];e.bbapp.context.batchAction({action:{name:"FETCH",resource:h,params:i,id:"refetch"}})}e.bbapp.context.commitActions({success:this.resolve})};g.prototype._init=function(){if(typeof this._entryPoint!="string"){this._entryPoint.appendChild(this._root);this.resolve()}else{require&&require([this._entryPoint],function(h){var i=this._args.slice();i.unshift(this._el);h.init&&h.init.apply(h,i);this.resolve()}.bind(this))}};g.prototype.run=function(k,j,i,h){if(this._running){return}this._running=true;this._success=[];this._failure=[];this._entryPoint=k;this._params=j;this._el=i;this._args=h;if(this._stepIdx>=this._steps.length){this._stepIdx=this._steps.length-1}this.log();this.log("start");this["_"+this._steps[this._stepIdx]]();return this};g.prototype.success=function(h){if(!this._running){h();return this}this._success.push(h);return this};g.prototype.failure=function(h){if(!this._running){h();return this}this._failure.push(h);return this};g.prototype.resolve=function(){this.log("success");this._stepIdx++;if(this._stepIdx<this._steps.length){this.log("start");this["_"+this._steps[this._stepIdx]]()}else{this._running=false;this._success.forEach(function(h){h()})}};g.prototype.reject=function(){this._running=false;this.log("failure");this._failure.forEach(function(h){h()})};var c={};return function(j,m,l,k){var i=Array.prototype.slice.call(arguments,4);var h=(c[j]||(c[j]=new g(j)));return h.run(m,l,k,i)}});(function(a){window.ta||(ta={});ta.masthead||(ta.masthead={});ta.masthead.NotificationDropdown=a(ta,ta.backbone.ModuleLoader)})(function(p,r){var q=-10;var k=false;var w=false;var e=false;var g=null;var m=null;var d=null;var n=null;var b=null;var t=null;var v=null;var l="modules.engagement.NotificationDropdown";var h="notification_desktop_deleted";var c=function(x){if(!e||!m||(x&&b.contains(x.target))||(x&&x.target.className=="notif_close_button")){return}e=false;m.style.left=q+"px";p.addClass(m,"hidden");p.removeClass(t,"masthead_notifctr_active");var y=window.bbapp&&bbapp.getView(l);if(y){y.record("CloseNotifDropdown")}};var o=function(){if(!m||e){return}e=true;p.removeClass(m,"hidden");p.addClass(t,"masthead_notifctr_active");var x=b.getPosition().x;var z=m.getWidth();var y=window.getSize().x;if(x+z>y){m.style.left=(q+(y-x)-z)+"px"}j(0)};var i=function(){if(v){return}v=setTimeout(function(){v=null;n=p.find(".notifdd_list",g);d.removeClass("hidden");n&&n.addClass("hidden");o()},250)};var u=function(){if(v){clearTimeout(v);v=null}d.addClass("hidden");n=p.find(".notifdd_list",g);n&&n.removeClass("hidden");o()};var j=function(y){var x=p.find(".masthead_notifctr_jewel",g);x.innerText=y;if(y==0&&!x.hasClass("hidden")){x.addClass("hidden");t.removeClass("masthead_notifctr_unread")}else{if(y>0&&x.hasClass("hidden")){x.removeClass("hidden");t.addClass("masthead_notifctr_unread")}}};var a={initialize:function(){this.listenTo(this.context.get("Engagement_MemberNotifications.data.notifications"),"reset",this.render);this.listenTo(this,"render",this.onRender);this.onRender()},onRender:function(){this.listEl=p.find(".notifdd_list",this.el);var x=this;require(["underscore"],function(y){var z=[];y.each(p.select(".notifdd_notif_container",x.el),function(A){if(A.hasClass("notifdd_unread")){z.push(+A.getAttribute("data-notif-id"))}});x.record("OpenNotifDropdown",{value:z.length});if(z.length>0){x.context.save("modules.engagement.entity.NotificationStatusUpdate",{set:true,status:["READ"],notifs:z})}})},refreshData:function(){var z=this.context.get("Engagement_MemberNotifications");if(z){return z.fetch()}var y=new ta.util.Deferred();var x=this;setTimeout(function(){y.resolve();x.onRender()},0);return y.promise()},events:{"click a.notifdd_link":function(x,y){this.record("NotifDropdownClick",{context:y.getAttribute("data-notif-type")});var z=this.context.save("modules.engagement.entity.NotificationStatusUpdate",{set:true,status:["USED"],notifs:[+y.getAttribute("data-notif-id")]});var A=function(){window.location.assign(y.href)};z.always(A);setTimeout(A,100);x.preventDefault()},mousewheel:function(x){var y=x.wheel||x.event.wheelDelta||-x.event.detail;if((this.listEl.scrollTop<=0&&y>0)||(y<0&&this.listEl.scrollTop>=(this.listEl.scrollHeight-this.listEl.offsetHeight))){x.preventDefault()}},"click div.notif_close_button":function(x,B){this.context.save("modules.engagement.entity.NotificationStatusUpdate",{set:true,status:["DELETED"],notifs:[+B.getAttribute("data-notif-id")]});this.record(h,{context:B.getAttribute("data-notif-type")});var y=p.find(".notifdd_list");var A=y.scrollTop;var C=this.context.get("Engagement_MemberNotifications.data.notifications");var z=B.getAttribute("data-notif-index");C.remove(C.at(z));this.render();y=p.find(".notifdd_list");y.scrollTop=A}}};var s=function(){require(["backbone/modbone/View"],function(x){x.create(l,a)})};var f=function(){b=p.find(".masthead_notification",g);t=p.find(".masthead_notifctr_btn",g);b.removeChild(p.find(".masthead_notifctr_dropdown",b));b.appendChild(m);var x=e?p.addClass:p.removeClass;x(t,"masthead_notifctr_active")};return{toggleNotifCenter:function(){g=p.find(".masthead_notification_enabled");b=p.find(".masthead_notification",g);m=p.find(".masthead_notifctr_dropdown",b);d=p.find(".notifdd_loading",m);t=p.find(".masthead_notifctr_btn",b);if(!w){w=true;p.addEvent(window,"click",c);p.addEvent(window,"mastheadFlyoutOpened",c);p.addEvent(window,"afterIpHeaderInjection",f)}if(!k){k=true;i();r(l,m).success(s).success(u);return}if(p.hasClass(m,"hidden")){var x=window.bbapp&&bbapp.getView(l);if(!x){return}i();x.refreshData().success(u);p.fireEvent(window,"mastheadFlyoutOpened")}else{c()}}}});var sTAMGFooterCookieName="hideTAMGFooter";var sFooterDivId="TM_FTR";var hmOngoingHover={};var savedDomain="tripadvisor.com";if(typeof cookieDomain!="undefined"){savedDomain=cookieDomain.substring(1,cookieDomain.length)}function _closeOverlay(){var a=ta.retrieve("overlays.current");if(a){a.hide()}}function setTAMGFooterCookie(d,c){var b=new Date();b.setTime(b.getTime());var e=1000*60*60*24*7;var a=new Date(b.getTime()+(e));document.cookie=sTAMGFooterCookieName+"="+escape(d)+";expires="+a.toGMTString()+";path=/"+((savedDomain)?";domain="+savedDomain:"");hideFooter(c)}function openUrl(b){var a=window.open(b);a.opener=null}function getTAMGFooterCookie(){var e=document.cookie.split(";");var a="";var c="";var d="";var b=false;for(i=0;i<e.length;i++){a=e[i].split("=");c=a[0].replace(/^\s+|\s+$/g,"");if(c==sTAMGFooterCookieName){b=true;if(a.length>1){d=unescape(a[1].replace(/^\s+|\s+$/g,""))}return d}a=null;c=""}if(!b){return null}}function hideFooter(b){if(!b){b=sFooterDivId}var a=document.getElementById(b);if(a){a.style.display="none"}}function tamgShowFly(c,d,b,a){hmOngoingHover[d]=true;setTimeout(function(){if(hmOngoingHover[d]){tamgCreateFly(c,b,a)}},250)}function tamgHideFly(a,c,b){var d=b.toElement||b.relatedTarget;while(d&&d!=a){d=d.parentNode}if(d!=a){hmOngoingHover[c]=false;setTimeout(function(){if(hmOngoingHover[c]==false){$$("."+c)[0].hide()}},250)}}function tamgCreateFly(g,j,e){var f=$(g).getElements(".ftrFly")[0];if($(f).getElements("img")[0]){f.show()}else{var k=CDNHOST+"/img2/x.gif";var h="ftrFlyLogo "+j;var d=new Element("img",{"class":h,src:k}).inject(f,"top");d.setProperty("height","25");d.setProperty("width",e);var c=new Element("div",{"class":"triWrap"});var b=new Element("span",{"class":"cssTri"});var a=new Element("span",{"class":"cssTri"});b.inject(a);a.inject(c);c.inject(f,"bottom");f.show()}}function getTAMGFooterViaAjax(d,c,a,b,e){new Request({url:"/TAMGFooterAjax",onSuccess:function(g){var h=ta.id("TAMGFooterHolder");if(h){h.innerHTML=g}var f="RuleBasedFooter_"+e;ta.trackEventOnPage("Footer","OpenFooter",f,1,true)},data:{a:"SHOW_FOOTER",dis:d,loc:c,"new":a,serv:b},evalScripts:true,method:"get"}).send()}function getFullDisclaimerText(){new Request({url:"/TAMGFooterAjax",onSuccess:function(b){try{ta.id("PDISCLAIMER").innerHTML=b}catch(a){ta.util.error.record(a,"Fail to find element (id PDISCLAIMER)")}},data:{a:"SHOW_FULL_DISCLAIMER"},evalScripts:true,method:"get"}).send()};define("utils/urlutils",[],function(){var c=window.asdf||global.asdf;function f(i,g,j){var h=new RegExp("(-"+g+"([0-9]+))|([?&]"+j+"=([0-9]+))");var k=h.exec(i);if(k){if(typeof k[2]!=="undefined"){return Number(k[2])}if(typeof k[4]!=="undefined"){return Number(k[4])}}return void (0)}function b(g){return f(g,"d","detail")||f(g,"g","geo")}function a(j){var h={};var m=j.split("#")[0].split("?")[1]||"";var l=m.split("&");for(var k=0;k<l.length;k++){var g=l[k].split("=");if(g[0]){h[decodeURIComponent(g[0])]=decodeURIComponent(g[1])}}return h}function e(g){return location.protocol+"//"+location.hostname+g}function d(g){g=g||"";if(g.indexOf("http")===-1){g=e(g)}return g.replace("http://","https://")}return{asdf:c,getUrlArgNumeric:f,getUrlPageLoc:b,getUrlQueryArgs:a,https:d}});define("utils/jsonutils",["dom-lib"],function(domlib){var _specialChars={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},_replaceChars=function(chr){return _specialChars[chr]||"\\u00"+Math.floor(chr.charCodeAt()/16).toString(16)+(chr.charCodeAt()%16).toString(16)};return{encode:function(obj){switch(domlib.type(obj)){case"string":return'"'+obj.replace(/[\x00-\x1f\\"]/g,_replaceChars)+'"';case"array":return"["+String(obj.map(this.encode).replace(/^\s+|\s+$/g,"").trim())+"]";case"object":case"hash":var string=[];domlib.each(obj,function(value,key){var json=this.encode(value);if(json){string.push(this.encode(key)+":"+json)}}.bind(this));return"{"+string+"}";case"number":case"boolean":return String(obj);case"null":return"null"}return null},decode:function(string,secure){if(domlib.type(string)!="string"||!string.length){return null}if(secure&&!(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(string.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))){return null}return eval("("+string+")")}}});define("utils/errorutils",["utils/store","utils/cookieutils","utils/jsonutils","utils/browserutils","ta","dom-lib"],function(h,t,a,w,l,j){var z="page_loaded",s="dom_ready",e="not_loaded";var k=0,b=3000,n=[],o=t.getCookie("JS_ERROR_HANDLING"),v={eMsg:"msg",eStak:"stack",eUrl:"url"},d=function(B){if(!B||!B.indexOf){return false}var C=window.CDNHOST||"";if(window.IS_DEBUG&&C==""){return B.match(/(js3\/|js\/)/)!=null}else{return B.indexOf(C)==0}},q=function(){var C=w.Platform.ios||w.Platform.android,B=t.getCookie("TAmobilemode")==="main";return C&&!B},c=function(C){if(!q()){return}for(i in v){var B=v[i];C[B]=C[i]}C.file=C.url||(document?document.URL:null);C.site=window.SITE_VERSION;C.loaded=e},r=function(C){if(!C||!C.indexOf){return false}var B="noPage";try{B=window.location.href}catch(D){}if(C===B){return true}return false},g=function(){var B="";j.each(document.getElementsByTagName("script"),function(F,C){if(!F){return}var E=F.src;if(d(E)){var D="";if(B!=""){D=", "}E=E.substring(E.indexOf("/js")+1);B=B+D+E}});if(B.length>b){B=B.substring(0,b)}return B},p=function(B){var C="";j.each(B,function(E,D){C=C+D+": "+E+"\n"});window.alert(C)},f=function(B){if(console){console.error(B)}},m=function(D,C,B){var E="<td class='"+B+"'>"+B+"</td><td><b>Error Block</b>:: "+C+", <b>Error Message</b>:: "+D+"</td>",F=j(document.createElement("tr"));F.html(E);return F},A=function(B){if(typeof B!="undefined"&&B!==null){return B.toString().replace(/[\r\n]/g,"")}return"null or undefined"},u=function(H){var I="";try{if(arguments&&arguments.callee&&!w.chrome&&!w.firefox&&!w.safari){var K=[];var C=arguments.callee.caller;C=C.caller;var F=0;while(C&&F++<20){var D=C.toString();if(D.match(/onErrorFunc/)){C=C.caller;continue}var B=D.length;var E=B>100?100:B;var L=D.substring(0,E);L=L.replace(/(\n|\r|\'|\")/g,"");L+="::";K.push(L);C=C.caller}return K.join(" ")}}catch(G){I="-arguments.callee issue"}if(H&&H.stack){var J=H.stack.split("\n");J=J.map(function(N){var M=N.lastIndexOf("/");if(M>0){N=N.substr(M+1)}return N});return J.join()}return"none"+I},y=function(D){var B=document.getElementByID("#DEBUG_JS_ERROR_DETAILS tbody"),C=j(".perfButtonWrap .jsErrors");if(!D){return}if(B){B.append(D)}if(D.html()&&D.html().indexOf("ERROR")>-1){C.addClass("ERROR")}else{C.addClass("WARN")}},x=function(K,B){var G="_extraInfoError_:Problem storing extra info.";var I={};var L="";try{var J=j.type(B);var D={};if(J==="array"||(J==="object"&&B.callee!=null)){for(var F=0;F<B.length;F++){var C=B[F];var H=typeof C;if(H==="string"||H==="number"||H==="boolean"){D[F]=C}else{D[F]=typeof C}}B=D}I=j.extend(K,B||{});L=a.encode(I);if(L){if(L.length>b){L=L.substring(0,b)}return L.replace(/[\r\n]/g,"")}}catch(E){}try{I=K;L=a.encode(I);if(L){if(L.length>b){L=L.substring(0,b)}return L.replace(/[\r\n]/g,"")}}catch(E){}return G};return{domIsReady:function(){e=s},record:function(T,C,N,P,I){try{if(!T){T=new Error("Stub error to build stack.")}if(h.has("ta.error.record.inFlight")||k>9){return}k++;h.add("ta.error.record.inFlight",true);var K=false;try{K=j("body").hasClass("js_logging")||q()}catch(W){}if(!K){return}if(IS_DEBUG&&console.error){console.error("JS_ERROR_RECORD: "+C,T)}var Z=true;if(P&&P.hasOwnProperty("error_script")&&!d(P.error_script)&&!r(P.error_script)){Z=false}var H={};var Y=false;try{if(N||window.event){N=N||window.event;Y=document.getElementById(N.target);H.eTarg=this.getSelectorString(Y)}}catch(M){}if(typeof(debugCacheKey)!="undefined"){H.key=debugCacheKey}var B=window.pageServlet;if(!B){B="unknown"}H.servlet=B;if(!I||typeof I!="string"){I="ERROR"}if(!Z){I="WARN";H.warnReason="externalError"}else{if(!IS_DEBUG&&k>1){I="WARN";H.warnReason="notFirstJSError"}}var ac={extraInfoError:"Problem storing extra info"};var ab="";var G={};try{var E="";try{E=window.navigator.userAgent}catch(O){}var F="";var D="";if(Y){if(typeof Y.id!=="function"){F=Y.id}D=Y.className}var R=false;try{R=doCookieCheck()}catch(W){}var U="";if(typeof serverPool!="undefined"&&serverPool){U=serverPool}var Q="";if(window.MooTools){Q+="MooTools "}if(window.jQuery||l.jquery){Q+="jQuery ";I="WARN";H.warnReason="jquery"}G={TARGET_ID:F,TARGET_CLASS:D,PAGE_UID:l.uid,INTERNAL_JS:g(),CLIENT_POOL:U,COOKIES_ENABLED:R,JS_LIBS:Q};if(!Z){G.INTERNAL_ERROR="false"}if(k>1){G.PRIOR_JS_PAGE_ERRORS=k-1}}catch(V){P=ac}H.xInfo=x(G,P);try{H.eUrl=window.location.href}catch(M){}var J="No Error";try{if(T){if(Object.prototype.toString.call(T)===Object.prototype.toString.call(new Error)){J=T.name+"-"+T.message}else{if(typeof T==="object"){J="non-Error object "+Object.prototype.toString.call(T)+" passed, sample properties - ";var aa=0;for(prop in T){if(T.hasOwnProperty(prop)){J+=prop.substring(0,30)+": "+(T[prop]&&T[prop].toString?T[prop].toString().substring(0,20):T[prop])+", ";if(++aa>4){break}}}}else{J="non-Object error passed: "+(""+T).substring(0,30)}}J=J.replace(/[\r\n]/g,"")}}catch(M){}H.eMsg=J;var S="";try{S=A(C).substring(0,150);H.eBlk=S}catch(M){}try{if(S.indexOf("window.onerror")!=0){var X=u(T);if(X){H.eStak=X}}}catch(M){}try{if(l.widgets&&l.widgets.calendar){H.eDates=l.widgets.calendar.getErrorDates()}}catch(M){}H.eLogLevel=I;c(H);j.ajax({url:"/JSErrorRecord",method:"POST",data:H});if(IS_DEBUG){(window.ERRORS||(window.ERRORS=[])).push(H)}if(o){if(o.match(/alert/)){p(H)}if(o.match(/console/)&&console){f(H)}}h.remove("ta.error.record.inFlight");if(IS_DEBUG&&T&&I==="ERROR"&&false){throw T}if(IS_DEBUG){var L=m(J,C,I);if(h.has("debug.toolbar.loaded")){y(L)}else{n.push(L)}}}catch(M){H={eBlk:"JSErrorRecord Error",servlet:B,eLogLevel:"ERROR",eMsg:"no error retrieved"};c(H);j.ajax({url:"/JSErrorRecord",method:"POST",data:H})}},getSelectorString:function(C){if(!C){return""}var B=[C];while(typeof C!="undefined"&&C&&typeof C.parentNode!="undefined"){B.push(C=C.parentNode)}B=B.map(function(E){if(E&&E.tagName){var D=E.tagName;if(E.id){D+="#"+E.id}if(E.className){D+="."+E.className}return D}return""});B=B.reverse().join(">");B=B.replace(/\s+/g,".");return B}}});(function(c){c.util=c.util||{};var f=false;var g={};var h={};var j="";var d="";var i=function(k){if(k<0){return 300}switch(k){case 0:return 0;case 1:return 250;case 2:return 500;case 3:return 1000;default:return 2000}};var e=function(k,l){if(c.util.error&&c.util.error.record&&("function"===typeof c.util.error.record)){c.util.error.record(k,l)}else{if(c.merror&&c.merror.recordError&&("function"===typeof c.merror.recordError)){c.merror.recordError(l,null,null,null,k)}}};var b=function(){c.trackEventOnPage("captcha","recaptcha","displayed")};var a=function(l,k){var m=document.getElementById(k);if(!m||("INPUT"!==m.tagName)){e(null,"The recaptcha input id was not found on the page: "+k);return}m.value=l||""};c.util.ReCaptcha={init:function(q,n,m,k,l){try{h[k]=l;if(f){return}if(!q){e(null,"No language specified for recaptcha.")}if(n){j=n}if(m){d=m}var p=document.createElement("script");p.type="text/javascript";p.async=true;p.defer=true;p.src="https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit&hl="+q;document.getElementsByTagName("head")[0].appendChild(p);f=true}catch(o){e(o,"Could not inject recaptcha script on to page.")}},reset:function(k){if(!k){e(null,"No reset key specified.");return}if(g[k]||(0===g[k])){try{if(("undefined"!==typeof grecaptcha)&&grecaptcha&&grecaptcha.reset&&("function"===typeof grecaptcha.reset)){grecaptcha.reset(g[k])}}catch(l){e(l,"Error resetting recaptcha object: "+k)}}},resetAll:function(){for(var k in g){if(g.hasOwnProperty(k)){c.util.ReCaptcha.reset(k)}}},checkGrecaptcha:function(){if(("undefined"!==typeof grecaptcha)&&grecaptcha&&grecaptcha.render&&("function"===typeof grecaptcha.render)){return true}return false},checkCaptchaRendered:function(k){return !!(g[k]||(0===g[k]))},showSync:function(n,l,m){var k=0;var o=window.setInterval(function(){if(++k>=40){window.clearInterval(o);e(null,"Recaptcha JS was not loaded on the page.");return}if("undefined"===typeof grecaptcha){return}c.util.ReCaptcha.show(n,l,m);window.clearInterval(o)},250)},showAll:function(l){for(var k in h){if(h.hasOwnProperty(k)){c.util.ReCaptcha.show(l,k,h[k])}}},waitForElm:function(o,l,m){var k=0;var n=function(){if(++k>=5){window.clearInterval(p);e(null,"Recaptcha element id was not loaded on the page."+l);return}var q=document.getElementById(l);if(q){window.clearInterval(p);c.util.ReCaptcha.show(o,l,m);return}};var p=window.setInterval(n,250)},show:function(t,u,r,q){try{if(("undefined"===typeof grecaptcha)||!grecaptcha||!grecaptcha.render||("function"!==typeof grecaptcha.render)){e(null,"Recaptcha JS was not loaded on the page.");return}if(!t||!u||!r){e(null,"Please pass a site key, element id, and input id.");return}var p=document.getElementById(u);if(!p){c.util.ReCaptcha.waitForElm(t,u,r);return}if(g[u]&&("object"===typeof g[u])){return}var k=0;var n=i(k);var s=document.getElementById("captchaSpinner");var m=function(){if(k==1){if(null!==s){s.style.display="block"}}if(++k>=5){window.clearTimeout(l);s.style.display="none";e(null,"Couldn't load recaptcha");require(["utils/memberAudit"],function(w){w.recordMemberAuditLog("CAPTCHA_FAILED",d,null,{reason:"Google Timeout"})});var v=document.getElementById("captchaError");if(null!==v){v.className="captchaError errorMsg warning wrap";v.innerHTML=j}return}if("undefined"===typeof g[u]){g[u]=grecaptcha.render(u,{sitekey:t,theme:"light",type:"image",tabindex:0,size:q?"compact":"normal",callback:function(w){a(w,r)},"expired-callback":function(){c.util.ReCaptcha.reset(u)}});n=i(k);l=window.setTimeout(m,n)}else{window.clearTimeout(l);s.style.display="none";return}};var l=window.setTimeout(m,n);b()}catch(o){e(o,"Error loading recaptcha.")}}}}(ta));(function(c){c.util=c.util||{};var g=false;var d="float";var e={};var f="";var b=function(i,j){if(c.util.error&&c.util.error.record&&("function"===typeof c.util.error.record)){c.util.error.record(i,j)}else{if(c.merror&&c.merror.recordError&&("function"===typeof c.merror.recordError)){c.merror.recordError(j,null,null,null,i)}}};var a=function(){if(c.trackEventOnPage&&("function"===typeof c.trackEventOnPage)){c.trackEventOnPage("captcha","geetest","displayed")}};var h=function(j){var i=j.getElementsByClassName("gt_guide_tip");if(i&&i.length>0&&f){i[0].innerHTML=f}};c.util.GeeTest={init:function(l,i){try{if(g||("undefined"!==typeof Geetest)&&Geetest){return}d=i?i:d;f=l;var k=document.createElement("script");k.type="text/javascript";k.async=true;k.defer=true;k.src="https://api.geetest.com/get.php?callback=ta.util.GeeTest.onloadCallback";document.getElementsByTagName("head")[0].appendChild(k);g=true}catch(j){b(j,"Could not inject geetest script on to page.")}},reset:function(i){try{if(e[i]&&("function"===typeof e[i].refresh)){e[i].refresh()}}catch(j){b(j,"Error resetting recaptcha object: "+i)}},resetAll:function(){for(var i in e){if(e.hasOwnProperty(i)){c.util.GeeTest.reset(i)}}},showSync:function(l,j,k){var i=0;var m=window.setInterval(function(){if(++i>=40){window.clearTimeout(m);b(null,"GeeTest JS was not loaded on the page.");return}if("undefined"===typeof Geetest){return}c.util.GeeTest.show(l,j,k);window.clearTimeout(m)},250)},show:function(l,i,k){try{if(("undefined"===typeof Geetest)||!Geetest){b(null,"GeeTest JS was not loaded on the page.");return}if(!l||!i){b(null,"Please pass a site key and element id.");return}var m=document.getElementById(i);if(!m){b(null,"The geetest element id was not found on the page: "+i);return}if(e[i]&&("object"===typeof e[i])&&!k){return}e[i]=new Geetest({gt:l,product:d,https:true});e[i].onReady(function(){h(m)}).appendTo(m);a()}catch(j){b(j,"Error loading geetest captcha.")}},onloadCallback:function(){}}}(ta));if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["utils/memberAudit"],["ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"ta-captcha",files:{"js-amd":{src:{utils:{memberAudit:1}}}},_:{baseUrl:"/"}})};define("utils/memberAudit",["ta","dom-lib","utils/urlutils","utils/errorutils"],function(a,d,c,e){var b=function(j,h,g,f){try{d.ajax({type:"POST",url:c.https("/MemberAuditLogger"),onFailure:function(l){var m=l&&l.code?l.code:"";var k=l&&l.status?l.status:"";var n=l&&l.text?l.text:"";e.record(null,"Ajax post request failure(recordMemberAuditLog), code: "+m+", status: "+k+", text: "+n)},data:{action:"MemberAuditLogger",token:h,recordType:j,registrationSessionUid:g,map:JSON.stringify(f)},xhrFields:{withCredentials:true}})}catch(i){e.record(i,"Failed to send an Ajax request to MemberAuditLogger.")}};return{recordMemberAuditLog:b}});define("ta/maps/opener",["ta","overlays/Overlay","overlays/styles/modal","overlays/position","overlays/options/autoReposition","overlays/options/closeOnEscape","overlays/styles/windowshade","overlays/utils"],function(h,b,i,c,a,j,e,k){var g,f,l;var d=function(){if(g){f=1;g.hide()}};h.on("mapOverlayOpened",function(){d();l&&setTimeout(h.mapsv2.Factory.closeFromOtherThanX,1);l=0});h.on("mapOverlayClosed",d);return{open:function(o,p,s,q){if(o==2){if(!g){var n,m=h.hasClass(document.body,"tablet_desktop"),t=0;if(!m){t=20;n=e()}g=new b(0,[i(0,"center",0,0,0,k.loadingSpinnerHtml()),c.framed([t,t]),a,j,n]);g.on("hide",function(){if(!f){l=1}f=0})}f=l=0;g.show()}var r=o==2?"ta.mapsv2.Factory.createPOIMapViaHashRedirect":"ta.maps.Factory.createFloatMapDelay";h.run(r,{},null,null,p,s,q)}}});ta.servlet.Member={memberBenefitsSubscribe:function(a){ta.servlet.Member.processMOSubscribeRequest(a);return false},memberGuideRequest:function(a){processGuideRequest(a)},memberTOGForm:function(a){processTOGForm(a)},processMOSubscribeRequest:function(a){if(!loggedIn){new Event(a).preventDefault();return false}var d=$("MEMONLY_SUBS_FORM");d.elements.action.value="subscribe";var c={url:"/TravelGuides",data:d,onFailure:function(f){alert(f.status+"\n"+f.responseText)}};c.onSuccess=ta.servlet.Member.subscribeRequestResFunc;var b=window["validate"+d.id];new Event(a).preventDefault();new Request(c).send()},subscribeRequestResFunc:function(a){if(a!=""){for(subtype in subtypes){if(subtyperes[subtype].test(a)){if(subtype=="tw"&&ta.retrieve("tcd.refresh")){window.location.reload()}var g=document.getElementById(subtype+"Optin");g.setAttribute("checked","true");g.setAttribute("disabled","true");var c=document.getElementById(subtype+"OptinLbl");c.innerHTML="<b>"+headings[subtype]+"</b> "+tamg_thanks;var f=document.getElementById("OPTINTEXT");f.style.display="none"}}var j={};for(subtype in subtypes){var d=document.getElementById(formids[subtype]);j[subtype]=d.checked}var h=true;var i=true;for(subtype in j){if(subtyperes[subtype].test(a)){h=false}if(!j[subtype]){i=false}}if(i){var e=document.getElementById("NLSUBMITDIV");e.style.display="none"}if(h){var b=document.getElementById("OPTINTEXT");b.innerHTML='<div class="alert">'+no_selection_error+"</div>";b.style.display="block"}}},addTripWatchLocation:function(event,elmt,updateTxt){var mElmt=new Element(elmt);new Event(event).stop();new Request({url:elmt.href,onFailure:ta.util.error.ajaxFailure.partial("Member:addTripWatchLocation"),onSuccess:function(txt,xml){if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){ta.overlays.showInLightbox(data.ERROR);return}else{if(data.ALERT){ta.overlays.showInLightbox(data.ALERT);return}}}var spanElt=new Element("span");spanElt.set("html",updateTxt);mElmt.hide();spanElt.inject(mElmt,"after")}}).send()},addTripWatchLocationReload:function(a){new Request({url:a.href,onFailure:ta.util.error.ajaxFailure.partial("Member:addTripWatchLocationReload"),onSuccess:function(b,c){window.location.reload()}}).send()}};ta.servlet.Tourism=(function(){var e=window.modelGeoId||0;var k=1;var d=null;var c=200;var a=0;var n=[];var f=false;var g=function(o){var p="modules_visible_"+o;n.each(function(r,q){if(ta.util.element.isScrolledIntoView(r)){ta.trackEventOnPage("Tourism",p,r.getAttribute("data-module"),0,true);n.splice(q,1)}})};var h=function(){var o=Math.floor(window.getSize().y/c)*c;a=o;while(o>=c){j(o);o-=c}};var l=function(){var o=Math.floor(window.getScroll().y/c)*c;if(o>a){a=o;j(o)}};var j=function(o){ta.trackEventOnPage("Tourism","Engagement","scroll"+o,o,true)};var b=function(){if(!f){var o=ta.id("FORUM_CONTENT");if(o&&ta.util.element.isScrolledIntoView(o)){o.load("/TourismForumContentAjax?geo="+e);f=true}}};var i=function(){var p=null;if(ta.retrieve("tourism.brand_viator_promotion")){p=ta.find(".highlightsSection .viator_promo")}else{p=ta.find(".highlightsSection .comparePrices")}if(p){var q=function(){if(o()){r();window.removeEvent("scroll",q)}};var o=function(){return p.getCoordinates().top<window.getHeight()+window.getScroll().y};var r=function(){if(ta.retrieve("tourism.brand_viator_promotion")){ta.trackEventOnPage("pcb_campaign","promo_booktosave_tourism","",0)}else{ta.trackEventOnPage("pcb_campaign","tourism_message_in_view","",0)}};if(o()){r()}else{window.addEvent("scroll",q)}}};var m=(function(){var s;var y=false;var v;var p=false;var o={TABS_DMO:1};var q="TABS_DMO";var r=function(D,z,E){var B=ta.id("PAGE");var F=B.getElement(".tabsSpacer");if(F){var C=B.getHeight()-E.getPosition(B).y-F.getHeight();var A=0;if(C>=window.getHeight()){F.style.height=A+"px"}}};var u=function(A){var z=document.getElement("#TABS_MORE .tabs_more_content");if(z&&!z.isDisplayed()){z.show();A.stop();window.addEvent("click",t)}};var t=function(){var z=document.getElement("#TABS_MORE .tabs_more_content");if(z&&z.isDisplayed()){z.hide();window.removeEvent("click",t)}};var x=function(){var D=ta.id("PERSISTENT_TAB_HEADER");var G=D&&D.getElement(".tabs_pers_content");var A=ta.id("TABS_MORE");var C=A&&A.getElement(".tabs_more_content");if(!A||!G||!D||!C){return false}var K=G.getChildren("li:not(.tabs_more)");if(K.length<1){return false}var H=K[0];if(!A.hasClass("hidden")){var I=ta.id(q);if(I){}else{G.adopt(C.getChildren())}G.adopt(A)}A.removeClass("hidden");var J=H.getPosition().y+H.getSize().y/2;var F=A.getElements(".tabs_more_content li").length>0;var z=F;for(var E=K.length-1;E>=0;E--){var B=K[E];if(B.id!="TABS_MORE"&&!o[B.id]&&B.isVisible()){if(J>0&&(B.getPosition().y>J||A.getPosition().y>J)){C.grab(B,"top");z=true}else{break}}}if(!z){A.addClass("hidden")}K=G.getChildren("li:not(.hidden)");D.getElements(".lastTab").removeClass("lastTab");if(K.length>0){K[K.length-1].addClass("lastTab")}D.removeClass("invisible");if(!p){p=true;A.addEvent("click",u);window.addEvent("resize",x);if(window.isTabletOnFullSite){window.addEvent("orientationchange",function(){w()});window.addEvent("gesturestart",function(L){v=L.scale});window.addEvent("gestureend",function(L){if(v!==L.scale){v=L.scale;w()}})}}};var w=function(){var A=ta.find(".persistent_tabs_container"),C=ta.find(".persistent_tabs_header"),D=ta.id(window),z=150;var B=A.getTop()+A.getHeight();if(D.getScrollTop()<(B-A.getHeight())){if(C.hasClass("fixed")&&!y){setTimeout(function(){C.removeClass("fixed");A.removeClass("fixed");C.addClass("static");A.addClass("static");y=false;C.style.transition="none";C.style.top=0;x()},z);y=true;C.style.transition="";C.style.top="-52px"}}else{if(!C.hasClass("fixed")){C.style.transition="none";C.addClass("fixed");A.addClass("fixed");C.removeClass("static");A.removeClass("static");C.style.top="-52px";setTimeout(function(){C.style.transition="";C.style.top=0;x();window.fireEvent("scrollingTabs_updateTabBar",{height:C.offsetHeight})},1)}}};return{init:function(){var B=ta.find(".persistent_tabs_container"),D=ta.find(".persistent_tabs_header");if(!B||!D){return}var C=B.getHeight()+24;var A=B.getHeight()+28;s=new ta.widgets.ScrollingTabs(window,".scroll_tabs",true,C,A);s.init();s.setCallback("tabChangeOnScroll",function(F,E,G){ta.trackEventOnPage("Tab_Bar",(G.id+"_SCROLL"),G.id)});s.setCallback("afterScroll",function(F,E,G){r(F,E,G);if(Browser.name.toLowerCase()==="firefox"){s.init();s.show(ta.id(G.getAttribute("data-tab")),1);s.setCallback("afterScroll",null)}});if(window.addEventListener){window.addEvent("scroll",w)}else{window.attachEvent("onscroll",w)}x();w();var z=ta.id("PERSISTENT_TAB_HEADER");z&&z.removeClass("invisible")},clickTab:function(D){var C=s.getTabAnchor(D);var A=ta.id("PAGE");if(!C||!A){return}var F=A.getElement(".tabsSpacer");if(F){var E=A.getHeight()-C.getPosition(A).y-F.getHeight();if(E<window.getHeight()){var z=window.getHeight()-E;if(z>parseInt(F.style.height,10)){F.style.height=z+"px"}}}var B=80;var G=300;s.show(D,G,B);return false},update:w}})();return{tabs:m,init:function(p){if(p&&p>0){e=p}n=ta.select("[data-module]");var q=ta.find(".weatherUnits .selected");d=q&&q.getAttribute("data-unit");g("load");h();i();window.addEvent("scroll",function(){g("scroll");l();b()});var o=ta.find(".navLinks .guides");if(o){ta.trackEventOnPage("Tourism","Nav","guide-nav-show-"+o.getAttribute("data-label"),0)}m.init()},showNextChildPage:function(){k++;var o=ta.find(".popularCities");if(o&&e>0){var p={geo:e,offset:k-1,desktop:true};new Request({url:"/TourismChildrenAjax",data:p,method:"get",evalScripts:true,onSuccess:function(r){var q=o.innerHTML+r;o.innerHTML=q;if(k>=ta.retrieve("tourism.popularCitiesMaxPage")){ta.select(".morePopularCities").destroy()}}}).send()}},linkClick:function(p,q,o){var r=new Event(o||window.event);if(r.target){var s=r.target;if(!s.href){s=s.getElement("a")||s.getParent("a")}if(s&&s.getAttribute("data-trk")){q=s.getAttribute("data-trk")}if(s&&s.href){ta.setEvtCookie("Tourism",p,q,0,s.href)}}},trackImpressionEvent:function(){var p=ta.find(".restaurants");var o=p.getBoundingClientRect();if(o.top>=0){ta.trackEventOnPage("Tourism","Impression_Test","tours_and_tickets")}},nonLinkClick:function(q,r,p){var s=new Event(p||window.event);if(s.target){var o=s.target;if(o&&o.getAttribute("data-trk")){r=o.getAttribute("data-trk")}ta.trackEventOnPage("Tourism",q,r,0)}},noFriendTease:function(p){if(!p||(ta.retrieve("facebook.session.available"))==false){return}var o=p.toString();if(o!="not_authorized"){this.showNoFriendTease()}else{this.showFBConnectTease()}},showNoFriendTease:function(){this.showFirstOfSelect(".travelersReviewed","block");this.showFirstOfSelect(".geoBox.wrap","none");this.showFirstOfSelect(".FBCover","none");this.showFirstOfSelect(".downloadAppSection.wrap","none");this.showFirstOfSelect(".FBThumb","block");this.showFirstOfSelect(".firstOfFriends","block");this.showFirstOfSelect(".findAPlace","block")},showFBConnectTease:function(){this.showFirstOfSelect(".geoBox.wrap","block");this.showFirstOfSelect(".FBCover","block")},showFirstOfSelect:function(p,o){var q=ta.find(p);if(q){q.style.display=o}},friendsLoaded:function(){this.showFirstOfSelect(".travelersReviewed","none");this.showFirstOfSelect(".FBThumb","none");this.showFirstOfSelect(".firstOfFriends","none");this.showFirstOfSelect(".findAPlace","none");var s=ta.select(".highlight #FRIEND_GRID .item");if(s.length==0){return}var u=document.getElement(".downloadAppSection");if(u){u.destroy()}var t=6;var r=ta.select(".highlight .geoBox .item");var p=r.length;if(s.length<=t){p=t*2}else{if(s.length<=t*2){p=t}else{p=0}}if(p==0){var q=document.getElement(".highlight .geoBox");if(q){q.destroy()}}else{if(p<r.length){for(var o=r.length-1;o>=p;o--){r[o].destroy()}}}var q=ta.id("FRIEND_GRID");if(q){q.style.display="block"}},toggleWeatherUnit:function(q,o,p){if(p==d){return}d=p;o.getSiblings().toggleClass("selected");o.toggleClass("selected");ta.select(".weatherInfo .temps").toggleClass("hidden")},showGeoDescription:function(q,o){var p=ta.retrieve("tourism.fullDescription");if(p){new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 dg descriptionLB",content:"<p>"+p+"</p>"})}},trackTourismFollowEventOnPage:function(o){if(!ta.has("tourism_followed")){ta.store("tourism_followed",true);ta.trackEventOnPage("tourism_follow","click")}if(window.event){window.event.cancelBubble=true}else{o.stopPropagation()}},trackTourismFollowEventOnNextPage:function(o){ta.setEvtCookie("tourism_follow","click","",0,"/twsubscriptions");if(window.event){window.event.cancelBubble=true}else{o.stopPropagation()}},showTourismBrandBubble:function(){if(window.setTimeout){window.setTimeout(function(){ta.servlet.Tourism.showTourismBrandBubbleContent()},1000)}},showTourismBrandBubbleContent:function(){var p=ta.id("tourismBrandBubble");if(p&&p.getStyle("display")=="none"){p.setStyle("opacity",0);p.setStyle("display","block");var o=new Fx.Tween(p,{duration:1000,property:"opacity"});o.start(0,1)}},hideTourismBrandBubble:function(){if(window.setTimeout){window.setTimeout(function(){ta.servlet.Tourism.hideTourismBrandBubbleContent()},8000)}},hideTourismBrandBubbleContent:function(){var p=ta.id("tourismBrandBubble");if(p&&p.getStyle("display")=="block"){var o=new Fx.Tween(p,{duration:1000,property:"opacity"});o.start(1,0);if(window.setTimeout){window.setTimeout(function(){ta.id("tourismBrandBubble").setStyle("display","none")},1000)}}},clickTab:function(o){ta.trackEventOnPage("Tab_Bar",o.id);m.clickTab(o)},clickDmoTabPart:function(o){ta.trackEventOnPage("Tab_Bar","TABS_DMO",o)},clickDmoTab:function(o){m.clickTab(o)},clickDestinationResourceLink:function(o){this.clickTourismLink("destination_"+o.toLowerCase()+"_link")},clkDestRsrceLnkId:function(o,p){this.clickTourismLinkWithId("destination_"+o.toLowerCase()+"_link",p)},clickTourismLink:function(o){ta.trackEventOnPage("dmo_tourism_links",o)},clickTourismLinkWithId:function(o,p){ta.trackEventOnPage("dmo_tourism_links",o,p,p)},clickTrvlGuideLink:function(t,r,p,q,o,s,u){if(o=="TripList"){ta.trackEventOnPage("Tourism",p,q)}else{ta.trackEventOnPage("Traveler_Guide",p,q);ta.setEvtCookie("TravelGuides","guideClick",s,u,r.href)}},trkDmoClick:function(o){ta.trackEventOnPage("Tourism","DMO",o)},trkDmoContentClick:function(r,p,o){var q=encodeURIComponent((p||""));ta.trackEventOnPage("DMO_content_click",q,o,r)}}})();ta.widgets.slider={handleSeparation:10,isRtl:function(){return ta.util.i18n.isRtl()},getValue:function(c,b){var a="";if(this.isRtl()){if(c.style.right&&c.style.right.trim()!=""){a=c.style.right}else{a=b.style.left}}else{a=c.style.left}if(a!=""){return a.toFloat()}return 0},resetHooks:function(e){var d=e.hasClass("slider_redesign")?e:e.getElement(".slider_redesign");var c=d.className;var b=parseFloat((c.match(/min_(\d+)/)[1]).replace("_","."));var a=parseFloat((c.match(/max_(\d+)/)[1]).replace("_","."));return this.setHooks(e,b,a)},setHooks:function(q,e,g,d,f){var m=q.hasClass("slider_redesign")?q:q.getElement(".slider_redesign");var h=m.className;var o=parseInt(h.match(/steps_(\d+)/)[1]);var k=parseFloat((h.match(/min_(\d+)/)[1]).replace("_","."));if(d&&k!=d){m.removeClass("min_"+k);m.addClass("min_"+d);k=d}var n=parseFloat((h.match(/max_(\d+)/)[1]).replace("_","."));if(f&&n!=f){m.removeClass("max_"+n);m.addClass("max_"+f);n=f}if(e<k){e=k}if(g>n){g=n}var i=parseInt(h.match(/width_(\d+)/)[1])-this.handleSeparation;var c=m.hasClass("maxAllInclusive");var p=i/(o-1);var a=(n-k)/(o-1);var l=(e-k)/a;var r=(g-k)/a;this.updateEnd(m.getElement(".handle-left"),this.isRtl()?r:l,p,true);this.updateEnd(m.getElement(".handle-right"),this.isRtl()?l:r,p,false);this.updateBar(m.getElement(".slider-range"),l,r,p,"set");var b=c&&(g>=n);if(m.id=="priceSelect"){this.priceUpdate(q,e,g,b)}else{if(m.id=="ratingSelect"){this.ratingUpdate(q,e,g,b)}else{if(m.id=="bedroomsSelect"){this.bedroomsUpdate(q,e,g,b)}else{this.simpleUpdate(q,e,g,b)}}}var t=q.getElement(".minMax");var s=t.value;var j=this.updateMinMax(t,l,r,a,o,k);return s!=j},updateMinMax:function(f,g,b,a,c,e){var d=(g<=0?0:g*a+e)+","+(b>=(c-1)?999999:b*a+e);f.value=d;return d},updateEnd:function(d,c,e,b){var a=c*e+(this.isRtl()^b?0:this.handleSeparation);if(this.isRtl()){d.setStyle("right",a+"px");d.setStyle("left","")}else{d.setStyle("left",a+"px");d.setStyle("right","")}return a},updateBar:function(b,g,d,f){if((g>d)){g^=d;d^=g;g^=d}var a=g*f;var c=(d*f+this.handleSeparation)-a;if(c<0){c*=-1}var e=this.isRtl()?"right":"left";if(this.isRtl()){b.setStyle("right",a)}else{b.setStyle("left",a)}b.setStyle("width",c)},initSliderInfo:function(e){var d={};var c=e.className;d.width=parseInt(c.match(/width_(\d+)/)[1])-this.handleSeparation;d.steps=parseInt(c.match(/steps_(\d+)/)[1]);d.min=parseFloat((c.match(/min_(\d+)/)[1]).replace("_","."));d.max=parseFloat((c.match(/max_(\d+)/)[1]).replace("_","."));d.stepSize=(d.max-d.min)/(d.steps-1);d.maxAllInclusive=e.hasClass("maxAllInclusive");d.snapDistance=d.width/(d.steps-1);d.rangeBar=e.getElement(".slider-range");d.minMax=e.getElement(".minMax");d.startMinMax=d.minMax.value;d.singleValue=e.hasClass("singleValue");var f=e.getParent().getElement(".handle-left");var b=e.getParent().getElement(".handle-right");var g=this.getValue(f,b);var a=this.getValue(b,f);if(this.isRtl()){g-=this.handleSeparation}else{a-=this.handleSeparation}d.leftStep=this.getClosestStep(g,d);d.rightStep=this.getClosestStep(a,d);return d},setSliderTarget:function(b,a){if(b.hasClass("handle-left")){a.target=b.getParent().getElement(".handle-left");if(this.isRtl()){a.limits=[a.rightStep+(a.singleValue?0:1),a.steps-1]}else{a.limits=[0,a.rightStep-(a.singleValue?0:1)]}a.isLeftHook=true}else{a.target=b.getParent().getElement(".handle-right");if(this.isRtl()){a.limits=[0,a.leftStep-(a.singleValue?0:1)]}else{a.limits=[a.leftStep+(a.singleValue?0:1),a.steps-1]}a.isLeftHook=false}return a},handleMouseDown:function(f,a){var d=new Event(f);if(d){d.stop();var c=ta.id(d.target);if(c){var b=this.initSliderInfo(c.getParent());b=this.setSliderTarget(c,b);b.snapCallBack=a.bind(this);b.dragHandle=this.handleMouseMove.bind(this);b.upHandle=this.handleMouseUp.bind(this);document.addListener("mousemove",b.dragHandle);document.addListener("mouseup",b.upHandle);document.addListener("touchmove",touchHandler);document.addListener("touchend",touchHandler);b.offset=c.getParent().getCoordinates().left+10+(b.isLeftHook?0:this.handleSeparation);ta.store("slider_info",b)}}},getClosestStep:function(a,b){return Math.round(a/b.snapDistance)},handleMouseMove:function(d){d=new Event(d);var b=ta.retrieve("slider_info");if(b&&b.target){var c=d.page.x-b.offset;var a=this.getClosestStep(c,b);if(this.isRtl()){a=b.steps-a-1}if(a<b.limits[0]){a=b.limits[0]}else{if(b.limits[1]<a){a=b.limits[1]}}this.sliderDrag(d,a,b,c)}d.stop()},sliderDrag:function(d,g,j,i){if(d){d.stop();var a=j.isLeftHook?g:j.leftStep;var h=j.isLeftHook?j.rightStep:g;this.updateEnd(j.target,g,j.snapDistance,j.isLeftHook);this.updateBar(j.rangeBar,a,h,j.snapDistance);this.updateMinMax(j.minMax,a,h,j.stepSize,j.steps,j.min);ta.store("slider_info",j);if(j.snapCallBack){var b=(this.isRtl()?h:a)*j.stepSize+j.min;var f=(this.isRtl()?a:h)*j.stepSize+j.min;var c=j.maxAllInclusive&&(f==(j.steps-1)*j.stepSize+j.min);j.snapCallBack(j.target,b,f,c)}}},handleMouseUp:function(b){b=new Event(b);if(b){b.stop()}var a=ta.remove("slider_info");if(a){document.removeListener("mousemove",a.dragHandle);document.removeListener("mouseup",a.upHandle);document.removeListener("touchmove",touchHandler);document.removeListener("touchend",touchHandler);a.dragHandle=null;a.upHandle=null;if(a.minMax.value!=a.startMinMax){sliderMoved()}}},currencyUpdate:function(){ta.util.error.record({name:"Deprecated",message:"ta.widgets.Slider.currencyUpdate will be going away soon and should not be used."},"Slider JS Cleanup",null,null,"WARN");var b=ta.id("l1currency");if(!b){return}var f=ta.retrieve("ta.currencyHash");if(!f){return}var h=f[parseInt(b.value)];var k=ta.id("pricePeriod_w");if((k!=null)&&k.checked){var j=ta.retrieve("ta.weekCurrencyHash");if(j){h=j[parseInt(b.value)]}}var i=ta.id("priceSelect").getParent();var a=i.getElement(".slider_redesign");var g=a.className;var d=currencyCodes[parseInt(i.getElement("select").value)];var c=ta.has("hacform.slider.price.min")?ta.remove("hacform.slider.price.min"):h.selMin;var e=ta.has("hacform.slider.price.max")?ta.remove("hacform.slider.price.max"):h.selMax;a.className=g.replace(/steps_\d+/,"steps_"+h.steps);ta.widgets.slider.setHooks(i,c,e,h.min,h.max)},priceUpdate:function(f,d,b,a){if(!f.hasClass("prcRng")){f=f.getParent(".prcRng")}var g=ta.id("l1currency");var e=currencyCodes[parseInt(g.value)];f.getElement(".s_min").innerHTML=ta.util.currency.formatCurrency(d,e);var c=ta.util.currency.formatCurrency(b,e);if(a){c+="+"}f.getElement(".s_max").innerHTML=c},ratingUpdate:function(g,e,c,b){if(!g.hasClass("tvrRtg")){g=g.getParent(".tvrRtg")}var a=e.toPrecision(2);var h=c.toPrecision(2);g.getElement(".s_min").innerHTML=a;g.getElement(".s_max").innerHTML=h;var d=g.getElement(".sLeft .lmtImg").src;g.getElement(".sLeft .lmtImg").src=d.replace(/\d.\d/,a);var f=g.getElement(".sRight .lmtImg").src;g.getElement(".sRight .lmtImg").src=f.replace(/\d.\d/,h)},bedroomsUpdate:function(d,c,b,a){if(d.tagName!="FIELDSET"){d=d.getParent("FIELDSET")}d.getElement(".s_min").innerHTML=(c==0?js_filter_studio:c);d.getElement(".s_max").innerHTML=(b==0?js_filter_studio:(b+(a?"+":"")))},simpleUpdate:function(d,c,b,a){if(d.tagName!="FIELDSET"){d=d.getParent("FIELDSET")}d.getElement(".s_min").innerHTML=c;d.getElement(".s_max").innerHTML=b+(a?"+":"")}};function touchHandler(c){var d=c.changedTouches,e=d[0],a="";switch(c.type){case"touchmove":a="mousemove";break;case"touchend":a="mouseup";break;default:return}var b=document.createEvent("MouseEvent");b.initMouseEvent(a,true,true,window,1,e.screenX,e.screenY,e.clientX,e.clientY,false,false,false,false,0,null);e.target.dispatchEvent(b);c.preventDefault()}if(!window.sliderMoved){window.sliderMoved=function(){if(!window.slidersReady){return}ta.servlet.HACSearch.adjustTopValueState();var a=window.pageServlet=="LocalMapsRedesign";filtersChanged(null,a)}};(function(){var b=new Class({Implements:[Options,Events],URL_SAVE_CONTROLLER:"/SavesAjax",parentName:null,parentFolderId:0,entityId:0,entityType:5,securityToken:"",guideId:0,tripGuideId:0,savedItems:{},sessionSavedItems:[],isUserLoggedIn:false,options:{savesTree:null,useNewRegOverlay:false},initialize:function(c){this.setOptions(c);if(this.options.savesTree){this.setSavesTree(this.options.savesTree)}this.addEvent("saveCompleteForTracking",this.trackSuccessfullSave);ta.on("regUpdateMember",function(){ta.widgets.Saves.setLoggedIn(true);ta.widgets.SavesButtons.refresh()});this.securityToken=window.JS_SECURITY_TOKEN||""},refresh:function(c){this.setOptions(c);if(this.options.savesTree){this.setSavesTree(this.options.savesTree)}},openSavesHoverRegflow:function(d){var g=ta.widgets.Saves;var f=1;if(d&&d.target&&d.target.getParent(".listing")){f=d.target.getParent(".listing").get("data-rankInList")}ta.trackEventOnPage("HoverSave","saveIntent",g.entityId,f,false);ta.store("registration.ga_module","SavesHover");if(g.options.useNewRegOverlay){if(g.isUserLoggedIn){g.refreshLoggedInHoverSaves()}else{var e={flow:"CORE_COMBINED",pid:39766,userRequestedForce:true,onSuccess:function(){ta.widgets.Saves.refreshLoggedInHoverSaves()}};ta.call("ta.registration.RegOverlay.show",d,d.target,e)}}else{if(ta.retrieve("secure_registration.enabled")){var c=ta.registration.register({product:"SAVES_HOVER",popup:true,successAction:"ta.widgets.Saves.refreshLoggedInHoverSaves",data:function(){return{type:g.entityType,entity:+g.entityId}}});if(c){g.refreshLoggedInHoverSaves()}}else{ta.overlays.registration.connect({flow:"SAVES_HOVER"},"SIGNUP")}}},openMastheadRegflow:function(c){ta.store("registration.ga_module","Masthead");ta.overlays.registration.connect({flow:"MASTHEAD"},"SIGNUP")},trackSuccessfullSave:function(e,c,d){if(!e){return}ta.trackEventOnPage("HoverSave","saveComplete",c,1,false);new Request({url:"/ActionRecord?action=Save_Completed"}).send()},setSavesTree:function(){},getSavesTree:function(c){if(this.options.savesTree&&!c){return this.options.savesTree}else{}},_logAjaxError:function(e,f,c,d){var g=new Error();g.name=f;g.message=e&&e.error||c;ta.util.error.record(g,d,null,null,"WARN")},saveCall:function(f,d){var h=this;this.entityType=f;this.entityId=d;for(var c in this.sessionSavedItems){if(this.entityId==this.sessionSavedItems[c]){this.showSaved();return}}var g={action:"SAVE_ITEM",entity:this.entityId,type:this.entityType,token:this.securityToken};var e=new Request({url:this.URL_SAVE_CONTROLLER,data:g,onRequest:function(){h.fireEvent("saveComplete",[true,d,f])},onSuccess:function(i){var k=false;i=JSON.decode(i);if(!i){return}if(i.error){if(i.error=="DUPITEM"){h.fireEvent("saveComplete",[k,d,f]);h.fireEvent("saveCompleteForTracking",[k,d]);ta.widgets.SavesButtons.refresh()}h._logAjaxError(i,"saves save item","Error while calling SAVE_ITEM with entityId: "+d+" and entityType: "+f+".","saveCall");return}else{k=true}var j;if(k&&i.id){j=i.id;if(j<-3){ta.run("ta.overlays.Factory.openMastheadRegflow")}}h.fireEvent("saveComplete",[k,d,f,j,i.folderid,h.btn]);h.fireEvent("saveCompleteForTracking",[k,d,j,i.folderid,h.btn]);h.entityId=0;h.btn=null}}).send();return e},unsaveCall:function(g,c,e){var h=this;e=e||5;var f={action:"DELETE_ITEM",id:g,token:this.securityToken};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onRequest:function(){h.fireEvent("unsaveComplete",[true,g,c,e])},onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){h._logAjaxError(i,"saves unsave item","Unknown error while deleting : "+g,"unsaveCall")}}h.fireEvent("unsaveComplete",[i,g,c,e])}}).send();return d},saveGuideCall:function(c){var e=this;var d={action:"SAVE_GUIDE",guideid:c,token:this.securityToken};new Request({url:this.URL_SAVE_CONTROLLER,data:d,onSuccess:function(g){var i=true;var h=null;var f=null;g=JSON.decode(g);if(!g||g&&g.error){i=false;e._logAjaxError(g,"saves save guide","Unknown error while saving guide : "+c,"saveGuideCall")}else{h=g.folder;f=g.items}this.guideId=0;e.fireEvent("saveGuideComplete",[i,h,f]);ta.trackEventOnPage("GuideSave","saveComplete",c,1,false);new Request({url:"/ActionRecord?action=Guide_Save_Completed"}).send()}}).send()},saveTripGuideCall:function(c){var e=this;var d={action:"SAVE_TRIP_GUIDE",guideid:c,token:this.securityToken};new Request({url:this.URL_SAVE_CONTROLLER,data:d,onSuccess:function(g){var i=true;var h=null;var f=null;g=JSON.decode(g);if(!g||g&&g.error){i=false;e._logAjaxError(g,"saves save tripguide","Unknown error while saving tripguide : "+c,"saveTripGuideCall")}else{h=g.folder;f=g.items}this.guideId=0;e.fireEvent("saveTripGuideComplete",[i,h,f]);ta.trackEventOnPage("TripGuideSave","saveComplete",c,1,false);new Request({url:"/ActionRecord?action=Trip_Guide_Save_Completed"}).send()}}).send()},getSavesCall:function(d){var e=this;var c={action:"FETCH_ALL_ITEMS",};if(!d&&this.options.savesTree){e.fireEvent("retrievedSaves",[this.options.savesTree])}new Request({url:this.URL_SAVE_CONTROLLER,data:c,method:"GET",onSuccess:function(f){f=JSON.decode(f);if(!f||f&&f.error){e._logAjaxError(f,"saves get saves","Unknown error while fetching items.","getSavesCall")}else{e.savedItems=f}e.fireEvent("retrievedSaves",[f])}}).send()},moveCall:function(g,c,e){var h=this;var f={action:"MOVE_ITEM",id:g,folder:c,token:this.securityToken};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){h._logAjaxError(i,"saves move item","Unknown error while moving : "+g,"moveCall")}}h.fireEvent("moveComplete",[i,g,c,e])}}).send();return d},addNoteCall:function(f,c,h){var g=this;var e={action:"ADD_NOTE",id:f,note:c,token:this.securityToken};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){g._logAjaxError(i,"saves add note","Unknown error while adding note to : "+f,"addNoteCall")}}g.fireEvent("addNoteComplete",[i,f,c]);if(typeof h=="function"){h(i,f,c)}}}).send();return d},addFolderNoteCall:function(c,d,h){var g=this;var f={action:"ADD_FOLDER_NOTE",id:c,note:d,token:this.securityToken};var e=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){g._logAjaxError(i,"saves add folder note","Unknown error while adding folder note to : "+c,"addFolderNoteCall")}}g.fireEvent("addFolderNoteComplete",[i,c,d]);if(typeof h=="function"){h(i,c,d)}}}).send();return e},createFolderCall:function(c,g){var f=this;var e={action:"CREATE_FOLDER",name:c,token:this.securityToken};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){f._logAjaxError(i,"saves create folder","Unknown error while creating folder named : "+c,"createFolderCall")}}var h=i&&i.folderid?i.folderid:"";var j=i&&i.foldername?i.foldername:"";f.fireEvent("createFolderComplete",[i,h,j]);if(typeof g=="function"){g(i,h,j)}}}).send();return d},deleteFolderCall:function(c,g){var f=this;var e={action:"DELETE_FOLDER",id:c,token:this.securityToken};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onSuccess:function(h){if(h!=""){h=JSON.decode(h);if(!h||h.error){f._logAjaxError(h,"saves delete folder","Unknown error while deleting folder : "+c,"deleteFolderCall")}}f.fireEvent("deleteFolderComplete",[h,c]);if(typeof g==="function"){g(h,c)}}}).send();return d},renameFolderCall:function(c,d,h){var g=this;var f={action:"RENAME_FOLDER",id:c,name:d,token:this.securityToken};var e=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){g._logAjaxError(i,"saves rename folder","Unknown error while renaming folder of : "+c,"renameFolderCall")}}g.fireEvent("renameFolderComplete",[i,c,d]);if(typeof h==="function"){h(i,c,d)}}}).send();return e},refreshLoggedInHoverSaves:function(){var c=ta.widgets.Saves;if(c.guideId!=0){c.saveGuideCall(c.guideId)}else{if(c.tripGuideId!=0){c.saveTripGuideCall(c.tripGuideId);c.tripGuideId=0}else{c.saveCall(c.entityType,c.entityId)}}},setUseNewRegOverlay:function(c){this.options.useNewRegOverlay=c},setLoggedIn:function(c){this.isUserLoggedIn=c}});if(!ta.widgets.Saves){ta.widgets.Saves=new b()}var a=new Class({Implements:[Options,Events],lastBtnClicked:null,options:{isGuidePage:false,listingClass:"listing"},initialize:function(c){this.setOptions(c);this.PAGE=ta.id("PAGE");ta.widgets.Saves.addEvent("saveComplete",this.setBtnSavedState.bind(this));ta.widgets.Saves.addEvent("unsaveComplete",this.setBtnUnsavedState.bind(this));ta.widgets.Saves.addEvent("retrievedSaves",this.setAllBtnStates.bind(this));ta.widgets.Saves.addEvent("saveGuideComplete",this.onGuideSaved.bind(this));ta.widgets.Saves.addEvent("saveTripGuideComplete",this.onTripGuideSaved.bind(this));ta.queueForReady(function(){var d=ta.id("SAVE_ALL_BUTTON");if(d){d.addEvent("click",function(g){var f=this.get("data-guideid");var e=this.get("data-tripguideid");if(f){ta.widgets.Saves.guideId=f;ta.widgets.Saves.btn=this;ta.call("ta.overlays.Factory.openSavesHoverRegflow",g)}else{if(e&&!this.hasClass("saved")){ta.widgets.Saves.tripGuideId=e;ta.widgets.Saves.btn=this;ta.call("ta.overlays.Factory.openSavesHoverRegflow",g)}}g.preventDefault()})}})},refresh:function(){ta.widgets.Saves.getSavesCall()},bindListingEvents:function(){var d=this;var c=$$("."+this.options.listingClass);if(!c||!c.length){return}c.removeEvents("mouseenter").removeEvents("mouseleave").addEvents({mouseenter:function(){d.overHover(this)},mouseleave:function(){d.outHover(this)}})},setBtnSavedState:function(d,e,h,i,c,f){var g=this.getBtnsByEntityId(e,h);if(g.length){this.showSaved(g,i)}if(this.lastBtnClicked&&e==this.lastBtnClicked.get("data-locationid")){this.showSaveAlert(this.lastBtnClicked)}},setBtnUnsavedState:function(c,g,d,f){var e=this.getBtnsByEntityId(d,f);if(e.length){this.showUnsaved(e,g)}},setAllBtnStates:function(c){var e=this;if(!c){c=ta.widgets.Saves?ta.widgets.Saves.savedItems:{}}Object.each(c,function(h,f){var g=e.getBtnsByEntityId(h.entityId,h.entityType);if(g&&g.length){e.showSaved(g,f)}});ta.select(".savesHover").each(function(f){e.bindBtnEvents(f)});var d=ta.id("HEADING_GROUP");if(d){d.getElements(".savesContainer, .savesHover").setStyles({visibility:"visible",display:"block"})}if(this.options.isGuidePage){this.setGuideSaveState()}if(!isTabletOnFullSite){this.bindListingEvents()}},setGuideSaveState:function(e){var d=ta.id("GUIDE_DETAIL");if(!d){return}var c=d.getElements(".savesHover");var f=c.filter(".saved");if(e===true||c.length==f.length){ta.id("SAVE_ALL_BUTTON")&&ta.id("SAVE_ALL_BUTTON").hide();ta.id("ALL_SAVED_BUTTON")&&ta.id("ALL_SAVED_BUTTON").show()}else{if(e===false||c.length!=f.length){ta.id("ALL_SAVED_BUTTON")&&ta.id("ALL_SAVED_BUTTON").hide();ta.id("SAVE_ALL_BUTTON")&&ta.id("SAVE_ALL_BUTTON").show()}}},onGuideSaved:function(e,d,c){var f=this;if(e){this.setGuideSaveState(true);if(c&&c.length){c.each(function(h,g){var j=f.getBtnsByEntityId(h.entityid);f.showSaved(j,h.id)})}}},onTripGuideSaved:function(e,d,c){var f=this;if(e){ta.store("tripGuideSavedFolder",d.folderid);f.swapSaveText(ta.widgets.Saves.btn);ta.widgets.Saves.btn.addClass("saved");if(c&&c.length){c.each(function(h,g){var j=f.getBtnsByEntityId(h.entityid);f.showSaved(j,h.id)})}}},bindBtnEvents:function(e){var j=this;var f=e.getParent();var m=f.getElement(".saveOptions");e.removeEvents();if(m){m.getElement(".btn-delete").removeEvents()}if(e.hasClass("saved")){var i=e.get("data-locationid");var h=e.get("data-entity-type")||5;var l=e.get("data-saveitemid");if(e.hasClass("savesHover-confirm-delete")){e.addEvent("click",function(){if(!m.isDisplayed()){j.showPositionedTip(this)}else{j.hidePositionedTip(m)}});m.getElement(".btn-delete").addEvent("click",function(){ta.widgets.Saves.unsaveCall(l,i,h);j.hidePositionedTip(m)})}else{e.addEvent("click",function(){ta.widgets.Saves.unsaveCall(l,i,h)})}j.closeHoverAlert(e)}else{var c=e.getParent(".savesContainer");if(c){var g=c.getElement(".hoverAlert");if(g){var d=false;e.addEvent("mouseenter",function(){if(!d){ta.trackEventOnPage("HoverSave","saveHover",i,1,false);d=true}j.showHoverAlert(e)});e.addEvent("mouseleave",function(){j.closeHoverAlert(e)})}var k=c.getElement(".saveAlert");if(k){j.closeSaveAlert(k)}}e.addEvent("click",function(p){var n=this.get("data-locationid");if(!n){return}var o=this.get("data-entity-type");if(!o){o=5}ta.widgets.Saves.entityId=n;ta.widgets.Saves.entityType=o;ta.widgets.Saves.btn=this;j.lastBtnClicked=this;ta.widgets.Saves.openSavesHoverRegflow(p);ta.trackEventOnPage("Saves","HoverButton",n,o)})}},overHover:function(e){e=ta.id(e);if(!e.hasClass("promoted")){if(!ta.isMetaHotels2013()&&!ta.has("meta.mini_meta_on_accommodations")){e.setStyle("background-color","#f1f1f1")}else{var d=e.getElement(".metaDisclaimer");if(d){d.setStyle("visibility","visible")}}}var c=e.getElement(".savesHover");if(c&&!c.hasClass("saved")&&c.hasClass("invisible")){c.removeClass("invisible")}var f=e.getElement(".hideHover");if(f&&f.hasClass("invisible")){f.removeClass("invisible")}},outHover:function(e){e=ta.id(e);if(!e.hasClass("promoted")){if(!ta.isMetaHotels2013()&&!ta.has("meta.mini_meta_on_accommodations")){e.setStyle("background-color","#fff")}else{e.removeClass("hoverShadow");var d=e.getElement(".metaDisclaimer");if(d){d.setStyle("visibility","hidden")}}}var c=e.getElement(".savesHover");if(c&&!c.hasClass("vr-heartContainer")&&!c.hasClass("saved")&&!c.hasClass("invisible")){c.addClass("invisible")}var f=e.getElement(".hideHover");if(f&&!f.hasClass("invisible")){f.addClass("invisible")}},getBtnsByEntityId:function(e,h){var c=ta.select(".savesHover-"+e);if(!c){return c}if(!h){return c}var g=[];var d;for(var f=0;f<c.length;f++){d=c[f].get("data-entity-type")||5;if(d==h){g.push(c[f])}}return g},showUnsaved:function(c,i){var e=this;if(c){if(c.length){c.each(function(l){e.showUnsaved(l,i)});return}if(c.hasClass("saved")){this.swapSaveText(c)}c.removeClass("saved");c.removeProperty("data-saveitemid");var f=c.getElement(".sprite-star_green");if(f){var g="sprite-star_gray";var k="sprite-star_green";f.addClass(g).removeClass(k)}if(c.getElement(".vr-icon")){var h=c.getElement(".vr-icon");if(h.hasClass("saved")){h.removeClass("saved");h.addClass("save");ta.vr.actionRecord("Unsave_VRR")}}var j=c.getElement(".sprite-hoverArrow");if(j){j.hide();var d=c.getElement(".vr_button_silver_border");if(d){d.removeClass("vr_button_silver_border").addClass("vr_button_silver")}}this.bindBtnEvents(c)}},showSaved:function(c,i){var e=this;if(c){if(c.length){c.each(function(m){e.showSaved(m,i)});return}if(!c.hasClass("saved")){this.swapSaveText(c)}c.addClass("saved");c.set("data-saveitemid",i);c.removeClass("invisible");var l=c.getElement(".sprite-save");if(l){l.hide()}var f=c.getElement(".sprite-star_gray");if(f){var g="sprite-star_green";var k="sprite-star_gray";f.addClass(g).removeClass(k)}if(c.getElement(".vr-icon")){var h=c.getElement(".vr-icon");if(h.hasClass("save")){h.removeClass("save");h.addClass("saved");if(h.hasClass("initial")){h.removeClass("initial")}else{ta.vr.actionRecord("Save_Success_VRR")}}}var j=c.getElement(".sprite-hoverArrow");if(j){j.show();var d=c.getElement(".vr_button_silver");if(d){d.removeClass("vr_button_silver").addClass("vr_button_silver_border")}}this.bindBtnEvents(c)}},swapSaveText:function(d){var c;var e;if(d.hasClass("vr-heartContainer")){c=d.getElement(".vr-saved");e=d.getElement(".vr-unsaved")}else{c=d.getElement(".saves-hover-txt-saved");e=d.getElement(".saves-hover-txt")}if(c){this.toggleVisibility(c)}if(e){this.toggleVisibility(e)}},toggleVisibility:function(c){var d=!ta.has("fall_2013_hr_saves_right");var f=d?c.isVisible():c.getStyle("visibility")!=="hidden";if(f){if(d){c.hide()}else{c.setStyle("visibility","hidden")}}else{if(d){var e;if(c.getParentBySelector("#why_ta_saves")){e="block"}else{e="inline"}c.show(e)}else{c.setStyle("visibility","visible")}}},hidePositionedTip:function(c){if(c){c.hide()}},showPositionedTip:function(d,c){var e=d.getParent();var f=e.getElement(".saveOptions");if(!f){if(typeof c=="function"){c()}return}f.show()},showSaveAlert:function(g){var c=g.getParent(".savesWrap");var h=c?c.getElement(".saveAlert"):null;if(!h){return}if(ta.has("meta.full_meta_photos")&&!ta.has("meta.full_meta_photos_v3")){if(ta.id("SAVES")){var f=32;var d=-5;h.setStyles({top:f,left:d}).show()}}else{h.show()}var e=this;setTimeout(function(){e.closeSaveAlert(h,h)},5000)},closeSaveAlert:function(c){c=ta.id(c);if(c){c.hide()}},showHoverAlert:function(d){var c=d.getParent(".savesWrap");var e=c?c.getElement(".hoverAlert"):null;if(!e){return}e.show()},closeHoverAlert:function(d){var c=d.getParent(".savesWrap");var e=c?c.getElement(".hoverAlert"):null;e=ta.id(e);if(!e){return}if(e){e.hide()}},assetsLoaded:function(){if(ta.id("SAVES")){ta.id("SAVES").setStyle("top",ta.id("HEADING").getTop()-123);ta.id("SAVES").show()}},assetsLoadedHeader:function(){var d=ta.id("SAVES");var c=ta.id("HR_HACKATHON_CONTENT");if(d&&c&&!ta.has("meta.full_meta_photos")&&!ta.has("feature.hr_css_reduction")){d.setStyle("top",c.getCoordinates().top);d.show()}},loadSavesButton:function(d,g,e,c,f){if(!ta.retrieve("saves_button_"+d)){ta.store("saves_button_"+d,true);if(ta.id("saves_placeholder_"+d)){new Request({url:"/SavesButtonAjax",onSuccess:function(i){try{if(i&&i.trim()!="BAD_REQUEST"){ta.id("saves_placeholder_"+d).innerHTML=i;ta.select(".savesHover-"+d).each(function(j){ta.widgets.SavesButtons.bindBtnEvents(j);j.removeClass("invisible")})}else{ta.util.error.record(null,"Failed to load saves button BAD_REQUEST",null,{DBLE_ID:d},"WARN")}}catch(h){ta.util.error.record(h,"Failed to load saves button",null,{DBLE_ID:d})}},data:{pop:g,del:e,dble:d,head:c,referringServlet:f},evalScripts:true,method:"get"}).send()}}},loadAllSavesButtons:function(){if(!ta.has("SAVES_BUTTONS_LOADED")&&typeof saveLocationsOnPage!="undefined"){ta.store("SAVES_BUTTONS_LOADED",true);window.removeEvent("scroll",ta.widgets.SavesButtons.loadAllSavesButtons);new Request({url:"/SavesButtonAjax",onSuccess:function(f){try{if(f&&f.trim()!="BAD_REQUEST"){var d=JSON.decode(f);if(d){d.each(function(g){var e=ta.id("saves_placeholder_"+g.id);if(e){e.innerHTML=ta.util.escaping.escapeHTMLSafe(g.html)}});ta.select(".savesHover").each(function(e){ta.widgets.SavesButtons.bindBtnEvents(e)})}}else{ta.util.error.record(null,"Failed to load saves buttons BAD_REQUEST",null,null,"WARN")}}catch(c){ta.util.error.record(c,"Failed to load saves buttons")}},data:{locations:saveLocationsOnPage.join()},evalScripts:true,method:"post"}).send()}}});if(!ta.widgets.SavesButtons){ta.widgets.SavesButtons=new a({})}})();ta.overlays.BACKDROP_NEVER=0;ta.overlays.BACKDROP_ALWAYS=1;ta.overlays.Overlay=new Class({Implements:[Options,Events],Binds:["_hide","show","hide","destroy","hideByClickOnDocument"],options:{requestData:null,showCloseButton:false,noPadding:false,noCpu:false,closeButtonClass:"close",closeLink:"",showArrow:false,arrowClassLeft:null,arrowClassRight:null,arrowClass:"ttarrow",style:"typeO",innerDivClass:"inner",backdrop:ta.overlays.BACKDROP_NEVER,backdropZIndex:"default",permanent:false,permanent_except_same:false,type:"",isChild:false,remoteContent:null,maintainCrPageServlet:false,keepElementInDocument:false,requestMethod:"get",zIndex:1001,positionType:"absolute",draggable:false,draggingClass:"dragging",title:null,onscroll:null,noScroll:false,noScrollY:false,backdropClickClose:false,backdropColor:"#000",backdropOpacity:0.6,offsetRight:0,offsetLeft:0,offsetTop:0,offsetBottom:0,closeOnDocumentClick:false,track:false,positionByOffsets:false,useTransparentOverlayPadding:false,transparentOverlayPaddingValue:0},initialize:function(k,b){this.noScroll=k.noScroll||k.noScrollY;if(k.noScroll){this.overflowToHide="overflow"}else{if(k.noScrollY){this.overflowToHide="overflow-Y"}}if(this.noScroll){var a=k.onShow;k.onShow=function(){if(a){a()}ta.find("body").setStyle(this.overflowToHide,"hidden")};var j=k.onClose;k.onClose=function(){if(j){j()}ta.find("body").setStyle(this.overflowToHide,"")}}this.setOptions(k);this.source=ta.id(b);this.visible=false;this.backdropOn=false;this.closedByDocClick=false;var h=this.options.style+" overlay";if(this.options.backdrop==ta.overlays.BACKDROP_ALWAYS){h+=" withBackdrop"}else{h+=" noBackdrop"}this.container=new Element("div",{styles:{position:this.options.positionType,left:"-999em",top:"-999em",fontSize:this.options.fontSize||".75em",zIndex:this.options.zIndex},"class":h});if(k.blockSelect){this.container.onselectstart=function(){return false}}this.container.store("overlay",this);this.container.overlay=this;ta.store("overlays.current",this);this._useIframeShim=Browser.ie6;if(this.options.title){this.header=new Element("h1",{"class":"title",html:this.options.title}).inject(this.container);if(this.options.draggable){var i=this.options.draggingClass;var d=function(){};if(this._useIframeShim){d=this.positionShim.bind(this)}if(this.options.useTransparentOverlayPadding){d=this.transparentOverlayPadding.bind(this)}this.drag=new Drag(this.container,{handle:this.header,preventDefault:true,stopPropagation:true,onSnap:function(e){e.addClass(i)},onDrag:d,onComplete:function(e){e.removeClass(i)}})}}this.inner=new Element("div",{"class":this.options.innerDivClass}).inject(this.container);this.inner.id="overlayInnerDiv";var f=this;if(f.options.onscroll){f.inner.addEvent("scroll",function(){f.options.onscroll(f.inner)})}if(this._useIframeShim){this.shim=new IframeShim(this.container,{browsers:true})}if(this.options.useTransparentOverlayPadding){this.transparentOverlayPadding=new Element("div",{"class":"overlayPadding",styles:{position:"absolute","z-index":this.options.zIndex-1}});this.transparentOverlayPaddingValue=this.options.transparentOverlayPaddingValue}var c;if(this.options.content){this.inner.setContent(this.options.content)}else{if(this.options.remoteContent){this.loadRemoteContent(this.options.remoteContent)}else{if(this.source&&(c=this.source.getElement(".overlayContents"))){if(c){this.inner.set("html",c.innerHTML);c.dispose();this.runBehaviorOnFirstShow=true}}}}if(this.options.showCloseButton){this.addCloseButton()}else{if(this.options.setCloseButton){this.setCloseButton()}}if(this.options.showArrow){this.arrow=new Element("div",{styles:{position:"absolute"},"class":this.options.arrowClass}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}}if(this.options.noPadding){if(this.header){this.container.addClass("noPad")}else{this.inner.addClass("noPad")}}if(this.options.noCpu){if(this.header){this.container.addClass("no_cpu")}else{this.inner.addClass("no_cpu")}}this.container.addEvent("trash",this.destroy);if("g_logFactoryMisuse" in window){try{ta.util.error.record(Error(),"Debug: Overlay on HR")}catch(g){}}},addCloseButton:function(){var a=this.options.closeButtonClass;if(ta.has("checkrates.add_holding_windows")){a+=" no_cpu"}this.closeBtn=new Element("div",{styles:{position:"absolute",fontSize:"92.5%",cursor:"pointer"},html:this.options.closeLink,"class":a,events:{click:(function(){this.fireEvent("onClose",this)}).bind(this)}}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}},setCloseButton:function(){if(this.options.closeButtonClass){this.closeBtn=this.container.getElement("."+this.options.closeButtonClass);if(this.closeBtn){this.closeBtn.addEvents({click:(function(){this.fireEvent("onClose",this);this.hide()}).bind(this)})}}},destroy:function(){this.container.overlay=null;if(this.shim){this.shim.destroy();this.shim=null}if(this.transparentOverlayPadding){this.transparentOverlayPadding.destroy();this.transparentOverlayPadding=null}},position:function(){if(this.shim){(function(){this.positionShim()}).delay(10,this)}if(this.transparentOverlayPadding){(function(){this.positionTransparentOverlayPadding()}).delay(10,this)}},positionTransparentOverlayPadding:function(){var b=this.container.getCoordinates();if(!b||!b.left){return}var a=this.transparentOverlayPaddingValue;this.transparentOverlayPadding.setStyles({left:b.left-a,top:b.top-a})},positionShim:function(){var a=this.container.getCoordinates();if(!a||!a.left){return}this.shim.shim.setStyles({left:a.left,top:a.top})},show:function(a){if(typeof(overlayCss)!="undefined"&&!ta.retrieve("ta.overlayCssAsset")){if(this.options.waitForCss){ta.store("ta.overlayCssAsset",ta.css(overlayCss,{onLoad:function(){this._show(a)}.bind(this)}))}else{ta.store("ta.overlayCssAsset",ta.css(overlayCss));this._show(a)}}else{this._show(a)}},_show:function(f){if(this.visible){return}if(f){new Event(f).preventDefault()}this.closedByDocClick=false;var a=ta.util.URL.parse(this.options.remoteContent);if(!this.options.maintainCrPageServlet&&typeof crPageServlet!=="undefined"&&a&&a.test(/\/{1}(\w*)$/)){ta.store("crPageServlet_orig",crPageServlet);crPageServlet=RegExp.$1}$$(".overlay").each(function(c){if(c.overlay){if(c.overlay==this){return}if(this.parentOverlay&&c.overlay==this.parentOverlay){return}if(c.overlay.options.permanent){return}if(c.overlay.options.permanent_except_same&&c.overlay.options.type!=this.options.type){return}c.overlay.hide(f)}},this);var d=ta.id(this.options.parentContainer||document.body);d.adopt(this.container);if(this.shim&&this.shim.shim){d.adopt(this.shim.shim);var e=this.container.getCoordinates();if(e){this.shim.shim.setStyles({display:"block",width:e.width,height:e.height})}}if(this.transparentOverlayPadding){d.adopt(this.transparentOverlayPadding);var e=this.container.getCoordinates();if(e){var b=this.transparentOverlayPaddingValue*2;this.transparentOverlayPadding.setStyles({display:"block",width:e.width+b,height:e.height+b})}}if(this.options.backdrop==ta.overlays.BACKDROP_ALWAYS){this.enableBackdrop()}this.position();if(this.options.closeOnDocumentClick){document.addEvent("click",this._hide.bind(this))}this.visible=true;this.fireEvent("onShow",this);window.fireEvent("onOverlayShow",this);if(ta.has("overlay.onShow")){ta.remove("overlay.onShow").each(function(c){c.call(this)},this)}return this},_setPosition:function(a){if(this.options.parentContainer){var c=Math.abs(this.container.getPosition().x-this.container.offsetLeft);var d=Math.abs(this.container.getPosition().y-this.container.offsetTop);var b={};if(a.left!==undefined){b.left=Math.abs(a.left-c)}if(a.top!==undefined){b.top=Math.abs(a.top-d)}if(a.bottom!==undefined){b.right=Math.abs(a.right-c)}if(a.right!==undefined){b.bottom=Math.abs(a.bottom-d)}this.container.setStyles(Object.merge(a,b))}else{this.container.setStyles(a)}},_hide:function(b){if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}if(!b||this.container.containsEvent(b)){return}if(this.options.pinnable==ta.overlays.PINNABLE_HOVER||this.options.pinnable==ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE){var a=b.target;while(a){if(a==this.source){return}else{a=a.parentElement}}}document.removeEvent("click",this._hide);this.hide(b)},hideByClickOnDocument:function(a){if(ta.retrieve("overlay.dontCloseOnClick")){return}this.closedByDocClick=true;this.hide(a)},hide:function(a){if(window.flyout){window.flyout.hide()}if(this.backdropOn){this.disableBackdrop()}if((this.options.keepElementInDocument&&this.container.style.left=="-999em")||(!this.options.keepElementInDocument&&!this.container.inDocument())){return this}if(this.shim){this.shim.hide().dispose()}if(this.transparentOverlayPadding){this.transparentOverlayPadding.hide().dispose()}this.container.setStyles({left:"-999em",top:"-999em"});if(!this.options.keepElementInDocument){this.container.dispose()}this.visible=false;this.fireEvent("onHide",!a);window.fireEvent("onOverlayClose",this);if(!this.options.maintainCrPageServlet&&ta.has("crPageServlet_orig")){ta.run("ta.meta.linkTracking.restoreCRPageServlet")}if(this.options.closeFunction&&typeof this.options.closeFunction==="function"){this.options.closeFunction(a)}if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}return this},calculateBackdropHeight:function(){return Math.max(window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),document.body.scrollHeight)},configureBackdrop:function(){var b={"class":"overlayBG"};var a;if(this.options.backdropZIndex==="behindOverlay"){a=this.options.zIndex-1}else{if(ta.retrieve("tablet_calendar_update.enabled")){b.events={click:function(d){this.fireEvent("backdropClick",d)}.bind(this)};if(document.getElement(".overlayBG")){this.options.backdropOpacity=0.01}var c=document.getElements(".overlay").length;a+=c*2}else{a=this.options.isChild?10000:9997}}this.backdrop=new Element("div",b);this.backdrop.setStyles({position:"fixed",left:0,top:0,width:"100%",height:this.calculateBackdropHeight(),backgroundColor:this.options.backdropColor,zIndex:a,opacity:this.options.backdropOpacity,filter:"alpha(opacity="+Math.floor(this.options.backdropOpacity*100)+")"});if(this.options.backdropClickClose){this.backdrop.addEvent("click",function(){this.fireEvent("onClose",this);this.hide()}.bind(this))}},updateBackdrop:function(){this.backdrop.setStyles({width:"100%",height:this.calculateBackdropHeight()})},enableBackdrop:function(){try{if(this.backdropOn){return}if(!this.backdrop){this.configureBackdrop()}if(Browser.ie6){var a=this.container;$$("select").each(function(d){if(!a.contains(d)){d.setStyle("visibility","hidden")}else{d.setStyle("visibility","visible")}})}ta.store("overlays.current",this);this.updateBackdrop();if(this.container.inDocument()){this.backdrop.inject(this.container,"before")}else{this.backdrop.inject(document.body)}this.backdropOn=true;if(this.options.backdropZIndex==="behindOverlay"){}else{if(ta.retrieve("tablet_calendar_update.enabled")){var b=document.getElements(".overlay").length;this.container.setStyle("z-index",parseInt(this.backdrop.getStyle("z-index"))+1)}else{this.container.setStyle("z-index",this.options.isChild?"10002":"9998")}}if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #424242")}else{this.container.setStyle("border","5px solid rgba(64,64,64,0.8)")}}}catch(c){ta.util.error.record(c,"Error setting the border property - enableBackdrop")}},disableBackdrop:function(){try{if(!this.backdropOn){return}this.backdrop.dispose();if(ta.retrieve("overlays.current")==this){ta.remove("overlays.current");if(Browser.ie6){$$("select").setStyle("visibility","visible")}}else{if(Browser.ie6&&ta.retrieve("overlays.current")&&!ta.retrieve("overlays.current").backdropOn){$$("select").setStyle("visibility","visible")}}this.backdropOn=false;this.container.setStyle("z-index","1001");if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #b2b2b2")}else{this.container.setStyle("border","5px solid rgba(128,128,128,0.6)")}}}catch(a){ta.util.error.record(a,"Error unsetting the border property - disableBackdrop")}},loadRemoteContent:function(c,a){var b={url:ta.util.URL.parse(c),method:this.options.requestMethod,data:this.options.requestData,onSuccess:this.loadRemoteSuccess.bind(this),onFailure:this.loadRemoteFailure.bind(this),evalScripts:true};this.options.track&&(b.trackEvent=this.options.track);if(!a&&!this.options.hideSpinner){new Asset.image(CDNHOST+"/img2/generic/site/loop.gif",{onload:this.position.bind(this),"class":"anim_loop"}).inject(this.inner)}new Request(b).send();return this},loadRemoteSuccess:function(b){if(typeof b==="string"){var a=document.head||ta.select("head")[0];b=b.replace(new RegExp("<style.*?>((.|\n)*?)</style.*?>","g"),function(c,d){var e=document.createElement("style");e.type="text/css";if(e.styleSheet){e.styleSheet.cssText=d}else{e.appendChild(document.createTextNode(d))}a.appendChild(e);return""})}this.cachedWidth=null;this.inner.setContent(b);this.position();if(typeof behavior!="undefined"&&behavior&&behavior.apply){behavior.apply(this.inner)}this.fireEvent("onLoad",this);this.cachedWidth=this.container.getSize().x;if(this.backdropOn){this.updateBackdrop()}return this},loadRemoteFailure:function(a){this.inner.addClass("ajax_failed");this.inner.setStyle("width","383px");this.inner.setStyle("padding","14px 24px 14px 14px");this.inner.set("text",JS_Ajax_failed);this.fireEvent("onLoadRemoteFailure",a)}});ta.overlays.getCurrent=function(){var a=$$(".overlay").shift();return a&&a.retrieve("overlay")};ta.overlays.safeCloseCurrent=function(){var a=ta.overlays.getCurrent();return a&&a.hide()};ta.overlays.safeCloseFromDom=function(c){c=ta.id(c);var a=c&&c.getParent(".overlay");var b=a&&a.retrieve("overlay");return b&&b.hide()};ta.overlays.AbsoluteOverlay=new Class({Extends:ta.overlays.Overlay,options:{xOffset:0,yOffset:0,toWindow:true,repositionOnScroll:false,autoShow:true,stayOpen:false,hideOnDocumentClick:false},initialize:function(a,b){a=a||{};a.showCloseButton=[a.showCloseButton,true].pick();this.parent(a,b);if(this.options.showCloseButton&&!this.options.stayOpen){this.closeBtn.addEvent("click",this.hide)}if(this.options.hideOnDocumentClick){document.addEvent("click",this.hideByClickOnDocument.bind(this))}if(this.options.autoShow){this.show()}},show:function(a){this.parent(a);if(this.options.repositionOnScroll){window.addEvent("scroll",this.delayedScroll.bind(this))}},hide:function(a){this.parent(a);if(this.options.repositionOnScroll){window.removeEvent("scroll",this.delayedScroll.bind(this))}if(this.options.hideOnDocumentClick){document.removeEvent("click",this.hideByClickOnDocument.bind(this))}},hideByClickOnDocument:function(d){if(!d||!d.page){return false}d=new Event(d);var c=d.page;var b=this.inner.getCoordinates();var a=c.y>=b.top&&c.y<=b.bottom&&c.x>=b.left&&c.x<=b.right;if(!a){this.parent(d)}},delayedScroll:function(){this.position.delay(500,this)},position:function(){this.container.setStyles({left:this.options.xOffset,top:this.options.yOffset+(this.options.toWindow?window.getScrollTop():0)});this.parent()}});ta.overlays.AbsoluteBottomOverlay=new Class({Extends:ta.overlays.Overlay,initialize:function(a,b){this.parent(Object.merge({positionType:"fixed"},a),b);if(this.options.showCloseButton&&!this.options.stayOpen){this.closeBtn.addEvent("click",this.hide)}thisOverlay=this;if(this.options.horizontalScroll){window.addEvent("scroll",function(){var c=window.getScroll().x*-1;thisOverlay.container.setStyle("left",(c))})}},position:function(){this.parent();this.reposition();this.flyIn()},reposition:function(){this.container.setStyles({top:null,left:null});if(!this.options.flyFromRight){if(this.options.horizontalScroll){leftValue=window.getScroll().x*-1}else{leftValue=window.getCoordinates().width/2-this.container.getWidth()/2}this.container.setStyles({bottom:0,left:leftValue})}else{this.container.setStyles({bottom:10,right:10})}},flyIn:function(){if(this.options.flyFromRight){this.container.setStyle("right",-window.getCoordinates().width)}else{this.container.setStyle("bottom",-this.container.getHeight())}var a=new Fx.Tween(this.container,{duration:"1000",transition:"quad:out"});if(this.options.flyFromRight){a.start("right",10)}else{a.start("bottom",0)}},show:function(a){this.parent(a);if(!this.options.flyFromRight){window.addEvent("resize",this.reposition.bind(this))}this.container.removeClass("overlay");this.reposition()}});ta.overlays.CenteredOverlay=new Class({Extends:ta.overlays.Overlay,Binds:["hideByClickOnDocument","position","hide","show"],options:{delayedPosition:false,autoShow:true,attachCloseEvent:true,xOffset:-1,yOffset:-1,absoluteOffset:false,fixed:false},initialize:function(b,c){b=b||{};b.showCloseButton=[b.showCloseButton,true].pick();b.fixed&&(this.options.positionType="fixed");this.parent(b,c);if(this.source){var a=this.source.getParentBySelector(".overlay");if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1);this.parentOverlay=a.overlay}}if(this.options.showCloseButton&&this.options.attachCloseEvent){this.closeBtn.addEvent("click",this.hide)}this.options.autoShow&&this.show()},position:function(d){var b=ta.retrieve("ta.overlays.CenteredOverlay.position.iters");if(!b){b=0}var f=this.container.getCoordinates();if(f.height<=14&&b<10){ta.store("ta.overlays.CenteredOverlay.position.iters",b+1);this.position.delay(100,this,true);return}var a=this.options.xOffset;var e=this.options.yOffset;if(a===-1){a=Math.max(5,(window.tabletOnFullSite?window.innerWidth:window.getWidth())-f.width)/2;!this.options.fixed&&(a+=window.getScrollLeft())}else{!this.options.absoluteOffset&&(a-=f.width/2)}if(e===-1){e=Math.max(20,(window.tabletOnFullSite?window.innerHeight:window.getHeight())-f.height)/2;!this.options.fixed&&(e+=window.getScrollTop())}else{!this.options.absoluteOffset&&(e-=f.height/2)}if(ta.util.i18n.isRtl()){this.container.setStyles({left:null,right:a,top:e})}else{this.container.setStyles({left:a,top:e})}this.parent()},positionShim:function(){var a=this.container.getCoordinates();if(!a||!a.left){return}this.shim.shim.setStyles({left:a.left,top:a.top,width:a.width,height:a.height})},positionTransparentOverlayPadding:function(){var d=this.container.getCoordinates();if(!d||((ta.util.i18n.isRtl()&&!d.right)||!d.left)){return}var b=this.transparentOverlayPaddingValue;var a=this.transparentOverlayPaddingValue*2;if(ta.util.i18n.isRtl()){this.transparentOverlayPadding.setStyles({left:null,right:d.right-b,top:d.top-b,width:d.width+a,height:d.height+a})}else{this.transparentOverlayPadding.setStyles({left:d.left-b,top:d.top-b,width:d.width+a,height:d.height+a})}}});ta.overlays.showInLightbox=function(a,b){return new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS},b)).loadRemoteSuccess(a)};ta.overlays.loadInLightbox=function(b,a){return new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS},a)).loadRemoteContent(b)};var lightbox={deactivate:function(){var a=ta.retrieve("overlays.current");a&&a.hide()}};ta.overlays.CouponOverlay=new Class({Extends:ta.overlays.CenteredOverlay,initialize:function(a,b){this.parent(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS,fixed:true,waitForCss:true,onClose:function(){ta.remove("suppressMetaFocus")}},a),b);this._opaqueBG=null;this._opaqueImg=null;if(Browser.name==="ie"){this._enableOpaqueBG()}window.addEvent("resize",this.position.bind(this))},hide:function(a){if(this._opaqueBG){this._opaqueBG.dispose();this._opaqueBG=null;this._opaqueImg=null}this.parent(a);return this},position:function(){this.parent();if(this._opaqueBG){var a=this.container.getCoordinates();this._opaqueBG.setStyles({top:Math.max(20,window.getHeight()-a.height)/2+window.getScrollTop(),left:Math.max(5,window.getWidth()-a.width)/2,width:a.width,height:a.height});this._opaqueImg.setStyles({width:a.width,height:a.height})}},_enableOpaqueBG:function(){if(this._opaqueBG){return}var a=this.options.isChild?9999:9996;this._opaqueBG=new Element("div",{"class":"printCouponBackground"});this._opaqueImg=new Element("img",{src:"/img2/generic/site/white_1x1.png"});var b=this.container.getCoordinates();this._opaqueBG.setStyles({top:Math.max(20,window.getHeight()-b.height)/2+window.getScrollTop(),left:Math.max(5,window.getWidth()-b.width)/2,width:b.width,height:b.height,zIndex:a,position:"fixed"});this._opaqueImg.setStyles({width:b.width,height:b.height});this._opaqueImg.inject(this._opaqueBG);if(this.container.inDocument()){this._opaqueBG.inject(this.container,"before")}else{this._opaqueBG.inject(document.body)}}});ta.overlays.showCouponInLightbox=function(b,d){var c=new ta.overlays.CouponOverlay(d);var a=c.loadRemoteSuccess(b);c.show();return a};ta.overlays.ACTIVATE_NEVER=0;ta.overlays.ACTIVATE_CLICK=1;ta.overlays.ACTIVATE_HOVER=2;ta.overlays.ACTIVATE_FOCUS=3;ta.overlays.ACTIVATE_HOVER_DELAY=4;ta.overlays.ACTIVATE_BOTH=5;ta.overlays.ACTIVATE_CLICK_ALTERNATE=6;ta.overlays.ACTIVATE_BOTH_DELAY=7;ta.overlays.ACTIVATE_CLICK_TOGGLE=8;ta.overlays.PINNABLE_NEVER=0;ta.overlays.PINNABLE_ALWAYS=1;ta.overlays.PINNABLE_CLICK=2;ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE=3;ta.overlays.PINNABLE_HOVER=4;ta.overlays.BACKDROP_PINNED=2;ta.overlays.RelativeOverlay=new Class({Extends:ta.overlays.Overlay,Binds:["overrideHoverDelayOnce","overridePinnableOption","_hide","show","hide","disable","destroy","hideNow","showWithDelay","hideWithDelay","_pin","prolongVisibility","showOrHide","_bothEnter","_bothEnterWithDelay","_bothClick"],options:{activate:ta.overlays.ACTIVATE_NEVER,pinnable:ta.overlays.PINNABLE_NEVER,activateHoverDelayTime:300,hoverDelayTime:250,pointArrowToSource:false,autoShow:true,ignoreFirstClickAfterHover:false,ignoreFirstClick:false,closeFunction:false,showFunction:false,closeButtonFunction:false},initialize:function(b,c){this.parent(b,c);this.debug_sticky=ta.retrieve("debug.stickyOverlays");this.container.addClass("relative");var a=this.source&&(this.source.getParentBySelector(".overlay")||this.source.getParentBySelector(".ui_overlay"));if(a){this.container.setStyle("z-index",parseInt(a.getStyle("z-index"),10)+2);this.parentOverlay=a.overlay}this.enabled=true;if(this.options.showCloseButton&&this.closeBtn){this.closeBtn.addEvent("click",(function(){try{if(this.options.closeButtonFunction&&typeof this.options.closeButtonFunction==="function"){this.options.closeButtonFunction()}}catch(f){}this.hideNow()}).bind(this));if(this.options.smartCloseButton){this.closeBtn.hide()}}switch(this.options.activate){case ta.overlays.ACTIVATE_CLICK:this.source.addEvent("click",this.show);break;case ta.overlays.ACTIVATE_CLICK_TOGGLE:this.source.addEvent("click",this.showOrHide);break;case ta.overlays.ACTIVATE_HOVER:this.source.addEvent("mouseenter",this.show);this.container.addEvent("mouseenter",this.show);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.addEvent("mouseenter",this.showWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);this.container.addEvent("mouseenter",this.show);this.container.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_FOCUS:this.source.addEvent("focus",this.show);break;case ta.overlays.ACTIVATE_CLICK_ALTERNATE:this.source.addEvent("mouseenter",this.prolongVisibility);this.container.addEvent("mouseenter",this.prolongVisibility);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this.showOrHide);break;case ta.overlays.ACTIVATE_BOTH:this.source.addEvent("mouseenter",this._bothEnter);this.container.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this._bothClick);this.ignoreNextClick=b.ignoreFirstClickAfterHover&&b.ignoreFirstClick;break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.addEvent("mouseenter",this._bothEnterWithDelay);this.container.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hideWithDelay);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this._bothClick);this.ignoreNextClick=b.ignoreFirstClickAfterHover&&b.ignoreFirstClick;break}switch(this.options.pinnable){case ta.overlays.PINNABLE_CLICK:case ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE:this.source.addEvent("click",this._pin);break}if(typeof this.options.remoteLink!="undefined"&&this.options.remoteLink!=null){this.loadRemoteContent(this.options.remoteLink)}else{if(this.source){var e=this.source.getElement(".overlaySrc");if(e){if(e.get("tag")=="a"){this.loadRemoteContent(e.href)}else{this.loadRemoteContent(e.get("text"));e.dispose()}}else{if(!this.options.content&&this.source.get("tag")=="a"){this.loadRemoteContent(this.source.href)}}}}var d=this.source&&ta.id(this.source.id+"_CONTENTS");if(d){this.inner.set("html",d.innerHTML);d.dispose();this.runBehaviorOnFirstShow=true}if(this.options.autoShow){this.show()}else{if(this.options.delayShow){this.showWithDelay()}}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},overrideHoverDelayOnce:function(a){this.overriddenHoverDelayTime=a},overridePinnableOption:function(a){if(a===true){this.source.addEvent("click",this._pin);this.container.addEvent("click",this._pin)}else{if(a===false){this.source.removeEvent("click",this._pin);this.container.removeEvent("click",this._pin);this.unpin()}}},show:function(b){b=b||window.event;if(b){new Event(b).stop()}if(!this.enabled){return}var a=this.visible;this.parent(b);clearTimeout(this.showTimeout);if((this.options.activate==ta.overlays.ACTIVATE_HOVER||this.options.activate==ta.overlays.ACTIVATE_HOVER_DELAY||this.options.activate==ta.overlays.ACTIVATE_BOTH||this.options.activate==ta.overlays.ACTIVATE_BOTH_DELAY)&&this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null}if(a){return}if(this.runBehaviorOnFirstShow){this.runBehaviorOnFirstShow=false;if(typeof behavior!="undefined"&&behavior&&behavior.apply){behavior.apply(this.inner)}}this.cachedWidth=this.container.getSize().x;switch(this.options.pinnable){case ta.overlays.PINNABLE_HOVER:this._pin();break}switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:case ta.overlays.ACTIVATE_HOVER_DELAY:break;case ta.overlays.ACTIVATE_CLICK:case ta.overlays.ACTIVATE_CLICK_TOGGLE:case ta.overlays.ACTIVATE_FOCUS:if(this.options.pinnable==ta.overlays.PINNABLE_NEVER){document.addEvent("click",this.hideByClickOnDocument.bind(this))}break}if(this.options.showFunction){this.options.showFunction()}return this},hide:function(c){if(this.debug_sticky){return this}c=c||window.event;if(!this.visible){return}if(window.flyout){window.flyout.hide()}if(c){var b=new Event(c);if(b.target&&b.target.tagName=="option"){return}if(Browser.ie&&b.target&&b.target.tagName=="select"&&this.container.getElements("select").contains(b.target)){return}if(ta.page&&ta.page.usingUnifiedDates&&ta.find&&ta.find(".ui_modal.date_picker_modal",document.body)){return}}switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:case ta.overlays.ACTIVATE_HOVER_DELAY:case ta.overlays.ACTIVATE_CLICK_ALTERNATE:case ta.overlays.ACTIVATE_BOTH:case ta.overlays.ACTIVATE_BOTH_DELAY:if(!this.hideTimer){var a=this.options.hoverDelayTime;if(this.overriddenHoverDelayTime!==undefined){a=this.overriddenHoverDelayTime;delete this.overriddenHoverDelayTime}this.hideTimer=this.hide.delay(a,this);return}else{clearTimeout(this.hideTimer);this.hideTimer=null}break;case ta.overlays.ACTIVATE_CLICK:case ta.overlays.ACTIVATE_CLICK_TOGGLE:case ta.overlays.ACTIVATE_FOCUS:if(c&&this.container.containsEvent(c)){return}if(this.options.pinnable==ta.overlays.PINNABLE_NEVER){document.removeEvent("click",this.hide)}break}return this.hideNow()},hideNow:function(a){if(!this.visible){return this}if(this.backdropOn){this.disableBackdrop()}if(this.shim){this.shim.hide().dispose()}if(this.transparentOverlayPadding){this.transparentOverlayPadding.hide().dispose()}if(!this.options.positionByOffsets){this.container.setStyles({left:"-999em",top:"-999em"}).dispose()}else{this.container.dispose()}this.visible=false;if(this.options.pinnable==ta.overlays.PINNABLE_CLICK||this.options.pinnable==ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE||this.options.pinnable==ta.overlays.PINNABLE_HOVER){this.unpin()}this.fireEvent("onHide",!a);if(this.options.closeFunction){this.options.closeFunction()}return this},_pin:function(a){this.pin();this.toggleBackdrop(true)},pin:function(){this.source=ta.id(this.source);switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:this.source.removeEvent("mouseenter",this.show);this.source.removeEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_BOTH:this.source.removeEvent("mouseenter",this._bothEnter);this.source.removeEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.removeEvent("mouseenter",this.showWithDelay);this.source.removeEvent("mouseleave",this.hideWithDelay);break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.removeEvent("mouseenter",this._bothEnterWithDelay);this.source.removeEvent("mouseleave",this.hideWithDelay);break}this.container.removeEvent("mouseenter",this.show);this.container.removeEvent("mouseleave",this.hide);this.pinned=true;if(this.options.smartCloseButton&&this.closeBtn){this.closeBtn.show()}return this},toggleBackdrop:function(a){if(this.options.backdrop==ta.overlays.BACKDROP_PINNED){this.enableBackdrop()}},unpin:function(){this.source=ta.id(this.source);switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:this.source.addEvent("mouseenter",this.show);this.source.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_BOTH:this.source.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.addEvent("mouseenter",this.showWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.addEvent("mouseenter",this._bothEnterWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);break}this.container.addEvent("mouseenter",this.show);this.container.addEvent("mouseleave",this.hide);if(this.options.backdrop==ta.overlays.BACKDROP_PINNED){this.disableBackdrop()}this.pinned=false;if(this.options.smartCloseButton&&this.closeBtn){this.closeBtn.hide()}return this},showWithDelay:function(a){a=a||window.event;clearTimeout(this.showTimeout);if(this.visible){return this.show(a)}else{this.showTimeout=this.show.delay(this.options.activateHoverDelayTime,this)}},hideWithDelay:function(a){a=a||window.event;if(!this.visible){clearTimeout(this.showTimeout)}else{return this.hide(a)}},prolongVisibility:function(){if(this.visible&&this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null}},showOrHide:function(a){if(this.blockShowOrHide){return}if(this.visible){return this.hideNow(a)}else{return this.show(a)}},_bothEnter:function(a){this.ignoreNextClick=this.options.ignoreFirstClickAfterHover;return this.show(a)},_bothEnterWithDelay:function(a){this.ignoreNextClick=this.options.ignoreFirstClickAfterHover;return this.showWithDelay(a)},_bothClick:function(a){if(this.ignoreNextClick){a=a||window.event;if(a){new Event(a).stop()}this.ignoreNextClick=false;return this}else{return this.showOrHide(a)}}});ta.overlays.RelativeOverlayHorizontal=new Class({Extends:ta.overlays.RelativeOverlay,options:{arrowHeight:0,arrowLeftForce:0,arrowTopForce:0,allowRightArrowPos:false,allowBelowBottomEdge:false,mirrorIfRtl:false},initialize:function(a,b){if(a.onRight==null){if(IS_DEBUG){alert("ERROR: Attempting to create Horizontal Overlay without specifying direction.")}return}if(a.mirrorIfRtl&&ta.util.i18n.isRtl()){a.onRight=!a.onRight;if(a.offsetLeft){a.offsetRight=-a.offsetLeft;a.offsetLeft=0}else{if(a.offsetRight){a.offsetLeft=-a.offsetRight;a.offsetRight=0}}}this.parent(a,b)},position:function(){if(this.options.onRight){this.positionRight()}else{this.positionLeft()}this.parent()},adjustTop:function(f,i){try{this.source=ta.id(this.source);var k=f+this.options.offsetTop;if(!this.options.allowBelowBottomEdge){var g=window.getScrollTop()+window.getHeight();var j=document.getElementById("tamgFooter");if(j){if(j.offsetHeight){g=g-j.offsetHeight}else{if(j.clientHeight){g=g-j.clientHeight}}}if(k+i.height>=g){k=g-i.height-1;if((this.crDHTML_BASIC||this.crDHTML_PNG24)&&this.options.showArrow){var b=this.container.getElement(".check_availability");var d=this.container.getElement(".username");if(b||d){var a=b?b:d;var c=a.getCoordinates().height}k=g-i.height+c-9}}}return k}catch(h){ta.util.error.record(h,"adjustTop: RelativeOverlayHorizontal")}},positionLeft:function(){try{this.source=ta.id(this.source);var d=this.source.getCoordinates();var b=this.container.getStyle("margin-top").toInt();var a=ta.id("PAGE").getCoordinates();var h=this.container.getCoordinates();if(!this.flipped&&d.left-a.left-(this.cachedWidth||h.width)<0){this.flipped=true;this.options.onRight=true;if(this.arrow){this.arrow.className=this.options.arrowClassLeft}this.positionRight();return}if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){this.positionLeftOrRight(d,b,a,h,"left")}else{var f=this.adjustTop(d.top,h)-b;d.left=d.left-this.options.offsetLeft;this._setPosition({left:null,right:window.getWidth()-d.left+(this.options.xoffset||0),top:f});if(this.options.pointArrowToSource&&this.options.arrowHeight){this.setArrowPosition(d,b,a,h,"left",f)}}}catch(g){ta.util.error.record(g,"positionRight: RelativeOverlayHorizontal")}},positionRight:function(){try{this.source=ta.id(this.source);var d=this.source.getCoordinates();var b=this.container.getStyle("margin-top").toInt();var h=this.container.getStyle("margin-bottom").toInt();var a=ta.id("PAGE").getCoordinates();var i=this.container.getCoordinates();if(!this.flipped&&a.right-d.right-(this.cachedWidth||i.width)<0){this.flipped=true;this.options.onRight=false;if(this.arrow){this.arrow.className=this.options.arrowClassRight}this.positionLeft();return}d.right=d.right-this.options.offsetRight;if(ta.isDHTMLCRRedesign2012()&&(this.container.getElement(".check_availability")||this.container.getElement(".username"))){this.positionLeftOrRight(d,b,a,i,"right")}else{var f=this.adjustTop(d.top,i)-b;this.container.setStyles({right:null,left:d.right+(this.options.xoffset||0),top:f});if(this.options.pointArrowToSource&&this.options.arrowHeight){this.setArrowPosition(d,b+h,a,i,"right",f)}}}catch(g){ta.util.error.record(g,"positionRight: RelativeOverlayHorizontal")}},setArrowPosition:function(j,e,h,g,a,d){if(a==="left"){this.arrow.setStyle("left",this.options.arrowLeftForce);var i=(d<j.top?j.top-d:0);var b=Math.max(-1,i+(j.height/2).toInt()-(this.options.arrowHeight/2));var f=g.height-this.options.arrowHeight-e-3;this.arrow.setStyle("top",Math.min(b,f))}else{if((a==="right")&&(this.options.allowRightArrowPos)){if(this.options.arrowTopForce){this.arrow.setStyle("top",this.options.arrowTopForce)}else{if(this.options.arrowRightForce){this.arrow.setStyle("right",this.options.arrowRightForce)}var i=(d<j.top?j.top-d:0);var b=Math.max(-1,i+(j.height/2).toInt()-(this.options.arrowHeight/2));var f=g.height-this.options.arrowHeight-e-3;this.arrow.setStyle("top",Math.min(b,f))}}else{if(a==="right"){ta.util.error.record("setArrowPosition with dir === right is only supported with options.allowRightArrowPos set")}}}},positionLeftOrRight:function(q,l,y,x,r){try{var d=this.container.getElement(".check_availability");var g=this.container.getElement(".username");if(!ta.retrieve("isDaoDao")){var i=this.adjustTop(q.top,x)}else{var i=q.top}var v=d?d:g;var t=v.getCoordinates().height;var m=16;var k=i-t+m/2;var n=false;if(d){var f=window.getScrollTop();var h=ta.id("PERSISTENT_CHECK_RATES");if(h){f+=h.getCoordinates().height}if((i-0.5*x.height)<f){k=f;if((q.bottom-f)>32){k=f}else{if((q.bottom-f)<=32){k=q.bottom-32}}n=true}}var p=d?k:k+5;if(typeof(dhtml_cr_redesign_basic)!="undefined"&&!this.crDHTML_BASIC){this.crDHTML_BASIC=Asset.css(dhtml_cr_redesign_basic,{onLoad:function(){this.position()}.bind(this)})}if(typeof(dhtml_cr_redesign_png24)!="undefined"&&!this.crDHTML_PNG24){this.crDHTML_PNG24=Asset.css(dhtml_cr_redesign_png24,{onLoad:function(){this.position()}.bind(this)})}if(this.crDHTML_BASIC){var b=d?(q.right+13):(q.right-45);if(r=="left"){b=q.left+13}var a=-16}if(this.crDHTML_PNG24){var b=d?(q.right+20):(q.right-45);if(r=="left"){var b=window.getWidth()-q.left+20}var a=d?-21:-24}if(r=="left"){this._setPosition({right:b,left:null,top:p})}else{this._setPosition({right:null,left:b,top:p})}if(this.arrow){this.arrow.setStyle("display","block");var j=d?16:0;if(n){this.arrow.setStyle("top",(q.bottom-p-32))}else{this.arrow.setStyle("top",t-j)}if(r=="left"){this.arrow.setStyle("left",(x.width-13))}else{this.arrow.setStyle("left",a)}try{q=this.source.getCoordinates();x=this.container.getCoordinates();var u=window.getScrollTop()+window.getHeight();var o=q.top-x.top-m/2;var j=d?0:20;if(i+x.height>=u&&o>0){this.arrow.setStyle("top",o+j);if(q.bottom+m/2>=x.bottom){this.container.setStyle("top",p+m*2);this.arrow.setStyle("top",o-m*2+j)}}else{if(o<=0&&!n){this.container.setStyle("top",p-t+m)}}}catch(w){ta.util.error.record(w,"bottomEdge - Reposition arrow and container: RelativeOverlayHorizontal")}}}catch(w){ta.util.error.record(w,"positionLeftOrRight: RelativeOverlayHorizontal")}}});ta.overlays.RelativeOverlayRight=new Class({Extends:ta.overlays.RelativeOverlayHorizontal,initialize:function(a,b){this.parent(Object.merge({onRight:true},a),b)}});ta.overlays.RelativeOverlayLeft=new Class({Extends:ta.overlays.RelativeOverlayHorizontal,initialize:function(a,b){this.parent(Object.merge({onRight:false},a),b)}});ta.overlays.RelativeOverlayVertical=new Class({Extends:ta.overlays.RelativeOverlay,options:{flipPadding:0,allowFlip:true,arrowWidth:0},initialize:function(a,b){if(a.below==null){if(IS_DEBUG){alert("ERROR: Attempting to create Vertical Overlay without specifying direction.")}return}this.parent(a,b)},position:function(){this.options.below?this.positionBelow():this.positionAbove();this.parent()},positionBelow:function(){if(this.options.positionType=="fixed"){var p=this.source.getBoundingClientRect();var f=p.left;var q=p.bottom;if(this.options.positionAsPercent){f=(f/window.innerWidth*100)+"%";q=(q/window.innerHeight*100)+"%"}this._setPosition({left:f,top:q});return}var r=this.options.positionSource?this.options.positionSource.getCoordinates():this.source.getCoordinates();var m=this.container.getCoordinates();var n=this._styleValueToPixel(this.container.getStyle("margin-left"));var j=this._styleValueToPixel(this.container.getStyle("margin-right"));var d=this.container;var b;if(this.options.leftEdge){b=this.options.leftEdge}else{if(this.options.justify=="right"){b=r.left+r.width-m.width}else{b=this.options.centered?r.left+(r.width/2)-(m.width/2):r.left}}var k=window.getHeight()+window.getScrollTop();var i=r.bottom;if(this.options.offsetTop){i-=this.options.offsetTop}if(this.options.scrollContainer){i-=this.options.scrollContainer.scrollTop}if(this.options.allowFlip&&!this.flipped&&k-m.height-i<0&&r.top-m.height>0){this.options.below=false;this.flipped=true;d.addClass("relAbove").removeClass("relBelow");i=r.top-m.height-this.options.flipPadding;if(this.options.scrollContainer){i-=this.options.scrollContainer.scrollTop}}else{d.addClass("relBelow").removeClass("relAbove")}b-=this.options.offsetLeft;var e=this.adjustEdge(b-n,m.width);this._setPosition({left:e,top:i+(this.options.yoffset||0)});if(this.options.pointArrowToSource&&this.options.arrowWidth){var o=(e<r.left?r.left-e:0);var g=(r.width/2).toInt()-(this.options.arrowWidth/2);var h=o+g;var a=m.width-this.options.arrowWidth-n-j;this.arrow.setStyles({right:"",left:Math.min(h,a)})}},_styleValueToPixel:function(a){var b=a&&a.toInt();return !b?0:b},positionAbove:function(){var n=this.options.positionSource?this.options.positionSource.getCoordinates():this.source.getCoordinates();var j=this.container.getCoordinates();var k=this._styleValueToPixel(this.container.getStyle("margin-left"));var i=this._styleValueToPixel(this.container.getStyle("margin-right"));var d=this.container;var b;if(this.options.justify=="right"){b=n.left+n.width-j.width}else{b=this.options.centered?n.left+(n.width/2)-(j.width/2):n.left}var l=window.getScrollTop();var h=n.top-j.height-this.options.flipPadding;if(this.options.offsetTop){h-=this.options.offsetTop}if(this.options.scrollContainer){h-=this.options.scrollContainer.scrollTop}if(this.options.allowFlip&&!this.flipped&&h-l<0){this.options.below=true;this.flipped=true;d.addClass("relBelow").removeClass("relAbove");h=n.bottom;if(this.options.scrollContainer){h-=this.options.scrollContainer.scrollTop}}else{d.addClass("relAbove").removeClass("relBelow")}b-=this.options.offsetLeft;if(this.options.positionByOffsets){this._setPosition({position:this.options.positionType,top:this.options.offsetTop,right:this.options.offsetRight,bottom:this.options.offsetBottom,left:this.options.offsetLeft})}else{var e=this.adjustEdge(b-k,j.width);this._setPosition({left:e,top:h+(this.options.yoffset||0)});if(this.options.pointArrowToSource&&this.options.arrowWidth){var m=(e<n.left?n.left-e:0);var f=(n.width/2).toInt()-(this.options.arrowWidth/2);var g=m+f;var a=j.width-this.options.arrowWidth-k-i;this.arrow.setStyles({right:"",left:Math.min(g,a)})}}},adjustEdge:function(d,c){var a=ta.id("PAGE").getCoordinates();if(d+c>=a.right){var b=this._styleValueToPixel(this.container.getStyle("margin-right"));d=a.right-c-b-1}else{if(d<0){d=0}}return d},hideNow:function(a){this.parent(a);if(this.flipped){this.flipped=false;this.options.below=!this.options.below}}});ta.overlays.RelativeOverlayBelow=new Class({Extends:ta.overlays.RelativeOverlayVertical,initialize:function(a,b){this.parent(Object.merge({below:true},a),b)}});ta.overlays.RelativeOverlayAbove=new Class({Extends:ta.overlays.RelativeOverlayVertical,initialize:function(a,b){this.parent(Object.merge({below:false},a),b)}});ta.overlays.RelativeOverlayIn=(function(a){return new Class({Extends:a.overlays.RelativeOverlay,options:{xOffset:0,yOffset:0,center:false},initialize:function(b,c){this.parent(b,c)},position:function(){if(this.options.center){var d=this.source.getCoordinates();var e=this.container.getCoordinates();this._setPosition({left:d.left+(d.width/2)-(e.width/2)+this.options.xOffset,top:d.top+(d.height/2)-(e.height/2)+this.options.yOffset})}else{var b=this.source.getPosition();this._setPosition({left:b.x+this.options.xOffset,top:b.y+this.options.yOffset})}this.parent()}})}(ta));(function(){var b;function i(j){if(!j){return null}if(j.get("tag")=="a"){return j.href}var f=j.getElement("a");if(f){return f.href}f=j.getElement(".overlaySrc");if(f){return f.get("text")}return null}var g={left:ta.overlays.RelativeOverlayLeft,right:ta.overlays.RelativeOverlayRight,above:ta.overlays.RelativeOverlayAbove,below:ta.overlays.RelativeOverlayBelow};function e(p,s,l,u){if(s||window.event){new Event(s||window.event).preventDefault()}var r=p.hyphenate().split("-"),n=r.indexOf("h")>=0,k=r.indexOf("lb")>=0,f=r.indexOf("remote")>=0,q=r.indexOf("click")>=0,j=Object.merge({showCloseButton:true},u),o=null,m;switch(r.shift()){case"rel":o=g[r.shift().toLowerCase()];if(k){j.pinnable=ta.overlays.PINNABLE_ALWAYS}break;case"center":o=ta.overlays.CenteredOverlay;break}if(o===null){return null}if(n){j.activate=ta.overlays.ACTIVATE_HOVER}else{if(q){j.activate=ta.overlays.ACTIVATE_CLICK}}if(k){j.backdrop=ta.overlays.BACKDROP_ALWAYS}if(f){j.remoteContent=i(l)}m=new o(j,l);if(l){l.store("overlay",m)}return m}b=function(f){var o,s,l,n,p,q,j,m,k,r;o=f||window.event;if(!o){return}if(!o.origin||(0!==o.origin.indexOf("https"))||(-1===o.origin.indexOf("tripadvisor"))){return}if(!o.data||(-1===o.data.indexOf("action"))){return}try{s=JSON.parse(o.data)}catch(o){}l=s.hasOwnProperty("action")?s.action:null;if(!l){return}switch(l){case"successClose":ta.overlays.Factory.closeOverlayRegistration();m=ta.retrieve("overlay_registration_onsuccess");if(m&&"function"===typeof(m)){m();ta.remove("overlay_registration_onsuccess")}break;case"fwdToRegistration":n=s.hasOwnProperty("curUrl")?s.curUrl:null;p=s.hasOwnProperty("partnerKey")?s.partnerKey:null;q=s.hasOwnProperty("urlKey")?s.urlKey:null;j="/Register?product=MASTHEAD&flow=MASTHEAD&action=SIGNIN";if(n&&(0!==n.length)&&p&&(0!==p.length)&&q&&(0!==q.length)){j=j+"&url="+n+"&partnerKey="+p+"&urlKey="+q}window.location=ta.util.URL.https(j);break;case"resizeFrame":k=ta.id("overlayRegFrame");if(k){r=s.hasOwnProperty("height")?s.height:null;if(r){k.style.height=r+"px"}}break;default:return}};function a(){ta.store("member_gating_cta_shown",true)}function d(){return ta.retrieve("member_gating_cta_shown")}ta.overlays.Factory={_magic:e,relRightRemoteHLB:function(f,j){j=ta.id(j);if(j.get("tag")!="div"){j=j.getParent()}var k=i(j);if(k==null){return}new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:ta.overlays.BACKDROP_PINNED,style:"commerceOverlay rgba_flyout",showCloseButton:true},j)},relRightRemoteHLB_Commerce:function(k,f){if(k||window.event){new Event(k||window.event).preventDefault()}f=ta.id(f);var j=i(f);if(j==null){return}f.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},f)},relBelowRemoteHLB_Commerce:function(k,f){f=ta.id(f);if(k||window.event){new Event(k||window.event).preventDefault()}var j=i(f);if(j==null){return}f.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},f)},relBelowRemoteHLB_CommCopy:function(k,f){f=ta.id(f);if(k||window.event){new Event(k||window.event).preventDefault()}var j=i(f);if(j==null){return}f.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true,onLoad:function(){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},f)},relBelowRGBA:function(m,j){if(m){m.stop()}var k="rgba_flyout";var l=true;var f="rgba_arrow";f=f+" rgba_arrow_png24";j.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:k,showArrow:l,arrowClass:f,showCloseButton:true},j)},relAboveH_PriceSaver:function(j,f){f=ta.id(f);j.stop();f.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,showArrow:true,style:"typePS",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},f)},relRight_SavingsAlert:function(k,j){j=ta.id(j);k.stop();j.onclick=null;var f={showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,showArrow:true,arrowClass:"arrow",style:"typeSA",waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(f,j)}else{new ta.overlays.RelativeOverlayRight(f,j)}},relRightH_SavingsAlert:function(m,j,l){j=ta.id(j);m.stop();j.onmouseover=null;var k="typeSA";if(l){k+=" ie8"}var f={showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,showArrow:true,arrowClass:"arrow",style:k,waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(f,j)}else{new ta.overlays.RelativeOverlayRight(f,j)}},relBelow:function(j,f){if(j){j.stop()}f.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},f)},relAbove:function(j,f){if(j){j.stop()}f.onclick=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},f)},relRight:function(j,f){if(j){j.stop()}f.onclick=null;new ta.overlays.RelativeOverlayRight({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},f)},relLeft:function(j,f){if(j){j.stop()}f.onclick=null;new ta.overlays.RelativeOverlayLeft({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},f)},relBelowH_Media:function(j,f){if(j){j.stop()}f.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},f)},relAboveH_Media:function(j,f){if(j){j.stop()}f.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},f)},relAboveH:function(j,f){f.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER},f)},relAboveTAMGFooter:function(k,f){f.onmouseover=null;var j=ta.id("PAGE");if(j){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"s3 vdg ovrFooter "+f.className},f)}},relRightH:function(j,f){f.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER},f)},relLeftH:function(j,f){f.onmouseover=null;new ta.overlays.RelativeOverlayLeft({activate:ta.overlays.ACTIVATE_HOVER},f)},imageLightbox:function(l,f){f.onclick=null;var j="<div><img src="+f.getAttribute("href")+"></div>";var k=new ta.overlays.CenteredOverlay({showCloseButton:true,backdrop:ta.overlays.BACKDROP_ALWAYS}).loadRemoteSuccess(j);f.addEvent("click",k.show)},microMetaOverlay:function(v,l,p,k,s,x,m,w){try{l.onmouseover=null;l.onclick=null;if(v){v.stop()}var f="";if(ta.meta&&ta.meta.update){f=ta.meta.update.buildUrl("MicroMetaAjax",p,true,false,"QC_Meta_Micro|Button")}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){f=dd.commerce.checkrates.getMicroMetaUrl(v,p)}else{ta.util.error.record(null,"microMetaOverlay : no meta js");return}}f+="&lowContentID="+k;if(m){f+="&xSellPlacement="+m}var r=l.className.match(/noDelayFirst/);var u=l.className.match(/delayOpen/);var q=ta.retrieve("delayedFirst");var j=!u||(r&&!q);var n="Above Fold Also Viewed";if(ta.id(l).getParent("#MMXS_LIST")){n="State Opt Also Viewed"}else{if(ta.id(l).getParent("#HORIZONTAL_CROSS_SELL_LIST")){n="HorizXSell"}else{if(ta.id(l).getParent("#hotel_flyout")){n="Scooter"}else{if(ta.id(l).getParent("#HSCS_ROW")){n="prodp13n_hr_similar_xsell"}else{if(window.mapDivId&&ta.id(l).getParent("#"+window.mapDivId)){n="Maps"}}}}}if(n=="Scooter"){f+="&from="+n}var y={activate:(x)?ta.overlays.ACTIVATE_CLICK:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:(x)?ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE:ta.overlays.PINNABLE_CLICK,backdrop:(x)?ta.overlays.BACKDROP_NEVER:ta.overlays.BACKDROP_PINNED,showCloseButton:!x,closeOnDocumentClick:x,positionByOffsets:false,positionType:"absolute",offsetTop:0,offsetRight:"",offsetBottom:"",offsetLeft:155};Object.merge(y,w);var o=new ta.overlays.RelativeOverlayBelow({style:"micro_meta_flyout gray",activate:y.activate,pinnable:y.pinnable,backdrop:y.backdrop,autoShow:j,delayShow:u,showCloseButton:y.showCloseButton,closeOnDocumentClick:y.closeOnDocumentClick,closeButtonClass:"roundOuterClose",onShow:function(){if(ta.util&&ta.util.element){ta.util.element.makeTextFitOneLine(".micro_meta_price_with_fee",true)}if(x){ta.trk("Meta_Micro_Providers_Displayed")}else{ta.trackEventOnPage("Meta_Micro_Providers_Displayed",n,s)}ta.overlays.Factory.logTrackingTree();if(y.onshow){y.onshow()}},onHide:y.onhide,positionByOffsets:y.positionByOffsets,positionType:y.positionType,offsetTop:y.offsetTop,offsetRight:y.offsetRight,offsetBottom:y.offsetBottom,offsetLeft:y.offsetLeft,trigger:l,onLoad:function(){window.fireEvent("MicroMetaHacComplete");if(y.onload){y.onload()}}},l);o.loadRemoteContent(f,false);ta.store("delayedFirst",true)}catch(t){ta.util.error.record(t,"micro meta overlay")}},microMetaExpandedSize:0,microMetaMore:function(n,o,j){try{var k=ta.id("micro_meta_remaining_"+o);if(!k){return}k.removeClass("hidden");function m(){var p=ta.id("micro_meta_more");if(!p){return}p.addClass("invisible")}if(j){m()}else{ta.meta.linkTracking.actionRecord("MICRO_META_EXPAND_MORE");if(k.getSize().y!=ta.overlays.Factory.microMetaExpandedSize){k.addClass("expanding");ta.overlays.Factory.microMetaExpandedSize=k.getSize().y;k.removeClass("expanding")}k.addClass("show");new Fx.Tween(k,{duration:"long",property:"height"}).start(0,ta.overlays.Factory.microMetaExpandedSize);window.setTimeout(m,1000);if(ta.retrieve("ibdm_impression_tracking")){var f=document.getElement(".micro_meta_first_block");if(f&&ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(f)){ta.trk("n_more_sites",false,f)}}}}catch(l){ta.util.error.record(l,"Micro meta expand failed.")}},isOverlayCreatedAlready:function(j,f){if(typeof f!="undefined"){var k=j.getElement(".overlaySrc");if(k){k.dispose();return false}else{return true}}return false},relRightRemoteHLB_optionalDelay_showArrow:function(u,s,y,x){try{s=ta.id(s);if(s.get("tag")!="div"){s=s.getParent()}var m=null;if(typeof y!="undefined"){m=y}if(null==m){m=i(s)}if(m==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();m=i(s)}if(m==null){return}var t=s.getElement(".overlaySrc");var w=m.match(/-d(\d+)\?/);if(w){w=w[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(u&&u.type=="mouseover"&&s){if(!s.hasClass("datedClickAdded")){s.addEvent("click",ta.overlays.Factory.relRightRemoteHLB_optionalDelay_showArrow.bind(this,null,s,m));s.addClass("datedClickAdded")}return}var p=ta.retrieve("scooterObj");if(p){p.slideOut()}if(w){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(w,s)}return}catch(C){ta.util.error.record(C,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(s,y)){return}var k=s.className.match(/noDelayFirst/),o=s.className.match(/delayOpen/),j=ta.retrieve("delayedFirst"),z=!o||(k&&!j),n="rgba_flyout",q=true,f="rgba_arrow",r="close",l;if(ta.has("hotels.redesignEnabled")&&(pageServlet==="Hotels"||pageServlet==="HACSearch")){n+=" gray";f="rgba_arrow_gray_lft_png24";r="roundOuterClose"}if(ta.has("daodao_noPop_single_cr_button")){n+=" no_cpu"}if(typeof(dhtml_cr_redesign_basic)!="undefined"&&!this.crDHTML_BASIC){this.crDHTML_BASIC=Asset.css(dhtml_cr_redesign_basic)}if(typeof(dhtml_cr_redesign_png24)!="undefined"&&!this.crDHTML_PNG24){this.crDHTML_PNG24=Asset.css(dhtml_cr_redesign_png24)}if(this.crDHTML_PNG24){l=f+" rgba_arrow_png24_right";f=f+" rgba_arrow_png24"}var A=ta.overlays.BACKDROP_PINNED;if(ta.has("daodao_ror_backdrop_type")){A=ta.retrieve("daodao_ror_backdrop_type")}var D=(o?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")||window.FastClick){D=ta.overlays.ACTIVATE_CLICK}var v={};if(ta.meta&&ta.meta.update){v=ta.commerce.meta.getMetaParams()}var B=new ta.overlays.RelativeOverlayRight({activate:D,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:A,style:n,showArrow:q,arrowClass:f,arrowClassLeft:f,arrowClassRight:l,closeButtonClass:r,showCloseButton:true,autoShow:z,delayShow:!z,smartCloseButton:ta.isMetaHotels2013(),remoteLink:y,requestData:v,onLoad:function(){if(w&&x){var E=this.inner.getElementById("CHECK_RATE_FLYOUT");if(E){var F=E.get("onclick");E.set("onclick",x+";"+F)}}if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){ta.store("metaDateSearchOverlay",this);if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(B)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}ta.store("ta.hlb_el",s);if(ta.page&&ta.page.usingUnifiedDates){this.haveDatesHandler=(function(){if(ta.page.hasDates("STAYDATES")){this.hideNow()}}).bind(this);ta.page.on("dateSelected",this.haveDatesHandler)}},onHide:function(){if(ta.retrieve("metaDateSearchOverlay")==this){ta.remove("metaDateSearchOverlay")}ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}ta.store("ta.hlb_el",null);if(this.haveDatesHandler&&ta.page){ta.page.off("dateSelected",this.haveDatesHandler)}}},s);B.metaLocId=w;ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(s,B,t)}catch(C){ta.util.error.record(C,"relRightRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_helper:function(w,k,s,x){try{k=ta.id(k);if(k.get("tag")!="div"){k=k.getParent()}var l=null;if(typeof x!="undefined"){l=x}if(null==l){l=i(k)}if(l==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();l=i(k)}if(l==null){return}var v=k.getElement(".overlaySrc");var p=l.match(/-d(\d+)\?/);if(p){p=p[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(w&&w.type=="mouseover"){if(!k.hasClass("datedClickAdded")){k.addEvent("click",ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper.bind(this,null,k,s,l));k.addClass("datedClickAdded")}return}var j=ta.retrieve("scooterObj");if(j){j.slideOut()}if(p){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(p,k)}return}catch(t){ta.util.error.record(t,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(k,x)){return}var r=k.className.match(/noDelayFirst/);var u=k.className.match(/delayOpen/);var q=ta.retrieve("delayedFirst");var f=!u||(r&&!q);var n=ta.has("daodao_ror_backdrop_type")?ta.retrieve("daodao_ror_backdrop_type"):ta.overlays.BACKDROP_PINNED;var m=(u?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")||window.FastClick){m=ta.overlays.ACTIVATE_CLICK}var o=new ta.overlays.RelativeOverlayLeft({activate:m,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:n,style:"rgba_flyout gray",showArrow:s,arrowClass:"rgba_arrow_gray_rgt_png24",arrowClassLeft:"rgba_arrow_gray_lft_png24",showCloseButton:true,closeButtonClass:"roundOuterClose",autoShow:f,delayShow:!f,smartCloseButton:ta.isMetaHotels2013(),remoteLink:x,onLoad:function(){if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){ta.store("overlay.lastElmt.className",k.className);if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(o)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}},onHide:function(){ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}}},k);ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(k,o,v)}catch(t){ta.util.error.record(t,"relLeftRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_showArrow:function(j,k,f){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(j,k,true,f)},hotelsMapCROverlay:function(j,k,f){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(j,k,false,f)},fbFriendOverlay:function(f){f.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,style:"s2 mg"},f)},albumsLB:function(s,k,p,f,j,m,q,l,o,r,n){if(s||window.event){new Event(s||window.event).preventDefault()}if(ta.media&&ta.media.viewer){ta.media.viewer.load({detail:p,geo:f,filter:j,ff:m,albumId:q,evtDelegates:r,lbShowRac:n})}else{ta.util.error.record(null,"Missing ta.media.viewer for albumViewerOverlay")}return false},photosLB:function(f,m){try{if(f||window.event){new Event(f||window.event).preventDefault()}m=ta.id(m);if(m.get("tag")!="a"){if(m.hasClass("fkASDF")&&(m.get("tag")=="span"||m.get("tag")=="div"||m.get("tag")=="li")){m=ta.id(m)}else{m=m.getParent("a")}}var l="";if(m.className){l=m.className.match(/u_([^ ]*)/)[1]}else{if(m.href.match(/\/?LocationPhoto.*/)){l=m.href}}ta.overlays.Factory._mediaLBLoadAssets();var j="QC_Meta_Mini";if(ta.has("photo.viewer.jsAssetsLoaded")){l=l.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");l=l.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");l=l.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(l.match(/\?/)){l=l+"&small=true"}else{l=l+"?small=true"}}l=l+"&area="+j;var n=l;try{l=ta.commerce.meta.tracking.updateUrlWithTiming(l,j)}catch(o){ta.util.error.record(o,"problem updating url with timing in Factory.photosLB");l=n}if(ta.meta&&ta.meta.update&&window.pageServlet){l=l+"&metaReferer="+window.pageServlet}var k=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.photoLBHelper,m);k.loadRemoteContent(l);ta.store("photo.viewer.lightbox",k);ta.commerce.meta.tracking.resetTimingLockForNavArea(j)}else{ta.util.error.record(null,"photo gallery - no assets to load");ta.overlays.Factory.viewerFallback.delay(2000,this,[null,m])}}catch(o){ta.util.error.record(o,"photo gallery overlay",null,{photoUrl:l});ta.commerce.meta.tracking.resetTimingLockForNavArea(j)}return false},viewerFallback:function(j){var f=ta.remove("photo.viewer.lightbox");if(f){f.hide()}if(j&&j.href&&j.href.match(/LocationPhotos/)){window.location=j.href}else{return ta.servlet.Popup.photoGallery(null,j)}},photoLBCounter:1,photoLBHelper:function(j){var f=ta.retrieve("photo.viewer.initData");if(ta.overlays.Factory.photoLBCounter>16){ta.overlays.Factory.photoLBCounter=1;try{ta.overlays.Factory.viewerFallback.delay(2000,this,j)}catch(k){}return}if(!f||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.photoLBHelper.delay(500)}else{ta.overlays.Factory.photoLBCounter=1;if(ta.retrieve("ta.photos.viewer.initializeOnSecondTab")){ta.store("photo.viewer.secondaryView",true);ta.photos.viewer.photoViewerInit(ta.retrieve("photo.viewer.secondaryViewer.data"))}else{ta.photos.viewer.photoViewerInit(f)}}},mediaLBAutoOpen:function(j){try{ta.overlays.Factory._mediaLBLoadAssets();if(!ta.has("photo.viewer.jsAssetsLoaded")){ta.util.error.record(null,"auto-open media lightbox - no assets to load")}else{j=j.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");j=j.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");j=j.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(j.match(/\?/)){j=j+"&small=true"}else{j=j+"?small=true"}}var f=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.mediaLBAutoOpenHelper,j);f.loadRemoteContent(j);ta.store("photo.viewer.lightbox",f)}}catch(k){ta.util.error.record(k,"ta.overlays.factory.autoOpenMediaLB failed",null,{photoUrl:j})}return false},mediaLBAutoOpenHelper:function(k){var f=ta.retrieve("photo.viewer.initData");var j=16;if(ta.overlays.Factory.photoLBCounter>j){ta.overlays.Factory.photoLBCounter=1;ta.util.error.record(null,"ta.overlays.factory.autoOpenMediaLBHelper is giving up after "+j+" attempts.",null,{photoUrl:k});return}if(!f||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.mediaLBAutoOpenHelper.delay(500,this,k)}else{ta.overlays.Factory.photoLBCounter=1;ta.photos.viewer.photoViewerInit(f)}},_mediaLBLoadAssets:function(){if(!ta.has("photo.viewer.jsAssetsLoaded")&&typeof cssPhotoViewerAsset!="undefined"&&typeof jsPhotoViewerAsset!="undefined"){ta.store("photo.viewer.jsAssetsLoaded",true);Asset.css(cssPhotoViewerAsset,{media:"screen, print"});if(!ta.photos.viewer){Asset.javascript(jsPhotoViewerAsset)}if(typeof TALSO=="undefined"){Asset.javascript(jsPhotoViewerTALSOAsset)}if(typeof jsPhotosAsset!="undefined"&&!ta.servlet.Photos){Asset.javascript(jsPhotosAsset)}if(!ta.media.JWPlayer){Asset.javascript(jsJWPlayerHelperAsset)}}},_mediaLBCreateOverlay:function(j,l){var k={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg",backdropClickClose:true,onLoad:function(){this.position();if(j){j(l)}},onHide:function(){var m=ta.remove("photo.viewer.lightbox");if(m){m.hide()}ta.meta.linkTracking.restoreCRPageServlet();document.removeEvent("keydown",ta.remove("photo.viewer.keydownListener"));if(ta.retrieve("photo.viewer.refreshOnClose")){window.location=window.location}if(ta.has("translationOverlay")){ta.retrieve("translationOverlay").hide()}if(ta.retrieve("hotels.datesChanged")&&(ta.has("meta.mini_meta_on_accommodations")||(ta.retrieve("hotels.redesignEnabled")&&ta.isMetaHotelsRequest&&ta.isMetaHotelsRequest()))){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}else{if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.ajax.resetAjaxCall();ta.commerce.minimeta.ajax.send(false,true);ta.remove("hotels.datesChanged")}}ta.widgets.calendar.closeCalendarWidgets()},permanent:true};if(ta.retrieve("checkrates.meta_ui_post_click_prices")){k.onShow=function(){var m=ta.retrieve("meta.baseLocationId");if(m){ta.commerce.meta.updateProvAreaFromLightBox(m)}}}var f=new ta.overlays.CenteredOverlay(k);return f},AccDetail:function(o,l,f){if(o){o.stop()}l=l.getParent();var n=location.pathname;if(n.length>0){if(n.charAt(0)=="/"){n=n.substring(1)}var m=n.indexOf("-");if(m>=0){n=n.substring(0,m)}}var k=f;var j=function(){var p=ta.id("overlay_description").get("text");if(p.length>1000){ta.id("overlay_description").setStyle("height",210)}};if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.CoverOverlay({yOff:35,onLoad:j,style:"s3 dg rgba_gry",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showCloseButton:true,delayShow:true,requestData:{d:k,tab:"descript",from:n},remoteContent:"/LocationTab"},l);return false},memberOverlay:function(v,l,t){if(v){v.stop()}l.onclick=null;l.onmouseover=null;var s="";var f="";var p="";var q=false;var k=false;var j=true;var r="rgba_arrow_png24";if(l.id&&l.id!=""){var n=l.id.split("-");for(var o=0;o<n.length;o++){var m=n[o];if(m.match(/\bUID_([0-9A-F]+)\b/)){s=RegExp.$1}else{if(m.match(/\bSRC_(\d+)\b/)){f=RegExp.$1}else{if(m.match(/\bCATID_(\d+)\b/)){p=RegExp.$1}else{if(m.match("FUS")){q=true}else{if(m.match("PATT")){k=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(l)})}var u="";if(typeof(footprintGet)!="undefined"){u=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayRight({style:t||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:j,arrowClass:r,showCloseButton:true,autoShow:false,delayShow:true,remoteContent:"/MemberOverlay?uid="+s+"&c="+p+"&src="+f+"&fus="+q+"&partner="+k+"&LsoId="+u},l);return false},memberOverlayBelow:function(x,l,v,t,u){if(x){x.stop()}l.onclick=null;l.onmouseover=null;var s="";var f="";var p="";var q=false;var k=false;var j=true;var r="rgba_arrow_up_png24";if(l.id&&l.id!=""){var n=l.id.split("-");for(var o=0;o<n.length;o++){var m=n[o];if(m.match(/\bUID_([0-9A-F]+)\b/)){s=RegExp.$1}else{if(m.match(/\bSRC_(\d+)\b/)){f=RegExp.$1}else{if(m.match(/\bCATID_(\d+)\b/)){p=RegExp.$1}else{if(m.match("FUS")){q=true}else{if(m.match("PATT")){k=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(l)})}var w="";if(typeof(footprintGet)!="undefined"){w=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayBelow({style:v||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:j,arrowClass:r,allowFlip:false,showCloseButton:true,autoShow:false,delayShow:true,offsetRight:u,offsetTop:t,remoteContent:"/MemberOverlay?uid="+s+"&c="+p+"&src="+f+"&fus="+q+"&partner="+k+"&LsoId="+w},l);return false},dropdownMiniMetaOverlayHotel:function(f,k,q,m){var p="hotel_"+m;var l=ta.id(p);if(l){var n=l.getElement(".chevron");if(n){k=n}var o=l.getElement(".dropdownMiniMeta");if(o){o=o.clone();o.set("class","dropdownMiniMeta");var j={offsetLeft:260,trigger:k};if(ta.util.i18n.isRtl()){j={offsetLeft:4}}ta.store("meta.dropdownHotelsActive",p);ta.overlays.Factory.dropdownMiniMetaOverlay(f,k,q,o,j)}}},dropdownMiniMetaOverlayHotelReview:function(j,f,n,m){var o=document.getElement(".skv3 .dropdownMiniMeta");if(!o){o=document.getElement(".dropdownMiniMeta")}if(!o){ta.trackEventOnPage("LP_Chevron_Dropdown_No_Data","0");var l=document.getElement(".LowestPrice.minOffer");if(l){l.click();return false}}o=o.clone();o.set("class","dropdownMiniMeta");if(!m){m=22}var k={offsetLeft:m};ta.overlays.Factory.dropdownMiniMetaOverlay(j,f,n,o,k)},dropdownMiniMetaOverlay:function(j,f,l,m,k){if(dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}if(j){j.stop()}if(m){ta.overlays.Factory.createDropdownMiniMetaOverlay(j,f,l,m,k);ta.store("pcr.disabled",true);return true}return false},loadDropdownCSS:function(){if(window.dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}},createDropdownMiniMetaOverlay:function(f,m,q,p,k){var j="rgba_flyout gray dropdownMiniMeta";var o=true;var l=-5;switch(ta.commerce.meta.getNavAreaContextFromDom(m)){case"PCR":o=false;j+=" pcrLightBox";l=-45;break;case"Photo_Lightbox":o=false;j+=" photoAmenitiesLightBox";break;case"Amenities_Lightbox":o=false;break;default:j+=" miniMetaLightBox"}var n=0;if(k){if(k.offsetLeft){n=k.offsetLeft}if(k.offsetTop){l=k.offsetTop}}new ta.overlays.RelativeOverlayBelow(Object.merge(k,{style:j,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:o,showCloseButton:q,closeButtonClass:"roundOuterClose",arrowClass:"rgba_gray_arrow_up",offsetTop:l,offsetLeft:n,allowFlip:false,closeOnDocumentClick:true,content:p}),m)},createFacebookCTACallout:function(p,j,o,n,l,k){try{j.removePropertyEvent("mouseover","ta.overlays.Factory.createFacebookCTACallout")}catch(m){j.onmouseover=function(){}}var q=(Browser.ie7||Browser.ie8)?" ie78":"";var f={activate:ta.overlays.ACTIVATE_HOVER_DELAY,style:"s4 dg rgba_gry update2012 facebookCTAFlyout"+q,showArrow:true,centered:true,pointArrowToSource:true,showCloseButton:false,delayShow:true,innerDivClass:"inner",hoverDelayTime:0,noPadding:true,content:"<div class='onsite_cta_overlay_content'><b>"+o+"</b><br />"+l+"<br /><br /><b>"+n+"</b><br />"+k+"</div>"};new ta.overlays.RelativeOverlayBelow(f,j)},tcNavDetailOverlay:function(k,j,f){if(k){k.stop()}new ta.overlays.RelativeOverlayBelow({style:f||"typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:true,content:ta.id("INLINE_NAV_DETAIL").innerHTML},j);return false},amexSettingsOverlay:function(p,n,f,j,l,m,o){if(p){p.stop()}var k;if(ta.has(l)){k=ta.retrieve(l);k.inner.setContent(ta.id(j).innerHTML);k.show()}else{k=new ta.overlays.RelativeOverlayBelow({style:f,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,content:ta.id(j).innerHTML,offsetLeft:m,offsetTop:o,allowFlip:false},n);ta.store(l,k)}return false},menuBLimps:function(j,f){var m=$(j);if(m){if(!m.getAttribute("blimped")){var l=m.getChildren();if(l){for(var k=0;k<l.length;k++){var n=l[k].getAttribute("data-imp");if(n){ta.t4b.bl_imp_tracking.queueImpression(n,f)}}ta.t4b.bl_imp_tracking.flushImpressions();m.setAttribute("blimped",true)}}}},mcNavOverlay:function(q,j,p,o,f,r,m,l,n){var k;if(q){q.stop()}if(ta.has(f)){k=ta.retrieve(f);k.inner.setContent(ta.id(o).innerHTML);k.show()}else{if(!(ta.util.i18n.isRtl()^l)){k=new ta.overlays.RelativeOverlayLeft({style:p,activate:ta.overlays.ACTIVATE_BOTH,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,hoverDelayTime:250,content:ta.id(o).innerHTML,offsetLeft:-r,offsetTop:m,allowFlip:false,showFunction:function(){ta.overlays.Factory.menuBLimps(o,n)}},j);ta.store(f,k)}else{k=new ta.overlays.RelativeOverlayRight({style:p,activate:ta.overlays.ACTIVATE_BOTH,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,hoverDelayTime:250,content:ta.id(o).innerHTML,offsetRight:r,offsetTop:m,allowFlip:false,showFunction:function(){ta.overlays.Factory.menuBLimps(o,n)}},j);ta.store(f,k)}}return false},createPairedCalendar:function(k,j,f){return ta.overlays.createPairedCalendar(k,j,f)},createPairedCalendarGeo:function(){},_injectAd:function(f){if(ta.has("ads.gptEnabled")){return}var j=ta.id(f);try{if(j){injectAdsTargeted(j)}}catch(k){ta.util.error.record(k,"AlsoViewedLB: error injecting ad into elemId="+f)}},createDatedPairedCalendar:function(l,j,f){if(!f){f={}}if(l){new Event(l).preventDefault()}j=ta.id(j);var k=j.getParent("form");f.validate=true;f.overlayOptions={onShow:function(){ta.overlays.toggleOffSearchAll(k)}};new ta.overlays.PairedCalendar(j,f);ta.overlays.toggleOffSearchAll(k)},recordVRCrossSell:function(){try{var j=ta.id("VR_CROSS_SELL");if(j){var f=j.innerHTML.indexOf("setPID");var l=j.innerHTML.substr(f+7,5);new Request({url:"/ActionRecord?action=VR_CROSS_SELL_"+l}).send()}}catch(k){ta.util.error.record(k,"VR Cross Sell - ActionRecord failed")}},launchAVLBCompleteFn:function(j){ta.overlays.Factory._loadAVCSS();var f=function(){ta.overlays.Factory._injectAd("ALSO_VIEWED_AD")};var k=function(n){var l="alsoViewedTest avStandalone";if(ta.has("ta.avlb_hero_photos")){l="avlb_hero_photos"}var m;m=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:l,onShow:f.delay(100),onLoad:ta.overlays.Factory.recordVRCrossSell}).loadRemoteSuccess(n);var p=false;if(m.inner){var o=ta.id("emptyAlsoViewed");if(o){p=true}else{ta.store("alsoViewedLB",true)}}else{p=true}if(p){m.hide();ta.store("commerce.pwrOverlay",m)}if(ta.meta&&ta.meta.cr){ta.meta.cr.removePCR()}else{ta.commerce.checkrates.removePCR()}};new Request({url:j,onSuccess:k,evalScripts:true}).send()},_loadAVCSS:function(){if(typeof(avlbCss)!="undefined"&&!ta.retrieve("ta.avlbCss")){ta.store("ta.avlbCss",Asset.css(avlbCss))}if(typeof(avlbTestCss)!="undefined"&&!ta.retrieve("ta.avlbTestCss")){ta.store("ta.avlbTestCss",Asset.css(avlbTestCss))}if(typeof(VRCrossSellCss)!="undefined"&&!ta.retrieve("ta.VRCrossSellCss")){ta.store("ta.VRCrossSellCss",Asset.css(VRCrossSellCss))}if(typeof(avlb_hero_photos)!="undefined"&&!ta.retrieve("ta.avlb_hero_photos")){ta.store("ta.avlb_hero_photos",Asset.css(avlb_hero_photos))}},_loadChkMoreCSS:function(){ta.overlays.Factory._loadAVCSS();if(typeof(chkMoreCss)!="undefined"&&!ta.retrieve("ta.chkMoreCss")){ta.store("ta.chkMoreCss",Asset.css(chkMoreCss))}if(typeof(chkMoreSpritesCss)!="undefined"&&!ta.retrieve("ta.chkMoreSpriteCss")){ta.store("ta.chkMoreSpriteCss",Asset.css(chkMoreSpritesCss))}},loadGeoCrAutoBroadenOverlay:function(f,l){var k=ta.retrieve("gcrab.cssPath");if(k&&!ta.retrieve("gcrab.css")){ta.store("gcrab.css",Asset.css(k))}var j=new ta.overlays.CenteredOverlay({permanent:true,style:"gcrabLb",noPadding:true,absoluteOffset:true,yOffset:(Math.max(20,window.getHeight()-540)/2)+window.getScrollTop(),xOffset:Math.max(5,window.getWidth()-965)/2,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",content:'<div style="background-color:#EEE;"><img style="padding:150px;display:block;width:79px;margin:auto;" src="'+ta.util.imageServer("/img2/meta_sprites/loadingAnim.gif")+'"></div>',onClose:function(){ta.trackEventOnPage("MetaGeoLightBox","unload","CloseButton",0,false)}},f);ta.commerce.meta.loadGeoCrAutoBroadenContents(j,l)},loadCheckRatesLBOverlay:function(u,k,n){try{var q={};if(ta.meta&&ta.meta.update){q=ta.commerce.meta.getMetaParams()}var l=Object.merge({d:n.detail,s:crPageServlet,a:n.area},q);if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var o="QC_Meta_Mini|Photo_LB";var r;try{r=ta.commerce.meta.tracking.setTimingForNavArea(o);l.metaRequestTiming=r}catch(p){ta.util.error.record(p,"problem locking timing for QC_Meta_Mini|Photo_LB")}}var s="CalendarLightbox";if(n&&n.gaContext){s=n.gaContext}var f=ta.widgets.calendar.getCheckRatesData();if(f){l=Object.merge(l,f)}var t="s3 dg cr_lb_overlay lb_overlay_post_date_close";var j={backdrop:ta.overlays.BACKDROP_ALWAYS,style:t,requestData:l,remoteContent:"/CheckRatesLB",showCloseButton:true,permanent:true,onLoad:function(){if(!f){ta.overlays.Factory.loadDatePicker(u,this,n.detail,"_cro",ta.widgets.calendar.launchCRLBUpdate)}},onHide:function(){ta.remove("meta.prof_photo_lb.post_date_close.overlay")}};j.closeButtonClass="roundOuterClose";j.onClose=function(){ta.trackEventOnPage("CalendarLightbox","unload","CloseButton")};ta.store("meta.prof_photo_lb.post_date_close.overlay",new ta.overlays.CenteredOverlay(j,k));if(typeof(checkRatesLBCss)!="undefined"&&!ta.retrieve("ta.checkRatesLBCss")){ta.store("ta.checkRatesLBCss",Asset.css(checkRatesLBCss))}}catch(m){ta.util.error.record(m,"check rates leave behind")}},tryToHideCROverlayPostDatesClose:function(){var f=ta.retrieve("meta.prof_photo_lb.post_date_close.overlay");if(f){f.hide()}},tamgShowLightbox:function(k,j,l){var f="tripadvisor.com";if(typeof cookieDomain!="undefined"){f=cookieDomain.substring(1,cookieDomain.length)}new Asset.css(l);new Request({url:"/TAMGFooterAjax",onSuccess:function(m){ta.overlays.showInLightbox(m,{style:"s0 TAMG_All"})},data:{a:"SHOW_GROUP_OVERLAY",dom:f},evalScripts:true,method:"get"}).send()},currencyPickerPopup:function(l,j,f){if(l){l.stop()}j.onclick=null;var k="/StaticVelocityPage?t=currency_picker.vm";new Asset.css(globalCurrencyPickerCSS);if(ta.retrieve("currency_format_using_icu4j_cldr.featureEnabled")=="true"){new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:k,style:"global_currency_picker_overlay currency_format_using_icu4j_cldr dropMenu",onShow:function(){api.fireEvent(window,"mastheadFlyoutOpened")}},j)}else{new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:k,style:"global_currency_picker_overlay dropMenu",onShow:function(){api.fireEvent(window,"mastheadFlyoutOpened")}},j)}ta.trackEventOnPage("CurrencyPicker","Open",f);return false},intlPopup:function(m,j){if(m){m.stop()}j.onclick=null;flagsUrl=document.location.pathname;var l="/StaticVelocityPage?t=intSitesFly.vm&lt=evt&footerFlagFormat="+footerFlagFormat+"&flagsURL="+encodeURIComponent(flagsUrl);if(document.location.search!=""){l+=encodeURIComponent(document.location.search)}if(document.location.hash!=""){l+=encodeURIComponent(document.location.hash)}if(window.modelGeoId){l+="&geo="+modelGeoId}if(window.flagsSettings){for(var f=0;f<flagsSettings.length;f++){l+="&"+flagsSettings[f]+"=true"}}l+="&useHreflangs="+(ta.util.URL.getServletNameFromUrl(window.location.pathname)==="ShowTopic");if(window.pageFeature){l+="&pageFeature="+pageFeature}new Asset.css(flagsFlyoutCSS,{async:true,onLoad:function(){var k="dropMenu";var n=ta.overlays.ACTIVATE_CLICK;new Request({url:l,onSuccess:function(o){var p=new Element("div",{html:o});ta.overlays.Factory.fixFlagsFlyout(p);new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:n,content:p,style:k,onShow:function(){api.fireEvent(window,"mastheadFlyoutOpened")}},j)}}).send()}});return false},fixFlagsFlyout:function(j){if(ta.retrieve("flag_flyout_link_fixing.featureEnabled")=="true"){var f=j.getElements("a.flag_link");f.forEach(function(l){var n=document.getElement("link[hreflang="+(l.get("hreflang"))+"]");if(n!=null){var m=n.get("href");if(typeof(m)=="string"){l.href=m}else{l.parentNode.style.display="none"}}else{l.parentNode.style.display="none"}});var k=j.getElements("li.region");k.forEach(function(l){var m=l.getElements("li.flag_item");var n=l.style.display;l.style.display="none";m.forEach(function(o){if(o.style.display!="none"){l.style.display=n}})})}},showRecentLocationEmailOverlay:function(){setPID(3833);if(typeof(recentViewedCSS)!="undefined"&&!ta.retrieve("ta.recentViewedCssAsset")){ta.store("ta.recentViewedCssAsset",Asset.css(recentViewedCSS))}new Request({url:"/RecentlyViewedAjax",onSuccess:function(f){if(!f.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(f,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"share_overlay"},evalScripts:true,method:"get"}).send()},expandRecentlyViewed:function(){for(var f=4;f<7;f++){var k=ta.id("recently_viewed_"+f);if(k&&k.hasClass("hidden")){k.removeClass("hidden")}}var j=ta.id("RECENTLY_VIEWED_MORE");if(j){j.addClass("hidden")}},showRecentlyViewedCompareOverLay:function(){ta.util.cookie.setPIDCookie(4898);var j=window.location.protocol+"//"+window.location.hostname+"/CompareHotels?detail=",f=0,k;for(f=0;f<7;f++){k=ta.id("recently_viewed_"+f);if(k){j=j+k.get("locid");f+=1;break}}for(;f<7;f++){k=ta.id("recently_viewed_"+f);if(k){j=j+"&compareHotelId="+k.get("locid")}}if(typeof(compareHotelCSS)!="undefined"&&!ta.retrieve("ta.compareHotelCssAsset")){ta.store("ta.compareHotelCssAsset",Asset.css(compareHotelCSS))}new Request({url:j,onSuccess:function(l){new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"compareHotel",content:l})}}).send()},clearRecentLocations:function(){var j=ta.id("RECENTLY_VIEWED_LIST");if(j){var f=j.getNext(".bxDivider");j.dispose();if(f){f.dispose()}}new Request({url:"/RecentlyViewedAjax?a=clear"}).send()},removeParticularLocation:function(f,j,s){var l=ta.id("recently_viewed_"+s);if(l){var r=l.get("locid");l.dispose();new Request({url:"/RecentlyViewedAjax?a=remove&locID="+r}).send();for(;s<7;++s){l=ta.id("recently_viewed_"+s);if(l&&l.hasClass("hidden")){l.removeClass("hidden");break}}for(;s<7;++s){l=ta.id("recently_viewed_"+s);if(l&&l.hasClass("hidden")){return}}var m=ta.id("RECENTLY_VIEWED_MORE");if(m&&!m.hasClass("hidden")){m.addClass("hidden")}var q=$$("li.rv_item");var p=0;var k=false;if(q){p=q.length;for(var n=0;n<p;n++){if(!q[n].hasClass("geoItem")){k=true}}}if(!k){var o=ta.id("RV_SAVE");if(o){o.dispose()}}if(p===0){l=ta.id("RECENTLY_VIEWED_LIST");if(l){l.dispose()}}else{if(p===1){l=ta.id("COMPARE_HOTELS");if(l){l.getParent().addClass("hidden")}}}}},showSendMessage:function(q,j){var f;if(q){q.preventDefault()}if(j){j=ta.id(j)}if(j){if(ta.has("overlays.sendmessage.loading")){return}else{ta.store("overlays.sendmessage.loading",true);ta.remove.delay(500,null,"overlays.sendmessage.loading")}if(typeof(privateMsgCSS)!="undefined"&&!ta.retrieve("ta.privateMsgCssAsset")){ta.store("ta.privateMsgCssAsset",Asset.css(privateMsgCSS))}var k;if(j.get("tag")=="span"&&j.hasClass("fkASDF")){k=j.className.match(/u_([^ ]*)/)[1]}else{k=j.href}if(k){var l=ta.retrieve("overlays.sendmessage");if(l&&k.match(/notyou=1/)){window.location="/NewsletterSignOut-e__2F__MemberSignIn"}else{if(l){return}}var n=parseInt(f,10)==1?"cc":"cm";var r=n=="cm"&&typeof(footprintGet)!="undefined"?footprintGet():null;if(r){k+="&LsoId="+r}f=j.get("id");if(ta.retrieve("registration_web_flow_messaging")){if(!ta.registration.isAuthorized("SEND_MESSAGE")){var o={flow:"CONTENT_SUBMISSION",pid:473,userRequestedForce:true,onSuccess:function(){if(f){ta.overlays.Factory.showSendMessage(null,f)}}};ta.call("ta.registration.RegOverlay.show",{type:"dummy"},j,o);return false}ta.common.sendmessage.communityLightbox(k)}else{var p={popup:true,product:"SEND_MESSAGE"};if(f){p.successAction="ta.overlays.Factory.showSendMessage||"+f}if(ta.registration.register(p)){var m;if(j.hasClass("callback_ShowRecaptcha")){new Asset.javascript(window.location.protocol+"//www.google.com/recaptcha/api/js/recaptcha_ajax.js");m="callback_ShowRecaptcha"}ta.common.sendmessage.communityLightbox(k,m)}}}}},showConnectOverlay:function(k,f,j,m,l){ta.overlays.registration.connect(j,m,l)},showOverlayRegistration:function(j,k,r){var l,n,q,f,p,o;window.addEventListener("message",b,false);ta.on("metaFocusShow",ta.overlays.Factory.closeOverlayRegistration());ta.on("preMetaFocusShow",ta.overlays.Factory.closeOverlayRegistration());if(r&&r.hasOwnProperty("onSuccess")&&"function"===typeof(r.onSuccess)){ta.store("overlay_registration_onsuccess",r.onSuccess)}p={source:"OverlayRegistration",flow:r.flow,action:r.action,pid:r.pid,category:r.category,detail:r.locationId,geo:r.geoId,curUrl:r.curUrl};q=ta.util.URL.https("/Registration?"+Object.toQueryString(p));f=true;function m(){ta.store("ta.overlay.overlayRegistration",new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"wide",yoffset:320,showCloseButton:f,closeButtonClass:"xCloseGreen",noPadding:true,waitForCss:true,content:'<div id="overlayRegFrameWrap"></div>',onShow:function(){var t,s;t=ta.id("overlayRegFrameWrap");if(t){new Asset.image(CDNHOST+"/img2/generic/site/loop.gif",{onload:this.position.bind(this),style:"margin: 40px 0 40px 300px","class":"anim_loop"}).inject(t)}ta.trackEventOnPage(r.category,"show_overlay","",r.pid,false);ta.util.recordInterruption("gate",r.category);l=document.createElement("iframe");l.src=q;l.id="overlayRegFrame";l.className="overlayRegFrame";l.width="640";l.height="0";l.style.visibility="hidden";n=ta.id("overlayRegFrameWrap");if(!n){ta.util.error.record(null,"The registration iframe wrapper was missing.");return}n.appendChild(l);s=ta.id("overlayRegFrame");if(s){s.addEvent("load",function(){if(t&&t.getElement(".anim_loop")){t.getElement(".anim_loop").hide()}s.style.visibility="visible"})}},onClose:function(){ta.trackEventOnPage(r.category,"closed","",r.pid,false)},onHide:function(){ta.remove("ta.overlay.overlayRegistration")}}))}if(!d()){a();m()}else{o=ta.retrieve("overlay_registration_onsuccess");if(o&&"function"===typeof(o)){o();ta.remove("overlay_registration_onsuccess")}}},closeOverlayRegistration:function(){var f=ta.retrieve("ta.overlay.overlayRegistration");if(f){f.hide();ta.remove("ta.overlay.overlayRegistration")}ta.overlays.safeCloseCurrent()},showAirlineTipsOverlay:function(l,k,o){try{var j="/AirlineTips?d="+modelLocId;if(o){j=j+"&filterLang="+o}var m=false;var f=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_NEVER,style:"s3 dg nopadding",permanent:true,zIndex:"9997",showCloseButton:true,remoteContent:j,onLoad:function(){if(f.inner){var p=ta.id("emptyTips");if(p){m=true}}else{m=true}if(m){f.hide()}}},k)}catch(n){ta.util.error.record(n,"showTipsOverlay")}},_loadSummaryCss:function(){if(typeof(conceptsCss)!="undefined"&&!ta.retrieve("ta.conceptsCssAsset")){ta.store("ta.conceptsCssAsset",Asset.css(conceptsCss))}},showReviewSummary:function(o,l,n,j){if(n&&j){ta.overlays.Factory.showSummaryTranslation(o,l,n);return}var m=null;var k=null;var f=null;if(o){o.stop()}if(l.id&&l.id!=""){m=l.id.replace("concept_","").replace(/_/g," ");ta.store("topconcepts.lastconcept",m);f="/HotelSummary?d="+modelLocId+"&geo="+modelGeoId+"&concept="+m;if(n){f+="&autotrans=true"}}else{ta.util.error.record(null,"showReviewSummary - elmt.id check");return}ta.overlays.Factory._loadSummaryCss();k=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding",autoShow:false,permanent:true,showCloseButton:true,remoteContent:f,onLoad:function(){ta.store("topconcepts.overlay."+m,this);this.show()}},l);l.onclick=k.show;return false},showSummaryTranslation:function(p,l,o){ta.util.cookie.setPIDCookie(16007);if(p){p.stop()}var j="s3 dg nopadding";ta.overlays.Factory._loadSummaryCss();var n="/MachineTranslation?";var m;if(l.id&&l.id!=""){if(l.id.indexOf("trans_")!=-1){m=l.id.replace("trans_","").replace(/_/g," ")}else{m=l.id.replace("concept_","").replace(/_/g," ")}ta.store("topconcepts.lastconcept",m);n+="page=summary&";n+="d="+modelLocId+"&";n+="concept="+m;n+="&sl=en&tl="+o}var f="topconcepts.overlay."+m;var k=ta.retrieve(f);if(k){k.hide()}k=new ta.overlays.CenteredOverlay({style:j,showCloseButton:true,remoteContent:n,onLoad:function(){ta.store(f,this);this.show()}},l)},toggleConceptSnippetTranslation:function(p,k){var o=null;var m=null;var n=null;var l=null;var f=null;if(p){p.stop()}if(k){ta.util.cookie.setPIDCookie(4111);n=k.id.replace(/[^_]*_(.*)/,"$1");o=ta.id("SUMMARYOVERLAY_"+n);if(o){m=o.getElements(".snippetText");for(var j=0;j<m.length;j++){if(m[j].isDisplayed()){m[j].hide()}else{m[j].show("inline")}}}l=ta.id("trans_"+n);f=ta.id("en_"+n);if(l.hasClass("activeButton")){l.removeClass("activeButton");l.addClass("inactiveButton")}else{l.removeClass("inactiveButton");l.addClass("activeButton")}if(f.hasClass("activeButton")){f.removeClass("activeButton");f.addClass("inactiveButton")}else{f.removeClass("inactiveButton");f.addClass("activeButton")}if(ta.overlays.Factory.storeReviewSummaryContent){ta.overlays.Factory.storeReviewSummaryContent(n.replace(/_/g," "),o.getParent().get("html"))}}},reviewTranslate:function(n,l,j){if(ta.servlet&&ta.servlet.Reviews){ta.servlet.Reviews.openTranslation(l,j)}else{ta.util.error.record(null,"reviewTranslate: Deprecated factory method");ta.util.cookie.setPIDCookie(16009);ta.overlays.Factory._loadSummaryCss();var k=ta.has("photo.viewer.lightbox");var m=1001;if(k){m=10001}var f=new ta.overlays.CenteredOverlay({style:"dg cb_overlay withClose ui_modal flat_bottom",zIndex:m,noPadding:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"ui_close_x",centered:true,showCloseButton:true,remoteContent:j,onLoad:function(){this.show()}});ta.store("translationOverlay",f)}},createFriendActivityOverlay:function(j,k,l){var f;return new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 mg",onShow:function(){l&&ta.util.pending.lock("friendActivityOverlay.pageAction",function(){f=setTimeout(function(){new Request({url:"/ActionRecord?action="+l}).send()},400)})},onHide:function(){clearTimeout(f)},content:k},j)},createFriendActivityLightbox:function(f){return new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 mg friendActivity",content:f})},createCouponAnnouncementOverlay:function(l,s,j,u,r,n,o,t,q,k){ta.util.error.record(null,"createCouponAnnouncementOverlay: Deprecated factory method");ta.util.cookie.setPIDCookie(n);ta.css(r);var f={};f.act=l;if(o){f.act+="-"+o}else{if(window.pageServlet){f.act+="-"+pageServlet}}var p;if(q&&q!="false"){p="amex"}else{p="couponDetail"}ta.trackEventOnPage("SpecialOffer","click",window.pageServlet);var m="/CouponAjax?"+(s?"couponId="+s+"&":"")+(j?"announcementId="+j+"&":"")+(t?"locale="+t+"&":"")+(q?"isAmex="+q+"&":"")+(k?"showLocs="+k+"&":"")+"locationId="+u+"&listing=true";new Request({url:m,data:f,onSuccess:function(w){var v=ta.overlays.showCouponInLightbox(w,{closeButtonClass:"roundOuterClose",style:p,delayedPosition:true});v.closeBtn.addEvent("click",ta.servlet.blcoupons.closeHandler)},evalScripts:true}).send()},postVideoLogin:function(j,f,k){if(k){ta.util.cookie.setPIDCookie(k)}ta.overlays.registration.connect({flow:"POST_VIDEO"},"SIGNIN")},fbLogin:function(){ta.support.Facebook.login()},iapFlyout:function(k,j,f){require(["pages/inappropriate_vote_stub"],function(l){l.open(k,j,f)})},iapOwnerFlyout:function(k,j,f){require(["pages/inappropriate_vote_stub"],function(l){f.owner=true;l.open(k,j,f)})},openSavesRegflow:function(){ta.widgets.Saves.openSavesRegflow()},openSavesHoverRegflow:function(){ta.widgets.Saves.openSavesHoverRegflow()},openMastheadRegflow:function(){ta.widgets.Saves.openMastheadRegflow()},createGuideOverlay:function(){ta.overlays.registration.connect({flow:"DESTINATION_GUIDE"},"SIGNUP")},createPostPhotosOverlay:function(){ta.overlays.registration.connect({flow:"POST_PHOTOS"},"SIGNUP")},popConditionsOverlay:function(){var f=ta.id("CONDITIONS");if(f){ta.overlays.showInLightbox(f.innerHTML)}},cancelCreateWARList:function(j){j.stopPropagation();var f=ta.retrieve("war.todolist.showOverlay");if(f){window.clearTimeout(f);ta.store("war.todolist.showOverlay",false)}},createNeighborhoodOverlay:function(n,l,f){if(ta.has("nbhdOverlay")){if(l){l.onclick=null}ta.retrieve("nbhdOverlay").show();return}var j=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,zIndex:"997",style:"nbhdOverlay typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,onShow:function(){if(f){ta.servlet.HACSearch.filter.update()}},onHide:function(){if(f){ta.servlet.HACSearch.filter.update()}}},"NEIGHBORHOOD_OVERLAY");var k=j.inner;var m=ta.id("NEIGHBORHOOD_FORM");if(k&&m){m.inject(k,"top");m.removeClass("hidden");ta.store("neighborhoodOverlayForm",m)}ta.store("nbhdOverlay",j)},createHACProgressOverlay:function(){try{if(ta.has("ta.hac.progress.overlay")){return ta.retrieve("ta.hac.progress.overlay")}var l=ta.id("HAC_PROGRESS_CONTAINER").dispose();var f=l.get("html");var k=new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",showCloseButton:false,permanent:true,content:f});ta.store("ta.hac.progress.overlay",k);return k}catch(j){ta.util.error.record(j,"createHACProgressOverlay")}},getFilterWaitOverlay:function(){var j=ta.retrieve("filters.waitDialog");if(!j){var f="mg s1 fatNotice";if(ta.isHotelsRedesign2011()||ta.has("hotels.redesignEnabled")){f=f+" fatNotice_2011"}j=new ta.overlays.CenteredOverlay({style:f,showCloseButton:false,autoShow:false,delayedPosition:true});j.inner.set("html","<b>"+JS_UpdatingYourResults+"</b>");ta.store("filters.waitDialog",j)}return j},showFilterWaitOverlay:function(j){var f=ta.overlays.Factory.getFilterWaitOverlay();if(f){if(j){f.show();f.position(false)}else{f.hide()}}},showUpdatingMessage:function(){var j=ta.overlays.Factory.getFilterWaitOverlay();j.show();if(ta.remove("filter.map")){j.container.setStyles({left:-9999,top:-9999});var k=ta.id(ta.retrieve("maps.container")).getCoordinates();var f=j.container.getCoordinates();j.container.setStyles({left:k.left+(k.width-f.width)/2,top:k.top+(k.height-f.height)/2})}if(ta.remove("filter.lockout")){j.enableBackdrop()}},createIpDeauthOverlay:function(j,f){new Request({url:"/ActionRecordPlus?action=DEAUTH_IP&id="+j,onSuccess:function(k){new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:false}).loadRemoteSuccess(k);if(f){ta.support.Facebook.ipRevoke(10000)}},onFailure:ta.util.error.ajaxFailure.partial("partials:ip_disable")}).send()},createHotelStyleCategoryDescriptionOverlayAbove:function(l,j,f){var k=ta.id(f);j.onmouseover=null;if(k){new ta.overlays.RelativeOverlayRight({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,style:"ryokanOverlay",showArrow:true,pointArrowToSource:true,allowRightArrowPos:true,arrowHeight:29,arrowClass:"ryokanArrow",fontSize:".7em",offsetRight:-14,offsetTop:-10,waitForCss:true,content:new Element("div",{style:"width:300px; padding:12px;",html:k.getChildren()[0].get("html")})},j)}},loadBLSlideshowOverlay:function(l,k,j,f){if(window.t4bSlideshowCSS&&!ta.retrieve("ta.t4bSlideshowCSS")){ta.store("ta.t4bSlideshowCSS",new Asset.css(t4bSlideshowCSS))}new Request({url:"/BusinessListingsAjax",onSuccess:function(m){ta.overlays.showInLightbox(m,{backdrop:ta.overlays.BACKDROP_ALWAYS,style:"g s10px np"})},data:{act:"slideshow",detail:j,pid:f,servletName:pageServlet,flash:(Browser.Plugins.Flash.version>=10)},evalScripts:true,method:"get"}).send()},createFriendOfFriendOverlay:function(f,j){f.onclick=null;if(j){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_CLICK,style:"s2 mg",showCloseButton:true,content:j},f)}if(lazyImgs!=null){window.setupLazyLoad()}},CLOSE_BTN_RIGHT_OFFSET:15,ratingsFlyout:function(r,f,k,n){if(r){r.stop()}try{var m=f.get("class").match("rating(\\d)")[1];var o=ta.id("ratingsFlyout"+m).get("html");var q=null;var j="";if(k){q=ta.servlet.Reviews.ratingFlyoutScroll}var l="ratingOverlay dg s3 rgba_gry";if(n){j=" fixedHeight";l=l+" overlayWithScroll"}new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,content:o,innerDivClass:"ratingFlyout inner"+j,style:l,onscroll:q},f);new Request({url:"/ActionRecord?action=ratingsFlyout&pid=4304"}).send()}catch(p){ta.util.error.record(p,"showRatingsFlyout")}},getWhiteFlyout:function(q,k,n,o,j){if(q){q.stop()}if(!k||!n){return}var l="whiteFlyOut";var f=true;var m="flyout_white_arrow";var p="flyout_icon_close";new ta.overlays.RelativeOverlayRight({style:l,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:f,arrowClass:m,pointArrowToSource:true,showCloseButton:true,closeButtonClass:p,content:n,offsetRight:o,offsetLeft:-o,onRight:ta.util.i18n.isRtl()?false:true,offsetTop:j},k)},firstToReviewFlyout:function(o,f,n){try{var j=ta.id("locationId"+n);var k=j.getElement(".firstToReviewFlyout").innerHTML;var l=j.getElement(".propName");ta.overlays.Factory.getWhiteFlyout(o,l,k,-12,-20)}catch(m){ta.util.error.record(m,"ta.overlays.factory.firstToReviewFlyout")}},openTourismDescription:function(f){ta.servlet.Tourism.showGeoDescription(f)},memberPassportStampOverlay:function(k,f,j){if(!ta.has("passportStampsCSS")){ta.store("passportStampsCSS",new Asset.css(passportStampsCSS))}j.geos=j.geos.join(",");new ta.overlays.RelativeOverlayRight({style:"s3 dg rgba_gry memberPassportStamps",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,onLoad:function(){this.show()},remoteContent:"/MemberPassportStamps",requestData:j},f);ta.trackEventOnPage("Reviews","reviews_in_cities");new Request({url:"/ActionRecord?action="+j.actionRecord}).send()},relRightLocalContent:function(k,f,j){f.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 og",content:ta.id(j).innerHTML},f)},cookieSettingsPanel:function(l,f){if(l){l.stop()}if(f&&f.onclick){f.onclick=null}var j={};j.en=451;j.en_UK=834;j.en_IE=835;j.en_ZA=2635;j.sv=720;j.no=721;j.da=1199;j.fr=1197;j.fr_BE=6409;j.fr_CH=6410;j.de=1201;j.de_AT=2719;j.de_CH=6431;j.el=1198;j.it=1202;j.it_CH=6432;j.es=1200;j.pl=1208;j.nl=1209;j.nl_BE=6411;j.fi=2968;j.hu=3049;j.cs=3128;j.sk=3233;j["default"]=451;var k;if(posLocale in j){k="//info.evidon.com/pub_info/"+j[posLocale]+"?v=1&nt=0"}else{k="//info.evidon.com/pub_info/"+j["default"]+"?v=1&nt=0"}new ta.overlays.RelativeOverlayBelow({showCloseButton:true,noPadding:true,activate:ta.overlays.ACTIVATE_CLICK,content:new Element("iframe",{src:k,height:562,width:731,styles:{margin:"0"}})},f)},loadJFYHotelsFilter:function(t,A,r){if(t){t.stop()}var y=ta.retrieve("ta.p13n.filterOnHover");var L=ta.retrieve("ta.p13n.prodp13nIsTablet");if(typeof(y)!=="boolean"||typeof(L)!=="boolean"){return}function C(){var Q;if(document.getElement(".horizontal_filters_wrap")){var R=document.getElement(".jfy_filter_bar_top");if(R){Q=R.getElement(".options_size_limiter");if(Q&&Q.scrollHeight>95){var T=R.getElement(".resizer_footer.hidden");if(T){T.removeClass("hidden")}}}}else{if(r==="neighborhood"){ta.overlays.Factory.fixLocationFilterFooter()}else{Q=$$(".jfy_filter_bar .jfy_filter_bar_"+r+"_inner");if(Q.length>0&&Q[0].scrollHeight>95){var S=$$(".jfy_filter_bar .jfy_filter_"+r+"_footer.hidden");if(S.length>0){S[0].removeClass("hidden")}}}}}var v={};if(ta.retrieve("ta.p13n.jfyFilterSet")&&typeof ta.retrieve("ta.p13n.jfyFilterSet")==="object"){v=ta.retrieve("ta.p13n.jfyFilterSet")}var I=null;var O=(r==="price"&&!ta.widgets.calendar.hasPageDates()&&(pageServlet!="Restaurants"));var l;if(O){l=ta.retrieve("ta.p13n.priceFilterWithCalender.content");if(!l){l=$("jfy_filter_bar_price_predates");ta.store("ta.p13n.priceFilterWithCalender.content",l);l.parentNode.removeChild(l)}}else{l=ta.id("jfy_filter_bar_"+r)}if(!l){return}var z=undefined;var G=ta.id("EATERY_FILTERS_CONT");if(G||r!=="sort"){var n=document.createElement("div");n.className="jfy_filter_bar_top_arrow";z=document.createElement("div");z.className="jfy_filter_bar_top_spacer";z.insertBefore(n,null)}var B=document.createElement("div");var u="jfy_filter_bar jfy_filter_bar_"+r;B.className=u;var w=l.getElements(".all");if(w&&w.length>0){w.removeClass("hidden")}var M=l.getElements(".less");if(M&&M.length>0){M.removeClass("hidden");M.addClass("hidden")}var E=l.getElements(".sprite-tag_list_expand");if(E&&E.length>0){E.removeClass("hidden")}var q=l.getElements(".sprite-tag_list_compress");if(q&&q.length>0){q.removeClass("hidden");q.addClass("hidden")}if(r!=="price"&&r!=="hotel_class"){var P=l.getElementsByTagName("DIV")[0];P=ta.id(P);if(r==="neighborhood"){P=l.getElements(".jfy_filter_bar_neighborhood_inner")[0]}var p=false;var x=false;var o=[];var k=0;var J;if(P){var m=P.getElements(".jfy_tag_style");if(m){for(J=0;J<m.length;J++){if(m[J].hasClass("selected")){if(x){p=true;break}}else{x=true}}if(p){for(J=0;J<m.length;J++){if(m[J].hasClass("selected")){m[J].dispose();o[k]=m[J];k++}}for(J=o.length;J>0;J--){P.insertBefore(o[J-1],P.firstChild)}}}}}B.innerHTML=l.get("html");var D=document.createElement("div");if(z){D.insertBefore(z,null)}D.insertBefore(B,null);if(!v[r]){var K=ta.overlays.ACTIVATE_CLICK_ALTERNATE;var H=true;var N=1500;if(y){K=ta.overlays.ACTIVATE_BOTH_DELAY;if(!L){H=false;N=250}else{if(r==="sort"){H=false}}}var F=(r==="price")?ta.overlays.PINNABLE_CLICK:ta.overlays.PINNABLE_NEVER;var f=function(){C();if(r==="price"){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}else{if(r==="sort"){if(ta&&ta.p13n&&ta.p13n.wizard&&typeof(ta.p13n.wizard.justifyRightSortOption)=="function"){ta.p13n.wizard.justifyRightSortOption()}}}};var s=ta.retrieve("ta.p13n.header_placement_overlay_class")||"";var j="jfy_filter_bar_top dg jfy_filter_bar_top_"+r+" "+s;if(G){j=j+" restaurants_filter_overlay"}if(ta.retrieve("left_hotels_filters")){j=j+" left_hotels_filters"}I=new ta.overlays.RelativeOverlayBelow({pinnable:F,style:j,activate:K,showCloseButton:H,noPadding:true,content:D.innerHTML,centered:true,allowFlip:false,closeOnDocumentClick:true,activateHoverDelayTime:150,hoverDelayTime:N,autoShow:false,ignoreFirstClickAfterHover:y,ignoreFirstClick:y,onShow:f},A);I.adjustEdge=function(V,S){var U=ta.id("JFY_hotel_filters")||ta.id("EATERY_FILTERS_CONT");if(U&&U.getCoordinates){var T=U.getCoordinates();var R=V;if(V<T.left){R=T.left}else{if(V+S>=T.right){var Q=this._styleValueToPixel(this.container.getStyle("margin-right"));R=T.right-S-Q-1}}var W=V-R;this.setJfyArrowOffset=function(){this.inner.getElements(".jfy_filter_bar_top_arrow").setStyle("left",W+"px")};this.setJfyArrowOffset();return R}};if(y){I.showWithDelay()}else{I.show()}v[r]=I}else{I=v[r];I.inner.innerHTML=D.innerHTML;I.container.removeClass("expanded");if(I.visible){C();I.setJfyArrowOffset()}if(O){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}I.enable()}if(L){ta.id("PAGE").addEvent("click",I.hide)}ta.store("ta.p13n.jfyFilterSet",v);if(!ta.retrieve("ta.p13n.filterOnHover")){ta.trk(r,false,t.target?t.target:t.srcElement)}},fixLocationFilterFooter:function(){var n=$$(".jfy_filter_bar .location_popular .jfy_filter_bar_neighborhood_inner");if(n.length>0&&n[0].scrollHeight>95){var k=$$(".jfy_filter_bar .location_popular .jfy_filter_neighborhood_footer.hidden");if(k.length>0){k[0].removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_popular .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}var l=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_bar_neighborhood_inner");if(l.length>0){if(l[0].scrollHeight>95){var j=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_neighborhood_footer.hidden");if(j.length>0){j.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_neighborhood .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(n.length>0){$$(".jfy_filter_bar .location_neighborhood").addClass("hidden")}}var f=$$(".jfy_filter_bar .location_attraction .jfy_filter_bar_neighborhood_inner");if(f.length>0){if(f[0].scrollHeight>95){var m=$$(".jfy_filter_bar .location_attraction .jfy_filter_neighborhood_footer.hidden");if(m.length>0){m.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_attraction .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(n.length>0&&l.length>0){$$(".jfy_filter_bar .location_attraction").addClass("hidden")}}},loadJFYFilterPulldown:function(l,j){if(!ta.retrieve("ta.p13n.jfyFilterPulldown")){var k="p13n_filter_pulldown";var f=new ta.overlays.RelativeOverlayBelow({content:ta.id(k).innerHTML,activate:ta.overlays.ACTIVATE_CLICK_ALTERNATE,closeOnDocumentClick:true,style:"",noPadding:true},j);ta.store("ta.p13n.jfyFilterPulldown",f)}},adjustJFYOverlayPositions:function(){var j=ta.retrieve("ta.p13n.jfyFilterSet");var f=Object.values(j||{});Object.each(f,function(k){if(k.visible){k.hideNow();k.show()}})},loadMetaHotelsFilter:function(l,f,j,k){ta.hac.filters.loadMetaHotelsFilter(l,f,j,k)},updateMetaHotelsFiltersFromBreadcrumbs:function(l,j,f,k){ta.hac.filters.updateMetaHotelsFiltersFromBreadcrumbs(f,k)},closeAllActiveFilters:function(){ta.hac.filters.closeAllActiveFilters()},hideFilterOverlay:function(m,f,j){var k=ta.retrieve("ta.filters.overlaySet");if(k&&k[j]){var l=k[j];if(l.visible){l.hide()}}},simulateDatePickerClick:function(n,j,m,k,l,f){ta.overlays.Factory.loadDatePicker(n,j,m,k,l,f);n.stopPropagation();n.preventDefault();return false},loadVRDatePicker:function(o,j,m,k,l,f){if(!f){f={}}var n=Object.merge({calendarOptions:{isVR:true}},f);ta.overlays.Factory.loadDatePicker(o,j,m,k,l,n)},loadDatePicker:function(s,j,m,f,n,t){if(!t){t={}}if(ta.widgets.calendar.isShim){if(!j){return}j=ta.id(j);var u=j.getAttribute("data-dateType");if(!u){if(j.hasClass("out_date")){u="CHECKOUT";j.setAttribute("data-dateType",u)}else{u="CHECKIN";j.setAttribute("data-dateType",u);ta.find(".out_date",j.parentNode.parentNode).setAttribute("data-dateType","CHECKOUT")}}ta.page.gatherDates(j);return}new Asset.image(CDNHOST+"/img2/generic/site/loading_anim_gry_sml.gif");if(ta.has("isHotelsLander")||ta.isMetaHomepageIntegration2013()||ta.has("isHomepage2015")||ta.has("widget.customHotel")||ta.has("isDaoDaoHomePageUnforkCalendar")){if(ta.has("isHotelsLander")||m==1||ta.has("isDaoDaoHomePageUnforkCalendar")){t=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end",postContent:function(){var v=Elements.from('<div id="SKIP_DATES"><span class="skip_dates_text"><span class="taLnk">'+ta.retrieve("multiDP.skipDates")+"</span></span></div>")[0];v.getElement(".taLnk").addEvent("click",function(){var x=ta.overlays.getCurrent(),y=x&&x.calendar;y&&y.clear();var w=ta.id("SUBMIT_HOTELS");if(w){w.focus()}ta.widgets.calendar.clearSessionDates(null,function(){if(ta.has("widget.customHotel")){ta.widget.hotels.changeDates()}});if(ta.has("isHotelsLander")){ta.overlays.Factory.trackSkipDatesEvent("Hotels_Lander","Calendar","Skip dates",0)}else{ta.overlays.Factory.trackSkipDatesEvent("Meta_Homepage","Calendar","Skip dates",0)}});return v},onSelect:function(w){if(!w.oneSelected){var v=ta.id("SUBMIT_HOTELS");v&&v.focus()}}}},t)}if(m==1&&ta.has("widget.customHotel")){t.calendarOptions=t.calendarOptions||{};t.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+ta.retrieve("multiDP.header")+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+ta.retrieve("multiDP.footer")+"</div>")[0]}if(m==1||m=="vr"){t.calendarOptions=t.calendarOptions||{};t.calendarOptions.submitOnEnter=ta.retrieve("widget.customHotel")?ta.widget.CustomHotelsWidget.validate:ta.pages.home.validate}}else{if(ta.retrieve("checkrates.meta_ui_sk_box_v3")){t=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end"}},t)}}j=ta.id(j);if((ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")&&!ta.has("hotels_left_filters_redesign"))&&j&&!j.getParent(".geoChkRates")&&(j.getParent(".jfy_header_dates_holder")||j.getParent(".filterControls")||j.getParent(".meta_chevron_module_2014")||j.getParent("#HotelDateSearch")||j.getParent(".HotelHighlight"))){try{ta.meta.update.clearDatesBumpedMessage();t.calendarOptions=t.calendarOptions||{};var p,l,k;if(ta.has("guests_rooms_picker_3.enabled")){l=ta.id(document.getElement(".guestsRoomsDatePickerHeaderForInject.hidden"));p=l?new Element("div").adopt(l.clone()).get("html"):""}l=ta.id(document.getElement(".showPricesForInject.hidden"));k=l?new Element("div").adopt(l.clone()).get("html"):"";t.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+p+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+k+"</div>")[0];t.calendarOptions.isGuestsRoomsCalendar=true}catch(o){ta.util.error.record(o,"error building content for guests rooms datepicker wrapper")}}if(!t.calendarOptions){t.calendarOptions={}}if(ta.has("calendar.default.postcontent")&&!t.calendarOptions.postContent){t.calendarOptions.postContent=ta.retrieve("calendar.default.postcontent")}if(t.calendarOptions.isholidayEnable){t.calendarOptions.holidaysOnCalendar=ta.retrieve("calendar.holidays")}t.calendarOptions.classicStyling=true;t.calendarOptions.flights=t.flights;t.calendarOptions.oneWayFlight=t.oneWayFlight;t.calendarOptions.multiCityFlight=t.multiCityFlight;if(t.oneWayFlight||t.multiCityFlight){t.calendarOptions.onSelect="ta.overlays.calendar.select";t.calendarOptions.oneWayStyling=true}if(t.flights){var r=new Date();r.setDate(r.getDate()+ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);t.calendarOptions.lastDate=r}window.fireEvent("onCalendarSelect",j);t.calendarOptions.onChangeDates=ta.widgets.calendar.onCalendarChangeDates;t.calendarOptions.onRangeSelect=ta.widgets.calendar.onCalendarRangeSelect;if(m=="vr"){var q=new Date();q.setMonth(q.getMonth()+18);q.setDate(1);t.calendarOptions.lastDate=q}ta.overlays.Factory.destroyAnimatedDateCTA();ta.overlays.Factory._loadAvailDateWidget(s,m,"calendar",f,n,t);if(ta.retrieve("load_date_picker_buttons")){return false}},destroyAnimatedDateCTA:function(){if(ta.isMetaHotels2013()||(ta.retrieve("hh_short_cell.enabled")&&ta.widgets.calendar.hasPageDates())){var f;if(ta.retrieve("animate_date_reformat")){f=ta.id("ANIMATED_DATE_CTA_REFORMAT")}else{f=ta.id("ANIMATED_DATE_CTA")}if(f){ta.servlet.HACSearch.destroyAnimatedDateCTA()}}},trackSkipDatesEvent:function(j,k,f,m){try{ta.trackEventOnPage(j,k,f,m,false)}catch(l){}},loadAdultsField:function(n,j,m,k,l,f){if(!f){f={}}if(!f.calendarOptions){f.calendarOptions={}}ta.overlays.Factory._loadAvailDateWidget(n,m,"adults",k,l,f)},_loadAvailDateWidget:function(q,k,j,f,m,r){var o="in",l,p;if(q){q=new Event(q)}if(q&&q.target&&ta.id(q.target).hasClass&&(ta.id(q.target).hasClass("out_date")||(ta.has("guests_rooms_picker_3.enabled")&&ta.id(q.target).hasClass("outDateTrigger")))){o="out"}r.calendarOptions.pickerOption=o;p=ta.widgets.calendar.getCalendarObjectKey(k,f,o);l=ta.retrieve(p);if(l&&l.calendar.positionElement&&ta.id(l.calendar.positionElement).getParent("#PAGE")){l.show(j)}else{try{l=new ta.commerce.AvailDataWidget(q,k,j,f,m,r)}catch(n){ta.util.error.record(n,"load availDateWidget init error")}}},onClickMetaCheckRatesOverlay_allProviders:function(l,j,k,f){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(k,f)},metaCheckRatesOverlay_allProviders:function(o,j){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&j&&ta.id(j).getParents){var s=ta.id(j).getParents();s.each(function(t){if(t.hasClass("premium_offers_area")){if(ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(t)){ta.trk("n_more_sites",false,t)}}else{if(t.hasClass("metaPriceInfo")||(t.hasClass("illisting")&&ta.retrieve("servlet.smartdeals"))){if(ta.meta&&ta.meta.treeTrack){ta.meta.treeTrack.logTreeImpression();ta.trk("n_more_sites",false,t)}}}})}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").hide()}ta.remove("metaCheckRatesOverlay");if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var q=ta.retrieve("pcr.overlay");if(q&&q.visible){q.hide()}var f="";if(ta.meta&&ta.meta.update){f=ta.meta.update.buildUrl("MetaCheckRatesAjax",o,false)}else{f=ta.commerce.checkrates.buildMetaHacUrl_allProviders(o,false,"lb_allProviders",true)}var r="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){r+=" meta_lightbox_v3"}r+=" metaLightBoxChevron marketingTextLightBox";var l=window.location.hash==="#MAPVIEW"||(ta.id(window.mapDivId)&&ta.id(window.mapDivId).innerHTML!=="");if(l&&ta.retrieve("meta_lightbox_v3.enabled")){r+=" wide"}var m={style:r,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:f,onLoad:function(){var y=false,u,x;ta.store("isLightboxOpen",true);try{if(!ta.meta||!ta.meta.update){var v="meta_lb_checkrates";y=new ta.commerce.CheckRatesData({type:v,evnt:null},o,o,true);ta.store("ta.commerce.MetaHacOverlay.crData."+y.vendorSetId,y);x=y.getVendorSet().getAllVendorIds();u=y.getVendorSet().getCheckedVendor();ta.commerce.checkrates.updateMetaProviders(y)}var t=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(t&&!t.hasClass("no_cpu")){t.className+=" no_cpu"}if(this.inner){ta.fireEvent("refreshedDOMContent",this.inner)}}catch(w){ta.util.error.record(w,"meta all providers overlay load issue")}if(ta.meta&&ta.meta.update){ta.meta.update.overlayRequest(o)}else{ta.commerce.checkrates.metaHacRequest(y,x,u)}},evalScripts:true,onClose:function(){ta.store("isLightboxOpen",false);var z="meta_lightbox",y,v;z="meta_lightbox_chevron";ta.trackEventOnPage(z,"close","");if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var C=ta.retrieve("meta.baseLocationId");if(C&&o==C){if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(v){ta.commerce.meta.updateProvAreaFromLightBox(v.vendorSetId)}}if(ta.has("metaCheckRatesUpdateDivInline")){ta.commerce.meta.updateInlineMeta(o)}}else{if(C){if(ta.has("ta.meta.navArea")){y=ta.retrieve("ta.meta.navArea")}var u=ta.id("MetaPricesTab");var w=false;if(u!=null&&u.hasClass("sprite-tab-active")){w=true}var E=ta.id("LOC_PHOTOS"),D=ta.id("AMENITY_LIGHTBOX"),t=false;if(E||D){t=true}var B=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(w){if(!t){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(C);B=true}else{try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(A){ta.util.error.record(A,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(A){ta.util.error.record(A,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{v=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+C);if(v){ta.commerce.meta.miniMetaAjax(null,v,1000)}}B=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(C);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(A){ta.util.error.record(A,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(A){ta.util.error.record(A,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}}else{if(ta.meta&&ta.meta.update){ta.meta.update.request(C)}else{v=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+C);if(v!=null){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,v,1000);B=true}}}}if(!ta.meta||!ta.meta.update){v=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+C);if(v!=null&&!B){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,v,1000)}}ta.commerce.meta.updateNavArea(y)}}}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").destroy()}ta.remove("metaCheckRatesOverlay");ta.widgets.calendar.removeMetaCalendarFromSync(o);ta.widgets.calendar.closeCalendarWidgets();if(!ta.retrieve("meta.isDeals")&&(!ta.servlet.hotelsMap||!ta.servlet.hotelsMap.isMapOpen())){if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.doMetaDateSearch()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var x=document.getElements(".classicPrice");x.each(function(F){F.hide()})}}}};if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){m.absoluteOffset=true;if(ta.retrieve("tablet_maps_v1")&&ta.retrieve("maps_v2_open")&&(window.innerHeight>window.innerWidth)){var p=72;var k=ta.find(".flexCard");if(k){p=k.clientHeight+80}m.yOffset=p+window.getScrollTop()}else{m.yOffset=72+window.getScrollTop()}}m.trigger=j;var n=new ta.overlays.CenteredOverlay(m,null);n.metaLocId=o;ta.store("metaCheckRatesOverlay",n);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},metaCheckRatesOverlay:function(j,f,s,n){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();ta.store("metaCheckRatesOverlay",null);if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var p=ta.retrieve("pcr.overlay");if(p&&p.visible){p.hide()}var r="";if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}r=ta.meta.update.buildUrl("MetaCheckRatesAjax",ta.retrieve("ta.meta.request.locId"),false)}else{r=ta.commerce.checkrates.buildMetaHacUrl(j,f,s,false)}var q="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){q+=" meta_lightbox_v3"}q+=" metaLightBoxChevron";var k=window.location.hash==="#MAPVIEW"||(ta.id(window.mapDivId)&&ta.id(window.mapDivId).innerHTML!=="");if(k&&ta.retrieve("meta_lightbox_v3.enabled")){q+=" wide"}var l={style:q,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:r,onLoad:function(){if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.meta.update.overlayRequest(ta.retrieve("ta.meta.request.locId"))}else{ta.commerce.checkrates.updateMetaProviders(j);ta.commerce.checkrates.metaHacRequest(j,f,s)}var t=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(t){t.className+=" no_cpu"}},evalScripts:true,onClose:function(){var u=this.source&&this.source.getParent(".gcrabLb");var t="meta_lightbox_chevron";ta.trackEventOnPage(t,"close","");if(!u){ta.overlays.Factory.updateMiniMetaPlacements(j)}m.destroy();if(!u){ta.store("metaCheckRatesOverlay",null);if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.widgets.calendar.removeMetaCalendarFromSync(ta.retrieve("ta.meta.request.locId"))}else{ta.widgets.calendar.removeMetaCalendarFromSync(j.vendorSetId)}ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")&&!ta.id("LOC_PHOTOS")&&pageServlet!="SmartDeals"){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var v=document.getElements(".classicPrice");v.each(function(w){w.hide()})}}}};if(!l.trigger){var o=ta.retrieve("ta.hlb_el");if(o){l.trigger=o}}if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){l.absoluteOffset=true;l.yOffset=72+window.getScrollTop()}var m=new ta.overlays.CenteredOverlay(l,n);ta.store("metaCheckRatesOverlay",m);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},updateMiniMetaPlacements:function(l){var q=ta.retrieve("meta.baseLocationId"),n;if(!q&&ta.id("LOC_PHOTOS")){var u=ta.id("LOC_PHOTOS").getElement("#CHECK_RATE");if(u&&/id_(\d+)/.test(u.className)){q=RegExp.$1}}if(ta.has("ta.meta.navArea")){n=ta.retrieve("ta.meta.navArea")}if(q){var k=ta.id("MetaPricesTab");var m=false;if(k!=null&&k.hasClass("sprite-tab-active")){m=true}var v=ta.id("LOC_PHOTOS");var s=ta.id("AMENITY_LIGHTBOX");var j=ta.id("CHECK_RATES_LB");var f=false;if(v||s||j){f=true}var p=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(m){if(f){try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(o){ta.util.error.record(o,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(o){ta.util.error.record(o,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(q)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),q,"checkrates")}}p=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(q);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(o){ta.util.error.record(o,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(o){ta.util.error.record(o,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(q);p=true}}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(q)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),q,"checkrates")}}p=true}}}if((ta.retrieve("checkrates.meta_ui_post_click_prices")||v)&&ta.widgets.calendar.datesExist()&&!p){ta.commerce.meta.updateNavArea("QC_Meta_Mini");var r=document.getElementById("CHECK_RATE");if(!ta.retrieve("checkrates.meta_ui_post_click_prices")&&v){r=v.getElement("#CHECK_RATE");if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){var t=v.getParent(".overlay");if(t&&t.overlay){t.overlay.addEvent("onHide",function(){ta.commerce.minimeta.doMetaDateSearch()})}}}if(ta.meta&&ta.meta.update){ta.meta.update.request(q)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,r,q,"checkrates",true)}}}}else{if(l){ta.commerce.meta.updateInlineMeta(l.vendorSetId)}}ta.commerce.meta.updateNavArea(n)},_recordLBOpen:function(){if(!ta.remove("skipLBGARecord")){var f=ta.remove("meta.lightboxOpener")||(ta.retrieve("meta.calendarCR")?"calendar":"button");var j="meta_lightbox_chevron";ta.trackEventOnPage(j,"open",f)}},createTAListingPolicyOverlay:function(j,f,l,k){var m=ta.id(l);if(m!=null){new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",backdrop:ta.overlays.BACKDROP_ALWAYS,content:m.get("html"),isChild:k},null)}},miniMetaCrossSellMicroOverlay:function(u,l,p,k){try{l.onmouseover=null;l.onclick=null;var f;if(ta.meta&&ta.meta.update){f=ta.meta.update.buildUrl("MicroMetaAjax",p,true,false,"QC_Meta_Mini|Related_XSell")}else{var n=new ta.commerce.CheckRatesData({type:"checkrates",evnt:u},l,p,true);var m=n.getVendorSet().getCheckedContentID();var w=n.getVendorSet().getCheckedVendor();var v=ta.retrieve("meta.travelData");v=ta.commerce.checkrates.getTravelDataFromDOM();f=ta.commerce.checkrates.buildVarMetaHacUrl("MicroMetaAjax",n,m,w,true,null,"QC_Meta_Mini|Related_XSell",v)}f+="&lowContentID="+k;f+="&drop=true";var r=l.className.match(/noDelayFirst/);var t=l.className.match(/delayOpen/);var q=ta.retrieve("delayedFirst");var j=!t||(r&&!q);var o=new ta.overlays.RelativeOverlayBelow({style:"",allowFlip:false,activate:ta.overlays.ACTIVATE_HOVER_DELAY,autoShow:j,delayShow:t,offsetLeft:0,offsetTop:-20,showCloseButton:false},l);o.loadRemoteContent(f,false);ta.store("delayedFirst",true)}catch(s){ta.util.error.record(s,"ta.overlays.factory.miniMetaCrossSellMicroOverlay")}},installmentRateTip:function(j,f){f=ta.id(f);new ta.overlays.RelativeOverlayAbove({style:"",innerDivClass:"installmentRateTipOverlay",activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,allowFlip:true,content:"<span>"+ta.retrieve("meta.paymentsTipText")+"</span>"},f)},jfyMoreTagOverlay:function(j,f,l){if(j){new Event(j).stop()}var k=ta.id(l);k=k.clone();new ta.overlays.RelativeOverlayAbove({style:"moreTagOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:k.innerHTML},f)},tripTypeSelectOverlay:function(k,f){if(!f||!k){return}f.onclick=null;k.stop();ta.trackEventOnPage("Reviews_Controls","filter_dropdown","");var j=document.getElement(".tripTypeOverlayContents");if(!j){return}j.show();new ta.overlays.RelativeOverlayBelow({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:j,offsetTop:3},f)},languageFilterSelectOverlay:function(k,f){if(!f||!k){return}f.onclick=null;k.stop();var j=document.getElement(".languageList");if(!j){return}j.show();new ta.overlays.RelativeOverlayRight({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:j,offsetLeft:-13},f)},reviewLanguageOverlay:function(k,f){if(!f||!k){return}f.onclick=null;k.stop();var j=document.getElement(".languageList");if(!j){return}var l=f.getSize().x-16;new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:j,offsetTop:1,offsetLeft:l},f)},reviewSeasonOverlay:function(k,f){if(!f||!k){return}f.onclick=null;k.stop();var j=document.getElement(".seasonList");if(!j){return}new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:j,offsetTop:1},f)},topDestinationsOverlay:function(k,f){if(!f||!k){return}f.onclick=null;k.stop();var j=document.getElement(".topDestinationsList");if(!j){return}new ta.overlays.RelativeOverlayBelow({style:"topDestinationsOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:j,offsetTop:1},f)},installExitInterrupter:function(){ta.servlet.HotelReview.installExitInterrupter()},ipLearnMoreMenu:function(j,f){if(!f||!j){return}f.onclick=null;j.stop();new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"dropMenu"},f);new Request({url:"/ActionRecord?action=FBIP-PersistentHeader-Flyout"}).send()},logTrackingTree:function(){var f=document.getElement(".micro_meta_flyout");if(f){var j=f.getElement(".impressionTrackingTree");if(j){ta.trkImpTree(j)}}},loadDatePickerOverlay:function(k,j,f){ta.call("ta.p13n.wizard.loadDatePickerOverlay",k,j,f)},racLBDelegates:function(){function f(){}function j(){}return{onLoad:f,onClose:j}},racGeoSearchDelegates:function(f){return{onLoad:function(){ta.restaurantAvailabilitySearch.init(f)}}},createSearchPageScopeSelect:function(f,j){if(!f||!j){return}return new ta.overlays.RelativeOverlayBelow({style:"geo_select_flyout",closeOnDocumentClick:true,content:j},f)},loadingMostRecentDraftOverlay:function(j,k){if(j){var f=new ta.overlays.CenteredOverlay({showCloseButton:false,backdrop:ta.overlays.BACKDROP_ALWAYS,content:j.innerHTML,backdropColor:"#FFF",backdropOpacity:0.8,style:"loadingMostRecentDraftOverlay"});k();setTimeout(function(){f.hide()},3000)}},restaurantFiltersOverlay:function(f){return new ta.overlays.CenteredOverlay({showCloseButton:true,innerDivClass:"filtersOverlay",style:"filtersOverlayContainer",closeButtonClass:"filtersOverlayClose",content:f,backdrop:ta.overlays.BACKDROP_ALWAYS,fixed:false,noScrollY:true})}};if("g_logFactoryMisuse" in window){var h=ta.overlays.Factory;for(var c in h){if(h.hasOwnProperty(c)&&typeof(h[c]=="function")&&c!="reviewTranslate"){(function(j){var f=h[j];h[j]=function(){if(ta.find&&!ta.find(".overlay .inner_poi_map")){ta.util&&ta.util.error&&ta.util.error.record(null,"Factory."+j+" called on HR")}f.apply(h,arguments)}})(c)}}}})();(function(a){Object.append(a,{injectReviewSummaryContentFromConcept:function(c){try{var b=ta.retrieve("topconcepts.rsContent")[c];if(!b){ta.util.error.record(null,"injectReviewSummaryContentFromConcept - no content")}ta.overlays.Factory.injectReviewSummaryContent(b)}catch(d){ta.util.error.record(d,"injectReviewSummaryContentFromConcept")}},injectReviewSummaryContent:function(c){try{var b=ta.retrieve("reviewSummaryOverlay");if(b){b.inner.setContent(c);b.show()}else{ta.util.error.record(null,"injectReviewSummaryContent - no overlay")}}catch(d){ta.util.error.record(d,"injectReviewSummaryContent")}},storeReviewSummaryContent:function(d,c){var b=ta.retrieve("topconcepts.rsContent");if(!b){b={}}b[d]=c;ta.store("topconcepts.rsContent",b)},addSummaryBoxContentAndShow:function(d,g){try{var h=ta.retrieve("reviewSummaryOverlay");ta.overlays.Factory.injectReviewSummaryContent(g);var c=null;var k=ta.id("TRAV_SAY_TERMS");if(typeof(k)!=undefined&&k!=null){var b=k.clone(true,false);b.addClass("col1of2");c=new Element("div",{"class":"wrap bx02 rd_concepts"});c.adopt(b)}else{c=ta.id("SUMMARYBOX").clone(true,false)}var j=h.inner;j.getElement(".title").adopt(c);var l="concept_"+d.replace(/ /g,"_");var i=document.getElement(".overlay .rd_concepts ."+l);if(i){i.removeClass("taLnk").removeClass("hvrIE6").addClass("conceptSelected").onClick=""}Array.each(j.getElements(".rd_concepts .snippetText"),function(e){var n=ta.id(e);n.removeClass("snippetText");n.removeClass("sprite-middot");n.removeClass("trip_type_snippet");n.addClass("conceptBullet");var m=n.getElement(".taLnk");if(m){m.setProperty("onclick","ta.util.cookie.setPIDCookie(25223);ta.call('ta.overlays.Factory.showReviewSummaryV2',event, this);")}});ta.overlays.Factory.storeReviewSummaryContent(d,j.get("html"));ta.overlays.Factory.injectReviewSummaryContentFromConcept(d)}catch(f){ta.util.error.record(f,"updateReviewSummaryContent - request.onSuccess")}},updateReviewSummaryContent:function(c,b){try{if(ta.has("reviewSummaryOverlay")&&ta.has("topconcepts.rsContent")&&ta.retrieve("topconcepts.rsContent")[c]){ta.overlays.Factory.injectReviewSummaryContentFromConcept(c);return}if(ta.has("reviewSummaryOverlay")){new Request({url:b,onSuccess:function(e){ta.overlays.Factory.addSummaryBoxContentAndShow(c,e)},evalScripts:true,method:"get"}).send();return}else{ta.util.error.record(null,"updateReviewSummaryContent - no overlay")}}catch(d){ta.util.error.record(d,"updateReviewSummaryContent")}},getReviewSummaryUrl:function(f,e,i,c){ta.store("topconcepts.lastconcept",f);if(typeof modelLocId=="undefined"||typeof modelGeoId=="undefined"){var h=(typeof modelLocId=="undefined")?"undefined":modelLocId;var d=(typeof modelGeoId=="undefined")?"undefined":modelGeoId;ta.util.error.record(null,"getReviewSummaryUrl",null,{locId:h,geoId:d})}if(i&&c){ta.util.cookie.setPIDCookie(16007);var g="/MachineTranslation?";if(e.id){var f;if(e.id.indexOf("trans_")!=-1){f=e.id.replace("trans_","").replace(/_/g," ")}else{f=e.id.replace("concept_","").replace(/_/g," ")}ta.store("topconcepts.lastconcept",f);g+="page=summary&";g+="d="+modelLocId+"&";g+="concept="+f;g+="&sl=en&tl="+i}return g}var b="/HotelSummary?d="+modelLocId+"&geo="+modelGeoId+"&concept="+f;if(i){b+="&autotrans=true"}return b},getReviewSummaryConcept:function(b){try{var c=b.id?b.id:b.className.match("(concept_[a-zA-Z0-9-_]+)")[1];return c.replace("concept_","").replace(/_/g," ")}catch(d){ta.util.error.record(d,"getReviewSummaryConcept",null,{id:b.id,"class":b.className})}return""},showReviewSummaryV2:function(h,e,g,c){if(h){h.stop()}var f=ta.overlays.Factory.getReviewSummaryConcept(e);var b=ta.overlays.Factory.getReviewSummaryUrl(f,e,g,c);if(ta.has("reviewSummaryOverlay")){ta.overlays.Factory.updateReviewSummaryContent(f,b);return}ta.overlays.Factory._loadSummaryCss();var d=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding rgba_gry",autoShow:false,permanent:true,showCloseButton:true,remoteContent:b,onLoad:function(i){try{ta.store("topconcepts.overlay."+f,this);ta.overlays.Factory.addSummaryBoxContentAndShow(f,this.inner.innerHTML);this.show()}catch(j){ta.util.error.record(j,"showReviewSummary - overlay onload")}}},e);ta.store("reviewSummaryOverlay",d)}})})(ta.overlays.Factory);ta.overlays.CalendarOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,options:{showCloseButton:true,activate:ta.overlays.ACTIVATE_FOCUS,style:"typeO ocal",autoShow:false,autoShowCal:false,calendarOptions:null,flipPadding:25,zIndex:999,extraShow:null},initialize:function(a,b){this.input=a.getElement("input[type=text]");this.parent(b,this.input);this.input.overlay=this;this.dayField=a.getElement("input.day");this.monthField=a.getElement("input.month");this.source.addEvent("click",this.show);this.icn=a.getElement("span.icn");if(this.icn){this.icn.onclick="";this.icn.addEvent("click",this.show)}var c=a.className.search("first")>=0;this.calendar=new ta.widgets.Calendar(Object.merge({dualCalendar:true,choiceLink:"ta.overlays.calendarSelect",prevAction:"ta.overlays.calendarPrev",nextAction:"ta.overlays.calendarNext",onSelect:this.select.bind(this),onClear:this.clear.bind(this),isFirstCal:c},this.options.calendarOptions));this.inner.adopt(this.calendar.container);this.parentOverlay=a.getParent(".overlay");if(this.parentOverlay){this.parentOverlay=this.parentOverlay.overlay;this.options.isChild=true}if(this.options.autoShowCal){this.show()}},destroy:function(){this.parent();this.input.overlay=null},show:function(c,a){if(this.options.extraShow){this.options.extraShow(this)}this.input.addClass("selected");var b=this.visible;this.parent(c);if(b&&!a){return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.loadFields();this.calendar.update();this.calendar.reposition();return this},hide:function(a){if(!this.visible){return}this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}},hideNow:function(a){this.input.removeClass("selected");if(!this.visible){return this}this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}},select:function(a,b){if(b){new Event(b).preventDefault()}this.updateFields();if(!a.options.dontHideOnSelect){this.hide()}this.fireEvent("onSelect",[this,b])},hover:function(b,a){this.fireEvent("onHover",[b,this,a])},mouseout:function(a){this.fireEvent("onMouseOutOnDate",[this,a])},clear:function(a,b){b&&new Event(b).preventDefault();this.clearFields();this.hide();this.fireEvent("onClear",this)},loadFields:function(){var b=parseInt(this.dayField.value.replace(/^0/,""));var a=this.monthField.value.split(/\//);if(a.length!=2){return}var c=parseInt(a[1]);if(ta.retrieve("thai_buddhist_era_year")&&c>=(new Date().getFullYear()+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)){c-=ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}a=parseInt(a[0].replace(/^0/,""));this.calendar.selectedDate=ta.util.date.create(c,a-1,b);return this},updateFields:function(){if(!this.calendar.selectedDate){this.loadFields()}if(!this.calendar.selectedDate){return}var a=this.calendar.selectedDate.getMonth()+1;if(a<10){a="0"+a}this.dayField.value=this.calendar.selectedDate.getDate();this.monthField.value=a+"/"+this.calendar.selectedDate.getFullYear();var b=this.calendar.selectedDate.getFullYear();if(ta.retrieve("thai_buddhist_era_year")){b=b+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}this.input.value=formatDate(this.calendar.selectedDate.getDate(),this.calendar.selectedDate.getMonth(),b);this.input.defaultValue=formatDate(this.calendar.selectedDate.getDate(),this.calendar.selectedDate.getMonth(),b);this.input.removeClass&&this.input.removeClass("placeholder")},clearFields:function(){if(this.options.calendarOptions&&!this.options.calendarOptions.clearToBlank){this.input.value=this.input.getAttribute("placeholderValue")||JS_DateFormat}else{if(this.input.value==this.input.defaultValue){this.input.value=""}}},clearDateFields:function(){this.calendar.selectedDate=null;this.dayField.value="";this.monthField.value="";this.clearFields()},resetFieldsIfBlank:function(){if(this.input.value==""){this.input.value=this.input.defaultValue}},validate:function(){var b=this.input.value.match(DATE_FORMAT.pattern);if(b){var c=parseInt(b[DATE_FORMAT.date].replace(/^0/,""));var a=parseInt(b[DATE_FORMAT.month].replace(/^0/,""));var d=parseInt(b[DATE_FORMAT.year].replace(/^0/,""));if(c>0&&c<32&&a>0&&a<13){if(c<10){c="0"+c}if(a<10){a="0"+a}if(d<100){d+=2000}this.dayField.value=c;this.monthField.value=a+"/"+d;this.loadFields();if(!this.calendar.isValid()){return sInvalidDates}}else{return sInvalidDates}}else{return sInvalidDates}return null}});ta.overlays.createCalendar=function(b,a){new Event(b).preventDefault();a.onfocus="";new ta.overlays.CalendarOverlay($(a).getParent(".cal"),{autoShowCal:true})};ta.overlays.createCustomCalendar=function(c,b,a){new Event(c).preventDefault();b.onfocus="";new ta.overlays.CalendarOverlay($(b).getParent(".cal"),{autoShowCal:true,calendarOptions:a})};ta.overlays.calendarSelect=function(f,e,a,c,b){if(ta.has("checkrates.calendarActionRecord")){ta.util.cookie.removePIDCookie();ta.meta.linkTracking.actionRecord(ta.retrieve("checkrates.calendarActionRecord"))}ta.id(b).getParent(".overlay").overlay.calendar.select(f,ta.util.date.create(e,a,c));if(ta.has("checkrates.meta_calendar_style_on_classic")&&(Browser.ie||Browser.chrome)){ta.popups.PopUtil.attemptHoldingWindow(ta.meta.cr.getPropIdFromCRElement(ta.id(b).getParent(".overlay").overlay.input))}};ta.overlays.calendarPrev=function(b,a){ta.id(a).getParent(".overlay").overlay.calendar.prev()};ta.overlays.calendarNext=function(b,a){ta.id(a).getParent(".overlay").overlay.calendar.next()};ta.overlays.PairedCalendar=new Class({Implements:[Options,Events],options:{validate:false,validateFun:function(){},allowSameDay:false,calendarOptions:null,defaultSpan:1,keepDelta:false,clearDatesId:"clearDates",overlayOptions:{},overlayFirstOptions:null,disallowChars:false,disableInvalidEndDates:false,showCalIfInvalid:false,clearOnRestart:false,allowReverse:false},initialize:function(b,a){this.setOptions(a);b=ta.id(b);this.form=b.get("tag")=="form"?b:b.getParent("form");var c=Object.merge({onSelect:this.adjustRange.bind(this)},this.options.overlayOptions);if(this.options.calendarOptions){c.calendarOptions=this.options.calendarOptions}this.form.getElements(".cal").each(function(d){var f;if(d.hasClass("first")&&this.options.overlayFirstOptions){f=new ta.overlays.CalendarOverlay(d,Object.merge(Object.clone(c),this.options.overlayFirstOptions))}else{f=new ta.overlays.CalendarOverlay(d,c)}f.input.onfocus="";if(this.options.disallowChars){f.input.addEvent("keypress",this.validateInput.bind(this))}if(d.hasClass("first")){this.before=f}else{this.after=f;if(ta.has("isDaoDaoCRRedesign")){var e=this.form.get("qc_area");this.after.qcArea=e;this.before.qcArea=e}}},this);if(ta.retrieve("isDaoDao")){ta.store("cal_in",this.before);ta.store("cal_out",this.after)}this.after.theOtherCal=this.before;this.before.theOtherCal=this.after;this.after.calendar.theOtherCal=this.before.calendar;this.before.calendar.theOtherCal=this.after.calendar;if(b===this.before.input||b===this.before.icn){this.after.loadFields();if(this.before.options.autoShowCal){this.before.show()}}else{if(b===this.after.input||b===this.after.icn){this.before.loadFields();if(this.after.options.autoShowCal){this.after.show()}}}if(this.form){this.form.calendar=this;if(this.options.validate){this.form.addEvent("submit",this.validate.bind(this));this.errorDiv=this.form.getElement(".error_msg")}}},getOverlayForCalendar:function(a){if(this.before.calendar==a){return this.before}if(this.after.calendar==a){return this.after}return null},adjustRange:function(c){this.requireFullLoad();if(this.form.searchAll){if(this.form.searchAll.type=="checkbox"){this.form.searchAll.checked=false}else{if(this.form.searchAll.type=="hidden"){this.form.searchAll.value="false"}}}var b=ta.id(this.options.clearDatesId);if(b){b.style.visibility="visible"}var h=false;if(this.options.clearOnRestart&&c===this.before){this.after.clearDateFields()}else{if(this.options.allowReverse&&c===this.after&&this.before.calendar.selectedDate&&this.after.calendar.selectedDate.getTime()<this.before.calendar.selectedDate.getTime()){var k=this.before.calendar.selectedDate;this.before.calendar.selectedDate=this.after.calendar.selectedDate;this.after.calendar.selectedDate=k;this.before.updateFields();this.after.updateFields()}else{if(!this.sameDayEnabled()&&!this.options.disableInvalidEndDates&&this.after.calendar.selectedDate&&this.after.calendar.selectedDate.getTime()==this.after.calendar.options.firstDate.getTime()){this.before.calendar.selectedDate=new Date(this.before.calendar.options.firstDate);if(this.options.keepDelta){this.options.defaultSpan=1}var k=new Date(this.after.calendar.options.firstDate);k.setDate(k.getDate()+this.options.defaultSpan);this.after.calendar.selectedDate=k;this.before.updateFields();this.after.updateFields()}else{if(c==this.before){if(this.options.keepDelta||!this.isBeforeValid()){var k=new Date(this.before.calendar.selectedDate);k.setDate(k.getDate()+this.options.defaultSpan);this.after.calendar.selectedDate=k;h=true}this.after.updateFields()}else{if(c==this.after){if(!this.isAfterValid()){var k=new Date(this.after.calendar.selectedDate);k.setDate(k.getDate()-this.options.defaultSpan);if(k.getTime()<this.before.calendar.options.firstDate.getTime()){k=new Date(this.before.calendar.options.firstDate.getTime())}this.before.calendar.selectedDate=k}this.before.updateFields()}}}if(this.options.keepDelta&&this.before.calendar.selectedDate){this.options.defaultSpan=ta.util.date.getDaysInRange(this.before.calendar.selectedDate,this.after.calendar.selectedDate)-1;if(this.sameDayEnabled()){if(this.options.defaultSpan<0){this.options.defaultSpan=0}}else{if(this.options.defaultSpan<1){this.options.defaultSpan=1}}}}}this.fireEvent("onUpdate",this);var g=ta.retrieve("calendar.onUpdateCallback");if(g){for(var f=0;f<g.length;f++){if(window[g[f]]){window[g[f]](this,c)}}}this.updateMinStay(this.before.calendar.selectedDate,this.after.calendar.selectedDate);try{var a="before";if(c==this.after){a="after"}}catch(j){ta.util.error.record(j,"availability check - paired cal")}if(this.options.disableInvalidEndDates){if(c==this.before){var k=new Date(this.before.calendar.selectedDate);k.setDate(k.getDate()+1);this.after.calendar.options.firstDate=k;if(h){this.after.show()}}}},updateMinStay:function(a,c){var b=ta.id("minStay");if(b&&a&&c){b.disabled=true;b.selectedIndex=this.getMinStayIndex(a,c)}},getMinStayIndex:function(a,c){var b=ta.util.date.getDaysInRange(a,c)-1;if(b<7){return b}else{if(b<28){return 7}else{return 8}}},isOneWay:function(){return this.form.oneWay&&this.form.oneWay.checked},sameDayEnabled:function(){return this.options.allowSameDay||this.isOneWay()},searchAllEnabled:function(){return this.form.searchAll&&(this.form.searchAll.checked||(this.form.searchAll.type=="hidden"&&this.form.searchAll.value=="true"))},updateFields:function(){this.before.updateFields();this.after.updateFields()},clearFields:function(){this.before.clearDateFields();this.after.clearDateFields()},resetFieldsIfBlank:function(){this.before.resetFieldsIfBlank();this.after.resetFieldsIfBlank()},requireFullLoad:function(){if(!this.before.calendar.selectedDate){this.before.loadFields()}if(!this.after.calendar.selectedDate){this.after.loadFields()}},isBeforeValid:function(){this.requireFullLoad();if(!this.after.calendar.selectedDate){return true}return(this.before.calendar.selectedDate<this.after.calendar.selectedDate)||(this.sameDayEnabled()&&this.before.calendar.selectedDate.getTime()<=this.after.calendar.selectedDate.getTime())},isAfterValid:function(){this.requireFullLoad();if(!this.before.calendar.selectedDate){return true}return(this.after.calendar.selectedDate>this.before.calendar.selectedDate)||(this.sameDayEnabled()&&this.after.calendar.selectedDate.getTime()>=this.before.calendar.selectedDate.getTime())},validateInput:function(a){if(a.key.match(/^[a-zA-Z]$/)){a.preventDefault()}},validate:function(g){if(this.searchAllEnabled()){return true}var a=this.before.validate();var b=this.after.validate();var d=true;if(this.isOneWay()){if(a!=null){d=false;this.setError(a)}}else{if(a!=null||b!=null){d=false;this.setError(a||b)}else{if(!this.isAfterValid()){d=false;this.setError(sInvalidDates)}}}if(!d&&g){new Event(g).stop()}if(this.options.showCalIfInvalid){var f;if(a!=null){f=this.before}else{if(b!=null||!d){f=this.after}}if(f){f.input.value="";f.selectedDate=new Date();f.updateFields();f.show()}}if(d&&this.options.validateFun&&typeof this.options.validateFun==="function"){try{return this.options.validateFun(g)}catch(c){ta.util.error.record(c,"post-validation callback function failed in PairedCalendar",g);return d}}else{return d}},setError:function(a){if(!this.errorDiv){return}this.errorDiv.setContent(a).show()},toggleSearchAll:function(){if(this.searchAllEnabled()){this.before.clearFields();this.after.clearFields()}else{this.requireFullLoad();this.before.updateFields();this.after.updateFields()}}});ta.overlays.createSimplePairedCalendar=function(b,a){new Event(b).stop();new ta.overlays.PairedCalendar(a)};ta.overlays.createPairedCalendar=function(f,c,b){if(!b){b={validate:true}}new Event(f).preventDefault();var e;if(ta.isMetaHomepageIntegration2013()||ta.isMetaHotel2013()||ta.isMetaHotels2013()||ta.isAirport()){var d=b.inline;var a=typeof b.skipHAC!=="undefined"&&b.skipHAC!=null&&b.skipHAC;b.clearOnRestart=true;b.allowReverse=true;b.overlayOptions={showCloseButton:false,style:"date_picker_calendar paired",noPadding:true,noCpu:true};b.calendarOptions={prevStyle:"sprite-date_picker-btnLeftIdle",nextStyle:"sprite-date_picker-btnRightIdle",showRange:true};b.onUpdate=function(g){ta.widgets.calendar.setPageInDate(g.before.calendar.selectedDate);ta.widgets.calendar.setPageOutDate(g.after.calendar.selectedDate);if(g.before.calendar.selectedDate&&g.after.calendar.selectedDate){if(ta.isMetaHotels2013()&&!a){ta.servlet.HACSearch.doMetaDateSearch()}else{if(d){ta.widgets.calendar.launchInlineMeta(f)}}}};if(b.clearDates){delete b.clearDates;b.calendarOptions.postContent=function(){var g=Elements.from('<div id="SKIP_DATES"><span class="skip_dates_text"><span class="taLnk">'+ta.retrieve("multiDP.skipDates")+"</span></span></div>")[0];g.getElement(".taLnk").addEvent("click",function(){var i=ta.overlays.getCurrent();if(i){i.clearDateFields();i.theOtherCal&&i.theOtherCal.clearDateFields();i.hide()}var h=ta.id("SUBMIT_HOTELS");if(h){h.focus()}ta.widgets.calendar.clearPageDates();ta.widgets.calendar.clearSessionDates();ta.overlays.Factory.trackSkipDatesEvent("Meta_Homepage","Calendar","Skip dates",0)});return g}}e=new ta.overlays.PairedCalendar(c,b);e.before.addEvent("onSelect",function(h,g){e.after.input.focus()})}else{e=new ta.overlays.PairedCalendar(c,b)}return e};ta.overlays.clearFields=function(a){if(a.calendar){a.calendar.clearFields()}};ta.overlays.resetFieldsIfBlank=function(a){if(a.calendar){a.calendar.resetFieldsIfBlank()}};ta.overlays.toggleOffSearchAll=function(a){if(a.calendar&&a.searchAll){if(a.searchAll.type=="checkbox"){a.searchAll.checked=false}else{if(a.searchAll.type=="hidden"){a.searchAll.value="false"}}a.calendar.toggleSearchAll()}};ta.overlays.toggleOnSearchAll=function(a){a=ta.id(a);var b=a.getParent("form");if(!b.calendar){new ta.overlays.PairedCalendar(a,{validate:true,clearDatesId:a})}if(b.calendar&&b.searchAll){if(b.searchAll.type=="checkbox"){b.searchAll.checked=true}else{if(b.searchAll.type=="hidden"){b.searchAll.value="true"}}b.calendar.toggleSearchAll()}};ta.overlays.toggleSearchAll=function(d,b,a){b=ta.id(b);b.onclick="";var c=b.getParent("form");if(!a){a={validate:true}}if(!c.calendar){new ta.overlays.PairedCalendar(b,a)}c.calendar.toggleSearchAll(b);b.addEvent("click",c.calendar.toggleSearchAll.bind(c.calendar))};ta.overlays.clearDates=function(c,a){ta.overlays.toggleOnSearchAll(a);ta.id(a).style.visibility="hidden";var b=ta.id("minStay");if(b!==null){b.disabled=false;b.selectedIndex=0;filtersChanged(c)}};ta.overlays.PermanentOverlay=new Class({Extends:ta.overlays.AbsoluteOverlay,initialize:function(a,b){this.parent(Object.merge({permanent:true},a),b)}});ta.overlays.SkinnyOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,initialize:function(a,b){this.parent(a,b);this.container.setStyle("max-width","120px");if(Browser.ie6){this.shim.setStyle("max-width","120px")}if(this.transparentOverlayPadding){this.transparentOverlayPadding.setStyle("max-width","120px")}}});ta.overlays.Registration=new Class({Implements:[Options,Events],Binds:["response","failure"],options:{flow:null,url:"/Registration",isOverlay:true,pageTarget:null,responseCallback:null,completeCallback:null,customOverlayOptions:{},noreload:false,failureCloseHandler:null},initialize:function(a){this.setOptions(a);if(this.options.isOverlay){this.overlay=new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS,autoShow:false,style:"s4 dg",attachCloseEvent:false},this.options.customOverlayOptions));if(this.overlay.closeBtn){this.overlay.closeBtn.addEvent("click",this.cancel.bind(this))}}},getRequestData:function(){var c={flow:this.options.flow};this.options.pid&&Object.merge(c,{pid:this.options.pid});if(ta.has("registration.data")){c=Object.merge(c,ta.retrieve("registration.data"))}if(ta.has("page.geo")){c.geo=ta.retrieve("page.geo")}c.source=pageServlet;c=[c];Array.from(arguments).each(function(d){c.push(d)});var a=ta.id("token");if(a&&a.hasOwnProperty("value")){c.securityToken=a.value}if(ta.has("rsa")){c.push({encrypted:ta.retrieve("rsaVersion")});var b=ta.retrieve("rsa");c.forEach(function(d){if(d.pass){try{c.push({epass:b.encrypt(d.pass.value)})}catch(f){ta.util.error.record(f,"Encrypted Signin - encrypting sign-in/sign-up form parameters")}}})}return c},_getUrl:function(){var a=ta.util.URL.https(this.options.url);if(0!==a.indexOf("https:")){ta.util.error.record(null,"Post URL must have https protocol.");return""}return a},request:function(c,b){ta.store("registration.method","request");var a={url:this._getUrl(),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:this.getRequestData(b,{action:c}),onSuccess:this.response,onFailure:this.failure};if(ta.has("registration.ga_module")){a.trackEvent={module:ta.retrieve("registration.ga_module"),action:c+"_Show",context:this.options.flow}}new Request(a).send();return this},post:function(b){var a=this;if(ta.has("registration.ga_module")){ta.trackEventOnPage(ta.retrieve("registration.ga_module"),b.action.value+"_Submit",a.options.flow,1,false)}ta.util.pending.waitFor(function(){return !ta.has("rsaLoading")},function(){if(ta.has("facebook.authcode.param")){b=Object.merge(b,{FBAuthCode:ta.remove("facebook.authcode.param")})}ta.store("registration.method","post");new Request({url:a._getUrl(),method:"post",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:a.getRequestData(b,{noreload:a.options.noreload}),onSuccess:a.response,onFailure:a.failure}).send()},100);return this},cancel:function(){ta.store("registration.method","cancel");new Request({url:this._getUrl(),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:this.getRequestData({CANCEL:"y",action:ta.retrieve("registration.action"),noreload:this.options.noreload}),onSuccess:this.response,onFailure:this.failure}).send();return this},log:function(a){new Request({url:this._getUrl(),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:false,data:this.getRequestData({action:"LOG",pageAction:a})}).send();return this},response:function(a){if(!ta.remove("registration.noop")){if(this.options.isOverlay){this.overlay.loadRemoteSuccess(a);if(this.overlay.visible){this.overlay.position()}else{this.overlay.show()}}else{if(this.options.pageTarget){this.options.pageTarget.setContent(a)}}}if(this.options.responseCallback){setTimeout(this.options.responseCallback,1)}if(ta.has("registration.afterUpdate")){ta.remove("registration.afterUpdate").each(function(b){setTimeout(b,1)})}},close:function(){if(this.options.isOverlay){this.overlay.hide()}this.fireEvent("onComplete");if(this.options.completeCallback){this.options.completeCallback()}},failure:function(c){var a=0;var d=ta.remove("registration.method");try{a=c.status}catch(b){}if(a==503){this.overlay.loadRemoteSuccess('<div style="padding:6px;">'+JS_maintenance+"</div>");if(!this.overlay.closeBtn&&this.options.failureCloseHandler){this.overlay.addCloseButton()}if(this.overlay.closeBtn){this.overlay.closeBtn.removeEvents("click");this.overlay.closeBtn.addEvent("click",this.options.failureCloseHandler||ta.overlays.registration.close)}if(this.overlay.visible){this.overlay.position()}else{this.overlay.show()}}else{if(d=="cancel"){ta.overlays.registration.close()}ta.util.error.ajaxFailure.partial("Registration:"+d)}}});ta.overlays.registration={getInstance:function(a){var b=ta.retrieve("registration.instance");if(!b){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCss")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}b=new ta.overlays.Registration(a);ta.store("registration.instance",b)}return b},connect:function(a,d,c){ta.queueForReady(function(){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCss")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}},0,"Pre-redesigned Registration CSS");if(ta.has("facebook.available")&&ta.retrieve("facebook.available")){var e={fbAvailable:true}}else{if(ta.has("registration.forceFBAvailable")){var e={fbAvailableForce:ta.remove("registration.forceFBAvailable")}}}var b="SIGNIN";ta.remove("registration.data");if(typeof(a)=="undefined"){a={}}ta.overlays.registration.addLoadingGeeTestCaptchaOnCallBack(a);ta.overlays.registration.getInstance(a).request(d||b,Object.merge({},c,e))},post:function(b,a){var c=a||window.event;if(c){new Event(c).stop()}ta.overlays.registration.getInstance().post(b)},request:function(c,b,a){if(c=="SIGNUP"||c=="SIGNIN"){b=Object.merge({fbAvailable:ta.has("facebook.available")&&ta.retrieve("facebook.available")},b)}if(typeof(a)=="undefined"){a={}}ta.overlays.registration.addLoadingGeeTestCaptchaOnCallBack(a);ta.overlays.registration.getInstance(a).request(c,b)},deferredRequest:function(d,b,e,c,a){ta.overlays.registration.getInstance(a).request(e,c,a)},cancel:function(a){ta.overlays.registration.getInstance(a).cancel(false)},log:function(a){ta.overlays.registration.getInstance().log(a)},close:function(){var a=ta.remove("registration.instance");if(a){a.close()}},switchFlow:function(a){ta.overlays.registration.getInstance().options.flow=a},logAndPost:function(c,b,a){ta.overlays.registration.getInstance(c).log(b).post(a)},postSignupForm:function(b,a){var c=a||window.event;if(c){new Event(c).stop()}ta.overlays.registration.getInstance().post(b)},addLoadingGeeTestCaptchaOnCallBack:function(b){if(typeof(b.responseCallback)=="function"){var a=b.responseCallback;b.responseCallback=function(){ta.overlays.registration.loadGeeTestCaptcha();a()}}else{b.responseCallback=ta.overlays.registration.loadGeeTestCaptcha}},loadGeeTestCaptcha:function(){if(ta.retrieve("geetest_captcha")){var e=ta.id("geetest_recaptcha_widget");if(e){var c=e.getAttribute("data-captcha-id");var d=e.getAttribute("data-captcha-type");var b=ta.select("#geetest_recaptcha_widget .gt_holder");if(window.Geetest&&b.length==0){var a=new Geetest({gt:c,product:d,https:true}).onReady(function(){var f=ta.select("#geetest_recaptcha_widget .gt_guide_tip");if(f.length>0){f[0].innerHTML=ta.retrieve("geetest_captcha.str_slide_to_verify")}}).appendTo(e);if(ta.trackEventOnPage){ta.trackEventOnPage("reg_captcha","GEETEST","displayed")}}}}}};ta.servlet.Registration={realNameDone:function(a){if(ta.id("use_real_name")&&ta.id("use_real_name").getProperty("checked")||ta.id("chooseNameFB")||ta.id("chooseNameGoogle")){ta.overlays.registration.post(ta.id("RealName"),a)}else{ta.overlays.registration.cancel()}},screenEdit:function(a){ta.id("screen").set("value","");ta.id("screen").focus();ta.id(a).hide()},displayLoading:function(){if(window.CDNHOST!=null){ta.id("buttonArea").innerHTML='<img class="loadingGif" src="'+CDNHOST+'/img2/generic/site/loading_anim_gry_sml.gif" />'}else{ta.id("submitButton").set("disabled",true)}},trackEmailOpt:function(a,b){if(a){if(!a.checked){ta.trackEventOnPage("register","sign_up_"+b,"email_opt_out")}}},toggleProgressCircle:function(b){var a=ta.id("circleContainer_"+b);if(a){if(a.hasClass("progressCircleChecked")){a.removeClass("progressCircleChecked");a.addClass("progressCircle");a.innerHTML=b}else{a.removeClass("progressCircle");a.addClass("progressCircleChecked")}}},toggleProgressBar:function(a){var b=ta.id("barContainer_"+a);if(b){if(b.hasClass("filled")){b.removeClass("filled")}else{b.addClass("filled")}}},toggleProgressElement:function(a,b,c){if(a&&a<=b){if(c=="Bar"){this.toggleProgressBar(a)}else{if(c=="Circle"){this.toggleProgressCircle(a)}}}},toggleTagged:function(c,b,f,e){if(c&&ta.id("tagContainer_"+c)){var a=ta.select(".tagSelection:checked").length;var d=ta.id("tagContainer_"+c);if(d.hasClass("tagged")){d.removeClass("tagged");this.toggleProgressElement(a,b,e);if(ta.id("tag_"+c).checked){ta.id("tag_"+c).checked=false;this.activateMemberTagSubmit(f)}}else{d.addClass("tagged");this.toggleProgressElement(a+1,b,e);if(!ta.id("tag_"+c).checked){ta.id("tag_"+c).checked=true;this.activateMemberTagSubmit(f)}}}},activateMemberTagSubmit:function(c){var b=1;var a=ta.id("submitBtn");if(c){b=0}if(a&&ta.select(".tagSelection:checked").length>=b){a.addClass("active")}else{if(a){a.removeClass("active")}}},submitMemberTags:function(s,j){var c;var i=(c=ta.select(".tagSelection:checked"))?c.length:0;var n=(c=ta.id("memberTagsPlacementPid"))?c.value:0;var a=(c=ta.id("memberTagsIsSecure"))&&(c.value=="true");var o=(c=ta.id("memberTagsIsEditFlow"))&&(c.value=="true");var l=(c=ta.id("memberTagsForceAjax"))&&(c.value=="true");var g=(c=ta.id("memberTagsOnSuccess"))?c.value:"";var f=ta.servlet.Registration[g];var b=$(s);if(!b||!b.hasClass("active")){return}var r=b.hasClass("skipBtn");var m=ta.id("submitBtn");if(m){m.removeClass("active")}var p=ta.id("skipBtn");if(p){p.removeClass("active")}ta.trackEventOnPage("self_tags",j,n,i);if(o&&r&&("undefined"!==typeof(oxapp))&&oxapp.getSubview("modules.membercenter.MemberTag")){if(m){m.addClass("active")}if(p){p.addClass("active")}var h=oxapp.getSubview("modules.membercenter.MemberTag");if(h.context&&h.context.get("MemberCenter_MemberTags")&&h.context.get("MemberCenter_MemberTags")._items&&h.context.get("MemberCenter_MemberTags")._items.length==0){h.taggedItems=[]}h.taggingOverlay.hide();return}if(o&&r&&("undefined"!==typeof(bbapp))&&bbapp.getView("modules.membercenter.MemberTag")){if(m){m.addClass("active")}if(p){p.addClass("active")}var h=bbapp.getView("modules.membercenter.MemberTag");if(h.context&&h.context.get("MemberCenter_MemberTags")&&h.context.get("MemberCenter_MemberTags").length==0){h.taggedItems=[]}h.taggingOverlay.hide();return}if(r){var d=ta.id("tagCancel");if(d){d.value=true}var k=ta.find(".overlayBG"),t=ta.find(".withBackdrop"),q=ta.id("tagPrompt");if(q&&k&&t&&t.hasClass("taggingOverlay")){q.hide();k.hide();t.hide()}}if(a&&!l){ta.overlays.registration.getInstance().post(ta.id("SELF_TAG_FORM")).response(function(){if(m){m.addClass("active")}if(p){p.addClass("active")}})}else{new Request({url:"/MemberTagsAjax",method:"post",data:ta.id("SELF_TAG_FORM"),onSuccess:function(e){if(m){m.addClass("active")}if(p){p.addClass("active")}if("function"===typeof(f)){f(e)}},onFailure:function(e){if(m){m.addClass("active")}if(p){p.addClass("active")}if(("undefined"!==typeof(oxapp))&&oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").taggingOverlay.hide()}if(("undefined"!==typeof(bbapp))&&bbapp.getView("modules.membercenter.MemberTag")){bbapp.getView("modules.membercenter.MemberTag").taggingOverlay.hide()}}}).send()}var d=ta.id("tagCancel");if(d){d.value=""}},memberTagsSuccessMemberCenter:function(c){if((typeof oxapp==="undefined"&&typeof bbapp==="undefined")||!c){return}var a,b=(a=ta.id("memberTagsIsEditFlow"))&&(a.value=="true");if(b&&typeof oxapp!=="undefined"&&oxapp.context.get("MemberCenter_MemberTags")){oxapp.context.get("MemberCenter_MemberTags").fetch().always(function(){if(oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").render()}});if(oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").taggingOverlay.hide()}}if(b&&typeof bbapp!=="undefined"&&bbapp.context.get("MemberCenter_MemberTags")){bbapp.context.get("MemberCenter_MemberTags").fetch().always(function(){if(bbapp.getView("modules.membercenter.MemberTag")){bbapp.getView("modules.membercenter.MemberTag").render()}});if(bbapp.getView("modules.membercenter.MemberTag")){bbapp.getView("modules.membercenter.MemberTag").taggingOverlay.hide()}}},memberTagsRedirectCompletionUrl:function(b){var a=ta.id("memberTagsCompletionUrl");if(a&&a.value){window.location.href=a.value}}};ta.overlays.PopoutOverlay=new Class({Extends:ta.overlays.Overlay,options:{backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true},initialize:function(a,b){this.parent(a,b);this.placeholder=new Element("div").inject(this.source,"before").adopt(this.source);this.placeholder.setStyles({marginBottom:this.source.style.marginBottom,marginTop:this.source.style.marginTop});this.source.setStyles({marginBottom:0,marginTop:0});if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}this.show()},show:function(a){this.sourceCoords=this.source.getCoordinates();this.placeholder.setStyles({width:this.sourceCoords.width,height:this.sourceCoords.height});this.inner.adopt(this.source);this.parent(a)},hide:function(a){this.parent(a);this.placeholder.adopt(this.source).setStyles({width:"auto",height:"auto"})},position:function(){var b=parseInt(this.container.getStyle("borderTopWidth").replace(/px/,""));var a=parseInt(this.container.getStyle("borderLeftWidth").replace(/px/,""));this.container.setStyles({left:this.sourceCoords.left-a,top:this.sourceCoords.top-b,width:this.sourceCoords.width,display:"block"});this.parent()}});ta.overlays.PopoutWithOverlay=new Class({Extends:ta.overlays.Overlay,options:{position:"topleft",edge:"topright",offset:{x:-10,y:0},scrollOffset:-20,backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true},initialize:function(a,b){this.parent(a,b);this.placeholder=new Element("div").inject(this.source,"before").adopt(this.source);this.popout=new Element("div",{styles:{position:"absolute",zIndex:"10002",fontSize:"0.75em",display:"none"}}).inject(document.body);if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}this.show()},show:function(b){this.parent(b);var a=this.source.getCoordinates();this.placeholder.setStyles({width:a.width,height:a.height,marginBottom:this.source.style.marginBottom,marginTop:this.source.style.marginTop});this.popout.setStyles({left:a.left,top:a.top,width:a.width,display:"block"}).adopt(this.source)},hide:function(a){this.parent(a);this.placeholder.adopt(this.source).setStyles({width:"auto",height:"auto"});this.popout.setStyle("display","none")},position:function(){var a=this.source.getCoordinates();this.container.setStyles({left:null,top:a.top+this.options.offset.y,right:window.getWidth()-(a.left+this.options.offset.x)});this.parent();window.scrollTo(0,a.top+this.options.offset.y+this.options.scrollOffset)}});ta.overlays.CoverOverlay=new Class({Extends:ta.overlays.Overlay,options:{autoShow:true,xOff:0,yOff:0},initialize:function(a,b){this.parent(a,b);if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}if(this.options.autoShow){this.show()}},position:function(){var b=this.source.getCoordinates();var a=this.container.getCoordinates();this.container.setStyles({left:b.left+(b.width/2-a.width/2)+this.options.xOff,top:b.top+(b.height/2-a.height/2)+this.options.yOff})},updateBackdrop:function(){var a=this.source.getCoordinates();this.backdrop.setStyles({left:a.left,top:a.top,width:a.width,height:a.height})}});ta.overlays.SpecialDropDownWithRangeOverLay=new Class({Extends:ta.overlays.RelativeOverlayBelow,options:{onClose:false,onShow:false},initialize:function(a,b){var d=["vrPriceMinDropDown","vrPriceMaxDropDown","vrPricePeriodDropDown"];var c="";if(b.id&&d.contains(b.id)){c="vrPriceDropDown"}this.parent(Object.merge({below:true,innerDivClass:"",style:c,autoShow:false},a),b);this.container.removeClass("relative");if(a.onClose){this.options.onClose=a.onClose}if(a.onShow){this.options.onShow=a.onShow}},show:function(h){if(this.visible){this.hide();return}try{this.options.onShow()}catch(g){}var b=h.srcElement?h.srcElement:h.target;if(b){this.source=b}if(this.options.sourceId){this.source=ta.id(this.options.sourceId);this.source.addClass("selected")}var d=ta.select(".overlay");for(var f=0;f<d.length;f++){var c=d[f];if(c.contains(this.source)){var a=c}}if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1)}document.addEvent("click",this.hide);this.parent(h)},hide:function(b){if(this.options.onClose){try{this.options.onClose()}catch(a){}}if(this.options.rangeInputClass){try{if(this.options.closeOnlyIfClick&&!b){return}if(this.container.getElements("."+this.options.rangeInputClass)[0].contains(b.target)){return}}catch(a){}}this.hideNow()},hideNow:function(a){if(this.options.sourceId){this.source.removeClass("selected")}document.removeEvent("click",this.hide);this.parent()},position:function(){var a=this.source.getPosition();this.container.setStyles({left:a.x+this.options.xOffset?this.options.xOffset:0,top:a.y+this.options.yOffset?this.options.yOffset:0});this.parent()}});ta.overlays.StaticOverlay=new Class({Extends:ta.overlays.RelativeOverlay,initialize:function(a,b){this.parent(Object.merge({autoShow:false},a),b);this.container.removeClass("relative")},position:function(a){this.container.position({position:"center",offset:{x:this.options.offsetX||0,y:this.options.offsetY||0}});this.parent()},hide:function(e){if(e==null){return}var a=e.srcElement?e.srcElement:e.target;if(this.container.contains(a)){return}if(this.options.childrenOverlays){for(var c=0;c<this.options.childrenOverlays.length;c++){var b=this.options.childrenOverlays[c];var d=b.container||ta.select(b)[0];if(d&&d.contains(a)){return}}}this.parent()}});if(!ta.overlays.filters){ta.overlays.filters={}}ta.overlays.filters.CheckboxOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","doOnInit","buildContent"],options:{showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,style:"date_picker_calendar",multiSelect:true,autoShow:false,delayShow:true,noPadding:true,keepElementInDocument:true,filterType:"",closeOnSelect:true},initialize:function(c,b){var a=Object.merge(this.options,c);this.input=document.getElement(".hotel_filter_wrap ."+a.filterType);this.parent(a,this.input);this.source.removeEvent("click",this.show);this.setupStandardBehavior();this.doOnInit()},setupStandardBehavior:function(){this.input.overlay=this;if(this.container){this.parentOverlay=this.container.getParent(".overlay");if(this.parentOverlay){this.parentOverlay=this.parentOverlay.overlay;this.options.isChild=true}}},doOnInit:function(){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType)},buildContent:function(b,e){var a=ta.retrieve("hac.data.object");var h=document.createDocumentFragment();if(a&&a.filters){var d=a.filters[e];if(d){var f=document.createElement("ul");var g=d.options.length;f.className="hacFilterItems "+d.hacName;if(g>8){f.className=f.className+" manyItems"}h.appendChild(f);var c=this;Array.each(d.options,function(i){c.addCheckboxItem(d,e,i,f,c,a)})}b.empty().appendChild(h)}},addCheckboxItem:function(g,b,c,e,h,d){var n="";if(h.isItemDisabled(c)){n="disabled"}var p="";if(n!=""){p="disabled=''"}var l=new Element("li");l.className="hacFilterItem";var j="";var a=b=="showUnavailable";if(a){j="showUnavailable"}if(n||a){l.className=l.className+" "+n+" "+j}if(c.value==0&&!a){l.className=l.className+" default"}var i=b;if(!h.isItemDisabled(c)){l.addEvent("click",function(r){(function(){h.dataItemClick.call(h,l,g.hacName,i,ta.hac.filters.getItemValue(c,b))}).delay(10);return false})}if(a){var k=new Element("hr");e.appendChild(k)}e.appendChild(l);var f="";if(a){if(c.value==1){f="checked=checked"}}else{if(h.isCheckboxItemSelected(d.selected,g.hacName,c.value)){f="checked=checked"}}var m=h.getItemDisplayFragment(c,b);var q=g.hacName+"_"+c.value;var o="";if(!a){o="<span class='itemCount'>("+c.count+")</span>"}else{q=g.hacName}l.innerHTML="<input type='checkbox' id='"+q+"' class='"+q+" "+n+"' "+f+" "+n+" /><span class='dataItem "+n+"'>"+m+o+"</span>"},dataItemClick:function(g,b,a,f){var h;if(ta.has("hac.filter.click.timeout")){ta.remove(ta.hac.filters.getHacFilterTimeoutKey());clearTimeout(ta.remove("hac.filter.click.timeout"))}this.fixCheckboxesInFilter(g);h=ta.hac.filters.updateFilterHash(b,this.getFilterSelections(b));var c=ta.has("persistentFilters.showing")?a+"|persistent_bar":a;if(h){try{var d="click";if(g&&g.getElement("input")&&!g.getElement("input").checked){d="unclick"}if(typeof pageServlet!="undefined"&&pageServlet=="Hotels"&&!ta.isMetaHotelsRequest()){ta.setEvtCookie(ta.hac.filters.getModuleString(this.options.filterType),d,c,f,"/HACSearch")}else{ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),d,c,f)}}catch(j){}var i=this;ta.store("hac.filter.click.timeout",setTimeout(function(){ta.remove("hac.updates.running");if(window.pageServlet=="Hotels"){ta.hac.filters.closeAllActiveFilters()}i.updateHACResults.call(i);ta.remove(ta.hac.filters.getHacFilterTimeoutKey())},2000));ta.store(ta.hac.filters.getHacFilterTimeoutKey(),ta.retrieve("hac.filter.changed"))}},updateHACResults:function(){if(this.options&&this.options.closeOnSelect){this.hide()}ta.hac.filters.updateResultsFromFilters()},setCloseOnSelect:function(a){if(this.options&&this.options.closeOnSelect){this.options.closeOnSelect=a}},fixCheckboxesInFilter:function(d){var d=ta.id(d);if(!d||d.hasClass("disabled")){return}if(d.hasClass("hacFilterItem")){d.getElement("input").checked=!d.getElement("input").checked}if(d.hasClass("default")){var e=d.getParent(".hacFilterItems");if(e){Array.each(e.getElements(".hacFilterItem"),function(f){f=ta.id(f);if(!f.hasClass("default")){f.getElement("input").checked=false}else{f.getElement("input").checked=true}})}}else{var b=false;var e=d.getParent(".hacFilterItems");if(!d.getElement("input").checked){var a=e&&document.getElements(".hacFilterItems input:checked");if(!a||!a.length){b=true}}if(e){var c=e.getElement(".default");if(c){c.getElement("input").checked=b}}}},getFilterSelections:function(c){var a=[];if(c=="showUnavailable"){a=document.getElements(".hacFilterItem."+c+" input:checked")}else{if(c){a=document.getElements(".hacFilterItems."+c+" input:checked")}else{a=document.getElements(".hacFilterItems input:checked")}}var b=[];Array.each(a,function(d){if(d.id!=c+"_0"){b.push(d.id)}else{if(c=="showUnavailable"){b.push("showUnavailable")}}});return b},addExpandableItem:function(c,d){var g=document.createDocumentFragment();var e=new Element("li");e.className=c+" expandFilterItem";g.appendChild(e);var f=document.createElement("div");f.className="nameItem sprite-filter-expand";if(ta.has("filterNames."+c)){f.innerHTML=ta.retrieve("filterNames."+c)}else{if(ta.has("hotels.currencies")&&"currencies"==c){f.innerHTML=ta.retrieve("hotels.currencies")[0]}else{f.innerHTML=c}}var b=new Element("div");b.className="toggleItem";e.appendChild(f);e.appendChild(b);var a=this;e.addEvent("click",function(){a.expandableClick.call(a,c,e)});d.appendChild(g)},expandableClick:function(){return},getItemDisplayFragment:function(a,b){return ta.hac.filters.getItemDisplayFragment(a,b,this.isItemDisabled(a))},isCheckboxItemSelected:function(c,a,f){if(!c){return false}var d=a+"_"+f;var b=c.cb;if(f!=0){if(b&&b.contains(d)){return true}}else{var e=false;if(b){Array.each(b,function(g){if(g.indexOf(a)!=-1){e=true}})}if(!e){return true}}return false},isItemDisabled:function(a){if(a&&a.count>0){return false}return true},destroy:function(){this.parent();this.input.overlay=null},nonSourceHide:function(a){if(!this.source.containsEvent(a)){this.hide()}},show:function(g){var d=this.visible;this.parent(g);document.removeEvent("click",this.hide);document.addEvent("click",this.nonSourceHide);if(this.options.filterType!="more"){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType)}if(d){return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}if(ta.has("persistentFilters.showing")&&tabletOnFullSite&&this.container){this.container.setStyle("position","fixed")}var c=document.getElement(".hotel_filter."+this.options.filterType);var f=document.getElement(".date_picker_calendar."+this.options.filterType);if(ta.util.i18n.isRtl()){var b=c.getCoordinates().width;var a=f.getCoordinates().width;this.options.offsetLeft=a-b}else{this.options.offsetLeft=0}this.position();return this},hide:function(a){if(!this.visible){return}document.removeEvent("click",this.nonSourceHide);this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}}});ta.overlays.filters.ClassOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"hotel_class"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.RatingOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"traveler_rating"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.PriceOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"price"},initialize:function(b,a){this.parent(b,a)},doOnInit:function(){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType);if(ta.has("hotels.currencies")){this.addExpandableItem("currencies",this.inner.getElement(".hotelFilterContent"))}this.addShowUnavailableCheckbox(this.inner.getElement(".hotelFilterContent"))},expandableClick:function(b,c){var a=c.getElement(".toggleItem");if(a&&a.innerHTML!=""){a.innerHTML="";if(ta.id(c).getElement(".nameItem")){ta.id(c).getElement(".nameItem").removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}}else{this.buildCurrencyContent(c.getElement(".toggleItem"),"currencies");var d=ta.id(c).getParent(".expandFilterItems");if(d){var e=d.getElements("li");if(e){Array.each(e,function(g){g=ta.id(g);var f=g.getElement(".nameItem");if(!g.hasClass("currencies")&&f&&f.hasClass("sprite-filter-collapse")){var h=g.getElement(".toggleItem");if(h){h.innerHTML=""}f.removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}})}}if(ta.id(c).getElement(".nameItem")){ta.id(c).getElement(".nameItem").removeClass("sprite-filter-expand").addClass("sprite-filter-collapse")}}},show:function(){if(ta.has("ta.calendar.isPriceOverlayCalendar")){return}this.parent();if(ta.has("hotels.currencies")){this.addExpandableItem("currencies",this.inner.getElement(".hotelFilterContent"))}this.addShowUnavailableCheckbox(this.inner.getElement(".hotelFilterContent"))},nonSourceHide:function(a){if(!this.source.containsEvent(a)&&!this.inner.containsEvent(a)){this.hide()}},addShowUnavailableCheckbox:function(d){var a=ta.retrieve("hac.data.object");if(a&&a.filters){var f={hacName:"showUnavailable"};var e=this;var g=a.selected.showUnavailable;var c=ta.retrieve("filterNames.showUnavailable");var b={label:c,count:1,value:g?1:0};e.addCheckboxItem(f,"showUnavailable",b,d,e,a)}},buildCurrencyContent:function(a){var d="";var g=document.createDocumentFragment();var e=document.createElement("ul");var c=ta.retrieve("hotels.currencies");if(c){var f=c.length;e.className="hacFilterItems currency";if(f>8){e.className=e.className+" manyItems"}g.appendChild(e);var b=this;Array.each(c,function(j,i){var m=new Element("li");m.className="hacFilterItem";m.addEvent("click",function(n){(function(){b.currencyItemClick.call(b,j)}).delay(10);return false});e.appendChild(m);var l="";var k=b.getItemDisplayFragment(j,"currencies");var h="currency_"+j;m.innerHTML="<span class='dataItem'>"+k+"</span>"})}a.innerHTML="";a.appendChild(g)},currencyItemClick:function(a){ta.commerce.meta.clearStoredMiniData();if(a.test(/[A-Z]{3}/)){ta.store("ta.commerce.MetaHacOverlay.currency",a);new Request({url:"/ActionRecord?action=MetaCurrencyPicker"}).send();ta.trackEventOnPage("MetaCurrencyPicker","selected",a,1);ta.hac.filters.changeCurrency()}if(this.hide){this.hide()}},showCalendarLightbox:function(d){var c=ta.hac.filters.getModuleString(this.options.filterType);var e="open_calendar";var b="price";ta.trackEventOnPage(c,e,b,0,false);var a=ta.retrieve("ta.overlays.filters.PriceOverlay.showCalendarLightbox");if(typeof(a)=="function"){a()}else{this.buildCalendarLightbox(d)}},calendarLightBoxOverlay:null,buildCalendarLightbox:function(e,a){var d;d=ta.id("PriceFilterCalendarOverlayContent");if(!d){return}d.show();var c={style:"priceFilterCalendarOverlay",innerDiv:"skv3",content:d,autoShow:false,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",onShow:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.store("ta.calendar.isPriceOverlayCalendar",true);var h=null;var g=document.getElement("date_picker_in_PriceFilterCalendar");setTimeout(function(){ta.overlays.Factory.loadDatePicker(h,g,"PriceFilterCalendar","",ta.servlet.HACSearch.doMetaDateSearch)},100);if(this.calendar){this.calendar.reposition()}},onClose:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.remove("ta.calendar.isPriceOverlayCalendar")},onHide:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.remove("ta.calendar.isPriceOverlayCalendar")}};var f=ta.id("HEADING");var b=new ta.overlays.CenteredOverlay(c,f);ta.store("ta.overlays.filters.PriceOverlay.showCalendarLightbox",function(){b.show()})},buildContent:function(a,b){if(ta.retrieve("meta.hotels_no_prices")&&!ta.widgets.calendar.hasPageDates()){this.showCalendarLightbox(a)}else{this.parent(a,b)}}});ta.overlays.filters.NeighborhoodOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"neighborhood"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.AmenitiesOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"amenities"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.BrandOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"hotel_brand"},initialize:function(b,a){this.parent(b,a)},getItemDisplayFragment:function(a){if(typeof brandMappings!="undefined"){return"<span class='itemLabel'>"+brandMappings[a.value]+"</span>"}return""}});ta.overlays.filters.MoreOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"more",moreOptions:""},initialize:function(b,a){if(b.moreOptions){this.displayFilters=b.moreOptions.split(" ")}this.parent(b,a)},doOnInit:function(){var b=document.createDocumentFragment();var a=new Element("ul");a.className="expandFilterItems more";b.appendChild(a);this.inner.getElement(".hotelFilterContent").innerHTML="";this.inner.getElement(".hotelFilterContent").appendChild(b);moreOvly=this;Array.each(this.displayFilters,function(c){var d=ta.retrieve("hac.data.object");if(d&&d.filters){var e=d.filters[c];if(e&&e.options.length>0){moreOvly.addExpandableItem.call(moreOvly,c,a)}}})},nonSourceHide:function(a){if(!this.source.containsEvent(a)&&!this.inner.containsEvent(a)){this.hide()}},expandableClick:function(c,b){var f=ta.has("persistentFilters.showing")?c+"|persistent_bar":c;var a=b.getElement(".toggleItem");if(a&&a.innerHTML!=""){a.innerHTML="";if(ta.id(b).getElement(".nameItem")){ta.id(b).getElement(".nameItem").removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),"close",f)}else{this.buildContent(b.getElement(".toggleItem"),c);var d=ta.id(b).getParent(".expandFilterItems");if(d){var e=d.getElements("li");if(e){Array.each(e,function(h){h=ta.id(h);var g=h.getElement(".nameItem");if(!h.hasClass(c)&&g&&g.hasClass("sprite-filter-collapse")){var i=h.getElement(".toggleItem");if(i){i.innerHTML=""}g.removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}})}}if(ta.id(b).getElement(".nameItem")){ta.id(b).getElement(".nameItem").removeClass("sprite-filter-expand").addClass("sprite-filter-collapse")}ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),"open",f)}}});ta.overlays.filters.SortOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"sort"},initialize:function(b,a){this.parent(b,a)},addCheckboxItem:function(e,a,b,d,f,c){var h=new Element("li");h.className="hacFilterItem";if(b.value==0){h.className=h.className+" default"}var g=this;h.addEvent("click",function(k){if(window.pageServlet=="WidgetEmbed"){ta.hac.filters.changeSort(b.value);ta.trackEventOnPage(ta.hac.filters.getModuleString(g.options.filterType),"click",b.value)}else{ta.pages.hac.hacSortChangedToValue(b.value)}g.hide();return false});d.appendChild(h);var i=f.getItemDisplayFragment(b,a);var j=b.value;h.innerHTML="<span class='dataItem'>"+i+"</span>"}});(function(m,e,f,c){var d="GuestRoomSelector",k="grp-rooms",n="grp-guests",l="grp-update",r="-value",j="singular_room_da",b="plural_rooms_da",a="singular_guest_da",q="plural_guests_da",i="rooms_guests_picker_update_da",o=function(t,s,w){var v=t.replace("grp-",""),u=s+"_"+v;f.trackEventOnPage(d,u,null,w)},h=function(){f.trackEventOnPage(d,"update_click")},p=function(s){var t=s&&s.target&&$(s.target).getParent(".date_picker_calendar");return(t!=null)};f.overlays.GuestsRoomsOverlay=new Class({Extends:f.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","hideByClickOnDocument"],options:{showCloseButton:false,activate:f.overlays.ACTIVATE_CLICK,multiSelect:true,autoShow:false,delayShow:true,noPadding:true,keepElementInDocument:true,closeOnSelect:false},callback:null,selectionModified:false,findTargetFunction:false,initialize:function(u,t){this.callback=u.moreOptions.callback;if(u.guestsRoomsData){this.saveData(u.guestsRoomsData)}this.buildContent(u);this.input=u.moreOptions.input;this.findTargetFunction=u.moreOptions.findTargetFunction;var s=Object.merge(this.options,u);this.parent(s,this.input);this.source.removeEvent("click",this.show);this.setupStandardBehavior()},setupStandardBehavior:function(){if(this.input.getParent(".overlay")){this.parentOverlay=this.input.getParent(".overlay").overlay;this.options.isChild=true}},getData:function(){return f.widgets.calendar.getGuestsRoomsPickerData()},saveData:function(s){f.store("guests.rooms.object",s);f.fireEvent("onLegacyGuestsChanged",s)},resetData:function(){var s={rooms:1,guests:2};this.saveData(s);return s},updateSessionGuestsRooms:function(u){var t;if(f.widgets.calendar.hasPageDates()){t=f.widgets.calendar.getCheckRatesData()}else{var v=this.getData();t={rooms:v.rooms,adults:v.guests}}var s=this;new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(t),method:"post",onSuccess:function(){s.runCallback(u);f.fireEvent("onLegacyGuestsChanged",f.retrieve("guests.rooms.object"))}}).send()},runCallback:function(s){if(this.callback&&typeof(this.callback)==="function"&&f.widgets.calendar.hasPageDates()){this.callback(s)}},resetOverlay:function(){this.resetData();this.updateOverlay(k);this.updateOverlay(n)},getTranslationString:function(t){var u=this.getData();var s;if(t===k){s=u.rooms;if(s===1){return f.retrieve(j)}else{return f.retrieve(b)}}else{if(t===n){s=u.guests;if(s===1){return f.retrieve(a)}else{return f.retrieve(q)}}else{if(t===l){return f.retrieve(i)}}}},getCounter:function(t){var u=this.getData();var s;if(t==k){s=u.rooms}else{if(t===n){s=u.guests}}return s},buildContent:function(t){var u=new Element("ul");u.className="guests_rooms_overlay";var w=this.buildButtonLine(k);u.appendChild(w);var v=this.buildButtonLine(n);u.appendChild(v);var s=this.buildUpdateLine();u.appendChild(s);t.content=u},buildButtonLine:function(y){var u=this.getCounter(y);var w=this.getTranslationString(y);var t=new Element("li");t.className="line";t.id=y;var z=new Element("div");z.className="signButton minusButton";if(u===1){z.className+=" disabled"}z.setContent("-");var v=this;z.addEvent("click",function(A){v.processDecrementCounter(y,true)});var s=new Element("div");s.className="numberLabelText";s.setContent(u+" "+w);var x=new Element("div");x.className="signButton plusButton";if(y===k&&u>7){x.className+=" disabled"}else{if(y===n&&u>31){x.className+=" disabled"}}x.setContent("+");x.addEvent("click",function(A){v.processIncrementCounter(y,true);A.stopPropagation()});t.appendChild(z);t.appendChild(s);t.appendChild(x);return t},processDecrementCounter:function(u,s){var v=this.getData(),w;if(u===k){if(v.rooms<=1){return}v.rooms-=1;w=v.rooms;this.saveData(v);this.updateOverlay(u);while((v.guests/4)>v.rooms){this.processDecrementCounter(n)}}else{if(u===n){if(v.guests<=1){return}v.guests-=1;w=v.guests;this.saveData(v);this.updateOverlay(u);var t=(v.guests<v.rooms);if(t){this.processDecrementCounter(k)}}}if(s){o(u,"subtract",w)}},processIncrementCounter:function(t,s){var v=this.getData(),w;if(t===k){if(v.rooms>7){return}v.rooms+=1;w=v.rooms;this.saveData(v);this.updateOverlay(t);var u=(v.rooms>v.guests);if(u){this.processIncrementCounter(n)}}else{if(t===n){if(v.guests>31){return}v.guests+=1;w=v.guests;this.saveData(v);this.updateOverlay(t);var u=((v.guests/4)>v.rooms);if(u){this.processIncrementCounter(k)}}}if(s){o(t,"add",w)}},updateOverlay:function(s){var u=this.buildButtonLine(s);var t=f.id(s);t.parentNode.replaceChild(u,t);this.selectionModified=true;this.updateCounterElement(s)},updateCounterElement:function(t){var u=this.getCounter(t);var s=$$("."+t+r);s.each(function(v){v.innerHTML=u});if(t===k){f.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".roomsGuestsButton.roomsButton",u);f.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.rooms",u)}else{if(t===n){f.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".roomsGuestsButton.guestsButton",u);f.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.guests",u)}}},buildUpdateLine:function(){var w=this.getTranslationString(l);var s=new Element("li");s.className="line update";s.id=l;var u=new Element("div");u.className="updateButton rndBtn rndBtnGreen";var t=this;u.addEvent("click",function(y){t.processUpdate(y);t.hide();h()});var v=new Element("div");v.className="ui-btn-inner";var x=new Element("div");x.className="ui-btn-text";x.setContent(w);v.setContent(x);u.setContent(v);s.setContent(u);return s},processUpdate:function(s){if(!this.selectionModified){if(this&&this.parentOverlay&&this.parentOverlay.visible&&f.widgets.calendar.hasPageDates()){this.parentOverlay.hide()}return}this.selectionModified=false;this.updateSessionGuestsRooms(s)},destroy:function(){this.parent();this.input.overlay=null},nonSourceHide:function(s){if(!this.source.containsEvent(s)&&!(s.target.className.contains("signButton"))){this.hide(s)}},hideByClickOnDocument:function(s){if(this.parentOverlay&&this.parentOverlay.visible){return}else{this.hide(s)}},show:function(t){var u=this.visible,v;this.parent(t);m.removeEvent("click",this.hide);m.addEvent("click",this.nonSourceHide);m.removeEvent("click",this.hideByClickOnDocument);$$(".date_picker_calendar").addEvent("click",this.nonSourceHide);v=this.findTargetFunction(t);if(v){this.source=v}f.widgets.calendar.syncAllDatePickers();if(u){this.hide(t);return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==f.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.position();var s=$$(".roomsGuestsButtonWrap .roomsGuests");if(s){s.addClass("disabled")}return this},hide:function(t){if(!this.visible){return}m.removeEvent("click",this.nonSourceHide);$$(".date_picker_calendar").removeEvent("click",this.nonSourceHide);this.parent(t);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}var s=$$(".roomsGuestsButtonWrap .roomsGuests");if(s){s.removeClass("disabled")}this.processUpdate(t)}});f.overlays.GuestsRoomsOverlay.closeModalAndUpdateCount=function(t){f.trackEventOnPage("PriceFinder_PromptChange",t?"revert":"update");var s=f.find(".ui_modal.increase_rooms_modal");var u=f.find(".ui_backdrop.increase_rooms_modal_backdrop");if(!t){var w={rooms:1,guests:2,child_rm_ages:""};w.rooms=f.overlays.GuestsRoomsOverlay.roomsNew;w.guests=f.overlays.GuestsRoomsOverlay.guestsNew;w.child_rm_ages=f.overlays.GuestsRoomsOverlay.child_rm_ages_old||"";f.store("guests.rooms.object",w);f.overlays.NumberPickerOverlay.updateHeaderMsg(".metaDatePicker",s);var v=f.find(".change_dates_button");v&&f.servlet.HACSearch.doMetaDateSearch(null,v)}};f.overlays.GuestsRoomsOverlay.trackPickerClick=function(s){if(p(s)){f.trackEventOnPage(d,"select_guest_room_calendar")}else{f.trackEventOnPage(d,"select_guest_room")}};var g;f.overlays.GuestsRoomsOverlay.open=function(w,u,v,x){var t=g;if(!t){if(f.has("guests_rooms_picker_3.enabled")){x.input=f.find(".calendar_wrapper .guests_rooms_picker_container")}else{x.input=f.find(".guests_rooms_picker_container")}x.findTargetFunction=function(y){if(f.has("guests_rooms_picker_3.enabled")&&!f.has("guests_rooms_picker_4.enabled")&&!f.has("hotels_rgpicker_outofcalendar")){return f.find(".date_picker_calendar.overlay .wrapper_header .roomsGuests")}else{if(y&&y.target){return f.id(y.target).getParent(".roomsGuests")}}};var s={style:"date_picker_calendar guests_rooms_overlay",moreOptions:x};t=new f.overlays.GuestsRoomsOverlay(s,u);g=t}t.show(w)}})(document,window,ta);(function(k,i,h,d){var e={rooms:{max:8,translationKey:"rgPicker.nRooms",tracking:"RoomSelector"},guests:{max:32,translationKey:"rgPicker.nGuests",tracking:"GuestSelector"}},a=4,j=function(n,p){p=h.id(p);if(p){var o=p.getWidth();if(n&&n.container&&o>n.container.getWidth()){n.container.setStyle("width",o-2)}}},c=function(s,t,o){var r=e[o],q={type:o,labels:h.retrieve(r.translationKey),maxValue:r.max,target:t,tracking:r.tracking},n=l(o),p=h.retrieve(n)||new h.overlays.NumberPickerOverlay(q,t);h.store(n,p);if(t&&(t.getParent("#hotels_lf_header_bar")||t.getAttribute("data-matchwidth"))&&p){p.addEvent("onShow",j.bind(this,p,t))}p.show(s);h.fireEvent("showRoomGuestPicker");return p},l=function(n){return"numberPickerOverlay_"+n},m=function(n,o){return o[n]},g=function(){return h.widgets.calendar.getGuestsRoomsPickerData()},f=function(n){h.store("guests.rooms.object",n);h.fireEvent("onLegacyGuestsChanged",n)},b=function(p,r){var q=g(),n=function(v){var x=v.guests/Math.max(v.rooms,1);if(x>a){h.trackEventOnPage("PriceFinder","guest_per_room_exceeded",v.guests,v.rooms);var u=Math.ceil(v.guests/a);if(h.retrieve("priceFinder.noAutoRefresh")){h.overlays.GuestsRoomsOverlay.roomsNew=u;h.overlays.GuestsRoomsOverlay.guestsNew=v.guests;var s=h.find(".roomsAdultsModalLnk");var z=s.getAttribute("data-subheader");var w="";z&&(w=z.replace(/%ROOMS%/g,u));s.setAttribute("data-subheader",w);s.click();var A=h.find(".increase_rooms_modal .yesUpdate");var y=h.find("#STATIC_DATE_PICKER_BAR .yesTxt");A&&y&&(A.innerHTML=y.innerHTML.replace(/%ROOM%/g,u));var t=h.find(".increase_rooms_modal .subheader_text");t&&(t.innerHTML=(s.getAttribute("data-subheader")));s.setAttribute("data-subheader",z);v.rooms=h.overlays.GuestsRoomsOverlay.roomsOld;v.guests=h.overlays.GuestsRoomsOverlay.guestsOld;v.child_rm_ages=h.overlays.GuestsRoomsOverlay.child_rm_agesOld||"";h.store("guests.rooms.object",v);h.overlays.NumberPickerOverlay.updateHeaderMsg(".metaDatePicker");return}v.rooms=u}else{if(v.rooms>v.guests){v.rooms=v.guests}}},o=function(t){var s=t.guests/Math.max(t.rooms,1);if(s>a){t.guests=t.rooms*a}else{if(t.rooms>t.guests){t.guests=t.rooms}}};if(q[p]===r){return false}q[p]=r;if(p==="rooms"){o(q)}else{if(p==="guests"){n(q)}}f(q);return true};h.overlays.NumberPickerOverlay=new Class({Extends:h.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","hideByClickOnDocument"],options:{activate:h.overlays.ACTIVATE_CLICK,style:"numberPickerOverlay",multiSelect:false,autoShow:false,delayShow:false,noPadding:true,keepElementInDocument:true,closeOnSelect:true,waitForCss:true},callback:function(){if(h.find(".HotelHighlight .hh_server_render")){h.commerce.metajson.refetchAll();h.fireEvent("guestsRoomsPickerUpdate")}else{if(h.retrieve("hh_short_cell.enabled")||h.retrieve("hh_two_view_deal_chevrons.enabled")){if(this.source&&this.source.className&&this.source.className.indexOf("placement_hh")!=-1&&h.commerce.metajson){h.commerce.metajson.refetchAll()}}else{if(i.pageServlet=="Hotels"){h.widgets.calendar.checkDatesMakeHacCallHotels()}else{var n=h.retrieve("meta.baseLocationId");h.widgets.calendar.checkDatesMakeHacCallHR(n)}}}h.retrieve("priceFinder.noAutoRefresh")&&this.source&&this.source.addClass("ready_for_update")},initialize:function(o,p){this.input=o.target;this.buildContent(o);if(p.getParent("#hotels_lf_header_bar")){this.options.style+=" hotels_lf"}if(p.getAttribute("data-style")){this.options.style+=" "+p.getAttribute("data-style")}var n=Object.merge(this.options,o);this.parent(n,this.input);i.addEvent("date_bar_docked",this.position.bind(this));i.addEvent("date_bar_undocked",this.position.bind(this));i.addEvent("resize",this.position.bind(this))},buildContent:function(n){var o=new Element("div");o.appendChild(this.buildSelectorRows(n));n.content=o},buildSelectorRows:function(o){var n=this,p=new Element("ul"),r,q,s=function(u,t){u.addEvent("click",function(w){if(h.retrieve("priceFinder.noAutoRefresh")){var x=g();h.overlays.GuestsRoomsOverlay.roomsOld=x.rooms;h.overlays.GuestsRoomsOverlay.guestsOld=x.guests;h.overlays.GuestsRoomsOverlay.child_rm_ages_old=x.child_rm_ages}var v=b(o.type,t);n.hide();h.trackEventOnPage(o.tracking,"Select",null,t);if(v){n.callback()}})};p.className="list";for(q=1;q<=o.maxValue;q++){r=new Element("li");r.setContent(m(q,o.labels));r.className="item";s(r,q);p.appendChild(r)}return p},resetOverlays:function(){h.remove(l("rooms"));h.remove(l("guests"))},show:function(n){if(this.visible){this.hide(n)}else{if(this.parent){this.parent(n);this.position();h.trackEventOnPage(this.options.tracking,"Open")}}return this},position:function(){var q=h.id(this.source);var n=q.getParent("#hotels_lf_header_bar_wrap");if(q&&(q.getParent("#PERSISTENT_DATE_PICKER")||(n&&n.hasClass("fixed")))){var p=q.getCoordinates().left-i.getScrollLeft()-3;var o=q.getCoordinates().top-i.getScrollTop()+33;if(n){var p=q.getCoordinates().left-(i.isTabletOnFullSite?0:i.getScrollLeft());var o=q.getCoordinates().bottom-(i.isTabletOnFullSite?0:i.getScrollTop())}h.id(this.container).setStyles({position:"fixed",left:p+"px",top:o+"px","z-index":9991})}else{if(n){h.id(this.container).setStyle("position","absolute")}this.parent()}},hide:function(n){this.resetOverlays();this.parent(n)}});h.overlays.NumberPickerOverlay.roomsPicker=function(n,o){return c(n,o,"rooms")};h.overlays.NumberPickerOverlay.guestsPicker=function(n,o){return c(n,o,"guests")};h.overlays.NumberPickerOverlay.updateHeaderMsg=function(n){var s=g(),u=$$(n+" .roomsChange"),p=m(s.rooms,h.retrieve("rgPicker.nRooms")),t=$$(n+" .guestsChange"),r=m(s.guests,h.retrieve("rgPicker.nGuests")),o=u.getElement("img"),q=(o&&o[0]&&o[0].outerHTML)||"";u.set("html",p+" "+q);t.set("html",r+" "+q)};h.overlays.NumberPickerOverlay.unhideDropdowns=function(n){var o=$$(n);if(o&&h.widgets.calendar.hasPageDates()){o.removeClass("hidden")}}})(document,window,ta);if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["pages/inappropriate_vote_stub","answers/question_overlay_stub"],["ta","ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"ta-overlays",files:{js3:{src:{pages:{inappropriate_vote_stub:1},answers:{question_overlay_stub:1}}}},_:{baseUrl:"/"}})};define("answers/question_overlay_stub",["ta","overlays/Overlay","overlays/styles/modal","overlays/position","overlays/options/closeOnEscape","overlays/options/autoReposition","overlays/styles/windowshade","overlays/options/ajax"],function(h,b,j,d,k,a,e,c){var g={};var f;var i={};g.open=function(n,l){if(!l){h.util.error.record(new TypeError("pid required for questionForm overlay"),"Question and Answers - questionForm",null,null,"WARN")}var m="/AnswersAjax?act=saqo&lcid="+n+"&altsessid="+(h.retrieve("altsessid")||"");if(f){f.updateContent(m);f.show()}else{f=new b(null,[j(null,"center","answersOverlay"),d.center([0,0]),k,a,e(),c(m)]);f.on("show",h.store.bind(h,"answers.pid.overlayType",l));f.on("hide",h.remove.bind(h,"answers.pid.overlayType"));f.show()}};g.confirmDlg=function(n){var r=n.data.type;var q=i[r];if(q){q.options=n;q.overlay.show()}else{var m=new b(null,[j(null,"center","confirmationPrompt small"),d.center([0,0]),a,e(),c("/AnswersAjax",{reqParams:n.data})]);i[r]={overlay:m,options:n,attached:false};var l=function(){var t=i[r];t.options.onConfirm&&t.options.onConfirm();t.overlay.hide();return true};var s=function(){var t=i[r];t.options.onCancel&&t.options.onCancel();t.overlay.hide();return false};var p=false;var o=(function(){if(!p){var u=h.find(".cancelBtn",this.inner),t=h.find(".confirmBtn",this.inner);if(u){h.addEvent(u,"click",s);h.addEvent(t,"click",l);p=true}}}).bind(m);m.on("contentLoaded",o).on("show",o).on("hide",function(){h.removeEvent(h.find(".cancelBtn",this.inner),"click",s);h.removeEvent(h.find(".confirmBtn",this.inner),"click",l);p=false});m.show()}};return g});if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["ta/registration/RegOverlay"],["ta","ta","ta","ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"ta-registration-RegOverlay",files:{js3:{src:{ta:{registration:{RegOverlay:1}}}}},_:{baseUrl:"/"}})};define("overlays/options/autosizePage",["dom-lib","api-mod"],function(b,a){return function(d,c){function f(i,g){this._origStyles=this._origStyles||{};for(var h in g){if(g.hasOwnProperty(h)){this._origStyles[h]||(this._origStyles[h]=i.css(h));i.css(h,g[h])}}}function e(){var g=b("#PAGE");return g.length?g:b("#PAGE_CONTAINER")}return function(){function g(){var k=e();if(!k.length){return}var l=a.getCoords(this.container);var i=a.getSize(window);this._scrollTop||(this._scrollTop=a.scrollTop());var j=Math.max(l.height+d*2,i.y);b(document.body).css("height",j);f.call(this,k,{position:"relative",top:-this._scrollTop,height:j,overflow:"hidden"});if(l.height+d*2>i.y){var h=b(this.container);h.css("top",d);h.css("marginTop",0);window.scrollTo(0,0)}}this.on("show",g);this.on("positionDirty",g);this.on("hide",function(){var h=e();if(!h.length){return}b(document.body).css("height","auto");if("static"===this._origStyles.position){this._origStyles.height="auto"}else{this._origStyles["min-height"]=this._origStyles.height}f.call(this,h,this._origStyles);delete this._origStyles;window.scrollTo(0,this._scrollTop);delete this._scrollTop})}}});define("overlays/styles/spinnershade",["dom-lib"],function(a){return function(c,b){return function(){this.loading=function(f){if(f===void 0){return a(this.container).hasClass("wait")}a(this.container).toggleClass("wait",f)};var e='<div class="spinnerImage"></div>';if(window.AnimationEvent){e='<div class="cssLoadingSpinner">'+e;for(var d=1;d<=8;d++){e+='<div class="cssLoadingSpinner_step'+d+'"></div>'}e+="</div>"}this.spinner=document.createElement("div");a(this.spinner).attr({"class":"spinnershade "+c}).html(e);this.container.appendChild(this.spinner);b===false||this.loading(true)}}});define("ta/registration/RegOverlay",["ta","dom-lib","api-mod","utils/urlutils","utils/errorutils","overlays/Overlay","overlays/position","overlays/options/closeOnDocClick","overlays/options/autoReposition","overlays/options/autosizePage","overlays/styles/modal","overlays/styles/windowshade","overlays/styles/spinnershade"],function(v,o,z,D,k,r,I,x,f,A,c,H,F){v.registration=v.registration||{};var u=null;var s=null;var G=null;var i=null;var j=function(){var J=o("#overlayRegFrame");if(!J.length){return}u&&u.loading&&u.loading(false);J.css("display","")};var a=function(L,J){var N=o("#overlayRegFrame");if(!N.length){return}var K=u?u.container:null;if(!K){k.record(null,"No overlay parent element found.");return}var M={frame:N[0],overlay:K,width:L,height:J};i(M)};var y=function(P){var M=o(window);var O=M.length?M.width():981;var L=P.width?P.width:0;L=L>O?O-20:L;var J=P.height?P.height:0;var N=o(P.frame);var K=o(P.overlay);if(L>100){N.css("width",L);K.css("width",L)}if(J>100){N.css("height",J);K.css("height",J)}u.emit("positionDirty")};var C=function(J){var L={};try{L=JSON.parse(J)}catch(K){k.record(K,"Error parsing controller result data: "+J);return{}}if("object"!==typeof L){k.record(null,"Parsed controller result is not an object.");return{}}return L};var q=function(J){if(s){s(J);s=null}};var n=function(J){if(G){G(J);G=null}};var e=function(L){v.registration.RegOverlay.close();var J=L.resultData||"";if(J){var N=C(J);q(N)}else{q({})}if(L.jsCallback){p(L.jsCallback)}var K=L.fireEvent||"";if(v.hasEventListener&&v.hasEventListener(name)){v.fireEvent&&v.fireEvent(K)}else{z.fireEvent(document,K)}try{if(!v.util||!v.util.partials||("function"!==typeof v.util.partials.requestPartials)){return}v.util.partials.requestPartials(["IP_HEADER"],{ifb:true},"facebook",null)}catch(M){k.record(M,"Could not request IP partial.")}};var p=function(K){if(!K){return}if("string"===typeof K){if(0===K.indexOf("function")){K=b(K)}else{K=E(K)}}if("function"===typeof K){try{K()}catch(J){k.record(J,"Unable to trigger js callback from registration overlay.")}}};var E=function(K){var O=K.split(".");var N;for(var M=0,J=O.length;M<J;M++){var L=O[M];if(0===M){N=window[L];continue}if(N&&(L in N)){N=N[L]}else{return null}}return N};var b=function(K){var J=/^function\s*\(\s*\)\s*{(.*)}/.exec(K);if(J&&J[1]){try{return new Function(J[1])}catch(L){k.record(L,"RegOverlay failed to parse js callback: "+J[1])}}};var w=function(L){var N=L||window.event;if(!N){return}if(!N.origin||(0!==N.origin.indexOf("https"))||(-1===N.origin.indexOf("tripadvisor"))){return}if(!N.data||(-1===N.data.indexOf("action"))){return}var K;try{K=JSON.parse(N.data)}catch(N){return}var M=K.hasOwnProperty("action")?K.action:null;if(!M){return}switch(M){case"successClose":e(K);break;case"reloadWindow":location.reload(true);break;case"fwdToRelativeUrl":var J=K.url?K.url:"";if(!J){k.record(null,"No url specified to forward to.")}if(0!==J.indexOf("/")){k.record(null,"Cannot forward to absolute url: "+J)}window.location=J;break;case"resizeFrame":a(K.width,K.height);break;case"domReady":j();break;default:return}};var m=function(){if(v.store){v.store("member_gating_cta_shown",true)}};var l=function(){if(v.retrieve){return v.retrieve("member_gating_cta_shown")}return false};var B=function(L){if(L){u=L;return}var O="no_padding";var K='<div id="overlayRegFrameWrap"></div>';var P=[c(null,"center",O,"","",K),I.topCenter([0,100],false,true),H("dark"),x,F("light"),A(20)];u=new r(null,P);var M=o(u.container);if(!M){k.record(null,"No overlay parent element found.");return}var J=300;var S=200;var R=o(window);var Q=R.length?R.width():981;var N=R.length?R.height():600;J=J>Q?Q-20:J;M.css("left",Math.floor((Q-J)/2));M.css("width",J);M.css("top",Math.floor((N-S)/6));M.css("height",S)};var h=function(L,K,J){B(J);u.on("show",function(){var M=o("#overlayRegFrameWrap");if(!M.length){k.record(null,"The registration iframe wrapper was missing.");return}v.trackEventOnPage("regoverlay","show_overlay",window.modelLocId||"",K,false);var N=document.createElement("iframe");o(N).prop("src",L).prop("id","overlayRegFrame").prop("class","overlayRegFrame").prop("scrolling","no").css("border","none").css("display","none");M.append(N)});u.on("hide",function(M){if(M.trigger==="close-button"){v.trackEventOnPage("regoverlay","closed",window.modelLocId||"",K,false)}u=null;n(M)});u.show()};var g=function(J){if(!J||"object"!==typeof J){k.record(null,"Options object is invalid.");return false}if(!J.hasOwnProperty("flow")||!J.flow){k.record(null,"Options object missing required flow field.");return false}if(!J.hasOwnProperty("pid")||!J.pid){k.record(null,"Options object missing required pid field.");return false}return true};var t=function(){var J=false;o.ajax({url:"/AuthCheck",data:{},async:false,type:"GET",timeout:1000,success:function(K){if("string"!==typeof K){return}if("true"===K.trim()){J=true}}});return J};var d=function(J){for(var K in J){if((false!==J[K])&&!J[K]){delete J[K]}}};v.registration.RegOverlay={attachListener:function(){if(window.addEventListener){window.addEventListener("message",w,false)}else{window.attachEvent("onmessage",w)}},show:function(O,M,K){g(K);G=K.onClose;s=K.onSuccess;if(K.loggedInBypass&&t()){q({});return}if(K.customResizeFn){i=K.customResizeFn}else{i=y}v.registration.RegOverlay.attachListener();if(!K.userRequestedForce&&v.on){v.on("metaFocusShow",v.registration.RegOverlay.close());v.on("preMetaFocusShow",v.registration.RegOverlay.close())}var N={flow:K.flow,pid:K.pid,mcid:K.mcid,locationId:K.locationId,stateToken:K.stateToken,jsCallback:K.jsCallback,requireSecure:K.requireSecure,expectedUser:K.expectedUser,forceDesktop:("forceDesktop" in K)?K.forceDesktop:false,preVerificationToken:K.preVerificationToken,returnTo:""};if(K.extraQueryParams){N=o.extend(N,K.extraQueryParams)}d(N);var J=o.param(N);var L=D.https("/RegistrationController?"+J);if(K.userRequestedForce){h(L,K.pid,K.customOverlay);return}if(!l()){m();h(L,K.pid,K.customOverlay)}else{q({})}},close:function(){if(u){u.hide()}},showFullScreen:function(N,L,K){g(K);if(!K.hasOwnProperty("returnTo")||!K.returnTo){k.record(null,"Options object missing required returnTo field.");return}var M={flow:K.flow,pid:K.pid,mcid:K.mcid,locationId:K.locationId,stateToken:K.stateToken,jsCallback:K.jsCallback,returnTo:K.returnTo,fullscreen:true};if(K.extraQueryParams){M=o.extend(M,K.extraQueryParams)}d(M);var J=o.param(M);window.location=D.https("/RegistrationController?"+J)},showForMobile:function(M,L,K){if(!K.customOverlay){var J=[c(null,"center","no_padding mobile_reg_overlay","","",'<div id="overlayRegFrameWrap"></div>'),I.framed(),F("light"),A(0)];K.customOverlay=new r(null,J)}if(!K.customResizeFn){K.customResizeFn=function(R){var P=R.width?R.width:0;var N=R.height?R.height:0;var Q=o(R.frame);var O=o(R.overlay);if(Q.prop("scrolling")){Q.prop("scrolling","")}N=Math.max(o(window).height(),N,O.height());Q.css("width",O.css("width"));Q.css("height",O.height());O.css("height",N);u.emit("positionDirty")}}this.show(M,L,K)}};return v.registration.RegOverlay});(function(a,c,b,d){b.commerce.meta=(function(h){var g=function(){return typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates},f=function(q,n,r){var o="sprite-",m=o+n,p=o+r;if(q.hasClass(m)){q.removeClass(m);q.addClass(p)}},i=function(){var m=h.retrieve("meta.chevronTracking"),o=h.retrieve("meta.chevronAction"),n=h.retrieve("meta.chevronLabel");if(m&&o){if(!n){h.trackEventOnPage(m,o)}else{h.trackEventOnPage(m,o,n)}}h.remove("meta.chevronTracking");h.remove("meta.chevronAction");h.remove("meta.chevronLabel")},e=function(q,m){var n,p,o,r;if(m!==null&&q!==null){h.commerce.meta.suppressCRArea(q);n=q.getElement(".metaDatesNotChosen");p=q.getElement(".metaDatesChosen");if(p){if(n){n.addClass("miniMetaHideHdr");n.removeClass("miniMetaShowHdr")}p.addClass("miniMetaShowHdr");p.removeClass("miniMetaHideHdr")}q.getElements(".minimalist_datepicker_wrap.hidden").each(function(s){s.removeClass("hidden")});o=q.getElement(".postShowMetaCR");if(o!=null){o.destroy()}o=q.getElement(".postShowMetaCRLB");if(o!=null){o.destroy()}o=q.getElement(".postShowMetaCRLBPCR");if(o!=null){o.destroy()}r=q.getElement("fieldset");h.commerce.meta.adoptMiniMetaElem(r,m);h.fireEvent("refreshedDOMContent",q)}},k=function(m){if(!m){return}if(m.getElement(".hacMiniComplete")&&!m.getElement(".anyOfferCompletedSuccessfully")){m.getElements(".photos_lb_update_avail").each(function(n){n.addClass("hidden")});m.getElements(".photos_lb_update_no_avail").each(function(n){n.removeClass("hidden")})}else{m.getElements(".photos_lb_update_avail").each(function(n){n.removeClass("hidden")});m.getElements(".photos_lb_update_no_avail").each(function(n){n.addClass("hidden")})}},j=function(m){m.getElements(".textLinks").each(function(n){n.addClass("hidden")});m.getElements(".maybeCheck").each(function(n){n.addClass("hidden")});m.getElements(".disclaimer").each(function(n){n.addClass("hidden")});m.getElements(".photos_lb_update_links").each(function(n){n.removeClass("hidden")});m.getElements(".taxesAndFees").each(function(n){n.addClass("hidden")});k(m)},l=function(n,m,o){n=n?n:"";m=m?m:"";o=o?o:"";var p=[n,m,o].join("|").replace("||","|").replace(/(\|$)/g,"");h.commerce.meta.updateNavArea(p)};return{updateInlineMeta:function(o,n){if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.popInlineDatePicker(n,o);return}var m=h.id("CHECK_RATE");if(!m){return}},popInlineDatePicker:function(o,p){if(!p){return}var m;var n="_inm";if(o&&o.target&&o.target.getParent("#CHECK_RATES_CONT")){m=h.id("date_picker_"+p)}m=m||h.id("date_picker_"+p+n);if(m){var q=m.getParent(".date_picker_calendar_wrap");if(q&&q.onclick){q.onclick(o,q,p,n);q.fireEvent("click",o,q,p,n);(function(){try{h.retrieve("avail.data."+p+n).calendar.calendarOverlay.position()}catch(r){}}).delay(200)}}},clickMetaShowPrices:function(n){var m;n=new Event(n);if(h.page.pushSuggestedDates(n.target)===true){return}if(h.page&&h.page.usingUnifiedDates){h.page.gatherDatesNear(n.target);n.stop();return}if(!h.widgets.calendar.hasPageDates()){h.widgets.calendar.setErrorStyling(n.target);return}m=a.getElement(".cr_lb_overlay");if(m&&m.overlay){m.overlay.hide()}},showLowestPriceCTA:function(s){var n=(s)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";if(h.has(n)){var r=true;if(s){var v=a.getElement(".meta_rates_content");r=v&&v.style.display=="block"}if(r){var o=h.retrieve(n);if(o.hasOwnProperty("idx")){var t=(s)?"Meta_LP_CTA_Display_Inline":"Meta_LP_CTA_Display";var q=(o.idx===0)?"Not_Displayed":"Displayed";var u=o.idx+"";h.trackEventOnPage(t,q,u)}var p=(s)?"LP_CTA_INLINE":"LP_CTA";var m=h.id(p);if(m){(function(){m.fade("in")}).delay(1000)}}}},chevronHover:function(q,o,n,p){if(o&&n&&p){var m=h.id(o).getElement("."+p);if(m){m.removeClass(p);m.addClass(n)}}},chevronBlur:function(q,o,n,p){if(o&&n&&p){var m=h.id(o).getElement("."+n);if(m){m.removeClass(n);m.addClass(p)}}},hoverTopOffer:function(){var m=a.getElement(".rgba_gray_arrow_up");if(m){m.removeClass("rgba_gray_arrow_up");m.addClass("rgba_yellow_arrow_up")}},blurTopOffer:function(){var m=a.getElement(".rgba_yellow_arrow_up");if(m){m.removeClass("rgba_yellow_arrow_up");m.addClass("rgba_gray_arrow_up")}},hoverBookBtn:function(m){var n=h.id(m);f(n,"bookBtnOrangeIdle","bookBtnOrangeOver");f(n,"bookBtnGreyIdle","bookBtnGreyOver");f(n,"bookIdle","bookOver");f(n,"goIdle","goOver");f(n,"selectIdle","selectOver");f(n,"bookSmallIdle","bookSmallOver");f(n,"goSmallIdle","goSmallOver");f(n,"selectSmallIdle","selectSmallOver");f(n,"goBtnGrey","goBtnGreyOver");f(n,"goBtnOrange","goBtnOrangeOver");f(n,"chevronOrangeIdle35","chevronOrangeOver35");f(n,"chevronGreyIdle27","chevronGreyOver27");f(n,"chevronIdle_ylw","chevronHover_ylw")},blurBookBtn:function(m){var n=h.id(m);f(n,"bookBtnOrangeOver","bookBtnOrangeIdle");f(n,"bookBtnGreyOver","bookBtnGreyIdle");f(n,"bookOver","bookIdle");f(n,"goOver","goIdle");f(n,"selectOver","selectIdle");f(n,"bookSmallOver","bookSmallIdle");f(n,"goSmallOver","goSmallIdle");f(n,"selectSmallOver","selectSmallIdle");f(n,"goBtnGreyOver","goBtnGrey");f(n,"goBtnOrangeOver","goBtnOrange");f(n,"chevronOrangeOver35","chevronOrangeIdle35");f(n,"chevronGreyOver27","chevronGreyIdle27");f(n,"chevronHover_ylw","chevronIdle_ylw")},hoverSmallBookBtn:function(n){var m=h.id(n).getElement(".bookBtn");if(m==null){return}f(m,"bookBtnOrangeIdleSmall","bookBtnOrangeIdleSmallOver");f(m,"bookSmallIdle","bookSmallOver");f(m,"goSmallIdle","goSmallOver");f(m,"selectSmallIdle","selectSmallOver")},blurSmallBookBtn:function(n){var m=h.id(n).getElement(".bookBtn");if(m==null){return}f(m,"bookBtnOrangeIdleSmallOver","bookBtnOrangeIdleSmall");f(m,"bookSmallOver","bookSmallIdle");f(m,"goSmallOver","goSmallIdle");f(m,"selectSmallOver","selectSmallIdle")},providerHoverOn:function(n,t,s){var r=h.id(n);r.addClass("partnerHvr");var m=r.getElement(".price_overlay");if(m){var q=r.getElement(".perNight");var p=q.getCoordinates().width+29;m.addClass("show");if(h.util.i18n.isRtl()){m.setStyles({position:"absolute",left:p,zindex:"101"})}else{m.setStyles({position:"absolute",right:p,zindex:"101"})}}var o=n.getElement(".bookBtn");if(o){h.commerce.meta.hoverBookBtn(o)}h.store("meta.hoverProvider",t);h.store("meta.hoverProviderPosn",s)},providerHoverOff:function(n){var p=h.id(n);p.removeClass("partnerHvr");var m=p.getElement(".price_overlay");if(m){m.removeClass("show")}var o=n.getElement(".bookBtn");if(o){h.commerce.meta.blurBookBtn(o)}h.remove("meta.hoverProvider")},restoreProviderHover:function(){var m=h.retrieve("meta.hoverProvider");var q=h.retrieve("meta.hoverProviderPosn");if(m&&q){var p=h.id("PROVIDER_BLOCK");if(p){var o=p.getElements(".metaProvider");var n=p.getElement(".provider_"+m);if(o&&n&&n.hasClass("order_"+q)){o.each(function(r){h.commerce.meta.providerHoverOff(r)});h.commerce.meta.providerHoverOn(n,m,q)}}}},updateNavArea:function(m){var n=h.retrieve("ta.meta.navArea");if(!n||n.indexOf(m)<0){h.store("ta.meta.navArea",m)}},getNavAreaContextFromDom:function(n,m){n=h.id(n);if(n.getParent(".persistentCR")){return(m)?"|PCR":"PCR"}else{if(n.getParent(".photosOverlay")||n.getParent("#LOC_PHOTO_ALBUMS")){return(m)?"|Photo_Lightbox":"Photo_Lightbox"}else{if(n.getParent(".amenities_lightbox")){return(m)?"|Amenities_Lightbox":"Amenities_Lightbox"}else{if(n.getParent("#CHECK_RATES_LB")){return(m)?"|Photo_LB":"Photo_LB"}else{return}}}}},updateNavAreaMini:function(n,o,m){o=h.id(o);var p=h.commerce.meta.getNavAreaContextFromDom(o);p=p?"|"+p:"";l(n,p,m)},loadBestPriceXsell:function(C,F,q,p){try{if(h.retrieve("checkrates.one_second_xsell")!==true){return}var E=q&&q.isInline;var y="";var r="";var K=q&&q.isMetaLighboxV3;if(h.isHRTabs2014()&&E){return}if(K){y="meta_lightbox_v3"}var D=1000;var m="loadBestPriceXsell_numTries";var s="loadBestPriceXsell_curCancelKey";if(E){m="loadBestPriceXsellInline_numTries";s="loadBestPriceXsellInline_curCancelKey"}var J="meta.xsellTravelData";if(E){J="meta.xsellTravelDataInline"}var u=h.retrieve(J);if(p==null){p=new Date().getTime();h.store(m,0);u=h.widgets.calendar.getCheckRatesData();h.store(J,u);var v=h.id(F);if(v){v.innerHTML="";v.setStyle("height",0);v.setStyle("opacity","0");var A=h.retrieve("metaCheckRatesOverlay");A=h.id(A);if(!E&&A&&A.container&&A.container.getPosition){c.scrollTo(0,A.container.getPosition().y)}}if(E){h.commerce.meta.metaInYourMeta_resetInline()}else{h.commerce.meta.metaInYourMeta_resetLB()}}var t="loadBestPriceXsell_"+p+"_cancel";if(E){t="loadBestPriceXsellInline_"+p+"_cancel"}if(h.retrieve(t)){return}if(h.has(s)){var I=h.retrieve(s);if(I!=t){h.store(I,true)}}if(!h.has(t)){h.store(t,false);h.store(s,t)}var w=h.retrieve(m);var M=w+1;h.store(m,M);if(!u){return}var L="";if(typeof(pageServlet)!==d&&pageServlet){L=pageServlet}var B={};if(h.meta&&h.meta.update){B=h.commerce.meta.getMetaParams()}var x=Object.merge(u,{detail:C,"try":h.retrieve(m),reqNum:q.secondTry?"2":"1",type:y,isInlineRequest:E?"1":"0",openedVendors:r,origServlet:L},B);var o=Object.toQueryString(x);if(!o||!o.trim()){h.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell  - toQueryString failure",null,x);return}var n=h.retrieve("ta.meta.navArea");var z;try{z=h.commerce.meta.tracking.setTimingForNavArea(n)}catch(H){h.util.error.record(H,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}if(z){x.metaRequestTiming=z}if(h.commerce.meta.tracking.hasAnySuppressedAreas()){var G=h.commerce.meta.tracking.getSuppressedAreasAsString();if(G){x.suppressImpressionsOnComplete=G}}new Request({url:"/MetaBestPriceCrossSellAjax?"+o,evalScripts:true,onSuccess:function(O){if(h.retrieve(t)){return}var N=O.contains("xsellHacStatusReady")||O.contains("xsellHacStatusSOL")||q.secondTry;if(!N){setTimeout(function(){var Q={secondTry:true,xsell:true,isInline:E,isHrRedesignTest:false,openedVendors:r};h.commerce.meta.loadBestPriceXsell(C,F,Q,p)},D)}else{var P=h.id(F);if(P){P.setStyle("height",0);P.setStyle("opacity","0");P.setContent(O);h.commerce.meta.metaInYourMeta(F,{xsell:true,inline:E})}h.store(m,0)}},onFailure:function(){h.store(m,0);h.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(H){h.util.error.record(H,"ta.commerce.meta.loadBestPriceXsell")}},loadGeoCrAutoBroadenContents:function(r,t){var z=5;var p=1000;var o="QC_Meta_Mini|GeoCheckRatesLightBox";try{var m=function(){u=false};var x=function(){r.fireEvent("close",r);r.hide()};var u=true;var w=h.id(r.inner);if(!w){throw new Error("Cannot find parent: "+r)}var q=function(D){var C=0;D.each(function(F){var E=F.getHeight();if(E>C){C=E}});D.each(function(E){E.setStyle("height",C)})};var A=h.commerce.meta.tracking.setTimingForNavArea(o);r.addEvent("close",m);var y={d:t,area:o,metaRequestTiming:A};var B=h.widgets.calendar.getCheckRatesData();if(!B){throw new Error("Cannot find dates and/or adults")}Object.merge(y,B);if(h.meta&&h.meta.update){Object.merge(y,h.commerce.meta.getMetaParams())}var s=0;var n=function(){if(!u){return}++s;y.attempt=s;new Request({url:"/GeoCrAutoBroadenAjax",data:y,method:"get",evalScripts:true,onSuccess:function(C){try{if(!u){return}var E=Elements.from(C,true);var F=E.getElement(".progress").filter(function(I){return I})[0];if(!F){h.util.error.record(null,"geo check rate malform response missing progress",null,y);x()}else{if(/\bfallbackUrl-(\S+)\b/.exec(F.className)){var H=RegExp.$1;var D=h.util.URL.getServletNameFromUrl(H);if(!D){h.util.error.record(null,"geo check rate cannot get servlet name from "+H,null,y);D="UNKNOWN"}h.setEvtCookie("MetaGeoLightBox","unload","Redirect",0,"/"+D);a.location.href=H}else{w.setStyles({overflow:"hidden",height:"auto"});w.innerHTML="";w.adopt(E);q(w.getElements("#GEO_CR_AUTO_BROADEN .recs .rec .info .distance"));q(w.getElements("#GEO_CR_AUTO_BROADEN .recs .rec .info .amenity"));if(!F.hasClass("isHacComplete")&&s<z){setTimeout(n,p)}else{w.getElements(".showUntilLast").dispose();w.getElements(".hideUntilLast").removeClass("hidden")}}}}catch(G){h.util.error.record(G,"cannot process geo check rate response",null,y);x()}},onFailure:function(C){h.util.error.record(null,"geo check rate request failed: status="+(C&&C.status),null,y);x()}}).send()};n()}catch(v){h.util.error.record(v,"cannot send geo check rate initial request");if(x){x()}}},xSellResponses:{lb_hac:false,lb_xsell:false,inline_hac:false,inline_xsell:false},metaInYourMeta_resetLB:function(){h.commerce.meta.xSellResponses.lb_hac=false;h.commerce.meta.xSellResponses.lb_xsell=false},metaInYourMeta_resetInline:function(){h.commerce.meta.xSellResponses.inline_hac=false;h.commerce.meta.xSellResponses.inline_xsell=false},hacIsBlockingXSell:function(m){var n=h.commerce.meta.xSellResponses;if(m){return n.inline_xsell}else{return n.lb_xsell}},metaInYourMeta:function(p,x){var o=x&&x.inline;var n=x&&x.xsell;var s=h.commerce.meta.xSellResponses;if(o){if(n){s.inline_xsell=true}else{s.inline_hac=true}}else{if(n){s.lb_xsell=true}else{s.lb_hac=true}}if((o&&s.inline_xsell)||(!o&&s.lb_xsell&&s.lb_hac)){var v=h.id("META_PRICE_XSELL");var u=h.id("STATE_OPT_RESPONSE");if(o){v=h.id("META_PRICE_XSELL_INLINE");u=h.id("STATE_OPT_RESPONSE_INLINE")}if(v&&v.hasClass&&!v.hasClass("hidden")){return}if(u&&u.hasClass&&!u.hasClass("hidden")){return}var w=v;var r=0;if(h.meta&&h.meta.update){r=h.meta.update.getMetaPricesCount(o)}else{if(g()){r=dd.commerce.checkrates.getMetaPricesCount(o)}}if(r==null){r=0}if(r<1&&u){w=u}var t=h.id(p);if(t){if(w){h.commerce.meta.revealBestPriceXsell(t,w,o,false)}else{var m="lA";if(o){m=m+"_Inline"}var q=h.id(m);if(q&&q.removeClass){q.removeClass("hidden")}}}}},revealBestPriceXsell:function(s,x,n,A){if(s){s=h.id(s)}if(x){x=h.id(x)}if(!s||!x){h.util.error.record(null,"revealBestPriceXsell - required elements missing");return}if(x.removeClass){x.removeClass("hidden")}var r=new Fx.Tween(s,{property:"opacity"});if(A){var p=h.retrieve("metaLeaveBehindOverlay");if(p&&p.container){var m=p.container;if(m.hasClass&&m.hasClass("hidden")&&m.removeClass){m.removeClass("hidden")}if(h.meta&&h.meta.cr){h.meta.cr.removePCR()}else{if(g()){dd.commerce.checkrates.removePCR()}}}}else{var t="META_MINI_META_MAYBE";if(n){t="META_MINI_META_MAYBE_INLINE"}var z=h.id(t);var w=true;if(z){w=false}var v="Displayed_Lightbox";if(n){v="Displayed_Inline"}var u=x.getElements(".hotelListing").length;if(u===0){u="0";v="Not_"+v}h.trackEventOnPage("Meta_State-Optimized_XSell",v,u)}var q=x.getSize().y;var y=new Fx.Tween(s,{property:"height",onComplete:function(){if(!A){r.start(0,1)}}});y.start(q);var o=h.retrieve("metaCheckRatesOverlay");if(o&&o.container&&o.closeBtn&&h.id(c).getScroll().y>o.container.getPosition().y){h.util.element.scrollIntoView(o.closeBtn)}},hideBestPriceXsell:function(q){var p=h.id(q);var n=h.id("META_PRICE_XSELL");if(!p||!n){return}var m=new Fx.Tween(p,{property:"height"});var o=new Fx.Tween(p,{property:"opacity",onComplete:function(){m.start(0);if(n.addClass){n.addClass("hidden")}}});o.start(1,0)},loadMetaAF:function(q,r,s){try{if(h.retrieve("checkrates.meta_af")!==true||h.retrieve("ta.redirectingPage")||h.retrieve("hist_price_cross_sell_hr.enabled")){return}var o="meta_af_last_request";var n=new Date().getTime();h.store(o,n);var p=1000;var w=false;var u=false;if(h.page&&h.page.usingUnifiedDates&&!h.page.hasDates("STAYDATES")){return}if(h.meta&&h.meta.update){w=h.widgets.calendar.getCheckRatesData();if(!w){return}var v={};if(h.meta&&h.meta.update){v=h.commerce.meta.getMetaParams()}u=Object.merge(w,{detail:q,reqNum:s?"2":"1",type:"af"},v)}else{if(g()){return dd.commerce.checkrates.loadMetaAF(q,r,s)}else{return}}var m=Object.toQueryString(u);if(!m||!m.trim()){h.util.error.record(null,"ta.commerce.meta.loadMetaAF - toQueryString failure",null,u);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:u,evalScripts:true,onSuccess:function(C){if(h.retrieve(o)!=n){return}var D=C.contains("xsellHacStatusReady")||C.contains("xsellHacStatusSOL")||s;if(!D){setTimeout(function(){h.commerce.meta.loadMetaAF(q,r,true)},p)}else{var A=h.id(r);var x=a.getElement(".clearDates");if(A){A.show();A.setStyle("height",0);A.setStyle("opacity","0");A.setContent(C);h.prwidgets.initWidgets(A);var B=a.getElement(".tablet_desktop .mapsv2-more .clearDates");if(x&&x!=B){x.style.display="none"}var E=A.getElement(".mainList");if(E){var y=new Fx.Tween(A,{property:"opacity",onComplete:function(){h.fireEvent("refreshedDOMContent",E)}});var z=E.getSize().y;var F=new Fx.Tween(A,{property:"height",onComplete:function(){A.setStyle("height","auto");y.start(0,1)}});F.start(0,z);h.fireEvent("avaf.loaded")}}}},onFailure:function(){if(h.retrieve("ta.redirectingPage")){return}h.util.error.record(null,"ta.commerce.meta.loadMetaAF - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(t){h.util.error.record(t,"ta.commerce.meta.loadMetaAF")}},updateProvAreaFromLightBox:function(q){var n=h.retrieve("meta.baseLocationId");if(n&&q==n){var p=h.retrieve("meta.postShowMetaCR");var o=h.retrieve("meta.postShowMetaCRLB");var m=h.retrieve("meta.postShowMetaCRLBPCR");if(p&&o&&m){h.commerce.meta.updateProvArea(p,o,m);return}}if(h.widgets.calendar.datesExist()){if(h.meta&&h.meta.update){h.meta.update.request(n)}else{if(g()){dd.commerce.checkrates.checkRatesMiniMeta(null,a.getElementById("CHECK_RATE"),n,"checkrates")}}}},updateProvArea:function(w){var q=a.getElement("#CHECK_RATES_CONT.chkRates");var y=a.getElement(".ShowUserReviews #CHECK_RATES_CONT.chkRates");var p=a.getElement("#LOC_PHOTO_ALBUMS.photos_lb_update .metaCrosssell .chkRates");var u=a.getElement("#LOC_PHOTO_ALBUMS.photos_lb_update .sidebar .chkRates");var r=a.getElement("#AMENITY_LIGHTBOX.photos_lb_update .chkRates");var A=a.getElement(".similarCarousel");var z=a.getElement(".premiumTimeout");if(A&&z){var m=q.getElement("div.bc_text_content");if(m){var n=w.getChildren()[1];if(n){var v=n.clone(false);v.innerHTML=n.innerHTML;m.innerHTML="";m.adopt(v)}}}else{e(y,w)}if(p){e(p,w);j(p);var x=a.getElement(".featuredImageWrap.metaCrosssell");if(x){var s=x.getElement(".premium_offers_area");if(s){var o=s.getElements(".offer.wrap.premium");var t=x.getElement(".chkRates");if(o&&t){t.toggleClass("noOffers",o.length===0)}}}}if(u){e(u,w);j(u)}if(r){e(r,w);k(r)}if(h.has("meta.isHackathonBC")){h.commerce.meta.alignPriceBlocks();if(h.has("meta.bc.isRevisedUnavailability")){h.commerce.meta.truncateProviderNames()}}c.fireEvent("postAjaxMetaUpdate");if(w&&w.getElement(".hacMiniComplete")){i(w)}},updatePCRAreaWithMiniMeta:function(o,m){if(m==null||o==null){return}var r=o.inner;if(!r){return}h.commerce.meta.suppressCRArea(r);var p=r.getElement(".postShowMetaCRLBPCR");if(p!=null){p.destroy()}var q=r.getElement("fieldset.miniMetaContainer");var n=m.getElement(".disclaimer");if(n!=null){n.destroy()}h.commerce.meta.adoptMiniMetaElem(q,m);if(!h.widgets.calendar.datesInRange()){h.commerce.meta.showCRArea(r)}},adoptMiniMetaElem:function(o,m){if(o!=null){var p=o.getElement(".disclaimer");if(p!=null&&!p.getParentBySelector("#hover_table_display_area")){p.destroy()}var n=m.clone(false);n.innerHTML=m.innerHTML;o.adopt(n)}},miniMetaAjax:function(m,n){if(g()){dd.commerce.checkrates.miniMetaAjax(m,n)}},suppressCRArea:function(m){var n=m.getElements(".miniMetaShow");Array.each(n,function(o){o.removeClass("miniMetaShow");o.addClass("miniMetaHide")})},showCRArea:function(m){var o=m.getElement(".postShowMetaCR");if(o!=null){o.destroy()}var n=m.getElements(".miniMetaHide");Array.each(n,function(p){p.removeClass("miniMetaHide");p.addClass("miniMetaShow")})},showCurrencyPicker:function(){},selectCurrency:function(){},clearStoredMiniData:function(){if(h.retrieve("checkrates.meta_ui_post_click_prices")){h.store("meta.postShowMetaCRLBPCR",null);h.store("meta.postShowMetaCR",null);h.store("meta.postShowMetaCRLB",null)}},storeMiniData:function(n){if(h.retrieve("checkrates.meta_ui_post_click_prices")){var p=n.getElement(".postShowMetaCR");var m=n.getElement(".postShowMetaCRLBPCR");var o=n.getElement(".postShowMetaCRLB");if(p&&o&&m){h.store("meta.postShowMetaCRLBPCR",m);h.store("meta.postShowMetaCR",p);h.store("meta.postShowMetaCRLB",o)}}},providerButtonClicked:function(n){if(n&&!h.has("hotels.hasTimeoutDates")){var m="CheckIn|provider_logo";h.trackEventOnPage("DATEPICKER","OPEN",m,n);h.store("meta.datepicker_tracked",true)}},moreSitesLinkClicked:function(m){if(m&&!h.has("hotels.hasTimeoutDates")){h.trackEventOnPage("DATEPICKER","OPEN","more_sites_link",m);h.store("meta.datepicker_tracked",true)}},buildMetaHacParamObj:function(){var n={};try{var m=a.getElement("#HAC_FORM input[name=geo]");if(m&&m.value){n.geo=m.value}if(!n.geo){var s=a.getElement("#SEARCH_LHN input[name=geo]");if(s){n.geo=s.value}}var t=a.getElementById("searchAll");if(t&&t.value!="true"){var q=h.widgets.calendar.getPageInDate();if(q){n.inDay=q.getDate();n.inMonth=(q.getMonth()+1)+"/"+q.getFullYear()}var p=h.widgets.calendar.getPageOutDate();if(p){n.outDay=p.getDate();n.outMonth=(p.getMonth()+1)+"/"+p.getFullYear()}var o=h.widgets.calendar.getPageAdultsCount();if(o!=2){n.adults=o}n.searchAll="false"}}catch(r){h.util.error.record(r,"buildHACUrlParams")}return Object.toQueryString(n)},getHACCategory:function(){var n=a.getElements(".tab.selected");var o="1";if(n&&n.length&&n.length>0){var m=n[0].className.match(/cat_(\d+)/);if(m){o=m[1]}}return o},buildHACSearchData:function(){var q=h.widgets.calendar.getPageInDate();var u=h.widgets.calendar.getPageOutDate();var v=h.widgets.calendar.getPageAdultsCount();var w=a.getElementById("geo");var n;if(w==null){n=a.getElementsByName("geo");if(n&&n.length>0){w=n[0]}}var t;if(w&&w.value){t=w.value}else{if(c.modelGeoId){t=c.modelGeoId}}var p=false;var x=h.commerce.meta._padZero;var s=q?x(q.getDate()):null;var o=u?x(u.getDate()):null;var r=q?x(q.getMonth()+1)+"/"+q.getFullYear():null;var y=u?x(u.getMonth()+1)+"/"+u.getFullYear():null;var m={};m.adults=v;m.geo=t;m.searchAll=p;m.inDateOfMonth=s;m.outDateOfMonth=o;m.inMonthYear=r;m.outMonthYear=y;m.category=h.commerce.meta.getHACCategory();return m},buildMetaHACUrl:function(){var m=h.commerce.meta.buildHACSearchData();var n="/HACSearch?adults="+m.adults+"&geo="+m.geo+"&searchAll="+m.searchAll;if(m.category){n=n+"&cat="+m.category}if(m.inDateOfMonth){n=n+"&inDay="+m.inDateOfMonth}if(m.outDateOfMonth){n=n+"&outDay="+m.outDateOfMonth}if(m.inMonthYear){n=n+"&inMonth="+m.inMonthYear}if(m.outMonthYear){n=n+"&outMonth="+m.outMonthYear}var o=n+c.location.hash;return o},redirectHACSearch:function(){h.setEvtCookie("Mini_meta_LP_chevron_display","Clicked","Unavailable","","/HACSearch");c.location=h.commerce.meta.buildMetaHACUrl()},_padZero:function(m){return String("0"+m).slice(-2)},anchorToOpenTab:function(){var n=h.id("ReviewsTab");var m=h.id("MetaPricesTab");if(n&&n.hasClass("selected")){h.commerce.meta.scrollToReviews()}else{if(m&&m.hasClass("selected")){n.click();h.commerce.meta.scrollToReviews()}}},scrollToReviews:function(){var m=h.id("REVIEWS");if(m!=null){h.util.element.scrollIntoView(m)}else{h.util.error.record(null,"couldn't find reviews element on page!")}},scrollToId:function(m){if(m&&h.id(m)){h.util.element.scrollIntoView(h.id(m))}},initNoAvailCarousel:function(){try{var m=h.id("ALSO_VIEWED_LIST"),t;if(!m){return}var q=m.getElement("ul");if(!q){return}var w=q.getElements("li").length;var u=new Fx.Tween(q,{property:"left"});var n=353;var r=1;var v=m.getElement(".prev");var o=m.getElement(".next");if(!o||!v){return}var s=function(x){var A,y,z,B;if((r===1&&x<0)||(r===w&&x>0)){return}if(x<0){h.trackEventOnPage("Pager_Arrows","Scroll_Left","Mini_Carousel_Xsell")}else{if(x>0){h.trackEventOnPage("Pager_Arrows","Scroll_Right","Mini_Carousel_Xsell")}}r+=x;A=parseInt(q.getStyle("left"),10);y=n*x*-1;z=A+y;u.start(z);B=m.getElement(".paginator");if(B){if(r===1&&x<0){t="front"}else{if(r===w&&x>0){t="end"}else{t="middle"}}B.className="paginator "+t}};v.addEvent("click",function(){s(-1)});o.addEvent("click",function(){s(1)})}catch(p){h.util.error.record(p,"ta.commerce.meta.initNoAvailCarousel")}},showRemainingProviders:function(n,m){m=h.id(m);if(m){m.destroy()}h.store("checkrates.hr_bc_see_all_click",true);if(h.retrieve("ibdm_impression_tracking")){h.trk("n_more_sites",false,a.getElement(".premium_offers_area"))}a.getElements(".remaining").removeClass("remaining");c.fireEvent("remainingMetaProvidersShown")},showRemainingProviders_Flyout:function(n,m){m=h.id(m);var q=h.find(".show_remaining_providers_flyout",m)||h.find(".show_remaining_providers_flyout");var p=m.getParent(".chkRates")||a;var r=h.select(".remaining",p);try{if(q&&r.length){a.body.addEvent("click",function(s){if(m&&!s.target||!s.target.getParents().contains(m)||q.isDisplayed()){q.hide();a.body.removeEvents("click");h.select(".remaining",q).destroy()}else{r.forEach(function(t){q.adopt(t.clone())});q.show()}})}}catch(o){h.util.error.record(o,"showRemainingProviders_Flyout")}},alignPriceBlocks:function(){h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceBlock .price",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceBlock .featuredText",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceOutsideChevron .price",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceOutsideChevron .featuredText",true);h.util.element.makeTextFitOneLine(".offer.premium .priceBlock.flag_bump .price",true);h.util.element.fitToContentsHorizontally(".offer.premium .lowest_price_folded .text",0,65);h.select(".chevron_redesign .offer.premium.unsized .loading").setStyle("display","none");h.select(".chevron_redesign .offer.premium.unsized").removeClass("unsized");h.util.element.makeSameWidth("#HR_HACKATHON_CONTENT > #HotelDateSearch .postShowMetaCR .priceBlock")},toggleBlueChevronLowestPriceCTA:function(n){if(h.retrieve("meta_guests_field_v2.CTAActivated")&&!a.getElements(".overlay").length){if(h.has("meta_guests_field_v2.CTATimer")){clearTimeout(h.remove("meta_guests_field_v2.CTATimer"))}var m=h.id("BC_LP_CTA");if(m&&m.fade){if(n){m.fade("in")}else{m.fade("out")}}}},displayBlueChevronLowestPriceCTA:function(){var o="bcMetaLowestPriceCTA",w,u,y,n,v,t,m,x,r;if(h.has(o)&&!h.has("hr_chevron_redesign")){w=h.retrieve(o);if(w.hasOwnProperty("idx")){u=(w.idx===0)?"Not_Displayed":"Displayed";y=w.idx+"";h.trackEventOnPage("BlueChevron_LP_CTA_Display",u,y)}n=h.id("BC_LP_CTA");if(n&&n.fade){(function(){n.fade("in");if(h.retrieve("meta_guests_field_v2.enabled")){h.store("meta_guests_field_v2.CTATimer",(function(){n.fade("out")}).delay(5000));h.store("meta_guests_field_v2.CTAActivated",true)}}).delay(700)}v=h.id("bc_lp_cta_text");if(v){t=v.getSize().y;if(t==12){while(v.getSize().y<=t){v.style.width=""+(v.getSize().x-1)+"px"}v.style.width=""+(v.getSize().x+1)+"px"}if(w.displayTop){m=n.parentNode.getElement(".priceBlock");n.style.position="relative";n.style.left=(345-v.getSize().x)+"px";n.style.top=""+(-m.getSize().y-22)+"px"}else{x=n.getElement(".bc_lp_cta_triangle");n.style.left="-"+(v.getSize().x+20)+"px";x.style.left=""+(v.getSize().x+10)+"px"}v.style.marginTop=""+Math.round((25-v.getSize().y)/2)+"px"}r=5800;if(h.retrieve("check_width_for_CTA_fade")){var A=a.getElement(".bc_lp_cta");var p=a.getElement(".priceBlock");if(A&&p){var q=A.getSize().x+p.getSize().x;var s=250;if((q>s)&&!w.displayTop){(function(){n.fade("out")}).delay(r)}}}else{var z=h.retrieve("fadeBcLpCTAout");if(z&&z==1&&!w.displayTop){(function(){n.fade("out")}).delay(r)}}}},truncateProviderNames:function(){var p=a.getElement(".textLink");if(!p){return}var n=p.getSize().x;var o=Math.max.apply(null,a.getElements(".textLink .price").map(function(q){return q.getParent(".moreLink")?0:q.getSize().x}));var m=n-o-28;if(h.retrieve("meta.paymentsTipText")){m=m-20}if(m>0){$$(".textLinks .providerName").each(function(q){if(q.getNext(".price")){q.setStyle("width",m)}})}},expandProvidersInline:function(o){o=h.id(o);if(!o){return}var n=o.getParent(".metaPriceInfo");if(!n){return}var p=n.getElements(".provider");if(!p){return}p.show();o.hide();if(h.retrieve("assisted_booking_desktop_entry")){var m=o.getParents();m.forEach(function(q){if(q.hasClass("metaPriceInfo")){if(h.meta&&h.meta.treeTrack&&h.meta.treeTrack.hasTrackingTree(q)){h.trk("n_more_sites",false,q)}}})}},flipHoverClass:function(n,m){if(n){n=h.id(n);var o=m+"Idle";var p=m+"Over";n&&n.toggleClass(o).toggleClass(p)}},trackHotelRatingsInfoClickInHR:function(m){m.target=m.target||m.srcElement;if(m.target&&m.target.href){h.setEvtCookie("Ratings_Info","all_hotels","",0,m.target.href)}},cleanupForMapView:function(){var m=h.retrieve("maps.floaterDiv");if(m){m.hide()}},navigateToHotelDetail:function(p,o,n,m){var q=h.id(p.target);if(q&&!q.match("img")&&!q.match("a")&&!q.hasClass("taLnk")&&!q.hasClass("greenLeaderTaLnk")&&!q.getParent(".metaPriceInfo")&&!q.getParent("a")&&!q.getParent(".p13n_inline_info")){if(h.retrieve("open_hotels_in_new_tab.enabled")){h.util.cookie.openWindowWithPID(n,m)}else{if(m){h.util.cookie.setPIDCookie(m)}c.location.href=n}}},updateHeaderMsg:function(n,o){var m=a.getElement(n);if(o&&m){if(m.hasClass("unifiedPickers")){}else{m.innerHTML=o}}},updateHeaderDates:function(){try{if(h.widgets.calendar.hasPageDates()){var o=$$(".dateHeader.inDate");var n=$$(".dateHeader.outDate");var m=h.widgets.calendar.getDatePickerFormat("short");var r=h.widgets.calendar.getDatePickerFormat("classic");if(o){var q=h.widgets.calendar.dateToString(h.widgets.calendar.getPageInDate(),m);Array.each(o,function(t){var u=h.id(t);if(u.getParent("#meta_on_photo_viewer")){return}if(u){u.innerHTML=q}})}if(n){var p=h.widgets.calendar.dateToString(h.widgets.calendar.getPageOutDate(),r);Array.each(n,function(t){var u=h.id(t);if(u){u.innerHTML=p}})}}}catch(s){h.util.error.record(s,"ta.commerce.meta.updateHeaderDates")}},enableAdultsPicker:function(){var p=a.getElement(".adultsText");if(p){p.addClass("hide")}var n=a.getElement(".changeAdults");if(n){n.addClass("hide")}var o=a.getElement(".overlay .date_picker_adults_wrap");if(o){o.removeClass("hide")}var m=a.getElement(".overlay .showPriceButtonHide");if(m){m.removeClass("showPriceButtonHide")}h.store("meta_guests_field_v2.originalAdults",h.retrieve("date.picker.adultsCount"))},disableAdultsPicker:function(n){if(!(n&&n.container)){return}var q=n.container.getElement(".adultsText");if(q){q.removeClass("hide")}var o=n.container.getElement(".changeAdults");if(o){o.removeClass("hide")}var p=n.container.getElement(".date_picker_adults_wrap");if(p){p.addClass("hide")}var m=n.container.getElement(".showPriceButton");if(m){m.addClass("showPriceButtonHide")}},adultsGoButtonClick:function(m,p,s,o,u){var q=h.widgets.calendar.getPageInDate();var v=h.widgets.calendar.getPageOutDate();var n=q&&q.getDate&&v&&v.getDate;if(n){var w=h.widgets.calendar.getCalendarObjectKey(s,o,"out");var t=h.retrieve(w);if(t){var r=t.calendar;if(r){r.onCalendarOverlayHide();r.fireEvent("onRangeSelect",[r.crId,r.options.ext]);r.fireEvent("onSelect",[r,m])}}}else{h.overlays.Factory.simulateDatePickerClick(m,p,s,o,u)}},updateAdultsText:function(){var m=a.getElement(".adultsText");if(m&&h.widgets.calendar.updateAdultsDisplay){h.widgets.calendar.updateAdultsDisplay(m)}},hhRedirectIfNoOffers:function(){var m=a.getElements("#HotelDateSearch .offer");if(m&&!h.commerce.meta._overlayOnPage()){h.store("ta.redirectingPage",true);h.setEvtCookie("NoOffersHH","redirect","",0,"/HotelHighlight");var n=/-r\d+-/;c.location.href=c.location.href.replace("Hotel_Review-","Hotel_Review-s1-").replace("ShowUserReviews-","Hotel_Review-s1-").replace(n,"-")}},getResponseAvailability:function(m){if(!m){return false}return{anyAvailable:!!m.match(/\shacComplete\s.*\sanyOfferCompletedSuccessfully\s/g),allUnavailable:!!m.match(/\shacComplete\s.*\shacMiniOfferNotAvailable\s/g),maybeAvailable:!!m.match(/\shacComplete\s.*\shasDisplayUnavailability\s/g)}},_overlayOnPage:function(){return h.overlays&&h.overlays.getCurrent&&h.overlays.getCurrent()},hhRemoveDatePickerForErrorMessaging:function(o){if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.clickMetaShowPrices(o);return}var n=h.id("GEO_CHECK_RATES_BALANCE");if(n){n.hide()}var m=a.getElement("#HLBASE .unavailHdr");if(m){m.removeClass("hidden")}},setupMiniMetaOnAccomPolling:function(m){if(!h.pages.hac.updateHACData||!h.hac.filters.updateResults){h.util.error.record(null,"setupMiniMetaOnAccomPolling bad linkage")}h.pages.hac.startHACUpdate();if(m){h.hac.filters.updateResults()}},checkRatesCreateGeoCrAutoBroadenLb:function(o,n,m){try{if(h.has("hr_to_hh_redirect_no_offers")&&c.pageServlet&&c.pageServlet!=="HotelHighlight"){if(h.widgets.calendar.hasPageDates()){h.widgets.calendar.justUpdateSessionDates(function(){h.commerce.meta.hhRedirectIfNoOffers&&h.commerce.meta.hhRedirectIfNoOffers.delay(300)})}else{h.widgets.calendar.setErrorStyling(new Event(o).target)}return}if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.clickMetaShowPrices(o);return}if(n.getParent(".meta_date_wrapper")){h.trackEventOnPage("MetaGeoLightBox","open","DatePicker",0,false)}else{h.trackEventOnPage("MetaGeoLightBox","open","ShowPrices",0,false)}h.run("ta.overlays.Factory.loadGeoCrAutoBroadenOverlay",{},n,m)}catch(p){h.util.error.record(p,"ta.commerce.meta.checkRatesCreateGeoCrAutoBroadenLb cannot track/create lightbox")}},metaListingClickReporting:function(m){if(!m||!m.target){return}if(m.target.hasClass("photo_image")){h.trackEventOnPage("PRICE_SAVER","CLICK","THUMBNAIL")}else{if(m.target.nodeName==="A"&&m.target.parentNode.hasClass("review_stubs_item")){h.trackEventOnPage("PRICE_SAVER","CLICK","REVIEW")}else{if(m.target.hasClass("property_title")){h.trackEventOnPage("PRICE_SAVER","CLICK","PROPERTY_TITLE")}else{if(m.target.getParent(".metaPriceInfo")!=null){h.trackEventOnPage("PRICE_SAVER","CLICK","META")}}}}},getMetaParams:function(){return{metaReferer:c.pageServlet}},trackAdBlock:function(){if(h.id(a.body)){var m=1;var n=new Element("div",{"class":"adInner",styles:{height:m,visibility:"hidden"}});h.id(a.body).adopt(n);if(n.getSize().y!=m){h.trackEventOnPage("ADBLOCK","ENABLED",null,null,true)}else{h.trackEventOnPage("ADBLOCK","DISABLED",null,null,true)}n.dispose()}},updateSessionDatesRedirect:function(m){if(h.widgets.calendar.hasPageDates()){h.widgets.calendar.justUpdateSessionDates(function(){c.location.href=m},false,true)}else{c.location.href=m}}}}(b))}(document,window,ta));ta.commerce.minimeta={ajax:{MAX_POLL_ATTEMPT:13,ALL_HAC_COMPLETE:"hotelsMeta.allHacComplete",LOCS_ON_PAGE:"hotelsMeta.locsOnPage",ATTEMPT_STORE_KEY:"hotelsMeta.ajaxNum",TIME_EXPIRED:"hotelsMeta.timeExpired",MINI_META_APPEAR_LOADING_TIMEOUT:5000,MINI_META_STOP_LOADING_TIMEOUT:60000,send:function(c,a){var b=ta.commerce.minimeta.ajax;setTimeout(function(){new Request({method:"post",url:b.getUrl(),data:b.buildPostData(a),onSuccess:function(d){var e=new Element("div",{html:d});b.updateDOM(e);if(!c&&b.shouldResubmit()){ta.commerce.minimeta.ajax.send()}b.updateAttemptNum()}}).send()},ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY)))},getUrl:function(){return"/BulkMiniMetaCRAjax"},buildPostData:function(b){var a={};a.area="QC_Meta_Mini";a.returnAllOffers=true;a.detail=ta.commerce.minimeta.ajax._getLocOnPageString(b);a.action="getMiniMetaForLocations";return a},updateDOM:function(d){var a=d.getElement(".isAllHacComplete");if(a||ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true);var c=$$(".metaDisclaimer");if(c&&c.hasClass("hidden")){c.removeClass("hidden")}}var b=document.getElements(".listing");b.each(function(j){var i=j.id;var h=i.substring(i.indexOf("_")+1);var g=d.getElement("."+h);ta.commerce.minimeta.ajax.updateLoadingState(d);if(g){var e=g.getElement(".metaPriceInfo");var f=j.getElement(".metaPriceInfo");ta.commerce.minimeta.ajax._setPrice(e,h);ta.commerce.minimeta.ajax._setAccomType(e,h);e.replaces(f)}})},resetAjaxCall:function(){ta.remove(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE);ta.remove(ta.commerce.minimeta.ajax.LOCS_ON_PAGE);ta.remove(ta.commerce.minimeta.ajax.ATTEMPT_STORE_KEY);ta.remove(ta.commerce.minimeta.ajax.TIME_EXPIRED)},shouldResubmit:function(){if(ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){return false}else{var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a||a<ta.commerce.minimeta.ajax.MAX_POLL_ATTEMPT-1){return true}else{return false}}},updateAttemptNum:function(){var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a){ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,1)}else{ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,a+1)}},_getLocOnPageString:function(b){var c=document.getElements(".listing");var a="";c.each(function(f){var d,e;if(ta.commerce.minimeta.ajax._isHacComplete(f)&&!b){return}e=f.id;d=e.substring(e.indexOf("_")+1);a=a+d+","});if(a===""){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true)}return a},_isHacComplete:function(a){return a.getElement(".metaPriceInfo.hacComplete")},_setPrice:function(b,f){var a=b.getElement(".classicPrice");if(a){var d="classicPrice_"+f;var c=ta.retrieve(d);if(ta.retrieve("hotels.shouldHideClassicPrices")){a.hide()}else{if(c&&c!==0){var e=a.getElement(".price");e.set("html",c);a.toggleClass("hidden",false)}else{a.hide()}}}},_setAccomType:function(a,d){var c=a.getElement(".contactStr");if(c){var b="accomType_"+d;var e=ta.retrieve(b);if(!e||e=="T_HOTEL"){c.set("html",ta.retrieve("hotels.contactHotel"))}else{c.set("html",ta.retrieve("hotels.contactAccom"))}}},updateLoadingState:function(b){if(ta.retrieve(ta.commerce.minimeta.ajax.TIME_EXPIRED)){var d=b.getElements(".loading_bubbles_gry");var c=new Element("span",{"class":"sprite-visitSite"});d.each(function(f){c.clone().replaces(f)});var a=b.getElements(".loadingHeader");var e=ta.retrieve("hotels.checkSites");a.each(function(f){f.set("html",e)})}}},storeAccomDetails:function(){var b=document.getElements(".classicPrices");b.each(function(d){ta.store(d.id,d.value)});var a=document.getElements(".accomTypes");a.each(function(d){ta.store(d.id,d.value)});var c=$$(".metaDisclaimer");if(c){c.addClass("hidden")}},doMetaDateSearch:function(){if(!ta.widgets.calendar.hasPageDates()){var c=document.getElement(".metaDatePicker .date_picker_calendar_wrap");c.fireEvent("click")}else{if(ta.has("hac.filter.changed")||ta.has("meta.mini_meta_on_accommodations")){ta.hac.filters.updateResults()}else{if(!ta.retrieve("hotels.datesChanged")){ta.hac.filters.updateResults();ta.servlet.HACSearch.destroyAnimatedDateCTA()}else{var b=ta.hac.filters.buildHACUrlParamString();var a="/HACSearch?"+b+window.location.hash;window.location=a}}}},lowestPriceBookBtnHover:function(b){try{var a=document.getElement(".LowestPrice .bookBtn");if(!a){ta.util.error.record(null,"lowestPriceBookBtnHover - no button for .LowestPrice .bookBtn",null,{out:b});return}if(b){a.className=a.className.replace(/Over\b/,"Idle")}else{a.className=a.className.replace(/Idle\b/,"Over")}}catch(c){ta.util.error.record(c,"lowestPriceBookBtnHover - cannot change button hover appearance",null,{out:b})}}};ta.commerce.AvailDataWidget=new Class({Implements:[Options],options:{calendarOptions:{},argArray:[]},initialize:function(h,d,c,b,e,k){this.setOptions(k);if(h||window.event){h=new Event(h||window.event);if(h){h.stop()}}this.locId=d;this.ext=b;var j=null;if(this.ext){j="date_picker_adults_"+this.locId+this.ext}else{j="date_picker_adults_"+this.locId}this.adultField=ta.id(j);this.options.calendarOptions=Object.merge(this.options.calendarOptions,{ext:this.ext?this.ext:"",creatorElem:h&&h.target});var i=true;if(h){var g=ta.id(h.target);if(g&&(g.hasClass("out_date")||(ta.has("guests_rooms_picker_3.enabled")&&g.hasClass("outDateTrigger")))){i=false}}if(!(ta.page&&ta.page.usingUnifiedDates&&c==="adults")){this.calendar=new ta.widgets.SingleDateCalendar(this.options.calendarOptions,this.locId,e,this.options.argArray,i)}var a=ta.retrieve("adultFieldsMap");if(!a){a={}}if(this.adultField){this.adultsField=a[j];var f=this.adultField.getParent(".overlay");if(!this.adultsField||(f&&this.adultsField.parentOverlay!=f.overlay)){this.adultsField=new ta.widgets.AdultsField(this.adultField,this.locId,e,h);a[j]=this.adultsField;ta.store("adultFieldsMap",a)}}this.show(c);if(ta.widgets.calendar.trackCalendarObject){ta.widgets.calendar.trackCalendarObject(this)}},show:function(a){if(a=="calendar"&&this.calendar&&this.calendar.calendarOverlay){this.calendar.showCalendarOverlay()}else{if(a=="adults"&&this.adultsField){this.adultsField.adultsOverlay.show()}}if(ta.has("persistentFilters.showing")&&tabletOnFullSite&&this.calendar.calendarOverlay.container){this.calendar.calendarOverlay.container.setStyle("position","fixed")}},clear:function(){if(this.adultField){if(!ta.retrieve("meta_guests_field_v2.enabled")){ta.widgets.calendar.setPageAdultsCount(2)}ta.widgets.calendar.syncAllDatePickers()}this.calendar.clear()},getState:function(d){var b=this.calendar.getState();var a={adults:"2"};if(this.adultsField){a=this.adultsField.getState()}else{if(ta.widgets.calendar.getPageAdultsCount()){a={adults:ta.widgets.calendar.getPageAdultsCount()+""}}}var c=Object.merge(b,a);if(d){return c}return Object.toQueryString(c)}});ta.widgets.AdultsField=new Class({adultsSelRegex:/.*_(\d)\s*$/,adultsExRegex:/.*_\d+_(.*)$/,initialize:function(j,c,f){this.adultsField=j;this.crId=c;this.selectionFunction=f;var k=this.adultsField.getParent(".overlay");if(k){this.parentOverlay=k.overlay}var g=ta.overlays.ACTIVATE_CLICK;if(this.parentOverlay&&this.parentOverlay.container&&ta.id(this.parentOverlay.container).hasClass("persistentCR")){g=ta.overlays.ACTIVATE_NEVER}this.guestFieldLabel=this.generateGuestFieldLabel(this.adultsField.id);this.adultsOverlay=new ta.overlays.RelativeOverlayBelow({style:"dp",showCloseButton:false,noPadding:true,autoShow:false,offsetLeft:1,activate:g,onShow:this.onAdultsShow.bind(this),onHide:this.onAdultsHide.bind(this)},this.adultsField);this.adultsField.onclick=function(){};ta.id(this.adultsField).addEvent("click",this.adultsOverlay.show);var i=ta.id(this.adultsOverlay.container).getElement(".adults_pre_selected");try{this.count=ta.retrieve("date.picker.adultsCount");if(!this.count){this.count=this.adultsSelRegex.exec(i.id)[1]}}catch(h){}if(!this.count){this.count="2"}ta.widgets.calendar.setPageAdultsCount(this.count);var a=ta.id(this.adultsOverlay.container).getElements(".option");var d=this.adultSelect.bind(this);a.each(function(m,e){var l=function(n){d.pass([e+1,m,n.event])()};ta.id(m).addEvent("click",l)});var b=this.adultsField.clientWidth;b=b+"px";ta.id(this.adultsOverlay.container).setStyles({width:b});this.optionElems=a},generateGuestFieldLabel:function(c){var b=this.adultsExRegex.exec(c);var a=ta.retrieve("open_guest_field.servletName");if(!a){a=window.pageServlet}if(!b){if(!a){return""}else{if(a=="Hotel_Review"){return"Guest_HR"}else{if(a=="Hotels"){return"Guest_Hotels"}else{if(a=="ShowUserReviews"){return"Guest_Hotels"}else{return""}}}}return"Guests"}else{if(b[1]=="pop"){return"Guest_Flyout"}else{if(b[1]=="met"){return"Guest_MetaLightbox"}else{if(b[1]=="pto"){return"Guest_HR_PhotoLightbox"}else{if(b[1]=="amo"){return"Guest_HR_AmenitiesLightbox"}else{return""}}}}}},trackGuestFieldEvent:function(b,a){try{ta.trackEventOnPage("GuestPicker",b,a)}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.trackGuestFieldEvent")}},onAdultsShow:function(){try{if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}if(ta.id("PERSISTENT_DATE_PICKER")&&this.optionElems[0]&&this.optionElems[0].getParent("div.relative")){this.optionElems[0].getParent("div.relative").setStyles({"z-index":10001})}this.keyEventListener=this.onAdultsOverlayKeyDown.bind(this);document.addEvent("keydown",this.keyEventListener);this.adultsField.blur();var a=document.getElements(".date_picker_adults_option");if(a){Array.each(a,function(d){ta.id(d).removeClass("adults_selected");ta.id(d).removeClass("adults_pre_selected")})}if(ta.id(this.adultsField).getParent("#PERSISTENT_CHECK_RATES")){var b=ta.id(this.adultsField).getCoordinates().top;if(typeof(isIPad)=="undefined"||!isIPad){b=b-window.getScrollTop()}ta.id(this.adultsOverlay.container).setStyles({position:"fixed",top:b+29,zindex:9997})}this.count=ta.retrieve("date.picker.adultsCount");if(ta.retrieve("meta_guests_field_v2.enabled")){this.optionElems[this.count-1].addClass("adults_pre_selected");this.preSelectElem=this.optionElems[this.count-1]}if(ta.retrieve("meta_guests_field_v2.trackingEnabled")){this.trackGuestFieldEvent("Open",this.guestFieldLabel)}}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.onAdultsShow")}},onAdultsHide:function(){try{if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}if(this.keyEventListener){document.removeEvent("keydown",this.keyEventListener)}}catch(a){}},onAdultsOverlayKeyDown:function(a){if(a.key=="esc"){this.adultsOverlay.hide()}},adultSelect:function(e,d,c){ta.commerce.meta.tracking.resetAllTimingLocks();ta.commerce.meta.tracking.clearSuppressedAreas();ta.commerce.meta.polling.clearAllPollingInfo();this.updateValue(e,d.innerHTML);this.adultsOverlay.hide();var b=this.guestFieldLabel+"|"+this.count;if(ta.retrieve("meta_guests_field_v2.trackingEnabled")){this.trackGuestFieldEvent("Select",b)}if(!ta.widgets.calendar.hasPageDates()){return}if(this.selectionFunction){if(this.selectionFunction===ta.widgets.calendar.launchInlineMeta){this.selectionFunction.call(this,c)}else{this.selectionFunction.call(this,this.crId,this.adultsField)}}if(ta.commerce.metajson){ta.commerce.metajson.refetchAll()}if(typeof oxapp!="undefined"&&oxapp&&oxapp.context){var a=oxapp.context.get("TravelDates");if(a){a.save()}}if(ta.has("checkrates.meta_af")){ta.commerce.meta.loadMetaAF(this.crId,"AV_ABOVE_FOLD_META",false)}ta.widgets.calendar.trackCalendarEvent("DATEPICKER","CHANGE","GUESTS",e)},updateValue:function(a,b){this.count=a;this.adultsField.innerHTML=b;ta.widgets.calendar.setPageAdultsCount(this.count);ta.widgets.calendar.syncAllDatePickers();ta.widgets.calendar.justUpdateSessionAdults();var c=document.getElements(".adults");c.each(function(d){d.innerHTML=b})},getAdultsCount:function(){return this.count},getState:function(){return{adults:this.count+""}}});ta.commerce.meta.tracking={getTimingForNavArea:function(a){if(!a){return}var b=ta.commerce.meta.tracking.processNavArea(a);return ta.retrieve(b)},setTimingLockForNavArea:function(b,a){ta.store(b+"-LOCK",a)},isTimingLocked:function(b){var c=ta.commerce.meta.tracking.processNavArea(b);var d=ta.retrieve(c);if(!d){return false}var a=Date.now();if(a-d>=2000){ta.commerce.meta.tracking.resetTimingLockForNavArea(c);return false}return true},resetTimingLockForNavArea:function(a){var b=ta.commerce.meta.tracking.processNavArea(a);if(ta.retrieve(b+"-LOCK")){ta.remove(b+"-LOCK")}},resetAllTimingLocks:function(){var a=["QC_Meta_Inline","QC_Meta_Mini","QC_Meta_Metro","QC_Meta_Micro","QC_Meta_Lightbox"];for(var b=0;b<a.length;b++){ta.commerce.meta.tracking.resetTimingLockForNavArea(a[b])}},processNavArea:function(a){if(!a){return}if(a.indexOf("QC_Meta_Inline")===0){return"QC_Meta_Inline"}if(a.indexOf("QC_Meta_Mini")===0){return"QC_Meta_Mini"}if(a.indexOf("QC_Meta_Metro")===0){return"QC_Meta_Metro"}if(a.indexOf("QC_Meta_Micro")===0){return"QC_Meta_Micro"}if(a.indexOf("QC_Meta_Lightbox")===0){return"QC_Meta_Lightbox"}},setTimingForNavArea:function(c,b){if(!c){return}if(!b){b=Date.now()}var a=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.isTimingLocked(a)){return ta.commerce.meta.tracking.getTimingForNavArea(a)}ta.store(a,b);ta.commerce.meta.tracking.setTimingLockForNavArea(a,b);if(a=="QC_Meta_Inline"&&!ta.commerce.meta.tracking.containsSuppressedArea("QC_Meta_Mini")){ta.commerce.meta.tracking.setTimingLockForNavArea("QC_Meta_Mini",b)}return b},updateUrlWithTiming:function(b,a){if(!b||!a){return b}var c=ta.commerce.meta.tracking.setTimingForNavArea(a);if(!c){return b}if(b.contains("&metaRequestTiming=")){var d=new RegExp("(&|\\?)metaRequestTiming=[^&]*");b=b.replace(d,"&metaRequestTiming="+c)}else{b+="&metaRequestTiming="+c}return b},suppressImpressionsForArea:function(c){if(!c){return}var b=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.containsSuppressedArea(b)){return}var a=ta.retrieve("suppressed.areas");a.push(b);ta.store("suppressed.areas",a)},getSuppressedAreas:function(){var a=ta.retrieve("suppressed.areas");if(!a){a=[];ta.store("suppressed.areas",a)}return a},getSuppressedAreasAsString:function(){var b=ta.commerce.meta.tracking.getSuppressedAreas();var a="";if(b.length>0){for(var c=0;c<b.length;c++){a+=b[c]+";"}}return a},hasAnySuppressedAreas:function(){var a=ta.commerce.meta.tracking.getSuppressedAreas();return a.length>0},containsSuppressedArea:function(d){if(!d){return false}var b=ta.commerce.meta.tracking.processNavArea(d);var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var c=0;c<a.length;c++){if(a[c]==b){return true}}return false},removeSuppressedArea:function(e){if(!e){return}var b=ta.commerce.meta.tracking.processNavArea(e);var f;var c;if(ta.commerce.meta.tracking.containsSuppressedArea(b)){var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var d=0;d<a.length;d++){if(a[d]==b){c=d;f=true}if(f){a=ta.commerce.meta.tracking.removeElementByIndex(a,c);ta.store("suppressed.areas",a)}}}},removeElementByIndex:function(b,a){if(b&&a>=0&&a<b.length){b.splice(a,1)}return b},clearSuppressedAreas:function(){ta.store("suppressed.areas",[])},getTrackFunctionForSuggestedAccommodations:function(){var a=function(){var g=ta.widgets.calendar.getPageOutDate();var c="hotelsAccommodationGroupTracking";var f=ta.id(c);if(f){var e=f.getBoundingClientRect();if(e&&e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)){var d="Hotels on Tourism";var h="Impression";var b="dated";if(g===false){b="undated"}var i=ta.has("suggestedAccommodationsIsDmoSponsored")?1:0;ta.trackEventOnPage(d,h,b,i);window.removeEvent("scroll",a)}}};return a},getTrackFunctionForSuggestedVRs:function(){var a=function(){var g=ta.widgets.calendar.getPageOutDate();var c="vrsAccommodationGroupTracking";var f=ta.id(c);if(f){var e=f.getBoundingClientRect();if(e&&e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)){var d="VRs on Tourism";var h="Impression";var b="dated";if(g===false){b="undated"}var i=ta.has("suggestedAccommodationsIsDmoSponsored")?1:0;ta.trackEventOnPage(d,h,b,i);window.removeEvent("scroll",a)}}};return a}};ta.commerce.meta.polling={setPollingAttemptForRequest:function(a,b){var c=ta.commerce.meta.polling.getPollingMap();if(!b){b=1}c[a]=b;ta.commerce.meta.polling.setPollingMap(c)},getPollingAttemptForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){return b}}},getPollingWaitTimeForRequest:function(a){var b=ta.commerce.meta.polling.getPollingAttemptForRequest(a);return ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(b)},isRequestBeingPolled:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=a&&c[a];if(b){return true}return false},incrementPollingAttemptForRequest:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){b=b+1;c[a]=b}ta.commerce.meta.polling.setPollingMap(c);return b},clearAllPollingInfo:function(){ta.store("ta.meta.polling.map")},removePollingInfoForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var b=ta.commerce.meta.polling.getPollingMap();delete b[a];ta.commerce.meta.polling.setPollingMap(b)}},getPollingMap:function(){var a=ta.retrieve("ta.meta.polling.map");if(!a){a={};ta.store("ta.meta.polling.map",a)}return a},setPollingMap:function(a){if(a){ta.store("ta.meta.polling.map",a)}},getPollWaitTimeForPollingAttempt:function(a){if(typeOf(a)!=="number"||a<0){return 1000}switch(a){case 1:case 2:case 3:case 4:return 1000;case 5:case 6:case 7:return 1500;case 8:case 9:case 10:return 2000;case 11:return 5000;case 12:return 15000;default:return 30000}},getMaxPollingAttemptNumber:function(){return 13}};ta.commerce.meta.horizontalXSell=(function(){var k=10;var g=1000;var h=false;var c=null;var n=null;var l=null;var p=0;var f=function(q){if(q.contains("hacComplete")&&(q.contains("hacMiniOfferNotAvailable")||q.contains("hacMiniOfferUnavailable"))){return true}return false};var j=function(q){if(!a()){return false}if(!q.contains("hacMiniOfferUnavailable")){return true}return false};var e=function(t,w){try{if(ta.retrieve("ta.redirectingPage")||ta.retrieve("non_comm_hr_xsell_2014")){return}if(!w){p=0}c=new Date().getTime();var v=c;var u=ta.widgets.calendar.getCheckRatesData();if(!u){return}var r={};if(ta.meta&&ta.meta.update){r=ta.commerce.meta.getMetaParams()}var q=Object.merge(u,{detail:t,reqNum:w?"2":"1",type:"horizontal_hr"},r);var x=Object.toQueryString(q);if(!x||!x.trim()){ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - toQueryString failure",null,q);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:q,evalScripts:true,onSuccess:function(D){if(v!=c){return}var A=new Element("div",{html:D});var C=A.getElement(".xsellHacStatusReady")||A.getElement(".xsellHacStatusSOL")||w;if(ta.has("meta.full_meta_photos_v3")){D+='<div class="gap_spacer"></div>'}if(!C&&p<k){setTimeout(function(){p=p+1;e(t,true)},g)}else{var F=ta.id("HORIZONTAL_CROSS_SELL");var z=A.getElement(".metaMicro");if(F&&z){if(F.getElement(".metaMicro")){F.setContent(D)}else{F.setStyle("opacity","0");var E=new Fx.Tween(F,{property:"opacity"});F.setStyle("height",0);var B=122;var y=new Fx.Tween(F,{property:"height",onComplete:function(){F.setStyle("height","auto");F.setContent(D);E.start(0,1)}});y.start(0,B)}if(n){n()}d(true)}}},onFailure:function(){if(ta.retrieve("ta.redirectingPage")){return}ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(s){ta.util.error.record(s,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell")}};var i=function(q,r){if(!q||!q.getElement(".bc_flags")){return}var s=q.getElement(".bc_flags").className;if(j(s)){m()}else{if(f(s)){e(r,false)}}};var m=function(){var q=ta.id("HORIZONTAL_CROSS_SELL");var s=ta.id("HORIZONTAL_CROSS_SELL_LIST");var t=document.getElement("#HORIZONTAL_CROSS_SELL_LIST .lodging");if(q&&s&&t){var u=s.getSize().y;q.setStyle("height",u);var v=new Fx.Tween(s,{duration:200,property:"opacity",onComplete:function(){s.addClass("hidden");r.start(u,0).chain(function(){q.setStyle("height",0);q.innerHTML=""})}});v.start(1,0);var r=new Fx.Tween(q,{duration:"long",property:"height"});if(l){l()}d(false)}};var a=function(){return h};var d=function(q){h=q};var o=function(q){n=q};var b=function(q){l=q};return{updateHorizontalXSell:i,removeHorizontalXSell:m,isLoaded:a,setLoaded:d,setOnloadFunction:o,setOnRemoveFunction:b}}());ta.commerce.meta.horizontalXSellExtensions={putAvafBelowMap:function(){if(ta.commerce.meta.horizontalXSell.isLoaded()){return}var d=ta.id("AV_ABOVE_FOLD_META");var c=ta.id("RHS_MAP");var b=d.parentNode;if(d&&c&&b){var a=b.getElement(".bxDivider.map");if(a){b.insertBefore(a,d);b.insertBefore(c,a)}else{b.insertBefore(c,d)}}},putAvafAboveMap:function(){if(!ta.commerce.meta.horizontalXSell.isLoaded()){return}var c=ta.id("AV_ABOVE_FOLD_META"),b=ta.id("RHS_MAP"),a=c.parentNode;if(c&&b&&a){a.insertBefore(c,b)}}};if(!ta.meta){ta.meta={}}if(!ta.meta.link){ta.meta.link={}}(function(b){b.OPEN_IN_NEW_TAB="new_tab";b.OPEN_IN_SAME_TAB="same_tab";b.OPEN_IN_NEW_WINDOW="new_window";b.getUrlFromClickElem=function(r){if(!r){return null}var t=r.get("data-commerceClickData");if(!t||!t.trim||t.trim()===""||typeof asdf!=="function"){return null}t=asdf(t).replace(/&amp;/g,"&");var s=ta.retrieve("tracking.impression.key");if(r.hasClass("inlineOffer")&&s){var q=/ik=[a-zA-Z0-9]*/;t=t.replace(q,"ik="+s)}return t};b.getPartnerFromClickElem=function(r){if(!r){return null}var q=r.get("data-offerauthor");if(!q||!q.trim||q.trim()===""){return null}return q.trim()};b.animateAndClick=function(s,q){var r=q.hasClass("bookableOffer"),t=function(){b.click(s,q);var u=function(){j();ta.off("commerceClickAnimated",u)};ta.on("commerceClickAnimated",u)};ta.CommerceClickAnimation.addAnimation(t,{animateOnFocus:!r,squelchAnimation:true})};b.addToCartAndClick=function(r,q){b.click(r,q);j()};b.click=function(r,w){var x=ta.id(w),t,u,A,v,y,q,D,C,s,B;try{x=h(x);t=b.getUrlFromClickElem(x);if(!t){return}u=x.get("data-vendorName");A=x.get("data-offerauthor");v=x.get("data-locationId");y=b.getNavAreaFromClickElem(x);q=x.get("data-contentId");D=x.get("data-openBehavior");C=x.get("data-imageUrl");s=x.get("data-mcid");B=x.get("data-pernight");if(t&&u&&v){i(t,y,u,v,D,x,C,s,B,A)}else{m(null,"Invalid commerce click",t,y)}}catch(z){m(z,"Invalid commerce click",t,y)}setTimeout(function(){try{window.fireEvent("metaLinkClick",[x,u,y,v,q,D,ta.popups.PopUtil.extractSlotFromCommerceUrl(t)])}catch(E){m(E,"Commerce click tracking failed",t,y)}},300)};b.getNavAreaFromClickElem=function(u){var t=ta.id(u),q=t.get("data-navArea"),v,r;if(!q){v=t.get("data-navAreaPre");r=t.get("data-navAreaPost");q=p(v,u,r)}if(q){q=q.replace("+","|")}if(ta.browser.isIE10Metro()){q="QC_Meta_Metro_Lightbox"}if(u.getParent("#LOC_PHOTO_ALBUMS")){if(u.getParent(".featuredImageWrap")){q=q+"|PHOTOS_LB|Featured_Reel"}else{q=q+"|PHOTOS_LB"}}else{if(u.getParent("#AMENITY_LIGHTBOX")){q=q+"|AMENITIES_LB"}}a(q);var s=q;q=k(t);if(q==null||q.indexOf("null")!=-1||q.indexOf("Unknown")!=-1){q=s}return q};b.extractPageLocId=function(q){return b.urlArgNumeric(q,"d","detail")||b.urlArgNumeric(q,"g","geo")};b.urlArgNumeric=function(s,q,t){var r=new RegExp("(-"+q+"([0-9]+))|([?&]"+t+"=([0-9]+))");var u=r.exec(s);if(u){if(typeof u[2]!="undefined"){return u[2]}if(typeof u[4]!="undefined"){return u[4]}}return null};b.photoClick=function(r,u,s,q,t){if(s.hasOwnProperty("area")){s.area=b.getPhotoNavArea(r)}ta.util.Doer.aimdoit(u,s,q,t)};b.getPhotoNavArea=function(q){return k(q,{"data-navArea-metaType":"Pro_Photo","data-navArea-availability":"NA"})};b.updateNavAreaInCommerceUrl=function(t,q){if(q){var r=b.getNavAreaFromClickElem(q);var s=new RegExp("(&|\\?)area=[^&]*");t=t.replace(s,"$1area="+r)}return t};function i(w,u,C,B,x,s,G,A,D,F){var I=w;var J=new RegExp("(&|\\?)area=[^&]*");I=I.replace(J,"$1area="+u);if(crPageServlet){var v=new RegExp("(&|\\?)from=[^&]*");I=I.replace(v,"$1from=HotelDateSearch_"+crPageServlet)}var r=ta.commerce.meta.tracking.setTimingForNavArea(u);if(r&&s&&!s.hasClass("bookableOffer")){if(I.contains("&metaRequestTiming=")){var t=new RegExp("(&|\\?)metaRequestTiming=[^&]*");I=I.replace(t,"&metaRequestTiming="+r)}else{I+="&metaRequestTiming="+r}}if(A){I+="&m="+A}if(D){I+="&priceShown="+D}if(F){I+="&cpn="+F}if(document.location&&document.location.href){var H=b.extractPageLocId(document.location.href);if(H){I+="&pageLocId="+H}}var z;if(I.indexOf("&tp=")<0){var y=ta.analytics.getCommentTrackingPath(s);if(y&&y.length>0){z=y.getLast();if(z&&z.indexOf(":")===-1){I+="&tp="+z;var q=d(y,I,u);if(q){I+="&gn="+q}}else{m(null,"ibdm_cc: no placement found",I,u,"WARN")}}else{m(null,"ibdm_cc: no tracking path found",I,u,"WARN")}}var E=I.indexOf("/StartBooking")>=0;if(E){l()}if(ta.retrieve("commerce_history_injection_v2")&&!E){I="/NewWindowRedirect?url="+encodeURIComponent(I)}if(ta.has("assisted_booking_clicks_new_tab")&&x===b.OPEN_IN_NEW_TAB&&E&&ta.browser&&ta.browser.isIE10Metro()){x=b.OPEN_IN_SAME_TAB}if(ta.has("tablet_google_search_app_open_same_tab")&&/GSA\/[0-9]{2}/.test(window.navigator.userAgent)){x=b.OPEN_IN_SAME_TAB}if(E&&ta.page&&ta.page.maybeOpenInlineBooking&&ta.page.maybeOpenInlineBooking(z,B,s,null,I)){return}if(x===b.OPEN_IN_NEW_TAB){e(I,G,C,s)}else{if(x===b.OPEN_IN_SAME_TAB){c(I,s)}else{n(C,I,G)}}if(window.IS_DEBUG){ta.store("ta.lastCommerceClickUrl",I)}}function o(){try{document.domain=document.domain}catch(q){return true}return false}function d(r,u,A){var q="groups";var E="_NavCart";var C="MyCartTab";var s="V:HG-1.1";var D=-1;var z=0;var t;var y;var w=r.getLast();var B=r[r.length-2];var v;var x;if(!r){return}if(r.length<5){return}if((w.indexOf(E)!==(w.length-E.length))&&w!==C){return}if(B.indexOf(s)!==0){return}for(y=r.length-1;y>=0;y--){if(!r[y]){continue}z=0;t=r[y];if(t===q&&D===-1){v=y;for(v=y-1;v>=0;v--){t=r[v];if(t.indexOf("N:")===0){z++;if(D===-1){D=v}}}}if(D!==-1){break}}if(z>=3&&D>0){t=r[D];x=t.split(":");if(x.length===2){return x[1]}else{m(null,"ibdm_cc: no group node found",u,A,"WARN")}}}function l(){if(!ta.has("ib_qualaroo_surveys")||(window.pageServlet!=="Hotels"&&window.pageServlet!=="Hotel_Review")||!ta.qualaroo){return}try{var q=window.pageServlet!=="Hotels"?"HOTEL_REVIEW":"HOTELS",r="IB_QUALAROO_SURVEYS_"+q;ta.qualaroo.forceDisplaySurvey("force",r,false)}catch(s){ta.util.error.record(s,"Unable to display Qualaroo survey")}}b.showQualarooSurvey=l;function e(v,r,u,s){var t=o(),q=window.open(t?v:"","_blank");if(!q&&typeof(Browser)!=="undefined"&&Browser.ie&&ta.has("ta.ie_commerce_popup_block_fix")&&ta.has("assisted_booking_clicks_new_tab")&&v.indexOf("/StartBooking")>=0){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38822)}c(v,s);return}!t&&ta.popups.PopUtil.redirectToUrl(q,v);ta.popups.PopUtil.pollForPartnerLoad(q,new Date(),u,ta.popups.PopUtil.extractSlotFromCommerceUrl(v))}function c(t,r){ta.meta.treeTrack.logTrackingTreeClickEvtCookie(t,r);if(ta.meta&&ta.meta.treeTrack){var s=function(){f(t)};if(r&&r.getParentBySelector(".metaCheckRatesOverlay")!=null){ta.meta.treeTrack.logLightboxTreeImpression(s)}else{if(ta.meta.treeTrack.isInitialized()){try{ta.meta.treeTrack.logTreeImpression(s)}catch(q){ta.util.error.record(q," Error in openMetaProviderSameTab");f(t)}}}}else{f(t)}}function f(q){if(ta.retrieve("ta.isIE11orHigher")){window.open(q,"_self",null,false)}else{window.location.href=q}}function n(w,v,s){var q=w,u=ta.popups.PopUtil.getProviderWindowDims(q,true),r=1,t;if(window&&window.chrome){r=0}t={customWidth:u.customWidth,customHeight:u.customHeight,widthOffset:u.widthOffset,heightOffset:u.heightOffset,name:q,url:v,scrollbars:r,providerLogo:s};ta.popups.PopUtil.createCheckRatesWindow(t)}function a(q){var r=ta.retrieve("ta.meta.navArea");if(!r||r.indexOf(q)<0){ta.store("ta.meta.navArea",q)}}function p(q,u,r,t){var v="";if(u.getParent(".persistentCR")){v=(t)?"|PCR":"PCR"}else{if(u.getParent(".photosOverlay")||u.getParent("#LOC_PHOTO_ALBUMS")){v=(t)?"|Photo_Lightbox":"Photo_Lightbox"}else{if(u.getParent(".amenities_lightbox")){v=(t)?"|Amenities_Lightbox":"Amenities_Lightbox"}else{if(u.getParent("#CHECK_RATES_LB")){v=(t)?"|Photo_LB":"Photo_LB"}}}}v=v?"|"+v:"";q=q?q:"";v=v?v:"";r=r?r:"";var s=[q,v,r].join("|").replace("||","|").replace(/(\|$)/g,"");return s}function m(t,s,u,r,q){ta.util.error.record(t,s,null,{servlet:window.pageServlet,url:u,area:r},q)}function k(r,s){var v;var u={"data-navArea-metaType":null,"data-navArea-linkType":null,"data-navArea-availability":null,"data-navArea-placement":null};var t=4;if(s){for(v in u){if(s.hasOwnProperty(v)){u[v]=s[v];t--}}}var w=null;while(r&&t>0){for(v in u){if(u[v]===null){u[v]=r.get(v);if(u[v]!==null){if(u[v]==="@trigger"){w=r}t--}}}r=r.getParent()}while(u["data-navArea-placement"]==="@trigger"&&w){while(w&&!w.overlay){w=w.getParent()}if(w&&w.overlay.options&&w.overlay.options.trigger){w=w.overlay.options.trigger}else{w=null;u["data-navArea-placement"]="null"}while(w){u["data-navArea-placement"]=w.get&&w.get("data-navArea-placement");if(u["data-navArea-placement"]!==null){break}w=w.getParent()}}var q=[];for(v in u){q.push(u[v]?u[v]:"null")}if(window.isTabletOnFullSite){q.push(g()?"Portrait":"Landscape")}else{q.push("Desktop")}return q.join("|")}function g(){if(ta.common&&ta.common.tablet){return ta.common.tablet.isPortrait()}return window.matchMedia&&window.matchMedia("(orientation: portrait)")&&window.matchMedia("(orientation: portrait)").matches}function h(r){if(!r||r.isVisible()){return r}var t=r.get("data-locationid");var u=r.get("data-contentid");var q=".offer";if(r.hasClass("bookableOffer")){q=q+'.bookableOffer[data-locationid="'+t+'"]'}else{q=q+'[data-locationid="'+t+'"][data-contentid="'+u+'"]'}var s=document.getElement(q);if(s){return s}return r}function j(){if(!ta.NavAbandonedCart){return}ta.NavAbandonedCart.udpate()}})(ta.meta.link);if(!ta.meta){ta.meta={}}if(!ta.meta.linkTracking){ta.meta.linkTracking={}}(function(e){e.setup=function(){try{ta.util.customEvent.addListener("metaLinkClick",window,j)}catch(k){ta.util.error.record(k,"trouble building event - metaLinkClick")}};e.actionRecord=function(k){new Request({url:"/ActionRecord?action="+k}).send()};e.restoreCRPageServlet=function(){var k=ta.retrieve("crPageServlet_orig");if(k){window.crPageServlet=k}};function j(l,r,k,p,q,o){g(r,k,p,o);ta.trackCommerceClickForInsight(l);b(l,q);d(l);i(l,q);if(!l.hasClass("bookableOffer")){var n=l.dataset?l.dataset.pernight:"";a(p,true,q,n)}if(l&&ta.retrieve("hotels_lists_engagement_tracking.enabled")){var m=l.hasClass("bookableOffer")?"Sherpa":"Meta";ta.fireEvent("hotels_lists_engagement_tracking.fired",{type:m,element:l})}if(o!=ta.meta.link.OPEN_IN_SAME_TAB){h(l)}}function h(k){if(ta.meta&&ta.meta.treeTrack){if(k&&k.getParentBySelector(".metaCheckRatesOverlay")!=null){ta.meta.treeTrack.logLightboxTreeImpression()}else{if(ta.meta.treeTrack.isInitialized()){ta.meta.treeTrack.logTreeImpression()}}ta.meta.treeTrack.logTrackingTreeClickTrk(k)}}function a(o,m,p,k){try{var l={locId:o,isMetaCheckRates:m,contentId:p,selectedPrice:k};ta.common.ads.loadClickoutMonikers(l)}catch(n){ta.util.error.record(n,"click out monikers failure (meta="+m+")")}}function g(p,l,o,n){var m="CheckRates";var q=1;ta.trackPhysicalCommerce(m,l,q,o);ta.trackAttemptedCommerce(m,l,p,q);var k=n?(n===ta.meta.link.OPEN_IN_NEW_TAB?"TAB_OPENED":(n===ta.meta.link.OPEN_IN_NEW_WINDOW?"WINDOW_OPENED":"SAME_TAB")):"";ta.trackEventOnPage("COMMERCE_CLICK",k,(p||""))}function i(m,n){var o=m.getParent("#HotelDateSearch");if(o){var l="bcMetaLowestPriceCTA";var p="BlueChevron_LP_CTA_Click";if(ta.has(l)){var t=ta.retrieve(l);if(t.hasOwnProperty("idx")&&t.hasOwnProperty("provider")){try{var r=f(o);var k=null;for(var q=0;q<r.length;q++){if(n==r[q]){k=q}}if(k){ta.trackEventOnPage(p,t.idx,k,0,false)}}catch(s){ta.util.error.record(s,"error logging blue chevron lowest price click info")}}}}}function b(l,m){var n=l.getParent("div#PROVIDER_BLOCK")||l.getParent("div#PROVIDER_BLOCK_INLINE");if(n){var u=(n.id=="PROVIDER_BLOCK_INLINE")?true:false;var q=(u)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";var o=(u)?"Meta_LP_CTA_Click_Inline":"Meta_LP_CTA_Click";if(ta.has(q)){var s=ta.retrieve(q);if(s.hasOwnProperty("idx")&&s.hasOwnProperty("provider")){try{var r=c(n);var k=null;for(var p=0;p<r.length;p++){if(m==r[p]){k=p}}if(k){ta.trackEventOnPage(o,s.idx,k,0,false)}}catch(t){ta.util.error.record(t,"error logging lowest price click info")}}}}}function c(p){var m=[];m[0]=-1;try{if(p){var l=p.getElements(".jsPrvdr");for(var k=0;k<l.length;k++){var o=l[k]&&ta.id(l[k]).get("data-contentid");if(o){m.push(o)}}}}catch(n){ta.util.error.record(n,"error scraping meta providers")}return m}function f(p){var m=[];m[0]=-1;try{if(p){var l=p.getElements(".offer");for(var k=0;k<l.length;k++){var o=l[k]&&ta.id(l[k]).get("data-contentid");if(o){m.push(o)}}}}catch(n){ta.util.error.record(n,"error scraping blue chevron providers")}return m}function d(l){var r=ta.id(l);try{var q=r.get("data-offer-author");if(!q){return}var t=null,k=null;var n=r.getParent(".overlay .skv3");var s=r.getParent(".mapsv2-listitem")||r.getParent(".mapsv2-dropdownlist");if(s&&s.get("data-sponsor")){t=s.get("data-sponsor");k=s.get("data-sponsor-provider")}else{if(n&&n.hasAttribute("data-sponsor")&&pageServlet){t=n.get("data-sponsor");k=n.get("data-sponsor-provider")}else{var m=ta.id("mapsv2-sponsordetail");if(m&&m.get("data-sponsor")){t=m.get("data-sponsor");k=m.get("data-sponsor-provider")}}}if(k&&q==k){var p=(pageServlet=="LocalMapsRedesign")?"LocalMap":(pageServlet=="HACSearch"||pageServlet=="Hotels")?"HACMap":"FloatingMap";ta.trackEventOnPage(p,"sponsor_cr_sent",t)}}catch(o){ta.util.error.record(o,"Error while trying to log map sponsored provider clicks")}}})(ta.meta.linkTracking);if(!ta.meta.treeTrack){ta.meta.treeTrack={}}(function(e){var d=false;var b={hotelListSelector:null,singleHotelSelector:null,placementName:null,getImpressionString:null};var c="ibdm_impression_tracking";e.init=function(h){if(d){ta.util.error.record(null,"ta.meta.treeTrack should be initialized only once");return false}b=h;d=true};e.isInitialized=function(){return d};e.hasTrackingTree=function(h){if(!h||typeof h.previousSibling==="undefined"){return false}var i=h.previousSibling||h.nextSibling;if(i){if(f(i)){return true}return f(i.previousSibling)}return false};var f=function(i){if(i){var h=i.nodeValue;return h&&(h.contains("trk")||h.contains("etk"))}return false};e.logImpressionTreeOnPageLoad=function(){if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&ta.widgets.calendar.hasPageDates()&&!ta.retrieve("vrTabOnHotels")){var i=1;var k=4;var h;if(!ta.retrieve("treeTrackImpressionInProgess")){ta.store("treeTrackImpressionInProgess",true);var j=setInterval(function(){if(ta.retrieve("isTrackTreeFresh")){h=e.logTreeImpression(null,(i<k))}if(!h&&i<k){i++}else{ta.store("isTrackTreeFresh",false);ta.store("treeTrackImpressionInProgess",false);clearInterval(j)}},2000)}}};e.logTreeImpression=function(k,j){if(!ta.retrieve(c)||ta.retrieve("vrTabOnHotels")){if(k){k()}return false}if(!d){ta.util.error.record(null,"ta.meta.treeTrack.logTreeImpression called before being initialized");if(k){k()}return false}var h=a();var i=b.getImpressionString(h);if(!i&&h<=0){if(k){k()}return false}if(i&&i.indexOf("I:IllegalContext")===-1){ta.recordImpression(i,k);return true}else{if(!j){ta.util.error.record(null,"ta.meta.treeTrack.logTreeImpression called but no tracking tree html found!",null,{},"WARN")}}if(k){k()}return false};e.logLightboxTreeImpression=function(i){if(!ta.retrieve(c)){if(i){i()}return false}var h=g();if(h){ta.recordImpression(h,i);return true}if(i){i()}};var g=function(){var h=$$(".metaCheckRatesOverlay .impressionTrackingTree");if(h){return h[0].innerHTML}};e.getElmtPriceData=function(h){var i=[];if(!h){return i}var j="PP:";if(h.getAttribute("data-pernight")){j+=h.getAttribute("data-pernight")}else{j+="-1"}i.push(j);var k="PN:";if(h.getAttribute("data-offer-author")){k+=h.getAttribute("data-offer-author")}else{k+="None"}i.push(k);return i};e.logTrackingTreeClickTrk=function(h){if(!ta.retrieve(c)){return}if(e.hasTrackingTree(h)){if(h.hasClass("bookableOffer")){ta.trk("sherpa_click",false,h)}else{var i=e.getElmtPriceData(h);ta.trk("meta_click",false,h,i)}}};e.logTrackingTreeClickEvtCookie=function(i,h){if(!ta.retrieve(c)){return}if(e.hasTrackingTree(h)){if(h.hasClass("bookableOffer")){ta.setEvtCookieAndPath("sherpa_click",i,h)}else{ta.setEvtCookieAndPath("meta_click",i,h)}}};e.getElmtHeight=function(h){if(h){return h.offsetHeight}};function a(){if(!b.hotelListSelector||!b.singleHotelSelector){return 0}var i=0;var h=0;var j=document.getElements(b.hotelListSelector);j.each(function(k){k.getElements(b.singleHotelSelector).each(function(l){if(l.match(b.singleHotelSelector)){i++;if(l.isFullyVisible()){h=i}}})});return h}})(ta.meta.treeTrack);if(!ta.meta.update){ta.meta.update={}}ta.util.customEvent.addListener("newInlinePageDates",window,function(b,a){ta.meta.update.request(b,a)});(function(n){var b="miniMetaHacRequest_longTimeoutKey";var f="miniMetaHacRequest_appearLoadedTimeoutKey";n.request=function(y,x){l(y);w(y,x)};n.completeOnInitialPage=function(x){a(true,"",x)};n.buildUrl=function(E,N,L,D,U,I,F,B,C,x){var y=e(U),G=ta.widgets.calendar.getCheckRatesData(),V="",M="",P="",K="",J="";if(G){V=Object.toQueryString(G)}if(D){M="&metaVersion="+D}if(ta.has("meta.baseLocationId")){P="&baseLocId="+ta.retrieve("meta.baseLocationId")}if(ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")||ta.retrieve("checkrates.hr_bc_see_all_click")||(ta.retrieve("checkrates.hr_bc_see_all_click.lb")&&E==="MetaCheckRatesAjax")){K="&seeAllClick=true"}if(window.pageServlet){J="&imp=true&metaReferer="+window.pageServlet}var Q=ta.retrieve("meta.requestFromArea");if(!Q){Q="";if(document.getElement("#LOC_PHOTO_ALBUMS")){Q="&requestFromArea=pal"}else{if(document.getElement("#AMENITY_LIGHTBOX")){Q="&requestFromArea=amo"}}ta.store("meta.requestFromArea",Q)}var A="/"+E+"?detail="+N+"&"+V+"&area="+y+"&returnAllOffers=true"+J+M+P+K+Q,O=A;try{A=ta.commerce.meta.tracking.updateUrlWithTiming(A,y)}catch(T){ta.util.error.record(T,"problem updating url with timing in CheckRates.buildVarMetaHacUrl");A=O}if(ta.commerce.meta.tracking.hasAnySuppressedAreas()){var R=ta.commerce.meta.tracking.getSuppressedAreasAsString();if(R){A+="&suppressImpressionsOnComplete="+R}}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){O=A;try{A=m(A,C);if(!A){A=O}}catch(T){ta.util.error.record(T,"problem updating url with isFirstPageLoad in CheckRates.buildVarMetaHacUrl");A=O}}if(L){A+="&finalRequest=true"}if(I){A+="&numTries="+I}if(B){A+="&loadingTimeoutPassed="+B}if(x){A+="&isDateChangedRequest="+x}if(ta.maps&&ta.maps.mapsponsor){var z=ta.maps.mapsponsor.getSponsorForLocation(N);if(z){A+="&mapSponsorship="+z}}var S="ta.commerce.MetaHacOverlay.currency";if(ta.has(S)){A+="&currency="+ta.retrieve(S);ta.remove(S)}var H=ta.retrieve("booking.tracking.context");if(H){A+="&btc="+H}return A};n.overlayRequest=function(R,T,Z,O,G){var Q,D="metaHacRequest_curCancelKey",I,L,E,X,A,P,M,V,y=13,U,x,C,K,F,N,H;try{if(!R){return}ta.commerce.meta.clearStoredMiniData();I=ta.widgets.calendar.getCheckRatesData();if(T==null){ta.store("meta.travelData",I);T=new Date().getTime();L=false;if(Z){if(ta.has("metaCheckRatesUpdateDivInline")){L=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}else{if(ta.has("metaCheckRatesUpdateDiv")){L=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}}if(L&&L.removeClass){L.removeClass("hidden")}}E="metaHacRequest_"+T+"_cancel";if(ta.has(D)){X=ta.retrieve(D);if(X!=E){ta.store(X,true);ta.commerce.meta.polling.removePollingInfoForRequest(X)}}if(Z){A=document.getElement(".meta_rates_content .postShowMetaCR");if(ta.has("checkrates.mini_meta_by_percent_cpc")&&ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")){P=A.getElement(".seeMore.threshold");if(P){M=A.getElements(".postClickPrice.hide");M.each(function(aa){aa.removeClass("hide")});P.hide()}}ta.commerce.meta.updateProvArea(A)}if(!ta.has(E)){ta.store(E,false);ta.store(D,E)}if(ta.retrieve(E)===true){return}V=ta.retrieve("metaCheckRatesOverlay");if(!V&&!Z){return}Q=false;if(V){Q=V.inner}if(ta.has("metaCheckRatesUpdateDiv")){Q=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(Z&&ta.has("metaCheckRatesUpdateDivInline")){Q=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}catch(W){ta.util.error.record(W,"overlayRequest setup")}if(!Q){return}try{if(ta.commerce.meta.polling.isRequestBeingPolled(E)){U=ta.commerce.meta.polling.getPollingAttemptForRequest(E);if(!U||U>y){ta.commerce.meta.polling.removePollingInfoForRequest(E);return}}else{U=1;ta.commerce.meta.polling.setPollingAttemptForRequest(E,U)}if(!Q.innerHTML.contains("hacComplete")){x=false;if(Z){x="QC_Meta_Inline"}if(!O){O=1}var J=ta.meta.update.buildUrl("MetaCheckRatesAjax",R,true,G,x,O);setTimeout(function(){new Request({url:J,onSuccess:function(aa){if(ta.retrieve(E)){return}if(ta.retrieve("metaCheckRatesOverlay")||ta.retrieve("metaCheckRatesUpdateDivInline")){Q.innerHTML=aa;ta.fireEvent("refreshedDOMContent",Q);if(ta.retrieve("checkrates.meta_ui_sk_box")){ta.commerce.meta.restoreProviderHover()}}if((ta.meta.update.getMetaPricesCount(Z)>0||U>9)&&ta.commerce.meta.hacIsBlockingXSell(Z)){if(Z){ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}ta.commerce.meta.polling.incrementPollingAttemptForRequest(E);ta.meta.update.overlayRequest(R,T,Z,O+1,G)},evalScripts:true}).send()},ta.commerce.meta.polling.getPollingWaitTimeForRequest(E))}else{try{ta.commerce.meta.polling.removePollingInfoForRequest(E);C=ta.id("META_HAC_DATE_HEADLINE");if(C){var Y=C.getElements(".headlineLegend");if(Y.length>=2){Y.forEach(function(aa){aa.addClass("hidden")});if(Q.getElement(".anyOfferCompletedSuccessfully")){Y[0].removeClass("hidden");if(ta.retrieve("lightbox_improvements")){ta.commerce.meta.hideBestPriceXsell("REC_CONT")}}else{if(Q.getElement(".partnersAllNotAvailable")&&ta.retrieve("lightbox_improvements")&&Y.length>2){Y[2].removeClass("hidden");if(Z){ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT_INLINE",{isInline:true});ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{var B={isMetaLighboxV3:ta.retrieve("meta_lightbox_v3.enabled")};if(!ta.id("META_PRICE_XSELL")){ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT",Object.merge(B,{isInline:false}))}ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}else{Y[1].removeClass("hidden");if(ta.retrieve("lightbox_improvements")){ta.commerce.meta.hideBestPriceXsell("REC_CONT")}}}}if(!ta.retrieve("lightbox_improvements")){if(Z){ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT_INLINE",{isInline:true});ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT",{isInline:false});ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}}if(V){ta.commerce.meta.storeMiniData(V.inner)}if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&Q){var S=Q.getElement(".impressionTrackingTree");if(S){ta.trkImpTree(S)}}K=i(Q);N="complete";if(Z){if(ta.id("COMHVY")){F="Mini-Meta";if(ta.find(".NotShowing .postClickPrice")){N+="_may_be_available"}else{if(ta.find("#HotelDateSearch .price .minCost")){if(ta.find(".strikeHigh")){N+="_available_lp_chevron"}else{N+="_available"}}else{N+="_unavailable"}}}else{F="Metainline"}}else{F="meta_lightbox"}if(Q.innerHTML.contains("doneNoAvailability")){ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_EMPTY",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount());if((ta.id("MAYBE_BUTTONS_INLINE")&&Z)||(ta.id("MAYBE_BUTTONS")&&!Z)&&F!="Mini-Meta"){N+="|may_be_availabile"}else{if(F!="Mini-Meta"){N+="|unavailable"}}}else{ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_PRESENT",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount())}ta.trackEventOnPage(F,N,K.toString());ta.commerce.meta.showLowestPriceCTA(Z);window.fireEvent("MetaLightboxHacComplete");H=ta.find(".overlay .skv3");if(H&&H.hasAttribute("data-sponsor")){var z=H.getAttribute("data-sponsor");ta.maps.ads.injectMetaLightBoxAd(z)}}catch(W){ta.util.error.record(W,"overlayRequest - failure in complete results block")}}}catch(W){ta.util.error.record(W,"meta HAC - ajax requests")}};n.displayRemainingProviders=function(A){try{var z=ta.id("CHECK_RATES_CONT");var y=z.getElements("li");for(var x=y.length;x--;){y[x].removeClass("hide")}A.hide();ta.store("checkrates.mini_meta_by_percent_cpc_see_all_click",true)}catch(B){ta.util.error.record(B,"displayRemainingProviders")}};n.updateCRForm=function(x){try{if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers();return}var J=ta.id("HotelDateSearch"+x);var I=ta.id("HotelDateSearch");var B=["select","input[type=checkbox]","input[type=hidden]","input[type=text]"];if(J&&I){for(var E=B.length;E--;){var z=B[E];var L=I.getElements(z);var A=J.getElements(z);for(var D=A.length;D--;){var K=A[D];var H=K.id.split("_")[0];for(var C=L.length;C--;){var G=L[C];if(G.id.contains(H)){if(z=="input[type=checkbox]"){var M=G.getParent("li");if(M&&!M.hasClass("unavailable")){var y=K.getParent("li");if(y){y.removeClass("unavailable")}}}if(z=="select"){K.selectedIndex=G.selectedIndex}else{if(z=="input[type=checkbox]"&&x!="_pop"){K.checked=G.checked}else{if(!K.id.contains("hacPid")){K.value=G.value}}}}}}}}}catch(F){ta.util.error.record(F,"updateCRForm")}};n.getMetaPricesCount=function(x){var z=0,B;var y=ta.retrieve("metaCheckRatesOverlay");var A=false;if(y){A=y.inner}if(ta.has("metaCheckRatesUpdateDiv")){A=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(x&&ta.has("metaCheckRatesUpdateDivInline")){A=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}if(!A){return}B=A.getChildren("#HR_HACKATHON_CONTENT .roomPrice");if(B){z=B.length}return z};function c(C){var B=ta.id("PROVIDER_BLOCK");if(!B){return}if(typeof CDNHOST!="undefined"){var A='<img class="provLoading" src="'+CDNHOST+'/img2/meta_sprites/loadingAnim.gif">';B.getElements(".rightBox").each(function(D){D.setContent(A)})}var y=B.get("html");var x=1000;var z="metaHacRequest_"+x+"_cancel";ta.remove(z);new Request({url:ta.meta.update.buildUrl("MetaCheckRatesAjax",C,true),onSuccess:function(D){B.setContent(D);ta.fireEvent("refreshedDOMContent",B);ta.meta.update.overlayRequest(C)},onFailure:function(){B.setContent(y)}}).send()}function w(y,x){if(x=="pop"){ta.store("ta.meta.request.locId",y);ta.store("ta.meta.request.placement",x);ta.run("ta.overlays.Factory.metaCheckRatesOverlay")}else{if(x=="met"||x=="solb"){if(!ta.has("meta.widget")){c(y)}}}}function i(z){var A;var B;var x=0;var y=0;z=ta.id(z);B=z.getChildren("#HR_HACKATHON_CONTENT .roomPrice");A=z.getChildren("#HR_HACKATHON_CONTENT .textLinks .offer .price");if(B){x=B.length}if(A){y=A.length}return x+y}function l(B,E,J,I){if(ta.retrieve("tablet_maps_v1")&&ta.retrieve("maps_v2_open")){return}if(!J){J=0}if(!I){I=false}var F="miniMetaHacRequest_curCancelKey";var D=13;if(E==null){E=new Date().getTime()}var C="miniMetaHacRequest_"+E+"_cancel";if(ta.retrieve(C)===true){return}if(ta.has(F)){var L=ta.retrieve(F);if(L!=C){ta.store(L,true);ta.commerce.meta.polling.removePollingInfoForRequest(L)}}if(!ta.has(C)){ta.store(C,false);ta.store(F,C)}var K;if(ta.commerce.meta.polling.isRequestBeingPolled(C)){K=ta.commerce.meta.polling.getPollingAttemptForRequest(C);if(!K||K>D){ta.commerce.meta.polling.removePollingInfoForRequest(C);return}}else{K=1;ta.commerce.meta.polling.setPollingAttemptForRequest(C,K)}var y=[];if(I){var H=$$("#CHECK_RATES_CONT div.premium:not(.tripConnectDemo)");for(var A=0;A<H.length;A++){var z=H[A].get("data-contentid");y.push(parseInt(z,10))}}if(J<1){var G;if(ta.has(b)){G=ta.retrieve(b);clearTimeout(Number.from(G))}if(ta.has(f)){G=ta.retrieve(f);clearTimeout(Number.from(G))}G=setTimeout(function(){u()},ta.commerce.minimeta.ajax.MINI_META_STOP_LOADING_TIMEOUT);ta.store(b,Number.from(G))}var x=ta.retrieve("hotels.datesChanged");if(x&&ta.has("hac_timezone_awareness")){n.clearDatesBumpedMessage()}new Request({url:ta.meta.update.buildUrl("MiniMetaCRAjax",B,true,null,"QC_Meta_Mini",J,y,I,C,x),onSuccess:function(M){a(false,M,B,E,J,I,C,x)},evalScripts:true}).send()}n.clearDatesBumpedMessage=function(){var y=ta.id("HAC_DATES_MOVED_FORWARD");var x=document.getElement("#CHECK_RATES_CONT .legend.metaDatesChosen");if(y&&x){y.dispose();x.removeClass("hidden")}};function d(x){x.getChildren().each(function(y){var z=y.getAttribute("data-targetEvent");if(z){ta.fireEvent(z,y)}})}function a(H,I,O,R,K,y,C,x){if(ta.retrieve(C)===true){return}var F,W,M,J,Z;if(H){var U=ta.select("#CHECK_RATES_CONT fieldset")[0];I=U.get("html");F=new Element("div",{html:I});W=true;M=document.getElement(".similarCarousel");J=F.getChildren()}else{F=new Element("div",{html:I});d(F);W=I.contains("hacMiniComplete");M=document.getElement(".similarCarousel");J=Elements.from(I)}if(!M||K<1){ta.commerce.meta.updateProvArea(F.getElement(".postShowMetaCR"));window.fireEvent("miniMetaOnHRUpdate",I)}if(!document.getElement(".dropdownMiniMeta")){var A=document.getElement(".postShowMetaCR");if(A){h(I,A)}}v(I);if(ta.retrieve("hotel_review_low_price_message")&&F.getElement(".price_alert_update")){var X=document.getElement("#PRICE_ALERT_RIBBON_CONTAINER");if(X){Z=X.getElementById("PRICE_ALERT_RIBBON");if(Z){Z.destroy()}Z=F.getElement(".price_alert_update").getElement(".price_alert_ribbon")||F.getElement(".price_alert_update").getElement(".ui_ribbon");if(Z){X.innerHTML=Z.outerHTML;ta.util.element.makeTextFitOneLine("#PRICE_ALERT_RIBBON",false);var L=Z.getElement(".priceAlertText b");if(W&&L&&L.innerHTML&&L.innerHTML.length>0){ta.trackEventOnPage("hotel_review_low_price_message","Display",L.innerHTML)}}}ta.fireEvent("priceAlertRibbonUpdated")}if(W&&!I.contains("bookableOffer")){window.fireEvent("hacComplete_noBookingOffersFound")}if(W||y){if(I.contains("bookableOffer")){window.fireEvent("hacComplete_bookingOffersFound")}}var N=ta.id("HR_META_INTERSTITIAL");if(N){var T=document.getElement("#HR_HACKATHON_CONTENT fieldset");if(T){if(K<1&&!H){ta.store("show_hr_meta_interstitial",true);window.setTimeout(function(){ta.store("show_hr_meta_interstitial",false);N.addClass("hidden");T.removeClass("hr_meta_loading_hidden")},2000);T.addClass("hr_meta_loading_hidden");var G=document.getElement("#HR_HACKATHON_CONTENT .metaExplanation");if(G){G.addClass("hidden")}N.removeClass("hidden")}else{if(!N.hasClass("hidden")&&(!ta.retrieve("show_hr_meta_interstitial")||W)){N.addClass("hidden");T.removeClass("hr_meta_loading_hidden")}}}}if(ta.has("meta.isHackathonBC")&&!ta.has("hr_unavail_xsell_flyout")){ta.commerce.meta.horizontalXSell.updateHorizontalXSell(F,O)}if(!W&&ta.has("meta.isHackathonBC")&&I.contains("firstRequest")){var D=setTimeout(function(){r(O,R,K)},ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT);ta.store(f,Number.from(D))}if(W&&ta.has(f)){var B=ta.retrieve(f);clearTimeout(Number.from(B))}var E=".metaDatesChosen",Y=".metaDatesChosen",V=ta.retrieve("meta.bc.bestPricesForYourStay");if(!W){if(ta.has("meta.isHackathonBC")&&I.contains("anyOfferCompletedSuccessfully")){ta.commerce.meta.updateHeaderMsg(Y,V);if(ta.has("guests_rooms_picker_3.enabled")){ta.commerce.meta.updateHeaderDates()}}if(ta.has("guests_rooms_picker_4.enabled")&&ta.overlays&&ta.overlays.NumberPickerOverlay){ta.overlays.NumberPickerOverlay.updateHeaderMsg(E)}ta.commerce.meta.polling.incrementPollingAttemptForRequest(C);setTimeout(function(){l(O,R,K+1,y)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(C))}else{if(ta.has("meta.isHackathonBC")){var S=V;if(I.contains("allNotAvailable")){var P=ta.id("priceNotAvailMsg");if(P){S=P.innerHTML}else{S=ta.retrieve("meta.bc.pricesTravelSitesNotAvailDates")}}ta.commerce.meta.updateHeaderMsg(Y,S);if(ta.has("guests_rooms_picker_3.enabled")){ta.commerce.meta.updateHeaderDates()}if(ta.has("guests_rooms_picker_4.enabled")&&ta.overlays&&ta.overlays.NumberPickerOverlay){ta.overlays.NumberPickerOverlay.updateHeaderMsg(E)}if(ta.retrieve("meta.full_meta_photos")){var z=document.getElement(".metaDatesChosen");if(z){if(I.contains("allNotAvailable")){z.addClass("no_offers_available")}else{z.removeClass("no_offers_available")}}}ta.commerce.meta.polling.removePollingInfoForRequest(C);ta.commerce.meta.displayBlueChevronLowestPriceCTA();window.fireEvent("HRHacComplete");if(!y){o(R,false)}var Q=document.getElement(".similarCarousel");if(y&&Q){g(I)}if(!H){setTimeout(function(){t()},1000)}}}ta.fireEvent("onHACUpdate",I);if(W&&!ta.retrieve("hotels_to_seo_hotels_redirect")&&x&&!y&&!ta.retrieve("meta.persist.visible")&&!(I.contains("cancelRedirect"))){if(I&&I.match(/\shacComplete\s.*\shacMiniOfferNotAvailable\s/g)){ta.trackEventOnPage("NoAvailability","redirect","",0,"/HotelHighlight")}if(I&&I.match(/\shacComplete\s.*\shasDisplayUnavailability\s/g)){ta.trackEventOnPage("MaybeAvailable","redirect","",0,"/HotelHighlight")}}if(W){ta.fireEvent("HRHacAvailabilityDetermined",{availability:ta.commerce.meta.getResponseAvailability(I),loadingTimeoutPassed:y,cancelRedirect:I.contains("cancelRedirect"),datesChanged:x,hasBookableOffer:I.contains("bookableOffer")})}k(W,F);s(R,W,y)}function h(z,x){var A=new Element("div",{html:z}),y=A.getElement(".dropdownMiniMeta");if(y){y.inject(x)}}function v(z){var x=document.getElement(".rgba_flyout.dropdownMiniMeta"),A,B,y;if(x){A=new Element("div",{html:z});y=A.getElement(".dropdownMiniMeta");if(y){B=x.getElement(".inner");B.innerHTML="";y.set("class","dropdownMiniMeta");B.adopt(y)}p()}}function p(){if(ta.retrieve("dropdownMiniMeta.hover")){ta.commerce.meta.hoverTopOffer()}else{if(ta.retrieve("dropdownMiniMeta.blur")){ta.commerce.meta.blurTopOffer()}}}function r(A,y,x){var z="miniMetaHacRequest_"+y+"_cancel";j();o(y,true);l(A,new Date().getTime(),x+1,true)}function e(x){var y="";if(ta.browser.isIE10Metro()){if(x=="QC_Meta_Book_Inline"){y="QC_Meta_Metro_Inline"}else{y="QC_Meta_Metro_Lightbox"}}else{if(!x){if(ta.has("ta.meta.navArea")){y=ta.retrieve("ta.meta.navArea")}else{ta.util.element.trackIfMapView();y="QC_Meta_Lightbox"}}else{y=x}}return y}function u(){var z=document.getElement("#CHECK_RATES_CONT div.hacMiniComplete");var x=document.getElement("#CHECK_RATES_CONT div.hacMiniCompleteTimeOut");if(z||x){return}var y=document.getElement("div.bc_flags");if(y){y.addClass("hacMiniCompleteTimeOut")}j();t()}function j(y){var x=y?"metaHacRequest_curCancelKey":"miniMetaHacRequest_curCancelKey";if(ta.has(x)){var z=ta.retrieve(x);ta.store(z,true);ta.commerce.meta.polling.removePollingInfoForRequest(z)}}n.cancelAllMetaCurrentQuery=function(){j(false);j(true)};function q(){var z=document.getElements("#CHECK_RATES_CONT span.textLinkLoading");var y=document.getElements("#CHECK_RATES_CONT div.loading");var x=0;if(z){x+=z.length}if(y){x+=y.length}return x}function m(x,A){var y,z;if(!x||!A){return}y=A+"_suppressCommerceImpressionState";z=ta.commerce.meta.polling.getPollingAttemptForRequest(A);if(z){if(z===1){if(ta.retrieve("meta.isFromDatesChange")){ta.remove("meta.isFromDatesChange");ta.store(y,true);x+="&isFirstPageLoad=false";return x}}else{if(ta.retrieve(y)){x+="&isFirstPageLoad=false";return x}}}return x}function o(D,G){var z=0;var E="unknown";if(G){z=ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT;var F=q();var y=document.getElements("#CHECK_RATES_CONT div.premium");var A=document.getElements("#CHECK_RATES_CONT span.textLink");var C=0;if(y){C+=y.length}if(A){C+=A.length}var x=C-F;if(C>0){var B=Math.round((x/C)*10)*10;if(B%10===0&&B>-1&&B<101){E=""+B+"percent"}}}else{z=new Date().getTime()-D;E="100percent"}ta.trackEventOnPage("HAC","HACComplete",E,z,true)}function g(B){var A=Elements.from(B)[0];if(!A){return}var z=A.getElementsByClassName("price");var y=A.getElementsByClassName("priceBlock");var x=0;if(z){x+=z.length}if(y){x+=y.length}ta.trackEventOnPage("HAC","StateCarouselDisplayed","",x,true)}function t(){var x=q();if(x>0){ta.trackEventOnPage("HAC","HACError","LoadingAfterHACComplete",x,true)}}function k(z,x){if(z&&ta.retrieve("ibdm_impression_tracking")){var A=x.getElements(".impressionTrackingTree");if(A){var y;for(y=0;y<A.length;++y){ta.trkImpTree(A[y])}}}}function s(A,z,x){if(z||x){var B="meta.lowestPricePromotionTracking.tracked"+A;if(ta.has("meta.lowestPricePromotionTracking")&&!ta.has(B)){var y=ta.retrieve("meta.lowestPricePromotionTracking");if(y&&y.bidDifference&&y.priceDifference&&y.bidDifference>=0.43&&y.priceDifference>=10){ta.store(B,true);ta.trackEventOnPage("lowest_price_promoted_impression",y.providers,y.bidDifference+"|"+y.priceDifference)}}}}})(ta.meta.update);if(!ta.meta){ta.meta={}}if(!ta.meta.cross_sell){ta.meta.cross_sell={}}(function(e){var f=0;var b=false;var c=0;e.relatedHoverOver=function(i,g){try{if(f!==0){return}if(g===0){a()}else{d((i)?(i.target||i.srcElement):null,g)}}catch(h){ta.util.error.record(h,"also viewed - avafIn")}};e.relatedHoverOut=function(j){try{if(f!=1||!b){return}if(!j){j=window.event}if(!j){return}var g=(j.relatedTarget)?j.relatedTarget:j.toElement;var i=ta.id("ALSO_VIEWED_LIST");while(g&&g!=i&&g.nodeName!="BODY"){g=g.parentNode}if(g==i){return}clearTimeout(b);b=false;f=0}catch(h){ta.util.error.record(h,"also viewed - avafOut")}};e.relatedExpand=function(g,i){var h,k;try{ta.trk("AVAF_EXPAND_"+(i?"MORE":"LESS"),false,(g)?(g.target||g.srcElement):null);if(i){h=ta.id("hideableMore");if(!h){return}h.addClass("hidden");h=ta.id("expand_av_on_more");if(!h){return}h.removeClass("hidden");if(c===0){h.addClass("expanding");c=h.getSize().y;h.removeClass("expanding")}h.addClass("show");new Fx.Tween(h,{duration:"long",property:"height"}).start(0,c)}else{h=ta.id("expand_av_on_more");if(!h){return}new Fx.Tween(h,{duration:"long",property:"height"}).start(h.getSize().y,0).chain(function(){h.removeClass("show");h.addClass("hidden");k=ta.id("hideableMore");if(!k){return}k.removeClass("hidden")})}}catch(j){ta.util.error.record(j,"also viewed - avafMore")}};e.relatedResetStateFlag=function(){f=0};function d(h,g){try{f=1;b=setTimeout(function(){a(h)},g)}catch(i){ta.util.error.record(i,"also viewed - avafWait")}}function a(h){try{ta.trk("AVAF_HOVER_EXPAND",false,h);f=2;var g=ta.id("expand_av_on_hover");if(!g){return}g.removeClass("hidden");g.addClass("expanding");var l=g.getSize().y;g.removeClass("expanding");g.addClass("show");var k=g.getParent("#AV_ABOVE_FOLD_META");if(k){k.setStyle("height","auto")}var j=new Fx.Tween(g,{duration:"long",property:"height"});j.start(0,l)}catch(i){ta.util.error.record(i,"also viewed - avafExpand")}}})(ta.meta.cross_sell);if(!ta.meta.cr){ta.meta.cr={}}(function(b){b.updateCRCalendar=function(c){if(c.form){a(c.form)}b.updateCRFormElement(this);if(ta.id("META_UI_INLINE")){ta.meta.update.updateCRForm("_imt")}};b.findInlineCRLocationId=function(){var g=null;var h=ta.id("HotelDateSearch");if(h){var c=h.getElements("input[type=text]");for(var f=c.length;f--;){var d=c[f];var e=d.id.match(/_(\d+)/);if(e.length){g=e[1];break}}}return g};b.updateCRFormElement=function(g){try{g=ta.id(g);var o=g.get("tag").toLowerCase();if(o=="li"){g=g.getElement("input[type=checkbox]")}var h=g.id.split("_")[0],k=this.findInlineCRLocationId(),n=h+"_"+k,f=g.id,c=f.substring(f.length-4),r=[n,n+"_icr",n+"_per",n+"_imt"],j,q,d,m,p;if(this.crSyncExtensions.contains(c)){for(j=r.length;j--;){n=r[j];if(n!=f){p=ta.id(n);if(p){if(o=="li"&&c!="_pop"){p.checked=g.checked;q=g.getParent("li");if(q&&!q.hasClass("unavailable")){d=p.getParent("li");if(d){d.removeClass("unavailable")}}}else{if(o=="select"){p.selectedIndex=g.selectedIndex}else{if(o=="input"){m=n.substring(n.length-4);if(!this.crSyncExtensions.contains(m)){m=""}this.updateCRFormElement_In(k,g,c,m)}}}}}}}}catch(l){ta.util.error.record(l,"updateCRFormElement")}};b.getPropIdFromCRElement=function(d){if(d){var c=null;if(c=d.className.match(/id_(\d+)/)){return c[1]}}return null};b.removePCR=function(){var c=ta.retrieve("pcr.overlay");if(c){c.hide()}};b.availCheck=function(d){var c=ta.id("availability")&&ta.id("availability").value=="1";var f=ta.id(d).getElement(".overlaySrc");if(c&&f){var e=f.innerHTML;f.innerHTML=e.replace(/cid=(\w+_)?&amp;/,"")}};b.crSyncExtensions=["_pop","_icr","_pto","_per","_amo","_cro","_met","_imt","_pal","_inm"];function a(c){if(ta.retrieve("checkrates.datesChanged")){return}try{var d=ta.id(c);d.getElements(".unavailable").each(function(e){e.removeClass("unavailable");if(e.hasClass("js_ua_checked")){e.getElements("input").set("checked",true)}ta.meta.update.updateCRFormElement(e)});ta.store("checkrates.datesChanged",true)}catch(g){ta.util.error.record(g,"_showSuppressedProviders")}}})(ta.meta.cr);(function(a){a.GoogleCSA={addCallback:function(c,b){b.adLoadedCallback=function(h,d){var f=ta.id(c);if(f&&!d){try{f.dispose()}catch(g){ta.util.error.record(g,"Google CSA")}}};return b}}}(ta.commerce));if(!ta.sales){ta.sales={}}ta.sales.metaImpressionTag=(function(g,f,d){var e=new Class({initialize:function(l,m,n){this.providerName=l;this.vendorName=m;this.trackingPixel=n;this.alreadyTracked=false}});var a=[],h=function(m){if(d.find(m)){var l=d.select(m);if(l&&l.length>0){l.each(function(n){a.each(function(o){j(n,o)})})}a=a.filter(function(n){return !n.alreadyTracked});if(!i()){b()}}return false},i=function(){return a.length>0},j=function(l,m){if(((l.get("data-provider")&&l.get("data-provider")===m.providerName)||(l.get("data-offer-author")&&l.get("data-offer-author")===m.providerName)||(l.get("data-vendorname")&&l.get("data-vendorname")===m.vendorName))&&!l.hasClass("hidden")){c(m.trackingPixel);m.alreadyTracked=true}},c=function(l){var m=l+Math.floor(Math.random()*100000);g.body.appendChild(new Element("img",{"class":"tracking",src:m,height:"0",width:"0"}))},k=function(){f.addEvent("HotelsHacComplete",d.sales.metaImpressionTag.chkHotels);f.addEvent("HRHacComplete",d.sales.metaImpressionTag.chkHR);f.addEvent("MicroMetaHacComplete",d.sales.metaImpressionTag.chkMicroMeta);f.addEvent("MetaLightboxHacComplete",d.sales.metaImpressionTag.chkLightbox);f.addEvent("MetaFetchComplete",d.sales.metaImpressionTag.chkMapDetailCard);f.addEvent("MetaFetchComplete",d.sales.metaImpressionTag.chkSmartDeals);f.addEvent("MapListMetaComplete",d.sales.metaImpressionTag.chkMapListCard)},b=function(){f.removeEvent("HotelsHacComplete",d.sales.metaImpressionTag.chkHotels);f.removeEvent("HRHacComplete",d.sales.metaImpressionTag.chkHR);f.removeEvent("MicroMetaHacComplete",d.sales.metaImpressionTag.chkMicroMeta);f.removeEvent("MetaLightboxHacComplete",d.sales.metaImpressionTag.chkLightbox);f.removeEvent("MetaFetchComplete",d.sales.metaImpressionTag.chkMapDetailCard);f.removeEvent("MetaFetchComplete",d.sales.metaImpressionTag.chkSmartDeals);f.removeEvent("MapListMetaComplete",d.sales.metaImpressionTag.chkMapListCard)};return{chkLightbox:function(){if(!i()){return}h(".overlay #PROVIDER_BLOCK .metaLbOffers .offer.premium")},chkMicroMeta:function(){if(!i()){return}h("#micro_meta_ajax .provider")},chkHotels:function(){if(!i()){return}h("#PAGE .metaPriceInfo .header")},chkMapDetailCard:function(){if(!i()){return}h(".mapsv2-detail-info .mapsv2-chevron")},chkMapListCard:function(){if(!i()){return}h(".mapsv2-listcard .mapsv2-listitem .mapsv2-dropdownfirstitem")},chkSmartDeals:function(){if(!i()){return}h("#AVAILABLEHOTELDEALS .lpContainer .offer")},chkHR:function(){if(!i()){return}h("#CHECK_RATES_CONT .offer.premium:not(.remaining):not(.noLink)")},addTrackingProvider:function(l,m,n){if(l&&l.length>0&&m&&m.length>0&&n&&n.length>0){a.push(new e(l,m,n))}},registerEvents:function(){if(a.length===0){return}k()}}}(document,window,ta));if(!ta.sales){ta.sales={}}ta.sales.bwIBImpressionComscoreTag=(function(l,k,i){var b="https://sb.scorecardresearch.com/",p="http://b.scorecardresearch.com/",a=(("https:"===l.location.protocol?b:p)+"p?c1=3&c2=6036461&c3=ALBwesternAgst15&c4=ibimpressions&c5=ibimpression&c6=&c10=1&c11=&c13=1x1&c16=gen&cj=1&ax_fwd=1&rn="),o="BestWestern",e="TripAdvisor",f=function(){var q=a+Math.floor(Math.random()*100000);l.body.appendChild(new Element("img",{"class":"tracking",src:q,height:"0",width:"0"}))},m=function(){f();h()},j=function(){var q=i.find(".hacComplete #META_SBS_TRACKING_DUMMY[data-provider="+o+"]");if(q){m()}},g=function(){var q=i.find(".metaContent .offer.bookableOffer[data-vendorname="+e+"][data-offer-author="+o+"]");if(q){m()}},d=function(){var q=i.select(".metaPriceInfo .header.bookableOffer[data-provider="+o+"]");if(q&&q.length>0){m()}},n=function(){var q=i.select("#AVAILABLEHOTELDEALS .sdBlueChevron:not(.hidden) .offer.bookableOffer[data-ibpartner="+o+"]");if(q&&q.length>0){m()}},c=function(){k.addEvent("hacComplete_bookingOffersFound",j);k.addEvent("hacComplete_bookingOffersFound",g);k.addEvent("HotelsHacComplete",d);k.addEvent("BlenderHacComplete",d);k.addEvent("MetaFetchComplete",n)},h=function(){k.removeEvent("hacComplete_bookingOffersFound",j);k.removeEvent("hacComplete_bookingOffersFound",g);k.removeEvent("HotelsHacComplete",d);k.removeEvent("BlenderHacComplete",d);k.removeEvent("MetaFetchComplete",n)};return{registerIBImpressionTrackingEvents:c}}(document,window,ta));if(!ta.sales){ta.sales={}}ta.sales.metaClickTag=(function(h,f,e){var g=new Class({initialize:function(m){if(m){this.providerName=m.providerName;this.vendorName=m.vendorName;this.trackingPixel=m.trackingPixel;this.brandName=m.brandName;this.locationIds=m.locationIds}if(this.vendorName&&this.trackingPixel){this.valid=true}else{this.valid=false}}}),b="TripAdvisor",i="All",a=[],d=new RegExp(/\[timestamp\]/),k=function(q){if(q&&q.dataset){for(var o=0;o<a.length;o++){var r=a[o].providerName;var t=a[o].vendorName;var s=a[o].brandName;var n=a[o].trackingPixel.replace(d,new Date().getTime());var p=a[o].locationIds;if(b===q.dataset.vendorname&&b===t){if(r===q.dataset.provider||r===i){if(!s){c(n,r,"IB")}if(s&&s===q.dataset.brandname){var m=q.dataset.locationid;if(!p||p&&m&&p.includes(m)){c(n,s,"IB")}}}}else{if(b!==q.dataset.vendorname&&b!==t&&t===q.dataset.vendorname){c(n,t,"meta")}}}}},j=function(){return a.length},c=function(q,n,p){var m=h.createComment("Activity name for this tag: "+n+" "+p+" click page view tag");var o=h.createElement("img");o.src=q;o.height="1";o.width="1";o.border="0";o.setAttribute("style","display:none");h.body.appendChild(m);h.body.appendChild(o)},l=function(){f.addEvent("metaLinkClick",e.sales.metaClickTag.chkMetaClick)};return{chkMetaClick:function(m){if(!j()){return}k(m)},addTrackingProvider:function(m){var n=new g(m);if(n&&n.valid){a.push(n)}else{throw new Error("ta.sales.metaClickTag :: Tracker invalid : "+m.trackingPixel?m.trackingPixel:"missing tracking pixel")}},registerEvents:function(){if(!j()){return}l()}}}(document,window,ta));(function(a){a.util||(a.util={});a.util.typeOf=function(b){return Object.prototype.toString.call(b).match(/(\w+)\]$/)[1].toLowerCase()};a.util.merge=function(g){for(var c=1;c<arguments.length;c++){var e=arguments[c];if(!e){continue}g||(g=(a.util.typeOf(e)==="array")?[]:{});for(var b in e){var f=e[b];if(e.hasOwnProperty(b)&&a.util.typeOf(f)!=="undefined"){var d=a.util.typeOf(f);if(d==="string"||d==="number"||d==="boolean"||d==="function"||f===null){g[b]=f;continue}g[b]=a.util.merge(g[b],f)}}}return g}}(ta));(function(a,b){var c=function(e){var d=false;new Request({url:"/AuthCheck",data:{product:e},async:false,method:"get",onSuccess:function(f){if("true"===f.trim()){d=true}}}).send();return d};b.isAuthorized=function(d){return c(d)};b.register=function(f,e){if(f.popup){return a.registration.popup.open(f,e)}var g={servlet:"Register",action:"SIGNIN",data:function(){return{}}};var d=a.retrieve("ta.registration.currentUrlDefaults");f=a.util.merge(g,d,f||{},e||{});if(!f.product){return false}if(c(f.product)){return true}if(f.successAction){a.registration.setSuccessActionCookie(f.successAction)}require(["utils/post"],function(h){h({url:"/"+f.servlet,https:true,data:{product:f.product,action:f.action,url:f.url,urlKey:f.urlKey,partnerKey:f.partnerKey,data:JSON.encode(f.data())}})});return false};b.popup={defaultWidth:547,defaultHeight:435,options:null,urloptions:null,isPopup:null,open:function(o,p){a.registration.popup.options=o;a.registration.popup.urloptions=p;var i={servlet:"Register",action:"SIGNIN",data:function(){return{}}};var f=a.retrieve("ta.registration.currentUrlDefaults");o=a.util.merge(i,f,o||{},p||{});if(!o.product){return false}if(c(o.product)){return true}var l=document.location;var k=l.protocol+"//"+l.host;if(l.port){k+=":"+l.port}var e=k.replace("http://","https://")+"/"+o.servlet;var m=[];m.push("popup=true");m.push("product="+o.product);m.push("action="+o.action);m.push("url="+o.url);m.push("urlKey="+o.urlKey);m.push("partnerKey="+o.partnerKey);m.push("data="+JSON.encode(o.data()));e=e+"?"+m.join("&");var g=a.registration.popup.defaultWidth;var n=a.registration.popup.defaultHeight;var h=(screen.width-g)/2;var j=(screen.height-n)/2;var d=window.open(e.toString(),"registration","width="+g+", height="+n+", top="+j+", left="+h+", resizable=yes, scrollbars=yes");if(!d&&!isTabletOnFullSite){a.registration.popup.fallback()}return false},init:function(){if(a.registration.popup.isPopup==null){a.registration.popup.isPopup=isTabletOnFullSite||(window.opener&&window.getSize().x<(a.registration.popup.defaultWidth+150))}if(a.registration.popup.isPopup){var f=a.id("REG_CON");if(f){var e=f.getElement("div.regDlg");if(!e){e=f.getElement("div.whyDlg")}if(e){a.registration.popup.resize(e)}}var d=a.id("SS_SSO");if(d){var g=d.getElement("input[type=button]");if(g){g.addEvent("click",function(){a.registration.popup.resizeTo(980,560,true)})}}}else{window.location="/RegisterDone?fallback=true"}},done:function(e,g){if(window.opener){var f=window.opener;if(f.ta){if(g){a.registration.popup.fallback(true)}else{var d;if(f.ta.registration&&f.ta.registration.popup.options){d=f.ta.registration.popup.options.successAction}if(d){f.ta.registration.runSuccessAction(d)}else{if(e){f.location=e}}a.registration.popup.updateMasthead(a.registration.popup.close)}}else{a.registration.popup.close()}}else{if(e){a.registration.returnTo(e)}}},close:function(){if(window.opener&&window.opener!=window){window.opener=window;window.close()}},updateMasthead:function(i){var f=0;var h=setInterval(function(){f++;var j=a.id("avatarImage");if(h>20||!j||j.get("src")){clearInterval(h);try{if(window.opener&&window.opener.ta){e();g()}}catch(k){a.util.error.record(k,"secure popup - unable to update masthead",null,{},"WARN")}if(i){i()}}},250);var d=function(k){if(k&&window.opener){var j=new Element("div").adopt(k).innerHTML;if(j){k=window.opener.Elements.from(j)}}return k};var e=function(){var k=window.opener.document.getElement("head");var j=a.id("IP_HEADER_CSS");if(k&&j){j=d(j);if(j){k.adopt(j)}}};var g=function(){var j=a.id("USER_PREFS");var k=window.opener.ta.id("USER_PREFS");if(j&&k){j=d(j);if(j){j.replaces(k)}}}},fallback:function(e){var f=window;if(e&&window.opener){f=window.opener}f.focus();if(f.ta&&f.ta.registration){var d=f.ta.registration.popup;if(d.options){d.options.popup=false;f.ta.registration.register(d.options,d.urloptions)}}if(e){a.registration.popup.close()}},resize:function(f){if(f){a.registration.popup.disableScrollBars();var e=f.getScrollSize().x;var d=f.getScrollSize().y;window.onresize=function(){window.onresize=null;var h=e-window.getSize().x+1;var g=d-window.getSize().y+1;if(h!=0||g!=0){window.onresize=function(){window.onresize=null;a.registration.popup.center(e+h,d+g);a.registration.popup.enableScrollBars()};a.registration.popup.resizeBy(h,g)}else{a.registration.popup.enableScrollBars();a.registration.popup.center()}};a.registration.popup.resizeTo(e,d)}},resizeTo:function(f,e,d){if(d){window.onresize=function(){window.onresize=null;a.registration.popup.center()}}window.resizeTo(f,e)},resizeBy:function(f,e,d){if(d){window.onresize=function(){window.onresize=null;a.registration.popup.center()}}window.resizeBy(f,e)},center:function(g,d){if(!g){g=window.getSize().x}if(!d){window.getSize().y}var f=(screen.width-g)/2;var e=(screen.height-d)/2;window.moveTo(f,e);window.focus()},disableScrollBars:function(){window.document.getElement("body").setStyle("overflow","hidden")},enableScrollBars:function(){window.document.getElement("body").setStyle("overflow")}};(function(e,g){var j="1070328450902.apps.googleusercontent.com";var d={cookiepolicy:"single_host_origin",requestvisibleactions:"http://schemas.google.com/AddActivity",clientid:j,client_id:j,immediate:false,apppackagename:"com.tripadvisor.tripadvisor"};var f=0;function i(){e.store("registration.google.avail",true);var k=e.remove("registration.google.onAvail");k&&k.each(function(l){l()})}function h(){if(typeof d.scope==="undefined"){var k=["https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/userinfo.email"];if(e.retrieve("google_wallet_permission_desktop_signin.enabled")){k.push("https://www.googleapis.com/auth/payments.make_payments")}d.scope=k.join(" ")}return d}g.google={init:function(k){if(k){g.google.onAvail(k)}new Asset.javascript("https://plus.google.com/js/client:plusone.js",{onLoad:function(){if(gapi&&gapi.auth){gapi.auth.init(i)}else{var l=setInterval(function(){if(gapi&&gapi.auth){clearInterval(l);gapi.auth.init(i)}},100)}}})},onAvail:function(k){if(e.retrieve("registration.google.avail")){k()}else{e.keep("registration.google.onAvail",k)}},connect:function(l,k,n){k=k||"MASTHEAD";var m={flow:k};if(0===k.indexOf("EMAIL_ONLY_SIGNUP")){Object.merge(m,{isOverlay:false});if(typeof n==="function"){Object.merge(m,{responseCallback:n})}}if(l){f=l}if(typeof gapi=="undefined"){e.registration.google.init(e.registration.google.connect)}else{if(!e.has("google.sso.sending")){e.store("google.sso.sending",true);gapi.auth.signIn(Object.merge({callback:function(p){if(p&&p.status&&p.status.signed_in&&p.access_token){if(!e.has("google.sso.receiving")){e.remove("google.sso.sending");e.store("google.sso.receiving",true);var o="/GoogleRegistration?google_token="+p.access_token+"&pid="+f;new Request.JSON({url:o,method:"get",onSuccess:function(q){e.remove("google.sso.receiving");if(q.success){if(q.created){e.overlays.registration.connect(m,"GOOGLE_SIGNUP")}else{if(q.connected){e.overlays.registration.request("GOOGLE_THANKS",{google_token:p.access_token},m)}else{e.overlays.registration.cancel(m)}}}},onError:function(){e.remove("google.sso.receiving")},onFailure:function(){e.remove("google.sso.receiving")}}).send()}}}},h()))}}},ifConnected:function(l,k){if(gapi&&gapi.auth){gapi.auth.authorize({client_id:j,immediate:true,scope:h().scope.split(" ")},function(n){if(n&&n.status&&n.status.signed_in){var m="/GoogleRegistration?google_token="+n.access_token+"&verify=true";var o=e.retrieve("google.sso.returnTo");if(o){m+="&returnTo="+o}new Request.JSON({url:m,method:"get",onSuccess:function(p){if(p.success&&l){l()}else{if(k){k()}}},onFailure:k}).send()}else{if(k){k()}}})}else{k()}},ifLoggedIn:function(m,k){if(typeof gapi!="undefined"&&gapi.auth){var l={client_id:j,session_state:null};gapi.auth.checkSessionState(l,function(n){if(n===false){m()}else{if(k){k()}}})}},disconnect:function(){if(typeof gapi=="undefined"){e.registration.google.init(e.registration.google.disconnect)}else{gapi.auth.authorize(h(),function(k){if(k&&k.access_token){new Request.JSONP({url:"https://accounts.google.com/o/oauth2/revoke?token="+k.access_token,method:"get",onSuccess:function(){e.overlays.registration.post({action:"GOOGLE_DISCONNECT"})}}).send()}})}}}})(a,b);(function(f,h){var e=4194307;var i=656;var g=382;var d=null;h.vkontakte={connect:function(k,p,l){if(k){new Request({url:"/ActionRecord?action=vkAuthAttempt&pid="+k}).send()}if(f.retrieve("vk.sso.clicked")&&d&&d.window){d.window.close();f.store("vk.sso.clicked",false)}if(!f.retrieve("vk.sso.clicked")){f.store("vk.sso.clicked",true);var o=(screen.height-g)/2;var j=(screen.width-i)/2;var n="https://oauth.vk.com/authorize?client_id="+l+"&scope="+e+"&redirect_uri=https%3A%2F%2F"+location.hostname+"%2FVKRegistration";if(p){n+="Masthead"}d=window.open(n,"registration","width="+i+", height="+g+", top="+o+", left="+j+", resizable=yes, scrollbars=yes");if(!d){f.store("vk.sso.clicked",false);new Request({url:"/Actionrecord?action=vkAuthPopupBlocked&pid=39094"}).send();if(!p){this.showSSOError(f.retrieve("popupBlockerSSOError"))}}else{var m=setInterval(function(){if(d.closed){clearInterval(m);if(p){document.window.location.reload()}f.store("vk.sso.clicked",false)}},500)}}},registrationSuccess:function(){f.overlays.registration.connect({flow:"MASTHEAD"},"VK_SIGNUP")},loginSuccess:function(){f.overlays.registration.request("SIGNIN")},showSSOError:function(j){f.store("vk.sso.clicked",false);var k=f.id("ssoErrorMessage");if(k){k.removeClass("hidden");k.set("html",j)}},done:function(k,j){try{if(window.opener.ta&&window.opener.ta.retrieve("vk.sso.clicked")){this.performPostAuthAction(k,j)}}catch(l){window.close()}window.close()},doneMasthead:function(){window.close()},performPostAuthAction:function(j,k){var l=window.opener;l.ta.store("vk.sso.clicked",false);if(j){if(l.ta.registration.vkontakte){if(j==="vkLogin"){l.ta.registration.vkontakte.loginSuccess()}else{if(j==="vkSignup"){l.ta.registration.vkontakte.registrationSuccess()}else{if(j==="error"){if(k){l.ta.registration.vkontakte.showSSOError(k)}}}}}}},disconnect:function(){f.overlays.registration.post({action:"VK_DISCONNECT"})}}})(a,b);b.done=function(d,e){if(window.opener){a.registration.popup.done(d,e)}else{a.registration.returnTo(d)}};b.returnTo=function(d){if(window.opener){window.opener.location=d;a.registration.popup.close()}else{window.location=d}};b.runSuccessAction=function(f,h){var i=f.split("|");try{var d=i.slice(1);d.unshift({});d.unshift(i[0]);if(h){d.push(h)}a.run.apply(null,d)}catch(g){a.util.error.record(g,"successAction",null,{funcName:i[0]})}};b.runSuccessActionCookie=function(){var d=a.registration.getSuccessActionCookie();if(d){a.registration.runSuccessAction(d,true)}};b.setSuccessActionCookie=function(d){Cookie.write("successAction",window.pageServlet+"|"+d,{domain:cookieDomain,path:"/"})};b.getSuccessActionCookie=function(){if(window==window.top){var f=Cookie.read("successAction");if(f){var d=f.split("|");var e=d[0];d=d.slice(1);if(window.pageServlet==e){Cookie.dispose("successAction",{domain:cookieDomain,path:"/"});return d.join("|")}}}return};a.queueForLoad(function(){a.registration.runSuccessActionCookie()})}(ta,ta.registration));if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["utils/post"],[])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"registration",files:{"js-amd":{src:{utils:{post:1}}}},_:{baseUrl:"/"}})};define("utils/post",["utils/urlutils"],function(a){return function(c){if(!c||!c.url||!c.data){return false}c.url=c.https?a.https(c.url):a.getAbsoluteUrl(c.url);var e=document.createElement("form");e.setAttribute("method","post");e.setAttribute("action",c.url);for(var d in c.data){if(c.data.hasOwnProperty(d)){var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name",d);b.setAttribute("value",c.data[d]);e.appendChild(b)}}document.body.appendChild(e);e.submit()}});ta.util.keys={onEnterKey:function(d,b,c){var a;if(window.event){a=window.event.keyCode}else{if(d){a=d.which}}if(a==13){if(typeof(b)==="function"){b()}return false}else{if(typeof(c)==="function"){c()}return true}},onEnterKeyClickSibling:function(b,a){return ta.util.keys.onEnterKey(b,function(){var c=b.target&&ta.id&&ta.id(b.target);if(c){var d=c.getSiblings(a);if(d&&d.length){d[0].click()}}})}};(function(a){var b,c;a.servlet=a.servlet||{};b=function(e,f,d){new Request({method:"POST",url:a.util.URL.https("/Registration"),onSuccess:f,onFailure:d,data:e,withCredentials:a.retrieve("access_control_headers")}).send()};c=function(d){if(!d||"object"!==typeof d){a.util.error.record(null,"Options object is invalid.");return false}if(!d.hasOwnProperty("flow")||!d.flow){a.util.error.record(null,"Options object missing required flow field.");return false}if(!d.hasOwnProperty("action")||!d.action){a.util.error.record(null,"Options object missing required action field.");return false}if(!d.hasOwnProperty("pid")||!d.pid){a.util.error.record(null,"Options object missing required pid field.");return false}if(!d.hasOwnProperty("token")||!d.token){a.util.error.record(null,"Options object missing required token field.");return false}if(!d.hasOwnProperty("category")||!d.category){a.util.error.record(null,"Options object missing required category field.");return false}return true};a.servlet.OverlayRegistration={submitEmailOnlySignup:function(d,p,t){var h,n,s,q,g,o,l,j,k,i,r,f,m;m=d||window.event;if(m){new Event(m).preventDefault()}if(!p){a.util.error.record(null,"Invalid form element.");return}if(!c(t)){return}h=p.getElement(".emailAddr");n=p.getElement(".g-recaptcha-response");s=p.getElement(".emailOptIn input");q=p.getElement(".submitBtn");g=p.getElement(".signupError");o=h?h.value:"";l=n?n.value:"";j=s&&s.checked;if(q){q.set("disabled","disabled")}else{a.util.error.record(null,"Form missing submit element.");return}if(!g){a.util.error.record(null,"Form missing error element.");return}i=(t.additional&&("object"===typeof t.additional))?t.additional:{};k=Object.merge(i,{flow:t.flow,action:t.action,pid:t.pid,category:t.category,token:t.token,email:o,"g-recaptcha-response":l,opt_in:j});r=function(u){var x;try{x=JSON.decode(u);if(x.error){g.setContent(x.error).show();var v={height:document.body.getScrollHeight()};a.servlet.OverlayRegistration.resizeFrame(v);q.set("disabled","");return}else{g.setContent("").hide()}a.trackEventOnPage(t.category,x.isLogin?"signup_success_logged_in":"signup_success","",t.pid,false);if(!t.keepOverlay){a.servlet.OverlayRegistration.closeOverlayRegistration()}if(t.hasOwnProperty("onSuccess")&&"function"===typeof t.onSuccess){t.onSuccess(x)}}catch(w){a.util.error.record(w,"Ajax request handling error");q.set("disabled","");if(t.hasOwnProperty("onFailure")&&"function"===typeof t.onFailure){t.onFailure()}}};f=function(e){a.util.error.record(null,"Ajax signup request failure: "+e.status);q.set("disabled","");if(t.hasOwnProperty("onFailure")&&"function"===typeof t.onFailure){t.onFailure(e)}};b(k,r,f)},closeOverlayRegistration:function(){var d,e;d=window.parent;if(d){e='{ "action": "successClose" }';d.postMessage(e,"*")}},fwdToRegistration:function(g){var e,i,d,j,h,f;a.trackEventOnPage(g.category,"already_member","",g.pid,false);e=window.parent;if(e){setTimeout(function(){d=(g.additional&&("object"===typeof g.additional))?g.additional:{};j=d.hasOwnProperty("curUrl")?d.curUrl:"";h=d.hasOwnProperty("partnerKey")?d.partnerKey:"";f=d.hasOwnProperty("urlKey")?d.urlKey:"";i='{ "action": "fwdToRegistration", "curUrl": "'+d.curUrl+'", "partnerKey": "'+d.partnerKey+'", "urlKey": "'+d.urlKey+'" }';e.postMessage(i,"*")},100)}},resizeFrame:function(f){if(!f||"object"!==typeof f){return}var d=f.hasOwnProperty("height")?f.height:null;if(+d!==parseInt(d)){d=340}var e=window.parent;if(e&&d){var g='{ "action": "resizeFrame", "height": "'+d+'" }';e.postMessage(g,"*")}},renderThanks:function(e){var d={source:"OverlayRegistration",flow:e,action:"GET_OVERLAY_REGISTRATION_THANKS"};window.location="https://"+window.location.hostname+"/Registration?"+Object.toQueryString(d)},cancelRegistration:function(h,f){var j,i,d,g;j=h||window.event;if(j){new Event(j).preventDefault()}if(!c(f)){return}i={flow:f.flow,action:f.action,pid:f.pid,category:f.category,token:f.token};d=function(k){var m;try{m=JSON.decode(k);a.trackEventOnPage(f.category,"signup_cancel",f.pid,0,false);if(f.hasOwnProperty("onSuccess")&&"function"===typeof f.onSuccess){f.onSuccess(m)}}catch(l){a.util.error.record(l,"Ajax request handling error");if(f.hasOwnProperty("onFailure")&&"function"===typeof f.onFailure){f.onFailure(m)}}};g=function(e){a.util.error.record(null,"Ajax cancel request failure: "+e.status);if(f.hasOwnProperty("onFailure")&&"function"===typeof f.onFailure){f.onFailure(e)}};b(i,d,g)}}}(ta));if("undefined"===typeof userLoggedIn){var userLoggedIn=false};ta.common.flyout=ta.common.flyout||{};ta.common.flyout.memberOverlay=ta.overlays.Factory.memberOverlay;ta.common.flyout.showRecentLocationEmailOverlay=ta.overlays.Factory.showRecentLocationEmailOverlay;ta.common.sendmessage.showSendMessage=ta.overlays.Factory.showSendMessage;ta.servlet.Hotel.showReviewSummary=ta.overlays.Factory.showReviewSummary;ta.servlet.Hotel.showTranslationReviewSummary=ta.overlays.Factory.showTranslationReviewSummary;tamgShowLightbox=ta.overlays.Factory.tamgShowLightbox;ta.util.taLnk={mouseover:function(b){$(b).addClass("underline")},mouseout:function(b){$(b).removeClass("underline")},redirect:function(a){window.location.href=a}};var StringBuffer=new Class({initialize:function(a){this.strings=new Array();if(a){this.append(a)}},append:function(a){this.strings.push(a);return this},toString:function(){return this.strings.join("")},isEmpty:function(){return this.strings.length==0}});var Table=new Class({Implements:[Options],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[]},initialize:function(a){this.setOptions(a);this.table=new Element("table").setProperties(this.options.properties);this.tbody=new Element("tbody").inject(this.table);this.options.rows.each(this.push.bind(this))},push:function(d,c,a){var b=new Element("tr").inject(c||this.tbody);d.each(function(e){var f=new Element(a?"th":"td").inject(b);if(e.properties){f.setProperties(e.properties)}if(e.content){f.setContent(e.content)}else{f.setContent(e)}});return this},pushHead:function(a){if(!this.thead){this.thead=new Element("thead").inject(this.table,"top")}this.push(a,this.thead,true);return this},pushFoot:function(a){if(!this.tfoot){this.tfoot=new Element("tfoot").inject(this.table)}this.push(a,this.tfoot);return this},pushCaption:function(a){new Element("caption").setContent(a).inject(this.table,"top");return this}});var TabSet=new Class({Implements:[Options,Events],options:{onActive:function(){},onBackground:function(){},show:0,collapsable:false},initialize:function(){var a,b,c;Array.each(arguments,function(f,e){switch(typeOf(f)){case"object":a=f;break;default:var d=$$(f);if(!b){b=d}else{c=d}}});this.togglers=b||[];this.elements=c||[];this.setOptions(a);this.elements.each(function(e,d){this.togglers[d].addEvent("click",this.display.bind(this).partial(Function._,d));if(this.options.show===d){e.show();this.previous=d;this.fireEvent("onActive",[null,this.togglers[d],e])}else{e.hide()}},this)},display:function(b,a){if(this.options.collapsable&&a==this.previous){if(this.elements[a].isHidden()){this.fireEvent("onActive",[b,this.togglers[a],this.elements[a]]);this.elements[a].show()}else{this.fireEvent("onBackground",[b,this.togglers[a],this.elements[a]]);this.elements[a].hide()}return this}if(this.previous||this.previous===0){this.elements[this.previous].hide();this.fireEvent("onBackground",[b,this.togglers[this.previous],this.elements[this.previous]])}this.previous=a;this.elements[a].show();this.fireEvent("onActive",[b,this.togglers[a],this.elements[a]]);return this}});var ToggleSet=new Class({initialize:function(b,c,a){this.index=a||0;this.togglers=b||[];this.elements=c||[];this.togglers.each(function(e,d){this.togglers[d].addEvent("click",this.display.bind(this,d));this.elements[d].hide()},this)},add:function(c,b){var a=this.togglers.length;this.togglers.push(c);this.elements.push(b);c.addEvent("click",this.display.bind(this,a));b.hide()},expand:function(a){this.togglers[a].addClass("open");this.elements[a].show();return this},collapse:function(a){this.elements[a].hide();this.togglers[a].removeClass("open");return this},display:function(a){if(this.previous==a){if(this.elements[a].isHidden()){this.expand(a)}else{this.collapse(a)}}else{if(this.previous||this.previous===0){this.collapse(this.previous)}this.previous=a;this.expand(a)}return this}});var Slider=new Class({Implements:[Options,Events],Binds:["clickedElement","draggedKnob"],options:{onChange:function(){},onComplete:function(){},onTick:function(a){this.knob.setStyle(this.p,a)},mode:"horizontal",steps:100,offset:0},initialize:function(d,a,b){this.element=$(d);this.knob=$(a);this.setOptions(b);this.previousChange=-1;this.previousEnd=-1;this.step=-1;this.element.addEvent("mousedown",this.clickedElement);var c,f;switch(this.options.mode){case"horizontal":this.z="x";this.p="left";c={x:"left",y:false};f="offsetWidth";break;case"vertical":this.z="y";this.p="top";c={x:false,y:"top"};f="offsetHeight"}this.max=this.element[f]-this.knob[f]+(this.options.offset*2);this.half=this.knob[f]/2;this.getPos=this.element["get"+this.p.capitalize()].bind(this.element);this.knob.setStyle("position","relative").setStyle(this.p,-this.options.offset);var e={};e[this.z]=[-this.options.offset,this.max-this.options.offset];this.drag=new Drag(this.knob,{limit:e,modifiers:c,snap:0,onStart:this.draggedKnob(),onDrag:this.draggedKnob(),onComplete:function(){this.draggedKnob();this.end()}.bind(this)});if(this.options.initialize){this.options.initialize.call(this)}},set:function(a){this.step=a.limit(0,this.options.steps);this.checkStep();this.end();this.fireEvent("onTick",this.toPosition(this.step));return this},setDefault:function(a){if(a>this.options.steps){a=this.options.steps}else{if(a<0){a=0}}this.step=a;this.end();this.knob.setStyle(this.p,this.toPosition(this.step)+"px");return this},scrolledElement:function(a){if(a.wheel<0){this.set(this.step+1)}else{if(a.wheel>0){this.set(this.step-1)}}a.stop()},clickedElement:function(b){var a=b.page[this.z]-this.getPos()-this.half;a=a.limit(-this.options.offset,this.max-this.options.offset);this.step=this.toStep(a);this.checkStep();this.end();this.set(this.step)},draggedKnob:function(){if(!this.drag){return}this.step=this.toStep(this.drag.value.now[this.z]);this.checkStep();this.setDefault(this.step)},checkStep:function(){if(this.previousChange!=this.step){this.previousChange=this.step;this.fireEvent("onChange",this.step)}},end:function(){if(this.previousEnd!==this.step){this.previousEnd=this.step;this.fireEvent("onComplete",this.step+"")}},toStep:function(a){return Math.round((a+this.options.offset)/this.max*this.options.steps)},toPosition:function(a){return this.max*a/this.options.steps}});var rules={};var rulesN={};var ajaxRules={};var Behavior=new Class({register:function(b){this.rules=b;for(var a in this.rules){this.reload(a)}for(var c in rulesN){this.reloadN(c)}return this},reload:function(c){var a=$$(c);for(var d=0;d<a.length;d++){try{this.rules[c](a[d])}catch(b){ta.util.error.record(b,"rules",null,{element:ta.util.error.getSelectorString(a[d]),ruleCount:d})}}return a.length},reloadN:function(b){var a=0;while(n=ta.id(b+(a++))){rulesN[b](n)}return a-1},apply:function(a){processLinks(a);for(var b in this.rules){window.applyLastRule=b;a.getElements(b).each(function(c){this.rules[b](c)},this)}for(var b in ajaxRules){window.applyLastRule=b;a.getElements(b).each(function(c){ajaxRules[b](c)},this)}}});window.behavior=new Behavior();TAReadyEvent=window.TAReadyEvent||"domready";if(Browser.ie&&(typeof semHotelBoxFocus!="undefined")&&semHotelBoxFocus){ta.queueForLoad(behaviorFunction,"Behavior")}else{window.addEvent(TAReadyEvent,behaviorFunction)}var bfCount=0;function behaviorFunction(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.behaviorStart=new Date().getTime()}if(Browser.ie&&(!$("FOOT")||!$("FOOT").readyState||$("FOOT").readyState!="complete")&&bfCount<10){bfCount++;behaviorFunction.delay(30);return}if(window.hideOnLoad){Array.from(hideOnLoad).each(function(c){var b=$(c);if(b){b.hide()}})}if(!Browser.ie6){searchFocus()}processLinks(document);behavior.register(rules);var a=$("MAIN");if((window.location.hash=="#Calculator")&&($("HOMEPAGE")||(a&&a.hasClass("VacationRentals"))||$("HOTEL_LANDER"))){showDHTMLOverlayOnLoad=function(){};if(typeof vrCalculator!="undefined"){vrCalculator()}}if(typeof performancePingbackInit!="undefined"){performancePingbackInit.behaviorEnd=new Date().getTime()}}function searchFocus(){var a=ta.id("mainSearch");if(a&&a.className.match(/\b(focusOnLoad)\b/)){try{a.focus()}catch(b){}}}rulesN.EOBF=function(a){var b=a.innerHTML+"@tripadvisor"+a.title;new Element("a",{href:"mailto:"+b}).setContent(b).replaces(a)};var linkMap={};var popupIndex=0;function popup(r,t,o,l,h,g,b,d,c,q){try{new Event(r).preventDefault();var a="",k=this.className.match(/sz(\d+)x(\d+)/),j=ta.id(document.body),i,s,f;if(k){o=k[1];l=k[2]}if(this.href.indexOf("p=HotelsCom")>-1){o=Math.max(o,960);l=Math.max(l,window.getHeight(),600)}if(o){a+=",width="+o}if(l){a+=",height="+l}if(h){a+=",screenX="+h+",left="+h}if(g){a+=",screenY="+g+",top="+g}if(a!==""){if(c){a="toolbar=1,resizable=1,menubar=1,location=1,status=1,scrollbars=1"+a}else{a="toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars="+(b?0:1)+a}}if(!d){d=this.href}s=t||("p"+(popupIndex++));if(q&&Browser.ie){f=new Element("a",{target:s,href:d});f.inject(j,"bottom");i=window.open("",s,a);f.click();f.destroy()}else{i=window.open(d,s,a)}if(i!==null){try{i.opener=self}catch(m){}i.focus()}}catch(p){ta.util.error.record(p,"behavior popup",r);throw p}}linkMap.js_popup=function(a,b){popup.attempt(b,a)};linkMap.js_popComm=function(a,b){popup.attempt([b,null,950,610,null,null,null,null,true],a)};linkMap.js_popMap=function(a,b){Cookie.write("mapPopup","1",{domain:cookieDomain});popup.attempt([b,"map",820,960],a)};linkMap.js_popNoScroll=function(a,b){popup.attempt([b,null,null,null,null,null,true],a)};linkMap.js_popCR=function(a,b){popup.attempt([b,"cr",245,610,5,5],a)};linkMap.js_email=function(a,b){popup.attempt([b,"email",580,460,30,25],a)};linkMap.js_popReview=function(a,b){popup.attempt([b,"review",550,395,30,25],a)};linkMap.js_popPhoto=function(a,b){popup.attempt([b,"photo",650,350],a)};linkMap.js_popGallery=function(a,b){Cookie.write("PhotoPop","1",{domain:cookieDomain});popup.attempt([b,"media",782,820],a)};linkMap.js_popGalleryComm=function(a,b){Cookie.write("PhotoPop","1",{domain:cookieDomain});popup.attempt([b,"media",780,950],a)};linkMap.js_popDMO=function(a,b){popup.attempt([b,"dmo",400,400],a)};linkMap.js_popNxTall=function(a,b){popup.attempt([b,330,680],a)};linkMap.js_popNxWide=function(a,b){popup.attempt([b,730,380],a)};linkMap.js_popNxLogin=function(a,b){popup.attempt([b,"login",795,645],a)};linkMap.js_popFraud=function(a,b){popup.attempt([b,"fraud",640,460],a)};linkMap.js_popDestGd=function(a,b){popup.attempt([b,"dest_guide",565,700,(screen.width-700)/2,(screen.height-600)/2],a)};linkMap.js_popSmall=function(a,b){if(screen.width>1024){popup.attempt([b,null,800,600,240,5,false,false,true],a)}else{if(screen.width>800){popup.attempt([b,null,620,500,240,5,false,false,true],a)}else{popup.attempt([b,null,475,390,210,5,false,false,true],a)}}return a};linkMap.js_popProfPhoto=function(a,b){if(screen.width>1024){popup.attempt([b,null,800,500,240,5,false,false,true],a)}else{if(screen.width>800){popup.attempt([b,null,620,450,240,5,false,false,true],a)}else{popup.attempt([b,null,475,390,210,5,false,false,true],a)}}return a};linkMap.js_popPartner=function(a,b){if(screen.width>1024){popup.attempt([b,null,980,500,240,5,false,false,true],a)}else{if(screen.width>800){popup.attempt([b,null,800,500,240,5,false,false,true],a)}else{popup.attempt([b,null,620,450,210,5,false,false,true],a)}}return a};linkMap.js_noTAPD=function(a,b){Cookie.dispose("TAPD",{domain:cookieDomain})};rules["a#TERMS"]=function(a){a.addEvent("click",popup.bind(a).partial(Function._,"terms",300,300,30,25))};linkMap.js_ajaxSubmit=function(a,f){if(!a.className.match(/\bform_(\w+)\b/)){return}var d=$(RegExp.$1);var c={url:a.href,data:d,onFailure:function(e){if(d){d.removeClass("ajaxInFlight")}ta.util.error.ajaxFailure("behavior:js_ajaxSubmit",e)}};var g=window["callback"+d.id];if(a.className.match(/method_(\w+)\b/)){c.method=RegExp["$1"]}if(a.className.match(/\btgt_(\w+)\b/)){c.update=RegExp["$1"]}else{c.onSuccess=function(e){if(d){d.removeClass("ajaxInFlight")}ta.overlays.showInLightbox(e);if(g&&typeOf(g)=="function"){g()}}}new Event(f).preventDefault();var b=window["validate"+d.id];if(b&&typeOf(b)=="function"&&b.apply(d)==false){return}d.addClass("ajaxInFlight");if(a.className.match(/\bevalScripts\b/)){c.evalScripts=true}(c.update?new Request.HTML(c):new Request(c)).send()};linkMap.js_ajax=function(a,b){new Event(b).preventDefault();if(!(tgt=a.className.match(/\btgt_(\w+)\b/))){return}tgt=$(tgt[1]);new Request.HTML({url:a.href,update:tgt,onFailure:ta.util.error.ajaxFailure.partial("behavior:js_ajax")}).send()};linkMap.js_ajaxlogin=function(b,c){new Event(c).preventDefault();if(!(tgt=b.className.match(/\btgt_(\w+)\b/))){return}var a=b.href;tgt=$(tgt[1]);new Request({url:b.href,onSuccess:function(d,f){var e=(d.indexOf("<!--nologin-->")<0);if(!e){login(["tt","ajax","returnTo",a+"&rd=1","greeting","showuserreviews_vote_25ee"])}else{tgt.innerHTML=d}},onFailure:ta.util.error.ajaxFailure.partial("behavior:js_ajaxLogin")}).send()};linkMap.js_ajaxReport=function(a,b){ajaxReport.attempt(b,a)};var ajaxReport=function(a){new Event(a).preventDefault();ta.overlays.loadInLightbox(this.href)};function toggle(a){new Event(a).preventDefault();this.toggleClass("off")}var toggleMeRule=function(a){if(false==a.hasClass("defaultOpen")){a.addClass("off")}a.getElements(".show").addEvent("click",toggle.bind(a));a.getElements(".hide").addEvent("click",toggle.bind(a))};rules["#TOGGLEME"]=toggleMeRule;rules["#TOGGLEME2"]=toggleMeRule;ajaxRules["div.js_swapBlocks"]=function(b){var a=b.getElement(".js_swapOut");var c=b.getElement(".js_swapIn");var d=b.getElement("a.js_swapTrigger");var e=b.getElement("a.js_swapBackTrigger");if(a&&c&&d){d.addEvent("click",function(f){new Event(f).preventDefault();window.removedBit=a.dispose();c.show()});d.removeClass("js_swapTrigger")}if(a&&c&&e){e.addEvent("click",function(f){new Event(f).preventDefault();c.hide();$("parentOfSwapOut").appendChild(window.removedBit)});e.removeClass("js_swapBackTrigger")}};ajaxRules["#PM_UNBLOCK"]=function(a){a.addEvent("submit",function(c){new Event(c).stop();var b=$("PM_UNBLOCK");if(b.unblock.value=="1"){new Request({url:"/SendMessageRD",data:b,onSuccess:ta.overlays.showInLightbox,onFailure:ta.util.error.ajaxFailure.partial("behavior:#PM_UNBLOCK")}).request()}else{$("unblock-intercept").hide();$("blockedreply").show();b.unblock.value="1"}})};function enableCommunity(c,a){var b=c;if(!a){b=function(d){enableCommunityResponse(d,c)}}if(typeof(JS_SECURITY_TOKEN)=="undefined"){JS_SECURITY_TOKEN=""}new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeM2M",set:"on",token:JS_SECURITY_TOKEN},onSuccess:b,onFailure:ta.util.error.ajaxFailure.partial("behavior:enableCommunity")}).send()}function enableCommunityResponse(res,callback){var isf=document.getElementById("inviteStatusField");if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){isf.innerHTML=data.ERROR;isf.style.display="block"}}else{isf.innerHTML=JS_community_on;isf.style.display="block"}}function getRelativeURL(){return window.location.pathname+window.location.search+window.location.hash}var follow=function(a){return function(){window.location=$(a).href}};function showToggleBlock(a){$$(".js_toggleBlocks .js_toggleBlock").each(function(c,b){c.hide();if(c.hasClass(a)){c.show()}})}linkMap.js_toggleBlockTrigger=function(b,c){var a=b.getProperty("class");a.replace(/toggleBlock[0-9]+/g,function(d){a=d});showToggleBlock(a)};rules["#SWAPBLOCK .js_toggleBlock"]=function(b){if(b.hasClass("js_toggleBlockSelected")){var a=b.getProperty("class");a.replace(/toggleBlock[0-9]+/g,function(c){a=c});showToggleBlock(a)}};var showLastSavesRD=function(){var a=$("LAST_SAVES_PLACEHOLDER");if(typeof savesIncluded!="undefined"){if(!a){return renderLastSaves(SAVES_RECENT_SAVES)}else{a.innerHTML=renderLastSaves(SAVES_RECENT_SAVES);flyout.positionCorners()}}else{if(!a){new Asset.javascript(savesJS);showLastSavesRD.delay(125);return new Element("div",{id:"LAST_SAVES_PLACEHOLDER"})}}};var showSavesWidget=function(d,f,c,b,g,e,a){if(typeof savesIncluded!="undefined"){showSavesWidget2(d,f,c,b,g,e,a)}else{new Asset.javascript(savesJS);showSavesWidget.delay(125,null,[d,f,c,b,g,e,a])}};var savesInlineLoginOnClickHandler=function(c,a,b){if(typeof savesIncluded!="undefined"){savesInlineLoginOnClickHandler2(c,a,b)}else{new Asset.javascript(savesJS);savesInlineLoginOnClickHandler.delay(125,null,[c,a,b])}};linkMap.js_trackDirPop=function(a,b){if(actionToRecord=a.className.match(/ar_(\w+)/)){actionToRecord=actionToRecord[1];new Request({url:"/ActionRecord?action="+actionToRecord}).send()}};function clearPopupForm(){$$("#POPUP_FORM #pass").setProperty("value","");$$("#DHTMLPOPUP .error-message").empty()}linkMap.js_clearPopupForm=function(a,b){clearPopupForm()};function setPopupFormAction(a){$$("#POPUP_FORM #action").setProperty("value",a)}linkMap.js_popupFormAction1=function(a,b){setPopupFormAction("1")};linkMap.js_popupFormAction2=function(a,b){setPopupFormAction("2")};var replaceContent=ta.util.element.replaceContent;linkMap.js_replaceContent=function(d,f){var b=d.className.match(/id_([^\s"]*)?/);if(!b||b.length!=2){throw new Error("Links with behavior js_replaceContent must also have a style class id_??? to indicate which element's contents should be replaced")}b=b[1];var c=$(b);var a=d.href;if(a){replaceContent(f,c,a)}f.stop()};function doCookieCheck(){Cookie.write("SessionTest","true",{duration:0});if(Cookie.read("SessionTest")){Cookie.dispose("SessionTest");return true}return false}var doBehavior=function(b){var b=new Event(b||window.event);var a=ta.id(b.target);if(a.get("tag")!="a"){a=a.getParent("a")}if(/pid(\d+)/.test(a.className)){ta.util.cookie.setPIDCookie(RegExp.$1)}(a.className.match(/(js_\w+)/g)||[]).each(function(e){if(window.linkMap){var d=linkMap[e];if(typeof d==="function"){d(a,b)}}})};function _processLink(a){if(a.className.indexOf("js_")>=0||a.className.indexOf("pid")>=0){if(a.addEventListener){a.addEventListener("click",doBehavior,false)}else{a.attachEvent("onclick",doBehavior)}try{if(a.className.match(/\b(js_pop)/)&&window.noPopClass){a.className=a.className+" "+window.noPopClass}}catch(b){ta.util.error.record(b,"_processLink - add no pop class")}}}function processLinks(a){var b=Array.from(a.getElementsByTagName("a"));b.each(_processLink);return b.length}if(typeof behavior=="undefined"){ta.queueForLoad(function(){processLinks(document)},"ProcessLinkBehavior")}(function(){function a(){if(window==window.top){var j=Cookie.read("ajaxAction");if(j){j=j.split("|");if(/^target:(\/[\w\d_-]+)/.test(j[0])){if(window.location.pathname.indexOf(RegExp.$1)!==0){return}j=j.slice(1)}else{if(window.opener){return}}Cookie.dispose("ajaxAction",{domain:cookieDomain,path:"/"});if((j[0]=="focus"||j[0]=="click")&&j.length>1){for(var f=0;f<j.length;f+=2){var d=ta.select(j[f+1]);if(d&&d.length){try{d[0][j[f]]()}catch(g){ta.util.error.record(g,"ajaxAction",null,{funcName:j[f],elmt:j[f+1]})}}}}else{try{var b=j.slice(1);b.unshift({});b.unshift(j[0]);ta.run.apply(null,b)}catch(h){ta.util.error.record(h,"ajaxAction",null,{funcName:j[0]})}}}}}ta.queueForLoad(function(){Cookie.dispose("TATypeAhead");a();if(Browser.firefox||Browser.safari||Browser.chrome){var c=window.location.hash;if(c.length>1){c=c.substring(1)}var b=ta.id(c);if(b&&b.getTop()!=window.getScrollTop()){window.scrollTo(0,b.getTop())}}if(/^#save/.test(location.hash)){doSavesPostLoginPopup()}freshVSCookieCheck()},1,"On_Load_Popups")}());ta.queueForLoad(function(){if(typeof cpu_run!="undefined"){cpu_run()}},"Commerce Popunder");function freshVSCookieCheck(){if(typeof freshVSTrackingCookie!="undefined"&&freshVSTrackingCookie){var a=new Cookie("v1st").readRaw();if(a){new Request({url:"/VSCookieRequest"}).send()}}}function royBatty(){if(typeof taSecureToken=="undefined"||!taSecureToken){return}try{var d=Cookie.read("roybatty");if(!window.taEarlyRoyBattyStatus){if(!d){Cookie.write("roybatty",taSecureToken+",1",{domain:cookieDomain});if(ta.browser&&ta.browser.isIEMetro&&ta.browser.isIEMetro()){new Request({url:"/CookiePingback?metroBrowser=true"}).send()}else{new Request({url:"/CookiePingback"}).send()}}else{var b=d.split(",");if(b&&b.length==2){var a=parseInt(b[1],10);Cookie.write("roybatty",taSecureToken+","+a,{domain:cookieDomain})}else{if(b&&b.length==1){Cookie.write("roybatty",taSecureToken)}else{ta.util.error.record(null,"royBatty -- Bad value in cookie: "+d)}}}}ta.store("roybatty.checked",true)}catch(c){ta.util.error.record(c,"javascript exection bot detection error")}}ta.queueForLoad(function(){if(typeof royBatty!="undefined"){royBatty()}},"RoyBatty");var doSavesPostLoginPopup=function(){if(typeof savesIncluded!="undefined"){handleSavesPostLoginPopup()}else{new Asset.javascript(savesJS);doSavesPostLoginPopup.delay(125)}};if(window.showPopup){showPopup()}function setDHTMLPopupShown(){if(window.ta&&window.ta.store){window.ta.store("DHTML_POPUP_SHOWN",true)}}function checkDHTMLPopupShown(){return window.ta&&window.ta.has&&window.ta.has("DHTML_POPUP_SHOWN")}var popupConfig={};function DHTMLOverlayRequest(f,e,c,d){var b="?";if(popupConfig.servletUrl.contains(b)){b="&"}if(popupConfig.servletUrl.contains("fromServlet=")){var a=popupConfig.servletUrl+b+"Action="+f}else{var a=popupConfig.servletUrl+b+"Action="+f+"&fromServlet="+pageServlet}new Request({url:a,onSuccess:e,onFailure:c,data:d,evalScripts:true}).send()}function showDHTMLPopup(b,g,d,a,f){try{popupConfig.servlet=b;popupConfig.servletUrl=g;popupConfig.lightbox=d||(a&&a.lightbox)||false;popupConfig.options=a;if(a&&a.loading&&f){f=new Event(f);ta.id(a.loading).show().inject(document.body).setStyles({left:f.page.x+20,top:f.page.y})}DHTMLOverlayRequest("Open",DHTMLOverlayResponse,null,a?a.data:null);if(a&&a.trackInterrupt&&ta.util&&ta.util.recordInterruption){ta.util.recordInterruption("popup",a.popupName)}}catch(c){ta.util.error.record(c,"showDHTMLPopup - "+b,f)}}var DHTMLOverlayResponse=function(g){if(!g){return}if(!ta.overlays||!ta.overlays.Factory){ta.load("ta-overlays",function(){DHTMLOverlayResponse(g)});return}if(popupConfig.options&&popupConfig.options.forward&&window.popupForward){window.location=window.popupForward}$$("#FLYOUT").each(function(j,i){j.dispose()});window.lightbox.deactivate();$$(".overlay").each(function(j,i){if(j.overlay&&j.overlay.hide){j.overlay.hide()}else{if(j.hide){j.hide()}else{j.dispose()}}});if(popupConfig.options&&popupConfig.options.loading){ta.id(popupConfig.options.loading).hide()}var d;var c={};if(popupConfig.lightbox){c.backdrop=ta.overlays.BACKDROP_ALWAYS}if(popupConfig.options&&popupConfig.options.delayedPosition){c.delayedPosition=popupConfig.options.delayedPosition}if(popupConfig.options&&popupConfig.options.permanent){c.permanent=popupConfig.options.permanent}if(popupConfig.options&&popupConfig.options.closeOnDocumentClick){c.closeOnDocumentClick=popupConfig.options.closeOnDocumentClick}if(popupConfig.options&&popupConfig.options.center){c.autoShow=false;d=new ta.overlays.CenteredOverlay(c)}else{if(popupConfig.options&&popupConfig.options.permanent){c.xOffset=ta.id("PAGE").getLeft()+100;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.PermanentOverlay(c)}else{if(popupConfig.options&&popupConfig.options.daodaoPopup){c.xOffset=ta.id("PAGE").getLeft()+240;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.AbsoluteOverlay(c)}else{c.xOffset=ta.id("PAGE").getLeft()+100;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.AbsoluteOverlay(c)}}}d.loadRemoteSuccess(g);d.show();setDHTMLPopupShown();ta.popups.PopUtil.trackPopup(popupConfig.servletUrl);var h=function(){if(typeof dhtmlRedirectLink!="undefined"){window.location=dhtmlRedirectLink;return}if(this.inner.getElement(".refreshOnClose")){document.location.reload();return}if(typeof addPopupCloseClass!="undefined"&&!this.inner.getElement(".silentClose")){DHTMLOverlayRequest("Close")}if(this.inner.getElement(".popupBackOnClose")){if(/(?:^|;)\\s*TAReturnTo=\%1\%([^;]*)/.test(document.cookie)){window.location=decodeURIComponent(RegExp.$1)}else{window.location="/"}}};d.addEvent("onHide",h);if(popupConfig.servlet){d.container.addClass(popupConfig.servlet);d.container.addClass("np");if(popupConfig.servlet=="RuleBasedPopup"&&popupConfig.options&&popupConfig.options.cmsDisplayName){d.container.addClass(popupConfig.options.cmsDisplayName)}d.inner.getElements(".popupConvert").each(function(j,i){j.addEvent("click",function(){DHTMLOverlayRequest("Convert")})});d.inner.getElements(".popupDecline").each(function(j,i){j.addEvent("click",function(){DHTMLOverlayRequest("Decline")})});d.inner.getElements(".dhtmlclose").each(function(j,i){j.addEvent("click",function(){var k=d;k.hide()})});var b=function(j){var i=(j.charCode)?j.charCode:((j.which)?j.which:j.keyCode);if(i==13||i==10){e(j)}};var f=function(j){var i=(j.charCode)?j.charCode:((j.which)?j.which:j.keyCode);if(i==13||i==10){new Event(j).preventDefault()}};d.inner.getElements(".popupSubmitOnEnter").each(function(j,i){j.addEvent("keydown",b)});var a=function(i){$$("#POPUP_FORM #sendpass").setProperty("value","true");e(i)};d.inner.getElements(".popupSendForgotEmail").each(function(j,i){j.addEvent("click",a)});var e=function(i){new Event(i).preventDefault();d.inner.getElements(".popupSubmit").each(function(k,j){k.removeEvent("click",e)});d.inner.getElements(".popupSendForgotEmail").each(function(k,j){k.removeEvent("click",a)});d.inner.getElements(".popupSubmitOnEnter").each(function(k,j){k.removeEvent("keydown",b);k.addEvent("keydown",f)});d.inner.getElements(".focusClear").each(function(k,j){k.setProperty("value","")});if(popupConfig.options&&popupConfig.options.disableOnHideForSubmit){d.removeEvent("onHide",h)}DHTMLOverlayRequest("Submit",DHTMLOverlayResponse,null,d.inner.getElementById("POPUP_FORM"))};d.inner.getElements(".popupSubmit").each(function(j,i){j.addEvent("click",e)})}if(popupConfig.options&&popupConfig.options.callback){popupConfig.options.callback(d.container)}};function expandIframe(c,a,b){if(document.getElementById(c)){document.getElementById(c).width=a;document.getElementById(c).height=b}}function collapseAd(c){var a=ta.id(c);if(a==null){return}var b=ta.id(a.parentNode);if(b&&b.hasClass&&b.hasClass("adServer")){b.addClass("taEmpty")}else{ta.util.error.record(null,"ta.common.ads.collapseAd:fail",null,{},"WARN")}}function injectAdsTargeted(a,b){if(!ta.has("p13n.requestAds")||ta.retrieve("p13n.requestAds")){ta.common.ads.injectAdsTargeted(a,b)}}function getIncrementedAdsAjaxCount(){return ta.common.ads.getIncrementedAdsAjaxCount()}window.addEvent("load",function(){if(ta.has("ads.gptEnabled")){if(window.isTabletOnFullSite){window.addEvent("orientationchange",function(){ta.common.ads.orientationChange()})}window.addEvent("onPopunderBlur",function(){ta.common.ads.resetAdRefreshFlag();ta.common.ads.setLocalStorageTargeting()});if(window.pageServlet==="Hotels"){ta.on("onUpdateHACAds",ta.common.ads.updateHotelHacAds);if(!ta.widgets.calendar.hasPageDates()){googletag.cmd.push(function(){ta.common.ads.refreshAjaxAds("#HAC_RESULTS .gptAd")})}}if(window.pageServlet==="Attractions"){window.addEvent("onAttractionFilterChange",function(){ta.common.ads.refreshAllAdsPolitely(true)})}if(window.pageServlet==="Restaurants"){window.addEvent("onRestaurantFilterChange",function(){googletag.pubads().updateCorrelator();ta.common.ads.injectAjaxAds("RestaurantSearch","#EATERY_OVERVIEW .gptAd",false);ta.common.ads.updateAdsFromAjaxTargeting("RestaurantSearch","#EATERY_OVERVIEW",["cuisine"])})}if(window.pageServlet==="Restaurant_Review"){ta.on("review_filters.filter_changed",function(){ta.common.ads.refreshAllAdsPolitely(true)});ta.on("review_keyword_search.tag_toggled",function(){ta.common.ads.refreshAllAdsPolitely(true)})}if((window.pageServlet==="HotelsList"&&ta.retrieve("ta.p13n.blender_with_category_xsells.enabled"))||(window.pageServlet==="ThemePark")){ta.on("onHACUpdateComplete",function(){ta.common.ads.refreshAllAdsPolitely(true)})}if(window.pageServlet==="VRACSearch"&&ta.retrieve("vrDblClickAdCallsEnabled")){ta.on("onVRACSearchFilterChange",function(){ta.common.ads.refreshAllAdsPolitely(true)})}if(!ta.has("ads.disableEventRefresh")){window.addEvent("focus",function(){ta.common.ads.refreshAllAdsPolitely(false)});window.addEvent("onOverlayClose",ta.common.ads.refreshAllAdsPolitely);if(ta.has("ads.calendarSelectRefresh")){window.addEvent("onCalendarSelect",function(){if(ta.common.ads.noOverlaysDisplayed()){ta.common.ads.refreshAllAdsPolitely()}})}if(window.pageServlet==="Search"){window.addEvent("onUpdateSearchResults",ta.common.ads.refreshAllAds)}}if(window.pageServlet==="Hotel_Review"||window.pageServlet==="Attraction_Review"||window.pageServlet==="Restaurant_Review"||window.pageServlet==="Tourism"){window.addEvent("scrollingTabs_Start",ta.common.ads.pauseOnScrollInjection);window.addEvent("scrollingTabs_End",ta.common.ads.resumeOnScrollInjection);window.addEvent("tabExpand_Start",ta.common.ads.roomListExpandStart);window.addEvent("tabExpand_End",ta.common.ads.refreshWhenRoomListExpand)}if(window.pageServlet==="Hotel_Review"){window.addEvent("HRReviewExpanded",ta.common.ads.refreshAllAdsPolitely)}}});ta.common.ads=(function(j,T,k,w){var f=0,J=false,u="ads.forceAdMode",I="test",af="live",R=(T.screen&&T.screen.orientation)?T.screen.orientation.type:null,x=true,P=true,d="#photos",M="gpt-ad-2x1",C="gpt-ad-2x1-b",V=1237,p=0,t=new Date().getTime(),K=10000,aa=true,ab=true,ad=T.pageServlet,c=29867505611,B=function(){ab=true;T.removeEvent("scroll",B)},ac=false,W=false,N=k.util&&k.util.localstorage&&k.util.localstorage.canUseLocalStore(),r=false,H=91472856971,D="gpt-ad-4x4-a-locationphotoalbum",L=function(ag){return typeof ag=="string"||typeof ag=="number"||typeof ag=="boolean"},l=null,F=null,v=function(ag){return(ag&&ag.id.replace(/-ref\d+/,"")==l)},i=function(){var ak=T.getWidth,ah=T.getHeight,aj=100;var ag=(typeof ak==="function")?Math.floor(ak()/aj)*aj:0;var ai=(typeof ah==="function")?Math.floor(ah()/aj)*aj:0;ag=(ag>2000)?9999:ag;ai=(ai>1500)?9999:ai;return"w"+ag+"_h"+ai},n=function(ai){var ah="WIN_SIZE";if(ai&&ai.win_size&&ai.report){var aj=ai.report;for(var ag=0;ag<aj.length;ag++){if(aj[ag].indexOf(ah)>-1){aj[ag]=aj[ag].replace(ah,ai.win_size);break}}}},U=function(ah){var al=[],aj=[];aj.top="a";aj.bottom="b";if(ah.constructor===Array){for(var ai=0,ag=ah.length;ai<ag;ai++){var ak=ah[ai];if(aj[ak]){al.push(ak);al.push(aj[ak])}}}else{if(aj[ah]){al.push(ah);al.push(aj[ah])}}return(al.length)?al:ah},a=function(ah){if(!ac||!W&&ah&&ah.tab&&ah.tab.id==="TABS_ROOMS"){return}k.remove("deferAds.ads");var an=T.getScroll().y;var ag=k.retrieve("ads.adStubs");if(ag){try{for(var ai=0,ak=ag.length;ai<ak;ai++){var am=ag[ai];var ao=k.id(am.tgt);var aj=k.common.ads.getAd(am);if(ao&&aj){if(k.has("scrollAd.enableScroll")&&v(aj)){k.common.scrollAd.resetScrollAd()}aj.injectOnScrollUp=ao.getCoordinates().bottom<an;aj.injectWhenViewable(false)}}}catch(al){k.util.error.record(al,"error resetting ads after autoScroll")}ac=false;if(k.has("scrollAd.enableScroll")){T.fireEvent("scroll")}}},y=function(ag){var ai=false;try{var ak=ag.adStub.tgt;if(ak.match(/ref\d+/)){var ah=parseInt(ak.match(/ref(\d+)/)[1],10)+1;ai=ak.replace(/ref\d+/,"ref"+ah)}else{ai=ak+"-ref1"}}catch(aj){k.util.error.record(aj,"error building refresh ad id")}return ai},z=function(ak){try{var al=ak.adStub;var ag=y(ak);if(!ag){var ah=(ak&&ak.adElem&&ak.adElem.id)?ak.adElem.id:null;throw new Error("unable to build refresh ad id for "+ah)}al.tgt=ag;var ao=k.id(ak.adElem.cloneNode(false));ao.id=al.tgt;ao.removeClass("taEmpty");if(ao.className.toLowerCase().indexOf("gutterad")==-1){ao.set("style","")}var an=k.id(ak.adId);var am=an.parentNode;am.replaceChild(ao,an);var ai=new k.common.ads.TripAd(al);ai.addTargeting(ak.slotTargeting);ai.injectWhenViewable()}catch(aj){k.util.error.record(aj,"error cloning ad for refresh")}},G=function(ah){if(!aa){return false}if(ah){return true}var ag=new Date().getTime();if(ag-t>K){t=ag;return true}else{return false}},m=function(ag,aj,ah){var ai=false;if(ag){ai=true;if(ag.getParent(".ad.inactive")){return false}if(!ah&&aj&&aj.slotTargeting&&aj.slotTargeting.disable_event_refresh){return false}if(aj.gutterAd&&k.common.behavior&&k.common.behavior.gutterAd&&!k.common.behavior.gutterAd.shouldDisplay()){return false}}return ai},ae=function(){var ai=0;if(!k.has("ads.reverseScroll")){return ai}if(T.location.hash){var ag=j.getElement(T.location.hash);if(ag&&ag.isVisible()){if(k.has("scrollingTabs.scrollOnPageLoad")){ai=k.retrieve("scrollingTabs.scrollOnPageLoad")}else{ai=ag.getCoordinates().top}if(ai>0){var ah=T.getScroll().y;if(ah==0){ab=false;T.addEvent("scroll",B)}}}}return ai},X=function(ag,an,ai,aq,al){try{if(ag&&an&&an.requestStart&&ai&&aq){var ao=50,am=ai-an.requestStart,ar=Math.floor(am/ao)*ao,aj=new Date().getTime()-an.requestStart,ak=Math.floor(aj/ao)*ao,au=an.adId.replace("gpt-ad-","").replace(/-ref\d+/g,""),at=[au,((al)?"ad:y":"ad:n"),ag.creativeId],ah="recvd_"+ar;k.trackEventOnPage("ad_latency",at.join("|"),ah,ak,true);an.requestStart=null}}catch(ap){}},E=function(aj){if(aj){try{var ah=aj.slot.getSlotId().getDomId();var ag=k.id(ah);if(ah&&ag){var an=k.retrieve("tripads."+ah);if(an&&an.requestStart){var ai=new Date().getTime();var am=!aj.isEmpty&&!ag.hasClass("taEmpty");var ak=ag.getElement("div iframe");if(am&&ak){ak.addEvent("load",function(){X(aj,an,ai,new Date().getTime(),am)})}else{X(aj,an,ai,ai,am)}}}}catch(al){}}},q=["PageType","platform","pool","rd","sess","slice","win_size","drs"],h=function(ai){var ag={};if(ai){for(var ah in ai){if(!q.contains(ah)){ag[ah]=ai[ah]}}}return ag},Y=function(ah){try{if(ah&&ah.slot&&ah.creativeId){var ag=k.id(ah.slot.getSlotId().getDomId());if(ag){ag.setAttribute("data-creative-id",ah.creativeId)}}}catch(ai){}},g=function(ag){if(ag&&!r&&k.photos&&k.photos.sponsoredVideo&&D==ag.slot.getSlotId().getDomId()){r=true;if(ag.creativeId&&ag.creativeId!=H){k.photos.sponsoredVideo.setSponsoredContentAvailable(true)}}},e=function(ag){if("VacationRentalReview"==T.pageServlet&&ag&&ag.creativeId!=(c)){k.fireEvent("VRGalleryAdContentReceived")}},Q=function(an,aj){aj=aj||M;try{if(k.retrieve("ads.attributionPixel")!==true){x=false;P=false;return}var ah=k.id(an);if(ah&&!ah.hasClass("taEmpty")&&ah.style.display!=="none"){if(M===aj){x=false}else{if(C===aj){P=false}}var am=new Element("div",{id:aj,"class":"gptAd hidden"});ah.parentNode.insertBefore(am,ah.nextSibling);var ai=k.retrieve("ads.gptBase");if(ai){var ak={base:ai,size:[[2,1]],tgt:aj,custom_targeting:{disable_event_refresh:true}};var ag=new k.common.ads.TripAd(ak);if(ag){ag.inject();k.store("tripads."+aj,ag)}else{throw new Error("TripAd is null")}}else{throw new Error("adBase not found")}}}catch(al){k.util.error.record(al,"error rendering CPM attribution pixel")}},O=function(ai){try{Y(ai);var ah=ai&&ai.slot&&ai.slot.getSlotId&&ai.slot.getSlotId();var ak=ah&&ah.getDomId?ah.getDomId():null;var ag=T.location.hash.indexOf(d)>=0;if(P&&ag){Q(ak,C)}else{if(x&&!ag){Q(ak,M)}}g(ai);if(k.has("ads.requestTracking")){E(ai)}e(ai);T.fireEvent("onAdRender",{domId:ak})}catch(aj){k.util.error.record(aj,"post render processing error")}},A=function(){localStorage.removeItem(u);T.location.reload()},S=function(){var ag=J===I?af:I;localStorage.setItem(u,ag);T.location.reload()},b=function(al){if(k.id("FRC_AD_MODE")){return}var ah=new Element("div",{id:"FRC_AD_MODE",style:"position:fixed;z-index:12000;top:0;right:0;background:#c00;color:#fff;font-size:16px;padding:5px;margin:5px;border-radius:5px",text:al});var aj=new Element("span",{style:"float:left;width:27px;height:15px;border-radius:5px;margin:3px 5px 0 0;background:#ccc;cursor:pointer;"});aj.onclick=S;var ai=al.indexOf("TEST")>-1?"right":"left";var ag=new Element("span",{style:"height:14px;width:14px;border-radius:50%;border:2px solid #555;background:#fff;margin:-2px -1px 0 -1px;float:"+ai+";"});aj.appendChild(ag);ah.appendChild(aj);var ak=new Element("span",{style:"padding-left:5px;font-size:18px;cursor:pointer;",html:"&times;"});ak.onclick=A;ah.appendChild(ak);j.body.appendChild(ah)},s=function(ag){try{if(J){var ai=ag.split("/");if(J===I){if(!ag.test(/\.test\./)){ai[2]=ai[2].replace(/\.s$/,".test.s")}b("TEST ADS")}else{ai[2]=ai[2].replace(/\.test\.s$/,".s");b("LIVE ADS")}return ai.join("/")}else{return ag}}catch(ah){return ag}},Z=function(ah){if(k.has("scrollAd.enableScroll")){if(ah&&ah.id&&v(ah)){try{k.common.scrollAd.addScrollHandler()}catch(ag){k.util.error.record(ag,"error checking for scrolling ad")}}}},o=function(ag){if(ag){if(k.has("scrollAd.enableScroll")&&v(ag)){k.common.scrollAd.resetScrollAd();ag.injectWhenViewable(false)}else{if(ag.adElem.getCoordinates().bottom<T.getScroll().y){ag.injectOnScrollUp=true}else{ag.injectOnScrollUp=false}ag.injectWhenViewable(false)}}};return{TripAd:new Class({adBase:null,adElem:null,adId:null,adSizes:[],adInjected:false,refreshWithNewContext:true,requestStart:null,adStub:null,adSlot:null,slotTargeting:{},id:null,type:null,options:{debug:false,collapse:true},Implements:[Options],initialize:function(ai,ah){try{this.setOptions(ah);this.adStub=ai;this.adBase=ai.base;this.adSizes=ai.size;this.adId=ai.tgt;this.id=ai.tgt;this.type=ai.type;this.errorKey="ads.fail."+ai.tgt;this.adElem=k.id(this.adId);this.injectOnScrollUp=false;this.reservedHeight=(this.adElem&&this.adElem.getParent(".ad"))?this.adElem.getParent(".ad").offsetHeight:0;if(!this.adElem){throw new Error("element for ad slot does not exist")}var ag;if(ad==="PricefinderPopunder"){var ak=k.common.ads.getLocalStorageTargeting();if(ak.gptBase){ai.base=ak.gptBase}if(ak.pageTargeting){ag=h(ak.pageTargeting)}}if(!k.has("tripads."+this.adId)){this.adSlot=googletag.defineSlot(s(ai.base),ai.size,ai.tgt).addService(googletag.pubads()).setCollapseEmptyDiv(this.options.collapse,!this.adStub.isExpanded);if(ai.custom_targeting&&ai.custom_targeting.companion){this.adSlot.addService(googletag.companionAds())}}else{throw new Error("ad slot has already been created")}if(ai.custom_targeting){this.addTargeting(ai.custom_targeting)}if(ag){this.addTargeting(ag)}this.addElementTargeting();k.store("tripads."+this.adId,this)}catch(aj){throw new Error("Unable to create TripAd for target "+this.adId+": "+aj.message)}},inject:function(ah){if(ah==false){this.refreshWithNewContext=false}try{var ag=k.id(this.adId);if(ag&&(ag.hasClass("inactive")||ag.getParent(".ad.inactive"))){return}if(this.adInjected){if(ag){this.adStub.isExpanded=!ag.hasClass("taEmpty")&&ag.getStyle("display")!="none";ag.removeClass("taEmpty");if(this.refreshWithNewContext){googletag.pubads().refresh([this.adSlot]);Z(this)}else{this.refresh()}}else{throw new Error("ad refresh fail, elem does not exist: "+this.adId)}}else{googletag.display(this.adId);this.adInjected=true;if(k.has("ads.requestTracking")){this.requestStart=new Date().getTime()}Z(this)}}catch(ai){if(!k.has(this.errorKey)){k.util.error.record(ai,"unable to inject TripAd for target: "+this.adId);k.store(this.errorKey,true)}}},refresh:function(){z(this)},injectWhenViewable:function(ag){if(ag==false){this.refreshWithNewContext=false}try{if(this.isInView()){this.inject(this.refreshWithNewContext)}else{this.defer()}}catch(ah){k.util.error.record(ah,"unable to inject/defer TripAd")}},defer:function(){var ai=k.retrieve("deferAds.ads")||[];var ag=ai.length>0;var ak=false;if(ag){for(var aj=0;aj<ai.length;aj++){var ah=ai[aj];if(ah&&this.adId==ah.adId){ak=true;break}}if(!ak){ai.push(this);k.store("deferAds.ads",ai)}}else{ai.push(this);k.store("deferAds.ads",ai);T.ta_handleAdDefer=k.common.ads.deferAds;T.addEvent("scroll",T.ta_handleAdDefer)}},getPosY:function(){var ag=this.adElem;return ag.getCoordinates().top},isInView:function(){if(ac){return false}if(!k.has("ads.deferEnabled")){return true}var ag=T.getScroll().y;var ah=0;if(k.has("ads_early_injection")){ah=k.retrieve("ads_early_injection")}if(this.injectOnScrollUp){return ab&&this.getPosY()+this.reservedHeight+ah>ag}else{return this.getPosY()<ag+T.getHeight()+ah}},isLeaderboard:function(){return this.adId.indexOf("gpt-ad-728x90")>-1},addElementTargeting:function(){if(this.adElem&&this.adElem.getAttribute("data-targeting")){var ah=this.adElem.getAttribute("data-targeting");if(T.JSON&&JSON.parse){try{var ag=JSON.parse(ah.replace(/'/g,'"'));this.addTargeting(ag)}catch(ai){k.util.error.record(ai,"error applying element ad targeting")}}}},addTargeting:function(ah){try{ah=this.mergeTargeting(ah);if(ah.pos){ah.pos=U(ah.pos)}if(T.isTabletOnFullSite&&R){ah.oriented=R.test(/portrait/)?"p":"l"}this.slotTargeting=ah;for(var ag in ah){this.adSlot.setTargeting(ag,ah[ag])}}catch(ai){k.util.error.record(ai,"error applying ad slot targeting")}},mergeTargeting:function(am){var ai=this.slotTargeting;for(var ah in am){if(ai[ah]==am[ah]){continue}if(ah=="kw"){ai.kw=am.kw;continue}if(ah=="proptype"){ai.proptype=am.proptype;continue}if(!ai[ah]){ai[ah]=am[ah]}else{if(L(ai[ah])){ai[ah]=[ai[ah]]}if(L(am[ah])){am[ah]=[am[ah]]}var al=ai[ah].concat(am[ah]);var ak=[];for(var ag=al.length-1;ag>-1;ag--){var aj=al.pop();if(!ak.contains(aj)){ak.push(aj)}}ai[ah]=ak.reverse()}}return ai},clearTargeting:function(){this.adSlot.clearTargeting();this.slotTargeting={}},updateHotelStyle:function(ah){if(ah&&this.adSlot){ah=ah.toLowerCase();var ag={};ag.triptype=ah;var ai=k.common.ads.SEGMENT_MAP[ah];if(ai){ag.seg=ai}this.addTargeting(ag)}},updateHotelType:function(ag){if(ag&&this.adSlot){ag=ag.toLowerCase();var ah={};ah.proptype=ag;var ai=k.common.ads.SEGMENT_MAP[ag];if(ai){ah.seg=ai}this.addTargeting(ah)}},isVisible:function(){return this.adElem.isVisible()}}),injectAjaxAds:function(ai,ag,ah){if(!(T.googletag&&T.googletag.cmd)){k.util.error.record(null,"googletag not defined, unable to inject ads for servlet: "+ai+","+ag);return}googletag.cmd.push(function(){if(typeof ai=="string"){var al="ads."+ai.toLowerCase();var am=k.retrieve(al+".adStubs");var ak=k.retrieve(al+".pageTargeting");var aj=j.getElements(ag);if(am&&am.length&&aj.length){aj.each(function(an){var ar=false;for(var aq=0;aq<am.length;aq++){var au=am[aq];if(au&&au.tgt){var av=au.tgt.split("-");var ap=av.slice(0,av.length-1).join("-");if(an.id.indexOf(ap)>-1){au.tgt=an.id;ar=au;break}}}if(ar){try{var ao=k.common.ads.getAd(ar);if(ao){if(ak){ao.addTargeting(ak)}ao.injectWhenViewable(ah)}}catch(at){k.util.error.record(at,"unable to inject ajax ad for: "+ar.tgt)}}})}}})},getSidebarElem:function(){if(k.retrieve("hr_below_the_fold_redesign.enabled")){return j.getElement(".accommodation_card_wrap")}if(k.retrieve("persistent_sidebar")){return j.getElements("#BODYCON .gridA .sidebar").getLast()}return j.getElement(".scrollAdSidebar")||j.getElement("#BODYCON .gridA .sidebar")},setAdIdThatEnablesScrolling:function(ag){if(ag){l=ag.replace(/-ref\d+/,"");return}F=k.common.ads.getSidebarElem();if(F){var ai=F.getElements(".gptAd");for(var ah=ai.length-1;ah>=0;ah--){if(!ai[ah].hasClass("inactive")){l=ai[ah].id.replace(/-ref\d+/,"");break}}}},getAd:function(ap,ai){var am=null;if(ap){try{if(ap.tgt){var at="tripads."+ap.tgt;if(k.has(at)){am=k.retrieve(at);var aq=k.id(am.adId);if(aq){am.adElem=aq}else{var au=k.id(ap.tgt.replace(/-ref\d+/,""));if(au){am.adElem=au;am.adId=am.id=au.id}else{am=null}}}else{try{am=new k.common.ads.TripAd(ap)}catch(ao){return null}}}else{var an=ap;var ah=ai?k.retrieve("ads."+ai+".adStubs"):k.retrieve("ads.adStubs");if(ah){for(var al=0;al<ah.length;al++){var ak=ah[al];if(ak.tgt&&ak.tgt.test(/-ref\d+/)&&!an.test(/-ref\d+/)&&ak.tgt.replace(/-ref\d+/,"")==an){var ag=k.id(an);if(ag){ag.id=an=ak.tgt}}if(ak.tgt==an){try{var ar="tripads."+ak.tgt;if(k.has(ar)){am=k.retrieve(ar);break}else{am=new k.common.ads.TripAd(ak);break}}catch(ao){return null}}}}}if(k.common.behavior&&k.common.behavior.gutterAd){var av=k.id(ap.tgt);if(av&&av.hasClass(k.common.behavior.gutterAd.adElemClass)&&am){am.gutterAd=true}}}catch(ao){var aj=(typeof ap=="string")?ap:ap.tgt;k.util.error.record(ao,"unable to get ad for id: "+aj)}}return am},getIncrementedAdsAjaxCount:function(){return ++f},checkForSponsoredVideo:function(){if(k.id(D)){var ag="#"+D;k.common.ads.injectAjaxAds("locationphotoalbum",ag,false)}else{k.util.error.record(null,"sponsored video 4x4 ad target not found, sponsored video skipped")}},disableRefresh:function(){aa=false},initDoubleClick:function(){if(N&&localStorage.getItem(u)){J=localStorage.getItem(u)}var ag=j.createElement("script");ag.async=true;ag.type="text/javascript";var ai="https:"==j.location.protocol;ag.src=(ai?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var ah=j.getElementsByTagName("script")[0];ah.parentNode.insertBefore(ag,ah);googletag.cmd.push(function(){k.common.ads.addPageTargeting();if(k.has("jwplayerHelper.adUrl")){googletag.pubads().enableVideoAds()}k.common.ads.setAdIdThatEnablesScrolling();googletag.enableServices();k.common.ads.injectViewable();if(k.has("ads.peelbackEnabled")&&k.id("gpt-peelback")&&k.has("ads.gptBase")){if(j.body.offsetWidth>=V){googletag.defineOutOfPageSlot(k.retrieve("ads.gptBase"),"gpt-peelback").addService(googletag.pubads()).setCollapseEmptyDiv(true);googletag.display("gpt-peelback")}else{k.store("ads.pbSuppress",true)}}googletag.pubads().addEventListener("slotRenderEnded",O)})},addPageTargeting:function(){try{var ah=k.retrieve("ads.pageTargeting")||{};ah.win_size=i();n(ah);for(var ag in ah){googletag.pubads().setTargeting(ag,ah[ag])}}catch(ai){k.util.error.record(ai,"GPT init: unable to add page targetiing")}},orientationChange:function(){R=T.screen.orientation.type;k.common.ads.refreshAllAdsPolitely(true)},injectViewable:function(){p=ae();var ak=k.retrieve("ads.adStubs");if(ak&&ak.length){for(var aj=0;aj<ak.length;aj++){var ai=ak[aj];if(ai.tgt){var ah=k.id(ai.tgt);if(ah&&ah.hasClass&&!ah.hasClass("delayAd")){try{var ag=new k.common.ads.TripAd(ai);if(k.has("ads.reverseScroll")&&ag.getPosY()<p){ag.injectOnScrollUp=true}if(ag.isInView()){ag.inject()}else{ag.defer()}}catch(al){k.util.error.record(al,"unable to create TripAd object for "+ai.tgt)}}}}}},collapseAd:function(ag){if(k.has("ads.gptEnabled")&&ag&&ag.parentNode){var ah=ag.parentNode;do{if(ah.className&&ah.className.indexOf("gptAd")>-1){ah.className+=" taEmpty";break}}while(ah=ah.parentNode)}},injectAdsTargeted:function(ah,ai){if(ah==null||typeof ah!="object"){k.util.error.record("ad injection requires target element, element passed is "+typeof ah);return}var ag=ah;ag.inject(ag.refreshWithNewContext);if(!ai){ai=null}},getMetaContent:function(ai){var al=j.getElementsByTagName("meta");for(var ah=0;ah<al.length;ah++){var ak=al[ah];var ag=ak.name;var aj=new RegExp(ai,"i");if(ag.match(aj)){return ak.content.replace(/["<>]/g,"")}}return""},loadMonikersAdcomHelper:function(){var ag=k.common.ads.getMetaContent("keywords");var ai=k.common.ads.getMetaContent("description");var aj=j.location.href;var al=j.referrer;var ah="/uvpages/adcom.html?pageRef="+encodeURIComponent(al)+"&keywords="+encodeURIComponent(ag)+"&description="+encodeURIComponent(ai)+"&pageUrl="+encodeURIComponent(aj);var ak=j.createElement("iframe");ak.setAttribute("width","1");ak.setAttribute("height","1");ak.setAttribute("src",ah);j.body.appendChild(ak)},SEGMENT_MAP:{"family-friendly":"fam",trendy:"trendy_hotel",business:"biz",on_the_beach:"beach",ski_in_out:"ski",luxury:"luxury",spa:"spa",casino:"casino"},deferAds:function(){var ap=k.retrieve("deferAds.ads"),al,am;if(!ap){return}try{var ao=false;for(al=0,am=ap.length;al<am;al++){var aj=ap[al];if(aj&&aj.isVisible()&&aj.isInView()){injectAdsTargeted(aj);if(k.servlet.HotelReview){k.servlet.HotelReview.pushXsellToBottom.delay(1000)}if(k.eateries){k.eateries.pushXsellToBottom.delay(1000)}if(k.attractions){k.attractions.pushXsellToBottom.delay(1000)}ao=true;delete ap[al]}}if(ao){var ag=[];for(al=0,am=ap.length;al<am;al++){if(typeof ap[al]!="undefined"){ag.push(ap[al])}}if(ag.length>0){k.store("deferAds.ads",ag)}else{k.remove("deferAds.ads");T.removeEvent("scroll",T.ta_handleAdDefer)}}}catch(an){try{T.removeEvent("scroll",T.ta_handleAdDefer)}catch(ak){}var ah=(aj&&aj.id)?aj.id:"undefined";var ai="ta.common.Ads.deferAds: Error with defer. ad ID: "+ah;k.util.error.record(an,ai)}},queueForInjection:function(ag){if(!(T.googletag&&T.googletag.cmd)){k.util.error.record(null,"googletag not defined, unable to queue ad for injection");return}if(ag&&ag.each){googletag.cmd.push(function(){ag.each(function(ah){var ai=k.common.ads.getAd(ah);if(ai){ai.injectWhenViewable(false)}})})}},resetAdRefreshFlag:function(){t=new Date().getTime()},setLocalStorageTargeting:function(){if(N){if(k.has("ads.gptBase")){localStorage.setItem("ads.storage.gptBase",k.retrieve("ads.gptBase"))}if(k.has("ads.pageTargeting")){localStorage.setItem("ads.storage.pageTargeting",JSON.stringify(k.retrieve("ads.pageTargeting")))}}},detectAdBlockers:function(){if(k.trackEventOnPage&&T.Browser){var ah=function(ak){T.setTimeout(function(){var an=true;var ap=k.id("ABCHK");var ao=function(ar,aq){if(an){if(!aq){ar="none"}ar+="_"+Browser.name;k.trackEventOnPage("ab_chk",ar,aq,0,false);an=false}};if(ap){var am=ap.style.display=="none"||ap.className!="adInner";if(!am&&T.getComputedStyle){var al=T.getComputedStyle(ap);am=al&&al.getPropertyValue("display")=="none"}ao(ak,am)}},500)};var ag=T.CDNHOST||"";var aj=ag+"/img2/x.gif?ads=1&rnd="+Math.floor(Math.random()*100000);var ai=new Element("img",{id:"ABCHK","class":"adInner",height:0,width:0,src:aj});ai.onload=function(){ah("ab")};ai.onerror=function(){ah("abp")};j.body.appendChild(ai)}},getLocalStorageTargeting:function(){var ag={};if(N){if(localStorage.getItem("ads.storage.gptBase")){ag.gptBase=localStorage.getItem("ads.storage.gptBase")}if(localStorage.getItem("ads.storage.pageTargeting")){ag.pageTargeting=JSON.parse(localStorage.getItem("ads.storage.pageTargeting"))}}return ag},hasStoredGeo:function(){var ag=false;if(N&&localStorage.getItem("ads.storage.pageTargeting")){var ah=JSON.parse(localStorage.getItem("ads.storage.pageTargeting"));ag=!!ah.geo}return ag},refreshWhenRoomListExpand:function(){setTimeout(a,500);W=true},roomListExpandStart:function(){ac=true;W=false;k.common.ads.emptyGutterAd()},emptyGutterAd:function(){ac=true;var ag=k.find(".gptAd.gutterAd");if(ag){ag.empty()}},pauseOnScrollInjection:function(ag){ac=true;if(ag&&ag.tab&&ag.tab.id==="TABS_ROOMS"){k.common.ads.emptyGutterAd()}},resumeOnScrollInjection:function(ag){a(ag)},noOverlaysDisplayed:function(){if(k.overlays&&k.overlays.getCurrent){return typeof k.overlays.getCurrent()==="undefined"}else{return true}},refreshAjaxAds:function(ag){var ah=j.getElements(ag);ah.each(function(ai){var aj=k.common.ads.getAd(ai.id);if(aj&&aj.adElem&&aj.adElem.getCoordinates){if(aj.adElem.getCoordinates().bottom<T.getScroll().y){aj.injectOnScrollUp=true}else{aj.injectOnScrollUp=false}aj.injectWhenViewable(false)}})},refreshAllAdsPolitely:function(ag){k.common.ads.refreshAllAds.delay(1,null,[ag])},updateAdsFromAjaxTargeting:function(ak,ai,aj){var ah=k.retrieve("ads."+ak.toLowerCase()+".pageTargeting");if(ah){var ag=k.retrieve("ads.adStubs")||[];ag.each(function(an){var am=k.id(an.tgt);if(!am||!am.getParent(ai)){var al=k.common.ads.getAd(an);if(al){if(aj){aj.each(function(ao){if(ah[ao]){var ap={};ap[ao]=ah[ao];al.addTargeting(ap)}})}o(al)}}})}},refreshAllAds:function(ag){if(!(G(ag)&&T.googletag&&T.googletag.cmd)){return}googletag.cmd.push(function(){try{var ak=k.retrieve("ads.adStubs");if(ak){googletag.pubads().updateCorrelator();for(var aj=0;aj<ak.length;aj++){var ai=ak[aj];var ah=k.id(ai.tgt)||k.id(ai.tgt.replace(/-ref\d+/,""));var am=k.common.ads.getAd(ai);if(ah&&am){if(m(ah,am,ag)){o(am)}}}}}catch(al){k.util.error.record(al,"error refreshing all ads")}})},refreshAdsWithStyle:function(ag){k.common.ads.refreshAdsWithStyleOrType(ag)},refreshAdsWithType:function(ag){if(!ag){var ah=k.retrieve("sel.category");if(ah){var ai={cat_1:"hotels",cat_2:"bbs_inns",cat_3:"spec_lodge"};ag=ai[ah]}}if(ag){k.common.ads.refreshAdsWithStyleOrType(null,ag)}},refreshAdsWithStyleOrType:function(ai,ah){var ag=k.id("right_hand_rail")!==null||k.find(".scrollingGutterAd")!==null;if(!ai&&!ah){return}if(ai){ai=ai.toLowerCase()}if(ah){ah=ah.toLowerCase()}if(k.has("ads.gptEnabled")){if(!(T.googletag&&T.googletag.cmd)){k.util.error.record(null,"googletag not defined, unable to refresh ads for style change");return}try{if(k.has("scrollAd.enableScroll")&&ag){k.common.scrollAd.resetScrollAd()}googletag.cmd.push(function(){try{var an=k.retrieve("ads.adStubs");if(an&&an.each){if(ag){an.each(function(aq){if(aq.tgt&&k.id(aq.tgt)){var ap=k.common.ads.getAd(aq);if(ap&&!(ap.slotTargeting&&ap.slotTargeting.kw)){ai&&ap.updateHotelStyle(ai);ah&&ap.updateHotelType(ah);ap.injectWhenViewable(false)}}})}else{for(var am=0;am<an.length;am++){var al=an[am];if(al.type==="leaderboard_top"&&k.id(al.tgt)){var ak=k.common.ads.getAd(al);if(ak&&!(ak.slotTargeting&&ak.slotTargeting.kw)){ai&&ak.updateHotelStyle(ai);ah&&ak.updateHotelType(ah);ak.injectWhenViewable(false);break}}}}}}catch(ao){k.util.error.record(ao,"unable to refresh ads for style change via googletag")}})}catch(aj){k.util.error.record(aj,"unable to refresh ads for style change")}return}else{k.util.error.record(null,"Non GPT call to refresh ads for style change")}},refreshSidebarAds:function(){if(!F){return}var ag=F.getElements(".gptAd");ag.each(function(ah){var ai=k.common.ads.getAd(ah.id);if(ai){ai.injectWhenViewable()}})},refreshSideBarAdsWithRefreshOrdKey:function(){if(k.retrieve("did_ad_refresh")){return}k.store("did_ad_refresh",true);if(k.has("ads.gptEnabled")){var ah=k.select(".sidebar .gptAd");var ag=j.getElement(".iab_leaBoa .gptAd");if(ag){ah.push(ag)}if(ah.length){ah.each(function(ai){var aj=k.retrieve("tripads."+ai.id);if(aj){aj.injectWhenViewable()}})}}else{k.util.error.record(null,"Non GPT call to refresh sidebar ads")}},stringifyTargeting:function(ah){var ai="";for(var ag in ah){if(ai.length){ai+="&"}if(L(ah[ag])||(typeof ah[ag]=="object"&&ah[ag].length)){ai+=ag+"="+ah[ag].toString()}}return encodeURIComponent(ai)},updateHotelHacAds:function(){k.fireEvent("onUpdateAdsChoice");googletag.cmd.push(function(){googletag.pubads().updateCorrelator();k.common.ads.injectAjaxAds("Hotels","#ACCOM_OVERVIEW .gptAd",false);k.common.ads.updateAdsFromAjaxTargeting("Hotels","#ACCOM_OVERVIEW",["proptype","star","brand","subBrand"])})},setMinRefresh:function(ag){K=ag}}}(document,window,ta));var ta=window.ta||{};ta.common=ta.common||{};ta.common.ads=ta.common.ads||{};ta.common.ads.remarketingOptions=ta.common.ads.remarketingOptions||{};(function(){var b=function(c){return ta.common.ads.remarketingOptions[c]};var a=ta.util&&ta.util.error?ta.util.error.record:function(){};ta.common.ads.loadMonikers=function(c){try{if(!b("pixelsEnabled")){return null}c=c||{};c.pixelType="PAGEVIEW";if(b("pixelContext")&&(b("pixelContext").servlet=="HotelBookingRoomSelectionHtml"||b("pixelContext").servlet=="MobileHotelBookingRoomSelection")){c.pixelType="IB_CLICK";ta.common.ads._addIBPageViewContext(c)}var d=ta.common.ads._loadMonikers(c);if(window.ta&&ta.m&&b("cacheMobileClickoutResponse")){c.pixelType="CLICKOUT";ta.common.ads._cacheClickoutMonikers(c)}return d}catch(f){a(f,"ads.loadMonikers",null,{context:c})}return null};ta.common.ads.loadClickoutMonikers=function(c){try{if(!(b("pixelsEnabled")&&b("clickoutPixelsEnabled"))){return null}if(ta.common.ads._cachedClickoutMonikerText){return ta.common.ads._appendMonikersIFrameText(ta.common.ads._cachedClickoutMonikerText)}c=c||{};c.pixelType="CLICKOUT";return ta.common.ads._loadMonikers(c)}catch(d){a(d,"ads.loadClickoutMonikers",null,{context:c})}return null};ta.common.ads.loadLightboxMonikers=function(d,g){try{if(!b("pixelsEnabled")){return null}d=d||{};d.pixelType="LIGHTBOX_CLICK";var c=ta.common.ads._mergeContexts(d,g);var f=ta.common.ads._loadMonikers(c);return f}catch(h){a(h,"ads.loadLightboxMonikers",null,{context:d})}return null};ta.common.ads.loadLightboxClickoutMonikers=function(c){try{if(!(b("pixelsEnabled")&&b("clickoutPixelsEnabled"))){return null}c=c||{};c.pixelType="LIGHTBOX_CLICKOUT";return ta.common.ads._loadMonikers(c)}catch(d){a(d,"ads.loadLightboxClickoutMonikers",null,{context:c})}return null};ta.common.ads.loadIBClickMonikers=function(c){return ta.common.ads._loadMonikersForPixelType(c,"IB_CLICK")};ta.common.ads.loadIBRoomSelectMonikers=function(c){return ta.common.ads._loadMonikersForPixelType(c,"IB_ROOM_SELECT")};ta.common.ads.loadIBConfirmMonikers=function(c){return ta.common.ads._loadMonikersForPixelType(c,"IB_CONFIRM")};ta.common.ads._loadMonikersForPixelType=function(d,c){try{if(!(b("pixelsEnabled")&&b("ibPixelsEnabled"))){return null}d=d||{};d.pixelType=c;return ta.common.ads._loadMonikers(d)}catch(f){a(f,"loadMonikers for pixelType, ",null,{context:d})}return null};ta.common.ads._cacheClickoutMonikers=function(e){var f=b("pixelContext");var c=ta.common.ads._mergeContexts(f,e);var d=ta.common.ads._buildPixelUrl(c);if(!d){return}var g=new XMLHttpRequest();g.open("GET",d,true);g.onreadystatechange=function(){if(this.readyState==4){ta.common.ads._cachedClickoutMonikerText=this.response}};g.send()};ta.common.ads._addIBPageViewContext=function(c){if(document.getElementById("roomList")){c.lowestPrice=document.getElementById("roomList").dataset.lowestPrice}if(document.getElementById("roomInfoContainer")){c.lowestPrice=document.getElementById("roomInfoContainer").dataset.lowestPrice}};ta.common.ads._buildPixelUrl=function(e){if(!b("pixelServlet")){a(null,"ads._buildPixelUrl: remarketing.pixelServlet not set");return null}var f=b("pixelList");if(!f){return null}var c="/"+b("pixelServlet")+"?pixelList="+f;for(var d in e){if(e.hasOwnProperty(d)){c+="&"+d+"="+e[d]}}if(ta.uid){c+="&puid="+ta.uid}return c};ta.common.ads._appendMonikersIFrame=function(c){var d=document.createElement("iframe");d.setAttribute("id","Monikers");d.setAttribute("style","border:none");d.setAttribute("width","1");d.setAttribute("height","1");d.setAttribute("src",c);document.body.appendChild(d);return d};ta.common.ads._appendMonikersIFrameText=function(d){var c=document.createElement("iframe");c.setAttribute("id","Monikers");c.setAttribute("style","border:none");c.setAttribute("width","1");c.setAttribute("height","1");c.setAttribute("srcdoc",d);document.body.appendChild(c);return c};ta.common.ads._mergeContexts=function(f,e){if(!f){return e}else{if(!e){return f}}var d;var c={};for(d in f){if(f.hasOwnProperty(d)){c[d]=f[d]}}for(d in e){if(e.hasOwnProperty(d)){c[d]=e[d]}}return c};ta.common.ads._loadMonikers=function(f){var h,c;try{h=b("pixelContext");c=ta.common.ads._mergeContexts(h,f);var d=ta.common.ads._buildPixelUrl(c);if(!d){return null}return ta.common.ads._appendMonikersIFrame(d)}catch(g){a(g,"ads._loadMonikers",null,{pixelContext:h,extraContext:f})}return null}})();if(typeof ta.common=="undefined"){ta.common={}}ta.common.dmp=function(l,k,f){var d=null,h=null,e=false,c=false,i=[/^modules\.common\.CityPageRatings/,/^meta_lightbox_open_button/,/^Meta_VP_Submit_Hotels/,/^reviews_travelerphotos/i,/_url_deals/i,/_url_hotel/i,/_url_packages/i,/_url_virtual_tour/i,/abandonedcart/i,/attraction_filter/i,/Attraction_Listing/i,/attraction_multi_click/i,/attraction_sort/i,/attractionbookbutton/i,/attractions_/i,/book_tour_click/,/CertificatOfExcellence/,/commerce_click_/i,/cruisecritic/i,/Eatery_Listing/i,/filters/i,/floatingmap/i,/greenleaders/i,/helpful_vote/i,/helpfulvotegiven/i,/herophotoscrollright/i,/Hotel_Review_EMAIL/i,/keyword_search_num_results/i,/map_/i,/meta_click/i,/meta_style/i,/MobileBusinessListings/i,/more_info_click/i,/multi_click/i,/p13n_tag_select/i,/photos_traveler/i,/rac_result/i,/reservation_button/i,/reserveclick/i,/restaurant_filter/i,/restaurant_sort/i,/restaurant_tag/i,/Reviews_Controls_/i,/reviews_expand/i,/reviews_viewed/i,/reviewstab_vr/i,/saveComplete/i,/self_tags/i,/ShowUserReviews_EMAIL/i,/sliderMoved/i,/special_offer_click/i,/sticky_header_click/i,/tab_button/i,/tab_click/i,/tablecell_click/i,/tag_cloud_click/i,/uber/i,/war_complete/i],g=function(n){if(n){var o=true;o&=b(n,"getName");o&=b(n,"load");o&=b(n,"setUUID");o&=b(n,"setBehaviors");o&=b(n,"addBehavior");o&=b(n,"send");return o}return false},b=function(o,n){if(o){return typeof o[n]=="function"}else{return false}},j=function(n,o){if(typeof o=="undefined"){o="INFO"}if(o=="ERROR"){f.common.dmp.errorRecord(null,n,null,null,o.toUpperCase())}if(c&&console.log){console.log("[ta.common.dmp] ["+o.toUpperCase()+"] "+n)}},m=function(o,n){if(typeof n=="undefined"||n==null||typeof n=="object"){return o}var p=n.toString();if(p.length){if(o==null||o.length<1){o=p}else{o+="_"+p}}return o},a=function(n){try{for(var o=0;o<i.length;o++){if(i[o].test(n)){return true}}if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isValidGABehavior=="function"){return f.common.dmp.behaviorTracker.isValidGABehavior(n)}}catch(p){j("Error evaluating GARecord behavior whitelists","ERROR")}return false};return{isEnabled:function(){if(!h){if(f.common.dmp.store){h=f.common.dmp.store.getValue("dmpEnabled")===true}else{h=false}}return h},errorRecord:function(){if(f&&f.util&&f.util.error&&f.util.error.record){f.util.error.record.apply(this,arguments)}},isValidBehavior:function(n){if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isValidBehavior=="function"){return f.common.dmp.behaviorTracker.isValidBehavior(n)}return true},isNewBehavior:function(n){if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isNewBehavior=="function"){return f.common.dmp.behaviorTracker.isNewBehavior(n)}return true},init:function(){try{if(!f.common.dmp.isEnabled()){j("DMP disabled","INFO");return}if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.init=="function"){f.common.dmp.behaviorTracker.init()}var o=f.common.dmp.store.getBehaviors();var p=f.common.dmp.store.getActiveDMP();if(p){if(g(p)){d=p;var s=f.common.dmp.store.getValue("taUUID");if(s){d.setUUID(s)}if(c){for(var r in o){for(var q=0;q<o[r].length;q++){j("setting initial behavior "+r+"="+o[r][q])}}}if(o!=null){d.setBehaviors(o)}f.common.dmp.store.clearBehaviors();d.load()}else{var n=(typeof p.getName=="function")?p.getName():"Unknown DMP";j(n+" failed interface sanity check","ERROR")}}e=true}catch(t){j("init failed. "+t,"ERROR")}},addBehavior:function(o,p){try{if(this.isEnabled()&&this.isValidBehavior(p)&&this.isNewBehavior(o+","+p)){if(e&&d){j("addBehavior "+o+"="+p,"DEBUG");d.addBehavior(o,p)}else{j("addBehavior called, but DMP not yet initialized; adding to stored behaviors: "+o+"="+p,"DEBUG");var n=f.common.dmp.store.getBehaviors();if(!n[o]){n[o]=[p]}else{n[o].push(p)}f.common.dmp.store.setBehaviors(n)}}}catch(q){j("addBehavior failed. "+q,"ERROR")}},addBehaviorBatch:function(n,r){if(this.isEnabled()){for(var q in n){if(n.hasOwnProperty(q)){var o=n[q];if(Object.prototype.toString.call(o)==="[object Array]"){for(var p=0;p<o.length;p++){this.addBehavior(q,o[p])}}else{if(typeof o=="string"||typeof o=="number"){this.addBehavior(q,o)}}}}if(r){f.common.dmp.send()}}},addGABehavior:function(q,r,p,v,u){var n=false;try{var s=f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.addDeviceSpecificGABehaviors=="function"&&f.common.dmp.behaviorTracker.addDeviceSpecificGABehaviors(q,r,p,v);if(s){return true}var o=m(null,q);if(q=="p13n_tag"&&r!=null){o=m(o,r.split(":",1)[0])}else{o=m(o,r)}if(!(q=="Attractions"&&p&&p.match(/^\d+$/))){o=m(o,p)}if(!(((q=="Meta_HAC_Filter"&&p=="neighborhood")||q=="FlashPhotoUploader")&&v&&v.match(/^\d+$/))){o=m(o,v)}if(o!=null&&o.length&&a(o)){f.common.dmp.addBehavior("GARecord",o);n=true}}catch(t){j("addGABehavior failed. "+t,"ERROR")}return n},sendGABehavior:function(o,s,n,r,q){var p=f.common.dmp.addGABehavior(o,s,n,r,q);if(p){try{f.common.dmp.send()}catch(t){j("Calling ta.common.dmp.send failed in sendGABehavior. "+t,"ERROR")}}},sendEventBehavior:function(q,s,p,r,o){if(f.common.dmp&&typeof f.common.dmp.behaviorTracker.addEventBehavior=="function"){var n=f.common.dmp.behaviorTracker.addEventBehavior(q,s,p,r,o);if(n){f.common.dmp.send()}}},send:function(){try{if(f.common.dmp.isEnabled()&&e&&d){j("send behaviors","DEBUG");d.send()}}catch(n){j("send failed. "+n,"ERROR")}},sendAjaxBehavior:function(n,o){if(typeof n=="string"&&n.length>0&&o!=null){f.common.dmp.addBehavior(n,o);f.common.dmp.send()}},log:j}}(document,window,ta);ta.common.dmp.bluekai=(function(r,n,o){var y="Bluekai",u=n.bluekaiClientId||17576,q=20645,h=4,g={},m=false,l=null,f=false,v=0,d=false,z=("https:"==r.location.protocol?"https":"http")+"://tags.bkrtx.com/js/bk-coretag.js",j=0,k=r.domain,A=false,b="",w=function(){try{if(!o.common.dmp){p("Bluekai._addBehaviorsToBlueKai exception: ta.common.dmp not loaded yet","ERROR")}else{var E=false;b="";for(var C in g){for(var B=0;B<g[C].length;B++){if(o.common.dmp.isValidBehavior(g[C][B])){p("adding behavior "+C+" = "+g[C][B],"DEBUG");l.bk_addPageCtx(C,g[C][B]);E=true;if(A){b+=(b.length>0?"::":"")+C+"="+g[C][B]}}}}}}catch(D){p("Bluekai._addBehaviorsToBlueKai exception. "+D,"ERROR")}return E},t=function(){if(o.common.dmp.store&&o.common.dmp.store.isMobileDevice()){return q}return u},i=function(){try{if(e("_addSendBehaviors")){var B=w();if(B){if("https:"==r.location.protocol){l.bk_pixel_url="https://tags.bluekai.com/"}l.bk_doJSTag(t(),h);s();if(A){A=false;o.trackEventOnPage("DMPBluekai","internal_tracking",b)}}}else{p("Bluekai._addSendBehaviors couldn't send. The API isn't accessible (_hasAPILoaded returned false) even though _loaded = "+d,"WARN")}}catch(C){p("Bluekai._addSendBehaviors general exception: "+C,"ERROR")}},c=function(){return m!==false},s=function(){g={}},p=function(C,D){try{if(typeof D=="undefined"){D="DEBUG"}if(console.log&&f){console.log("[ta.common.dmp.bluekai] ["+D+"] "+C)}if(D!="DEBUG"){o.common.dmp.errorRecord(null,C,null,null,D.toUpperCase())}}catch(B){}},e=function(C){if(!l){if(r.getElementById("BK_CONTAINER")&&r.getElementById("BK_CONTAINER").contentWindow){l=r.getElementById("BK_CONTAINER").contentWindow}}var B="";if(C&&typeof C=="string"){B=C+" -> "}B=B+"Bluekai._hasAPILoaded returned false ";if(!r.getElementById("BK_CONTAINER")){p(B+"- iframe element has not created","WARN");return false}else{if(!r.getElementById("BK_CONTAINER").contentWindow){p(B+"- the iframe contentWindow returned null","WARN");return false}else{if(!l){p(B+"- BK iframe container is not yet initialised","WARN");return false}else{if(typeof l.bk_addPageCtx!="function"){p(B+"- BK API bk_addPageCtx function is not found","WARN");return false}else{if(typeof l.bk_doJSTag!="function"){p(B+"- BK API bk_doJSTag function is not found","WARN");return false}else{return true}}}}}},x=function(){try{var C=false;if(n.ta&&o.common.dmp.store){C=o.common.dmp.store.getValue("dmpPerfLoggingEnabled")===true}if(C&&v>0){p("Bluekai loaded in "+(new Date().getTime()-v)+" ms.","INFO")}}catch(B){}},a=function(){return o.common.dmp.store&&o.common.dmp.store.getValue("dmpMeasureTest")};return{getName:function(){return y},load:function(){try{f=o.common.dmp.store&&o.common.dmp.store.getValue("dmpConsoleDebugEnabled");p("loading Bluekai API","DEBUG");var B='<script type="text/javascript" src="'+z+'"><\/script>';var F='<iframe name="__bkframe" height="0" width="0" frameborder="0" src="javascript:void(0)"></iframe>';var C='<script type="text/javascript"> function hasBluekai(win) { return ( win.ta && win.ta.common &&  win.ta.common.dmp && win.ta.common.dmp.bluekai) ? true : false; } var win = window; while(win.parent && win.parent != win && !hasBluekai(win)) { win = win.parent; } if(hasBluekai(win)) {  if(win.ta.common.dmp.bluekai.shouldIframeDomainBeSet()) {    document.domain = win.ta.common.dmp.bluekai.getParentPageDomain();  }  win.ta.common.dmp.bluekai.sendAfterLoad(); }<\/script>';var D=r.createElement("iframe");D.id="BK_CONTAINER";D.src="javascript:'<html><head>"+B+"</head><body>"+F+C+"</body></html>'";D.width=0;D.height=0;D.frameBorder=0;D.title="";D.role="presentation";v=new Date().getTime();r.body.appendChild(D);l=D.contentWindow}catch(E){p("Bluekai.load general exception. Failed to load API. "+E,"ERROR")}},shouldIframeDomainBeSet:function(){try{l.document&&typeof l.bk_addPageCtx=="function"}catch(B){return true}return false},getParentPageDomain:function(){return k},setUUID:function(B){m=B},setBehaviors:function(B){g=B||{}},addBehavior:function(B,C){if(!g[B]){g[B]=[C]}else{g[B].push(C)}},sendAfterLoad:function(){try{if(e("sendAfterLoad")){x();d=true;if(j>0){p("Bluekai API successfully loaded after "+j+" retries.","WARN")}p("sending initial behaviors","DEBUG");l.bk_addPageCtx("__bk_l",r.location.href);if(c()){p("sending UUID: "+m,"DEBUG");l.bk_addPageCtx("uuid",m)}l.bk_allow_multiple_calls=true;if(o.common.dmp.store&&o.common.dmp.store.getValue("dmpBlueKaiEnableMultipleIframes")){l.bk_use_multiple_iframes=true}l.bk_ignore_meta=true;A=a();i()}else{j++;if(j<=3){n.setTimeout(o.common.dmp.bluekai.sendAfterLoad,(200*j))}else{p("Bluekai API failed to load after 3 retries. Giving up.","WARN")}}}catch(B){p("Bluekai.sendAfterLoad general exception: "+B,"ERROR")}A=false},send:function(){if(d){i()}}}}(document,window,ta));ta.common.dmp.store=(function(){var a={};var b={};var d=null;var c=false;return{setBehaviors:function(e){a=e||{}},clearBehaviors:function(){a={}},getBehaviors:function(){return a},storeValue:function(e,f){b[e]=f},hasValue:function(e){return typeof b[e]!="undefined"},getValue:function(e){return b[e]},getActiveDMP:function(){return d},setMobileDevice:function(){c=true},isMobileDevice:function(){return c},setActiveDMP:function(e){d=e}}}());ta.common.dmp.behaviorTracker=(function(r,j,k){var h=[];var w=[];var g=[/^attraction_deep_link/,/hotel_review/i];var s=[/^thirty_days$/i,/^review$/i,/^vrpi$/i,/^attrpi$/i,/^flightspi$/i,/^bookingpi$/i,/^travelocitypi$/i,/^expediapi$/i,/^hotelscompi$/i,/^pricelinepi$/i,/^cheaptixpi$/i,/^venerepi$/i,/^splendiapi$/i,/^agodapi$/i,/^olotelspi$/i,/^hrspi$/i,/^ebookerspi$/i,/^edreamspi$/i,/^hotelclubpi$/i,/^tcookukpi$/i,/^wotifaupi$/i,/^despegarpi$/i,/^beach_b$/i,/^budget_b$/i,/^luxury_b$/i,/^natparks_b$/i,/^romance_b$/i,/^spa_b$/i];var e=false,u=false;var o=/^\/((Hotel|Restaurant|Attraction)_Review|VacationRentalReview)/i,a=/reviews/i,p=null;var t=function(x){try{for(var y=0;y<g.length;y++){if(g[y].test(x)){return true}}}catch(z){n("Error evaluating GARecord behavior blacklists","ERROR")}return false},v=function(x){for(var y=0;y<g.length;y++){if(g[y].test(x)){return true}}return false},b=function(){try{if(j.ta&&k.widgets&&k.widgets.calendar&&k.util&&k.util.date){var x=k.widgets.calendar.getPageInDate();if(x){var z=k.util.date.getDaysInRange(new Date(),x)-1;k.common.dmp.addBehavior("Calendar","days_to_trip_"+z);var E=m(x);if(E){k.common.dmp.addBehavior("Calendar","start_"+E)}var F=q(x);if(F){k.common.dmp.addBehavior("Calendar_Month",F)}var C=k.widgets.calendar.getPageOutDate();if(C){var y=k.util.date.getDaysInRange(x,C)-1;k.common.dmp.addBehavior("Calendar","stay_duration_"+y);var A=m(C);if(A){k.common.dmp.addBehavior("Calendar","end_"+A)}var D=q(C);if(D&&D!=F){k.common.dmp.addBehavior("Calendar_Month",D)}}}}}catch(B){n("Error adding calendar behaviors","ERROR")}},q=function(x){var y=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];try{if(x&&x.getMonth()>=0&&x.getMonth()<y.length){return y[x.getMonth()]}}catch(z){n("Error getting month from date "+x,"ERROR")}return"unknown"},m=function(x){var z=["sun","mon","tue","wed","thu","fri","sat"];try{if(x&&x.getDay()>=0&&x.getDay()<z.length){return z[x.getDay()]}}catch(y){n("Error getting day of week from date "+x,"ERROR")}return"unknown"},d=function(y,x){u=y||u;e=x||e;if(u&&e){k.common.dmp.addBehavior("Meta_Click",u+"_rank_"+e);u=false;e=false}},n=function(x,y){if(k.common.dmp&&typeof k.common.dmp.log=="function"){k.common.dmp.log(x,y)}},i=function(){var z=k.find("#REVIEWS .reviewSelector");if(z){var x=z.getCoordinates().top||0;var y=j.getScroll().y;var A=j.getHeight();if(x>0&&(y+(A/2))>=(x)){f("reviews_scrolled",true);j.clearInterval(p)}}},f=function(A,z){if(!A||!j.location){return}var y=o.exec(j.location.pathname);var x="";if(y&&y.length>=2){x=y[1]}if(x&&x.length>0){k.common.dmp.addBehavior(A,x)}if(z){k.common.dmp.send()}},l=function(){if(j.location){var x=j.location.pathname;var y=j.location.hash;if(x&&o.test(x)){if(y&&a.test(y)){f("reviews_viewed")}else{if(k.common.dmp.store&&k.common.dmp.store.getValue("dmpReviewReadTest")){p=i.periodical(30000)}}}}},c=function(x,y){if(x&&y&&y.length){x.push(y)}};return{init:function(){b();l();if(k.common.dmp.store&&k.common.dmp.store.getValue("dmpMetaExposedEnabled")){this.sendMetaExposedTags();j.addEvent("HRHacComplete",this.sendMetaExposedTags)}},isNewBehavior:function(x){try{if(x&&!h.contains(x)){h.push(x);return true}return false}catch(y){n("Error evaluating whether to send interval behavior to DMP","ERROR")}return true},isValidBehavior:function(x){try{for(var y=0;y<s.length;y++){if(s[y].test(x)){n("Blacklisted behavior: "+x,"DEBUG");return false}}}catch(z){n("Error evaluating behavior blacklists","ERROR")}return true},isValidGABehavior:function(x){return t(x)},addDeviceSpecificGABehaviors:function(y,A,x,z){if(A=="meta_click"){d(false,z);return true}if(y=="CheckRates"){d(x,false);return true}if(y=="DATEPICKER"&&A=="SELECT"){b();return true}return false},addEventBehavior:function(z,B,y,A){if(v(z)){var x=[z];c(x,B);c(x,y);c(x,A);k.common.dmp.addBehavior("GARecord",x.join("_"));return true}return false},sendMetaExposedTags:function(){if(k.common.dmp.store&&k.common.dmp.store.getValue("dmpMetaExposedEnabled")){var y=/MainCommerce.*\\N:(\d+).*?\\PN:(BookingCom).*?\\F:(\w+)/;try{k.select(".impressionTrackingTree").each(function(B){if(B){var A=B.innerHTML;var z=y.exec(A);if(z&&z.length>3){var E=z[2];var C=z[3];var D=z[1];var F=E+"_"+C+"_rank_"+D;if(!w.contains(F)){k.common.dmp.sendAjaxBehavior("Meta_Exposed",F);w.push(F)}}}})}catch(x){n("Error scraping meta exposed data for DMP. "+x,"ERROR")}}}}}(document,window,ta));ta.maps=ta.maps||{};ta.maps.trackpixel=(function(a,d,b,e){var c=[];return{storeTrackPixleSrc:function(f){if(f){c.push(f)}},loadSponsorTrackingPixel:function(f){c.each(function(g){var h=g.trim();var i=new Element("img",{"class":"tracking"});i.src=h});if(!f){c=[]}}}}(document,window,ta));linkMap.js_modifySub=function(a,b){modifySub.apply(a,[b])};rules["#NEWSLETTER_CALLOUT input.memberUpdateEmail[type=text]"]=function(a){$("memberUpdatesEmailDefault").hide();$(a.form).addEvent("submit",function(b){if(a.value==$("memberUpdatesEmailDefault").innerHTML){a.value=""}})};function alertIfEmpty(a){if(a&&a.value==""){if(msg=a.className.match(/\bmsg_([\w\d]+)\b/)){alert(window[msg[1]])}else{alert("The field can not be empty")}return false}return true}function addNonMember(c,b){if(!b){b=this}popupConfig.clickedElement=b;new Event(c).preventDefault();var a="/MemberBenefitsPopup";if(/pid(\d+)/.test(b.className)){a+="?pid="+RegExp.$1}showDHTMLPopup("MemberBenefitsPopup",a,true)}function clickNonMember(){setTimeout("window.lightbox.deactivate()",500);if(popupConfig.clickedElement==null){return}var a=popupConfig.clickedElement;popupConfig.clickedElement=null;$$("#TRAVEL_GUIDES_LANDER .clickNonMember").each(function(c,b){c.removeEvent("click",addNonMember)});$$("#TRAVEL_GUIDES_FLY .clickNonMember").each(function(c,b){c.removeEvent("click",addNonMember)});if(a.className.match(/\bclickPopDestMOGLink\b/)){processPopDestMOGLink(null,a)}else{if(a.get("tag")=="a"){window.location=a.getProperty("href")}else{a.click()}}}function processPopDestMOGLink(b,a){if(!a){a=this}if(!loggedIn){addNonMember(b,a)}else{processGuideLink(b,a)}}rules["#TRAVEL_GUIDES_LANDER .clickNonMember"]=rules["#TRAVEL_GUIDES_FLY .clickNonMember"]=function(a){if(a.get("tag")!="a"||!a.className.match(/\bskipATag\b/)){a.addEvent("click",addNonMember)}};rules["#TRAVEL_GUIDES_LANDER .clickPopDestMOGLink"]=function(a){a.addEvent("click",processPopDestMOGLink)};rules["#HELP_CENTER dl.js_toggleset"]=function(a){var c=0;var b=new ToggleSet(a.getElements("dt"),a.getElements("dd"));if(window.location.hash&&(hash=window.location.hash.match(/c(\d+)/))){b.display(parseInt(hash[1]))}};rules["#TAB_CONTAINER"]=ta.widgets.tabContainer;linkMap.js_replaceContentSet=function(c,f){var d=c.className.match(/set_([^\s"]*)?/);if(!d||d.length!=2){throw new Error("Links with behavior js_replaceContentSet must also have a style class set_??? to indicate the set of elements the contents of which should be replaced")}var a=c.className.match(/id_([^\s"]*)?/);if(!a||a.length!=2){throw new Error("Links with behavior js_replaceContentSet must also have a style class id_??? to indicate which element's contents should be replaced")}a=a[1];var b=$(a);if(!b){throw new Error("Element of id "+a+" does not exist.")}d=d[1];replaceContentSet(d,f,b.id)};var replaceContentSet=function(h,j,f){j=new Event(j);var b=$$("a.set_"+h);for(var c=0;c<b.length;c++){var k=b[c];var g=k.className.match(/id_([^\s"]*)?/);if(!g||g.length!=2){throw new Error("Links with behavior js_replaceContentSet must also have a style class id_??? to indicate which element's contents should be replaced")}g=g[1];var d=$(g);var a=k.href;if(c==b.length-1&&f){d.addEvent("onContentReplaced",function(){window.setTimeout(function(){window.location.hash=f},200)})}else{if(f){d.removeEvents("onContentReplaced")}}if(a){replaceContent(j,d,a)}}j.stop()};function vrCalculator(c,g){var f=g!=null?new Event(g):null;if(c&&/pid(\d+)/.test(c.className)){ta.util.cookie.setPIDCookie(RegExp.$1)}var b="";var a=$("homePageVRCalcPromo");if(!a){a=$("calculatorOverviewPromo")}if(!a){a=$("calculatorLanderPromo")}if(!a){a=$("expandedHomePageVRCalcPromo")}if(a&&$("vrCalculatorForm")){var d=a.getElement("#geoName");if(d.hasClass("focusClear")){d.value="";d.removeClass("focusClear")}b="&geoName="+a.getElement("#geoName").value;if(a.getElement("#adults")){b+="&adults="+a.getElement("#adults").value}if(a.getElement("#nights")){b+="&nights="+a.getElement("#nights").value}}new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,backdropClickClose:true,onReady:function(){this.inner.getElement("input").focus()}}).loadRemoteContent("/VacationRentalCalculator?restart=true"+b);if(f){f.stop()}return false}linkMap.js_submitVRCalculator=function(b,g){var d=g!=null?new Event(g):null;var h=$("vrCalculator");var c=h.getElement("form");var f=h.getElement(".serverErrorMsg");if(f){f.style.display="none"}if(c.geoName.value==""){h.getElement(".errorMsg").style.display=""}else{var a=c.action+"?"+c.toQueryString();replaceContent(g,h.getParent(),a)}if(d){d.stop()}return false};var SocialHistory=function(){var o={f:["http://www.facebook.com/","https://login.facebook.com/login.php","http://www.facebook.com/home.php"]};var l={};function m(s,r,i){if(s.currentStyle){var t=s.currentStyle[i]}else{if(window.getComputedStyle){var t=r.defaultView.getComputedStyle(s,null).getPropertyValue(i)}}return t}function j(i){i.parentNode.removeChild(i)}function p(){var i=document.createElement("iframe");i.style.position="absolute";i.style.visibility="hidden";document.body.appendChild(i);if(i.contentDocument){i.doc=i.contentDocument}else{if(i.contentWindow){i.doc=i.contentWindow.document}}i.doc.open();i.doc.write("<style>");i.doc.write("a{color: #000000; display:none;}");i.doc.write("a:visited {color: #FF0000; display:inline;}");i.doc.write("</style>");i.doc.close();return i}var g=p();function c(r,s){var i=g.doc.createElement("a");i.href=r;i.innerHTML=a;g.doc.body.appendChild(i)}for(var a in o){var n=o[a];for(var h=0;h<n.length;h++){c(n[h],a);if(n[h].match(/www\./)){var e=n[h].replace(/www\./,"");c(e,a)}else{var d=n[h].indexOf("//")+2;var f=n[h].substring(0,d)+"www."+n[h].substring(d);c(f,a)}}}var q=g.doc.body.childNodes;for(var h=0;h<q.length;h++){var k=m(q[h],g.doc,"display");var b=k!="none";if(b){l[q[h].innerHTML]=true}}j(g);return new (function(){var i=[];for(var r in l){i.push(r)}this.visitedSites=function(){return i};this.doesVisit=function(t){if(typeof(o[t])=="undefined"){return -1}return typeof(l[t])!="undefined"};var s=[];for(var r in o){s.push(r)}this.checkedSites=function(){return s}})()};function sniffFacebook(){var d=false;try{var a=SocialHistory();var b=a.visitedSites();if(b[0]=="f"){d=true}}catch(c){}return d};function registerOnLoad(b,a){if(ta&&ta.queueForLoad){ta.queueForLoad(b,a)}else{window.addEvent("load",b)}}function registerOnUnload(a){window.addEvent("unload",a)}function getScrollOffset(){return[window.getScrollLeft(),window.getScrollTop()]}function isIn(h,j,a){var d=getScrollOffset();j=$(j);var g=findPos(j);var e=g[0]-d[0];var i=g[1]-d[1];var c=e+j.clientWidth;var f=i+j.clientHeight;if(a){if(typeof(a)=="number"){e=e-a;i=i-a;c=c+a;f=f+a}else{if(a instanceof Array&&(a.length==2||a.length==4)){i=i-a[0];c=c+a[1];e=e-(a.length==4?a[3]:a[1]);f=f+(a.length==4?a[2]:a[0])}}}return(h[0]>=e&&h[0]<=c&&h[1]>=i&&h[1]<=f)}function setDetails(b,d,a,c){new Event(b).stop();$("title").value=d;$("category").value=a;$("space").value=c;$("newPage").submit()}function setOneTimeCookie(a,b){Cookie.write(a,b,{domain:cookieDomain,time:5});return true}function setOneTimeCookieOnFQDN(a,b){Cookie.write(a,b,{time:5});return true}var getChildByClass=function(e,d,c){if(!d||d.length==0){if(c==e.tagName){return e}}else{if(e.className&&(!c||c==e.tagName)){var f=-1;do{f=e.className.indexOf(d,f+1);if(f>=0&&(f==0||e.className.charCodeAt(f-1)==32)&&(f+d.length==e.className.length||e.className.charCodeAt(f+d.length)==32)){return e}}while(f>=0)}}for(var b=0;b<e.childNodes.length;b++){var a=getChildByClass(e.childNodes[b],d,c);if(a){return a}}return null};function showPrivacyPolicy(){window.open("/pages/privacy.html","PrivacyPolicy","toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars=3,width=800,height=600,screenX=30,screenY=25,left=30,top=25")};ta.common.header=(function(){var e=false;var b=false;var a;ta.queueForLoad(function d(){var i=4;var j=ta.select(".masthead h1")[0];if(!j||!j.textContent||!j.textContent.length){return}var f=j.cloneNode(true);f.style.overflow="hidden";f.style.visibility="hidden";f.style.position="absolute";j.appendChild(f);var h=f.textContent;var g=h.length-1;while(g>0&&f.clientHeight>=45){while(g>0&&h.charAt(g)!==" "){g--}h=h.substring(0,g)+"...";f.textContent=h;f.offsetWidth}if(f.textContent.length>=i){j.textContent=f.textContent}},50,"ta.Header.truncateLongMasthead");var c=(function(){var g={};var f={};f.open=function(m,h,j,l,k,i){if(m in g){g[m].show();return true}else{k=k||{};i=i||{};require(["overlays/Overlay","overlays/styles/modal","overlays/styles/dropdown","overlays/position","overlays/options/closeOnDocClick","overlays/options/closeOnEscape","overlays/options/closeOnSourceClick","overlays/options/autoReposition","overlays/styles/windowshade","overlays/options/ajax"],function(o,w,z,q,u,y,v,n,s,p){var r=k.direction||"below";var x=k.type=="dropdown"?z:w;var t=g[m]=new o(h,[x(h,r,l,""),q[r](k.offset||[0,0]),u,v,y,n,k.windowshade&&s(),k.url?p(k.url,{resources:k.resources}):null]);i.show&&t.on("show",i.show.bind(null,g[m]));i.hide&&t.on("hide",i.hide.bind(null,g[m]));k.url&&i.load&&t.on("contentLoaded",i.load.bind(null,t));t.arrow&&t.arrow.destroy();t.show();if(j){t.contentElement.innerHTML=j;i.load&&i.load(t)}});return false}};f.close=function(h){h in g&&g[h].hide()};f.openSubmenu=function(h,n,l,m,i,p){var u,j=[],t;var q=function(w,v){j[v]=w;if(t){clearTimeout(t);t=0}if(!j[0]&&!j[1]){t=setTimeout(function(){if(!j[0]&&!j[1]){c.close(h)}},300)}};var s=q.bind(null,true,0);var o=q.bind(null,false,0);var k=q.bind(null,true,1);var r=q.bind(null,false,1);c.open(h,n,l,m,i,{show:function(v){u=n.onmouseover;n.onmouseover=null;ta.addEvents(n,{mouseover:s,mouseout:o});ta.addEvents(v.container,{mouseover:k,mouseout:r});p&&p.show&&p.show()},hide:function(v){ta.removeEvents(n,{mouseover:s,mouseout:o});ta.removeEvents(v.container,{mouseover:k,mouseout:r});n.onmouseover=u;p&&p.hide&&p.hide()}})};return f})();return{createNavMenu:function(g,f){f=f||{};g.hoverIntent({over:(function(){var h=false;return function(){if((this.hasClass("ownerMenu")||this.hasClass("warLink"))&&ta.has("disableBehindAccountMenu")){return}if(f.initFn&&!h){f.initFn();h=true}var i=ta.find(".subNav",this);i.show();if(f.showFn){f.showFn.call(null,evnt)}window.fireEvent("onOverlayShow")}})(),out:function(i){var h=ta.find(".subNav",this);h.hide();if(f.hideFn){f.hideFn.call(null,i)}},timeout:f.timeout||500})},openAccountMenu:function(f){ta.trackEventOnPage("TopNav","open","Signed_in_profile_dropdown");var g=ta.find(".bizMenu.overlayContents",f);if(g){a=g.innerHTML;g.destroy()}c.open("profile",f,ta.find(".overlayContents",f).innerHTML,"accountMenuFlyout dropMenu",{type:"dropdown"},{show:function(){ta.store("disableBehindAccountMenu",1);ta.fireEvent(window,"mastheadFlyoutOpened")},hide:ta.remove.bind(null,"disableBehindAccountMenu")});return false},openBizListingsMenu:function(f){if(!a){return false}c.openSubmenu("bizListings",f,a,"dropMenu bizListingsMenuFlyout",{direction:"right",type:"dropdown"});return false},openCurrencyPicker:function(h,g){var f="global_currency_picker_overlay";if(ta.retrieve("currency_format_using_icu4j_cldr.featureEnabled")=="true"){f+=" currency_format_using_icu4j_cldr"}c.open("currency",h,null,f,{type:"dropdown",url:"/StaticVelocityPage?t=currency_picker.vm",resources:[globalCurrencyPickerCSS]},{show:ta.fireEvent.bind(null,window,"mastheadFlyoutOpened"),load:ta.trackEventOnPage.bind(null,"CurrencyPicker","Open",g)});return false},openPosSelector:function(g){window.flagsUrl=document.location.pathname;var h="/StaticVelocityPage?t=intSitesFly.vm&lt=evt&footerFlagFormat="+footerFlagFormat+"&flagsURL="+encodeURIComponent(flagsUrl+(document.location.search||"")+(document.location.hash||""))+"&useHreflangs="+(ta.util.URL.getServletNameFromUrl(window.location.pathname)==="ShowTopic")+(window.modelGeoId?"&geo="+modelGeoId:"")+(window.pageFeature?"&pageFeature="+pageFeature:"");if(window.flagsSettings){for(var f=0;f<flagsSettings.length;f++){h+="&"+flagsSettings[f]+"=true"}}if(window.localeCodes){h+="&localeCodes="+localeCodes}c.open("pos",g,null,"flags_flyout_overlay",{showCloseBtn:true,url:h,resources:[flagsFlyoutCSS]},{show:ta.fireEvent.bind(null,window,"mastheadFlyoutOpened"),load:function(i){if(ta.retrieve("flag_flyout_link_fixing.featureEnabled")=="true"){ta.select("a.flag_link",i.container).forEach(function(j){var k=ta.find("link[hreflang="+j.get("hreflang")+"]");if(k&&k.href){j.href=k.href}else{j.parentNode.style.display="none"}});ta.select("li.region",i.container).forEach(function(k){var j=k.style.display;k.style.display="none";ta.select("li.flag_item",k).forEach(function(l){if(l.style.display!="none"){k.style.display=j}})})}}});return false},clear:function(g,f){f=ta.id(f);f.value="";f.removeClass("hasDefault");f.removeEvent("focus","ta.common.header.clear")},clearIfEquals:function(h,f,g){if(f.value==g){ta.run("ta.common.header.clear",{},h,f)}},addClearParam:function(f){if(typeof document.cookie!=="undefined"&&document.cookie&&document.cookie.indexOf("TASession")>=0){if(ta.hac&&ta.hac.filters&&ta.hac.filters.cancelAllExistingHAC){ta.hac.filters.cancelAllExistingHAC()}var g="?";if(typeof f!=="undefined"&&f&&typeof f.href!=="undefined"&&f.href&&f.href.indexOf("clearFilters=true")<=-1){if(f.href.indexOf("?")>-1){g="&"}f.href+=g+"clearFilters=true"}}},setSearchText:function(i,g,h){g=ta.id(g);var f=g.getParent().getNext("input");f.value=h;f.addClass("hasDefault");f.addEvent("focus",function(j){ta.call("ta.common.header.clear",j,f)})},changeSearchType:function(m,g,k){g=ta.id(g);var i=g.getParent("form"),f=g.getParent().getNext("input"),j=f.getParent().getNext(),l=f.retrieve("nameTA"),h=f.retrieve("geoTA");ta.run("ta.common.header.setSearchText",{},m,g,k);if(g.id=="dropGeoRadio"){if(l){l.pause()}if(h){h.resume()}else{if(!ta.retrieve("hotelGeoTA")){ta.store("hotelGeoTA",true);ta.run("ta.widgets.typeahead.factory.location_mutable",{onComplete:function(n){f.store("geoTA",n)}},m,f,"GEO",function(){},{minLength:3})}}i.action="/HACSearch";j.show()}else{if(h){h.pause()}if(l){l.resume()}else{if(!ta.retrieve("hotelNameTA")){ta.store("hotelNameTA",true);ta.run("ta.widgets.typeahead.factory.standard_mutable",{onComplete:function(n){f.store("nameTA",n)}},m,f,"LOCATION","ta.widgets.typeahead.events.onSelectHotelDrop",{minLength:3,xargs:"&types=hotel"})}}i.action="/Search";j.hide()}},firstClickHotelText:function(k,g,j){g=ta.id(g);var i=g.getParent("form"),f=ta.id("dropGeoRadio"),h=ta.retrieve("hotelNameTA");hasGeoTA=g.retrieve("hotelGeoTA");if(f.checked){if(!hasGeoTA){ta.store("hotelGeoTA",true);ta.run("ta.widgets.typeahead.factory.location_mutable",{onComplete:function(l){g.store("geoTA",l)}},k,g,"GEO",function(){},{minLength:3})}}else{if(!h){ta.store("hotelNameTA",true);ta.run("ta.widgets.typeahead.factory.standard_mutable",{onComplete:function(l){g.store("nameTA")}},k,g,"LOCATION","ta.widgets.typeahead.events.onSelectHotelDrop",{minLength:3,xargs:"&types=hotel"})}}ta.run("ta.common.header.clear",{},k,g);g.removePropertyEvent("focus","ta.common.header.firstClickHotelText")},submitAndSetPid:function(h,g,f){setPID(f);form=g.getParent("form");if(f&&f==18898&&ta.id("dropVracGeo").value==""){window.location="/Rentals"}else{form.submit()}},submitHotelsForm:function(i,g,f){setPID(f);form=g.getParent("form");if(ta.has("useHotelsFilterState")){var h=form.toQueryString();new Request({url:"/FilterState",data:h,method:"post",onSuccess:function(j){ta.widgets.calendar.redirectToHotelOverview(j)},onFailure:function(j){ta.widgets.calendar.redirectToHotelOverview(null)}}).send()}else{form.submit()}},seeMoreOnToDoList:function(l,h,j){l.stopPropagation();var k=h.getParent("#WAR_MORE_TO_DO_ITEMS");if(k){var f=k.getChildren();if(f&&f.length>0){var g;var i=false;Array.each(f,function(p){if(p.getProperty("id")=="WAR_ADD_A_LISTING"){return}var n=p.getChildren();if(p.getProperty("id")!=j){if(i){if(n&&n.length>0){Array.each(n,function(q){if(!q.hasClass("warHeader")){q.addClass("hidden")}})}var o=p.getElement(".warHeader img.downarrow");var m=p.getElement(".warHeader img.rightarrow");if(o&&m){o.addClass("hidden");m.removeClass("hidden")}}}else{if(n&&n.length>0){Array.each(n,function(q){if(q.getProperty("id")=="warMore"){q.addClass("hidden")}else{q.removeClass("hidden")}})}i=true}})}}},seeLessOnToDoList:function(l,j,i){l.stopPropagation();var g=j.getParent("#WAR_MORE_TO_DO_ITEMS");if(g){var f=g.getChildren();if(f&&f.length>0){var h;var k=false;Array.each(f,function(o){var n=o.getChildren();if(o.getProperty("id")!=i){if(k){ta.common.header.openWARToDoListSection(o)}}else{var m=0;if(n&&n.length>0){Array.each(n,function(p){if(p.getProperty("id")=="warMore"){p.removeClass("hidden")}if(p.getProperty("id")=="warLess"){p.addClass("hidden")}if(p.hasClass("warLoc")){m++;if(m>3){p.addClass("hidden")}}})}k=true}})}}},expandWARToDoList:function(j,g,f){j.stopPropagation();var i=g.getParent("#"+f);var h=g.getChildren(".downarrow");if(h&&h.length>0){if(h[0].hasClass("hidden")){ta.common.header.openWARToDoListSection(i)}}},openWARToDoListSection:function(j){var h=j.getChildren("#warLess");if(h&&h.length>0&&!h[0].hasClass("hidden")){return}var i=j.getChildren();if(i&&i.length>0){var g=0;Array.each(i,function(l){if(l.getProperty("id")=="warMore"){l.removeClass("hidden")}if(l.hasClass("warLoc")&&g<3){l.removeClass("hidden");g++}})}var k=j.getElement(".warHeader img.downarrow");var f=j.getElement(".warHeader img.rightarrow");if(k&&f){k.removeClass("hidden");f.addClass("hidden")}},getWARNotificationFlag:function(){var h=ta.id("NO_WAR_NOTIFICATION_FLAG");if(h){return}var f=ta.id("WAR_NOTIFICATION_FLAG");if(f&&f.hasClass("hidden")){try{new Request({url:"/UserReviewToDoListAjax",data:{getCount:true},method:"get",onSuccess:function(l){var k=new Element("div",{html:l});var i=k.getElement("#WAR_NOTIFICATION_FLAG_NEW");if(i){i.replaces(f);i.setProperty("id","WAR_NOTIFICATION_FLAG")}else{var j=k.getElement("#NO_WAR_NOTIFICATION_FLAG");if(j){f.dispose()}}}}).send()}catch(g){ta.util.error.record(g,"ta.common.Header.getWARNotificationFlag");return}}},openImproveListing:function(g,h,f,i,j){window.processReq=function(){ta.servlet.Location.requestListingWithLightbox("",this,"",j,false,true)};if(f){processReq()}else{ta.store("registration.ga_module","WarToDoAddListing");ta.overlays.registration.connect({flow:"LISTINGREQ"},"SIGNIN",{LocationId:i})}},adjustFriendsLink:function(g){var f=$("TAIPPREFS");if(f){if(f.hasClass("auth_ip")){ta.util.cookie.setPIDCookie(18783)}else{if(f.hasClass("auth_fbc")){ta.util.cookie.setPIDCookie(15210)}else{return true}}window.location="/Friends";return false}return true},hideWarTodoDropdown:function(f){if(!e){return}var g=api.find(".masthead_war_dropdown");if(f===true||(f&&api.containsElement(g,f.target))){return}api.removeClass(api.find(".subNav",g),"shown");e=false;api.removeClass(g,"masthead_war_dropdown_active")},warTodoDropdownOnClick:function(h){if(!b){b=true;ta.common.header.createWARToDoListOverlay(h);api.addEvent(window,"click",ta.common.header.hideWarTodoDropdown);api.addEvent(window,"mastheadFlyoutOpened",ta.common.header.hideWarTodoDropdown)}var g=ta.find(".masthead_war_dropdown");if(!e){ta.setEvtCookie("WAR","MASTHEAD_WAR_DROPDOWN","MASTHEAD_WAR_DROPDOWN_OPENED","39392","/UserReviewRedesign");api.addClass(g,"masthead_war_dropdown_active")}else{api.removeClass(g,"masthead_war_dropdown_active")}var f=api.find(".subNav",g);api.toggleClass(f,"shown");e=!e;ta.fireEvent(window,"mastheadFlyoutOpened",true)},createWARToDoListOverlay:function(g){ta.trackEventOnPageOnce("WAR","GLOBAL_NAV_WAR_HOVER");var i=ta.id("WAR_TODO_LOADING");if(i){var h=g?{d:g}:{};var f=ta.id("WAR_NOTIFICATION_FLAG")||ta.id("NO_WAR_NOTIFICATION_FLAG");i.removeClass("hidden");new Request({url:"/UserReviewToDoListAjax",data:h,method:"get",onSuccess:function(m){var l=new Element("div",{html:m});var j=l.getElement("#WAR_NOTIFICATION_FLAG_NEW");var n=l.getElement("#WAR_MORE_TO_DO_ITEMS");if(n){n.replaces(i)}if(f){if(j){j.replaces(f);j.setProperty("id","WAR_NOTIFICATION_FLAG")}else{var k=l.getElement("#NO_WAR_NOTIFICATION_FLAG");if(k){f.dispose()}}}}}).send()}}}})();if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["mixins/Events","utils/browserutils","mootoolsShim","dom-lib","api-mod","overlays/Overlay","overlays/ajaxUtil","overlays/options/closeOnDocClick","overlays/options/closeOnSourceClick","overlays/options/closeOnEscape","overlays/options/repositionOnEvent","overlays/options/autoReposition","overlays/options/storeOverlayOnElement","overlays/options/ajax","overlays/position","overlays/styles/modal","overlays/styles/windowshade","overlays/styles/dropdown","overlays/uiOverlay"],["ta","ta","ta","ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"common-header",files:{"js-amd":{src:{mixins:{Events:1},mootoolsShim:1,"dom-lib":1,utils:{browserutils:1},"api-mod":1,overlays:{ajaxUtil:1,uiOverlay:1,options:{autoReposition:1,closeOnEscape:1,repositionOnEvent:1,storeOverlayOnElement:1,ajax:1,closeOnDocClick:1,closeOnSourceClick:1},styles:{windowshade:1,dropdown:1,modal:1},position:1,Overlay:1}}}},_:{baseUrl:"/"}})};define("overlays/options/closeOnSourceClick",["api-mod"],function(d){function b(e){if(d.containsElement(this.sourceElement,e.target)){this.hide("source-click")}}function a(e){return function(){var g=b.bind(this);var f=(function(h){setTimeout(h.bind(this),1)}).bind(this);this.on("show",f.bind(undefined,function(){d.addEvent(this.sourceElement,"click",g);e&&d.addEvent(this.sourceElement,"touchstart",g)})).on("hide",f.bind(undefined,function(){d.removeEvent(this.sourceElement,"click",g);e&&d.removeEvent(this.sourceElement,"touchstart",g)}))}}var c=a(true);c.withoutTouchEvents=a(false);return c});define("overlays/options/storeOverlayOnElement",["api-mod"],function(b){var a=function(){if(this.sourceElement){b.store(this.sourceElement,"overlay",this)}};return a});define("overlays/styles/dropdown",["api-mod"],function(b){function c(e,f,g,d){this.container=b.createElement(d||"span",{"class":"ui_overlay ui_dropdown "+f,style:g});this.contentElement=this.container}var a=function(h,g,f,j,e,d){f=f||h.getAttribute("data-dropdown")||"";var i=e||h.getAttribute("style")||"";return function(){c.call(this,g,f,i,d);this.updateContent(j)}};return a});define("overlays/uiOverlay",["api-mod"],function(b){var c={tooltip:{defaultPosition:"above",defaultFade:"fade_short"},popover:{defaultPosition:"below",defaultFade:"fade_short"},modal:{defaultPosition:"center",defaultFixed:true,defaultFade:"fade_short"},dropdown:{defaultPosition:"below"},notification:{}};var d={};var a=function(r,h){r=r||window.event;h=h||r.target||r.srcElement;var m=r&&r.type;if(m){b.removePropertyEvent(h,m,"uiOverlay")}if(r){b.stopEvent(r)}var i=(h.getAttribute("data-position")||"").split(" ").filter(function(t){return !!t.length});var o=i.shift();var p=["overlays/Overlay","overlays/position"];var j;for(var g in c){if(h.hasAttribute("data-"+g)){o=o||c[g].defaultPosition;p.push("overlays/styles/"+g);j=true;break}}var q=h.getAttribute("data-options")||"";if(!j&&ta.util.error&&ta.util.error.record){var f="uiOverlay: no style. class="+h.className+", id="+h.id;[].forEach.call(h.attributes,function(s){if(/^data-/.test(s.name)){f+=", "+s.name+"="+s.value}});ta.util.error.record(null,f);return}p.push(h.hasAttribute("data-windowshade")?"overlays/styles/windowshade":null);var e=false;if(h.hasAttribute("data-defer")){e=parseInt(h.getAttribute("data-defer"))}p.push(e?"overlays/options/hoverDelay":null);p.push(h.hasAttribute("data-fade")?"overlays/options/fadeInOut":null);p.push(h.getAttribute("data-url")?"overlays/options/ajax":null);p.push(h.hasAttribute("data-close-event")?"overlays/options/closeOnEvent":null);p.push(h.hasAttribute("data-maxWidth")?"overlays/options/maxWidth":null);p.push("overlays/options/storeOverlayOnElement");if(q){p=p.concat(q.split(" ").map(function(s){return"overlays/options/"+s}))}if(h.hasAttribute("data-tooltip")){if(m==="click"){p.push("overlays/options/closeOnDocClick")}else{if(m==="mouseover"){if(q.indexOf("closeOnMouseAway")<0){p.push("overlays/options/closeOnMouseOut")}}}}else{if(h.hasAttribute("data-dropdown")){if(m==="click"){p.push("overlays/options/closeOnDocClick");p.push("overlays/options/closeOnSourceClick")}}}var l;if(h.hasAttribute("data-unique")){l=h.getAttribute("data-unique");if(l&&(l in d)){var k=d[l];k.sourceElement=h;k.updateContent();!e&&k.show();if(h.hasAttribute("data-callback")){var n=b.fn(h.getAttribute("data-callback"));n&&n(k)}return}}require(p,function(s,u,E,v,D,A,t,z,y){var C=[E(h,o),o&&u[o](i,c[g].defaultFixed),v&&v(h.getAttribute("data-windowshade")),D&&D(e,true),A&&A(c[g].defaultFade),t&&t(),z&&z(h.getAttribute("data-close-event")),y&&y(h.getAttribute("data-maxWidth"))],w=Array.prototype.slice.call(arguments,9),x=new s(h,C.concat(w));if(m){!e&&b.addEvent(h,m,x.show);x.on("destroy",function(){b.removeEvent(h,m,x.show)})}if(l){d[l]=x;x.on("destroy",function(){delete d[l]})}!e&&x.show();if(h.hasAttribute("data-callback")){var B=b.fn(h.getAttribute("data-callback"));B&&B(x)}});return false};return a});window.uiOverlay=function(){var a=arguments;require(["overlays/uiOverlay"],function(b){b.apply(null,a)})};if(!ta.p13n){ta.p13n={}}ta.p13n.placements=(function(){var k={};var b={};var h={};var e={};function f(n,o,m,p){o=o.replace(/\.js$/i,"");k[n+":"+o]={reqs:m,inifunc:p}}function d(m,n,t,u){t=t.replace(/\.js$/i,"");var r=m[t];if(r){return r}var p=n+":"+t;if(u[t]){throw p+" depends on itself recursively"}var q=k[n+":"+t];if(!q){return window.require(t)}u[t]=true;var v=q.reqs;var s=[];for(var o=0;o<v.length;o++){s.push(d(m,n,v[o],u))}r=q.inifunc.apply({},s);u[t]=false;m[t]=r;return r}function j(p,q,o){q=q.replace(/\.js$/i,"");var m=o.id;var n=b[m];if(!n){n={placement:o};b[m]=n;o.prepareRequestData=function(){return{detail:""+o.location_id,placementName:o.name,servletClass:o.servletClass,servletName:o.servletName}};o.requestAJAXPlacement=function(u,r,t){var s=o.prepareRequestData();if(typeof Request!=="undefined"&&Request.prototype.send){if(t){s=Object.merge(s,t)}new Request({url:"/MetaPlacementAjax",data:s,evalScripts:true,onSuccess:u,onFailure:function(){ta.util.error.record(null,o.name+" load - MetaPlacementAjax request failed");if(r){r()}}}).send()}else{if(typeof z!=="undefined"&&z.ajax){if(t){s=z.extend(s,t)}z.ajax({url:"/MetaPlacementAjax",data:s,success:u,error:function(){ta.util.error.record(null,o.name+" load - MetaPlacementAjax request failed");if(r){r()}}})}}}}return d(n,p,q,{})}function l(p,s,q){var r,o,n={},m;if(!p){return}e[p]=e[p]||1000;q=q||{};r={};if(ta.widgets&&ta.widgets.calendar){o=ta.widgets.calendar.getCheckRatesData();if(o){r=o}}n={};if(ta.meta){n=ta.commerce.meta.getMetaParams()}m=ta.util.merge(r,q,{placementName:p,assets:!a(p),wrap:true,occ:e[p]},n);new Request({url:"/MetaPlacementAjax",data:m,evalScripts:true,onSuccess:function(t){e[p]++;t=g(p,t);s&&s(t)},onFailure:function(){ta.util.error.record(null,p+" load - MetaPlacementAjax request failed")}}).send()}function c(p,r,v){if(ta.retrieve("ta.redirectingPage")){return}var o=false;var u=ta.widgets.calendar.getCheckRatesData();if(!u){u={}}else{o=true}var q={};if(ta.meta){q=ta.commerce.meta.getMetaParams()}var n=Object.merge(u,q,{reqNum:r});if(v.customRequestParams){n=Object.merge(n,v.customRequestParams)}var s=v.displayableRequestNumber||1;var m=v.maxRequestNumber||5;var t=v.pollWaitTime||2000;p.requestAJAXPlacement(function(y){p.latestCrossSellResponseText=y;var C=v.readyStrings||["xsellHacStatusReady","xsellHacStatusSOL"];var x=r>=m||C.some(function(D){return y.contains(D)})||!o;var w=r>=s||x;var B=ta.id(p.id);if(!B){return}function A(E){if(E&&E.target){E.target.removeEvent("mouseout",A);E.target.removeEvent("blur",A)}var D=B.querySelector&&B.querySelector(":hover");if(D){D.addEvent("mouseout",A);return}var F=B.querySelector&&B.querySelector(":focus");if(F){F.addEvent("blur",A);return}B.setContent(p.latestCrossSellResponseText);delete p.latestCrossSellResponseText;ta.prwidgets.initWidgets(B);if(v.onSuccess){v.onSuccess()}}if(w){A()}if(!x){setTimeout(c.pass([p,r+1,v]),t)}},v.onFailure,n)}function i(n,m){if(n.autoRefreshEnabled){return}m=m||{};ta.queueForLoad(function(){var p=m.customRequestParams||{};if(m.includePackagePrivateAssetsOnDateChange){p=Object.merge(Object.clone(p),{packagePrivateAssets:true})}var s=Object.merge(Object.clone(m),{displayableRequestNumber:(m.onCalendarRangeSelectDisplayableRequestNumber||2),customRequestParams:p});ta.on("onCalendarRangeSelect",c.pass([n,1,s]));var r=Object.merge(Object.clone(m),{customRequestParams:p});ta.on("clearDates",c.pass([n,1,r]));var q=m.initialRequestNumber||1;var o=m.pollWaitTime||2000;if(ta.widgets.calendar.hasPageDates()){setTimeout(c.pass([n,q,m]),o)}},"initialize "+n.id);n.autoRefreshEnabled=true}function g(q,p){var r=document.createElement("div"),o,m,n;r.innerHTML=p;o=r.getElementsByTagName("style");while(o.length>0){n=r.removeChild(o[0]);if(!a(q)){document.head.appendChild(n)}}h[q]=true;return r.innerHTML}function a(m){return !!h[m]}return{define:f,load:j,loadDynamicPlacement:l,enableAutoRefresh:i}})();(function(g){var j=g.select||window.z||window.$||g.jquery;var m={};var c;function h(q,p,o,r){p=p.replace(/\.js$/i,"");m[q+":"+p]={reqs:o,inifunc:r}}function l(o,t,v){t=t.replace(/\.js$/i,"");var s=o[t];if(s){return s}var q=o.widget.name+":"+t;if(v[t]){throw q+" depends on itself recursively"}var r=m[q];if(!r){try{r=window.require(t)}finally{r||console.error("Can't load module '"+t+"' for widget '"+o.widget.name+"'")}return r}v[t]=true;var w=r.reqs;var u=[];for(var p=0;p<w.length;p++){u.push(l(o,w[p],v))}s=r.inifunc.apply({},u);v[t]=false;o[t]=s;return s}function a(p,q){var o=f(p);if(o){return l(o,q,{})}}function k(o){var q,p;if(!o){o=document}if(typeof(o)==="string"){o=document.getElementById(o);if(!o){return}}q=j(".prw_rup",o);for(p=0;p<q.length;p++){i(q[p])}q=j(".prw_dyn",o);for(p=0;p<q.length;p++){i(q[p])}}function i(t){var r,p,q,s,o;if(!t){return}if(t._prWidgetContext){return}r=t.getAttribute("data-prwidget-init");if(typeof(r)!="string"){return}q=t.getAttribute("data-prwidget-name");if(!q){return}r=e(r);o=e(t.getAttribute("data-scriptFlags")).reduce(function(x,w){x[w]=true;return x},{});p={widget:{name:q,element:t,modules:r,flags:o}};t._prWidgetContext=p;for(s=0;s<r.length;s++){var v=r[s];l(p,v,{})}if(t._prPendingClick){var u=t._prPendingClick;t._prPendingClick=void (0);if(u.key===c){window.setTimeout(function(){g.prwidgets.call.apply(g.prwidgets,u.args)},0)}}}function e(o){if(typeof o!=="string"){return[]}return o.match(/[^\s,]+(\s+[^\s,]+)*/g)||[]}function f(q){var p;if(!q){return null}var o=q._prWidgetContext;if(o){return o}p=b(q);if(p){o=p._prWidgetContext;if(o){q._prWidgetContext=o;return o}}return}function b(p){for(var o=p;o&&o.hasAttribute;o=o.parentNode){if(o.hasAttribute("data-prwidget-init")){return o}}return void (0)}function d(p,o){o=o||document.body;return o.getElement(".prw_"+p)}function n(v,s,r){if(typeof(v)!=="string"||!s||!r){throw"ta.prwidgets.call() requires method, event, element"}var u=v.split(".");var t=a(r,u.shift());var q=void (0);var p=(s&&s.type==="click");if(p){g.stopEvent(s);c=void (0)}if(!t){if(p){var o=b(r);if(o&&!o._prWidgetContext){c={};o._prPendingClick={key:c,args:Array.prototype.slice.call(arguments,0)}}}return false}while(u.length>0&&t){q=t;t=t[u.shift()]}if(typeof(t)!=="function"){throw"ta.prwidgets.call: '"+v+"' is not a function"}return t.apply(q||{},Array.prototype.slice.call(arguments,1))}g.prwidgets={define:h,getjs:a,initWidgets:k,getWidgetElement:d,call:n}})(ta);if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install([],[])};define("Logging",[],function(){var b=typeof IS_DEBUG!=="undefined"&&IS_DEBUG?3:-1;var a={};var d=["error","warn","dir","info","debug"];for(var c=0;c<d.length;c++){var e=d[c];a[e]=(function(g,f){return function(){if(b<f){return}if(typeof console==="undefined"||!console[g]||!console[g].apply){return}console[g].apply(console,arguments)}})(e,c)}a.setLevel=function(f){b=f};return a});(function(b){var a={ALL:"sprite-typeahead-all",GEO:"sprite-typeahead-destination",HOTELOVERVIEW:"sprite-typeahead-destination",HOTEL:"sprite-typeahead-hotel",ATTRACTION:"sprite-typeahead-attraction",EATERY:"sprite-typeahead-restaurant",VACATION_RENTAL:"sprite-typeahead-vr",FLIGHTS_TO:"sprite-typeahead-flight",AIRPORT:"sprite-typeahead-flight",AIRLINE:"sprite-typeahead-flight",THEME_PARK:"sprite-typeahead-themepark",VACATION_PACKAGE:"sprite-typeahead-hotel",SMART_DEAL:"sprite-typeahead-hotel",CHILD_TOP:"sprite-typeahead-connector-top",CHILD_BOTTOM:"sprite-typeahead-connector-bottom",NEIGHBORHOOD:"sprite-typeahead-neighborhood",TRAVEL_GUIDE:"sprite-typeahead-travel-guide"};var f={ALL:"ui_icon globe-world",GEO:"ui_icon map-pin-fill",HOTELOVERVIEW:"ui_icon map-pin-fill",HOTEL:"ui_icon hotels",ATTRACTION:"ui_icon attractions",EATERY:"ui_icon restaurants",VACATION_RENTAL:"ui_icon vacation-rentals",FLIGHTS_TO:"ui_icon flights",AIRPORT:"ui_icon flights",THEME_PARK:"ui_icon amusement-parks",VACATION_PACKAGE:"ui_icon hotels",SMART_DEAL:"ui_icon hotels",CHILD_TOP:"sprite-typeahead-connector-top",CHILD_BOTTOM:"sprite-typeahead-connector-bottom",NEIGHBORHOOD:"ui_icon neighborhoods",TRAVEL_GUIDE:"ui_icon guides",AIRLINE:"ui_icon flights"};var e={PAGE:true,BLENDER_PAGE:true,NEAR_POI:true,VACATION_PACKAGE:true,SMART_DEAL:true,FLIGHTS_TO:true};var d={FLIGHTS_TO:true,VACATION_PACKAGE:true};function h(j){return j.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00A0/g,"&nbsp;").replace(/"/g,"&quot;")}b.views||(b.views={});b.views.iconMap=a;b.views.iconFontMap=f;b.views.escapeHTML=function(j){return h(j)};var i=function(l,k){var j={};var m=[];Array.each(l,function(n){var o=n.type;j[o]=j[o]||[];j[o].push(n)});Array.each(k,function(o){var p=j[o];if(p){for(var n=0;n<p.length;n++){m.push(p[n])}}});return m};b.views.configTypeAheadOptionsForSortingByPOIType=function(l,k){var j=l.postResultsFnList||[];j.push(function(n){var m=ta.util.Deferred();n.results=i(n.results,k);m.resolve(n);return m.promise()});l.postResultsFnList=j;l.listTemplate=function(o){var n=o.results;var m=[];if(n.length>0){m.push("<ul>");Array.each(n,(function(){var q="";return function(s){if(q!=s.type){q=s.type;var r=[s.rendered];r.push('<span class="label">');r.push(s.title);r.push('<img src="/img2/x.gif" class="icon hidden" alt="">');r.push("</span>");s.rendered=r.join("")}}})());var p=(function(){var q="";var r=document.createElement("div");return function(t){var s='<li class="typeahead-choice '+h(t.title.toLowerCase())+'">'+t.rendered+"</li>";if(q!=t.type){q=t.type;r.innerHTML=s;r.firstChild.addClass("first");s=r.innerHTML}return s}})();m.push(n.map(p).join(""));m.push("</ul>")}return m.join("")}};var c={showChildren:false,tagLabels:null,poiClasses:"",geoClasses:""};b.views.itemTemplate=function(k){k=ta.extend(c,k);var l=k.useIconFont;var j=this.iconMap;if(l){j=this.iconFontMap}return function(u,t){var w=[];var y;if(u.no_icon){y=null}else{if(u.isNeighborhood){y=j.NEIGHBORHOOD}else{y=j[u.type]}}t=t||{};var q=u.icon_type||u.data_type;if(q&&d[q.toUpperCase()]){y=j[q.toUpperCase()]}if(!l&&y&&q&&e[q]){y+="-list"}if(y){var z=(l?"":"sprite-image ")+"leftIcon "+y;w.push('<div class="'+z+'"></div>')}var B;if(k.tagLabels){var r=k.tagLabels;if(u.isChild&&u.parent&&u.parent.moved){B=r.newLocation}else{if(u.moved===true){B=r.moved}else{if(u.closed===true){B=r.closed}}}if(B){w.push('<span class="search-tagged-poi" >'+B+"</span>")}}var o=u.details||u;var p=o.highlighted_name||o.name||"";var s=u.data_type==="TAG"||u.scope==="local_tag"||u.scope==="overview"||k.simpleChild&&u.isChild;var v=s?"":o.geo_name||"";if(t.HTMLEscape){p=h(p);v=h(v)}var n="poi-name "+k.poiClasses;if(!v){n+=" no-geo"}var A="geo-name "+k.geoClasses;w.push('<span class="'+n+'">');if(k.debug){w.push('<span class="debug">');w.push(typeof u.order==="number"?u.order:"??");w.push("("+(typeof u.score==="number"?u.score:"??")+")");w.push("&nbsp;</span>")}w.push(p);w.push("</span>");w.push('<span class="'+A+'">'+v+"</span>");w.push();if(k.showChildren&&u.isChild){w.unshift('<div class="child">');w.push("</div>");var x=u.lastChild?j.CHILD_BOTTOM:j.CHILD_TOP;var m="sprite-image childIcon leftIcon "+x;w.unshift('<div class="'+m+'"></div>')}return w.join("")}};b.views.configureTypeAheadForSegmentedResults=function(j,m){var v=m||{};var n=v.groupByPlacetype;var q=v.boldSearchQuery;var p=j.postResultsFnList||[];var r="search";var s="history";var u="suggested";var o="overview";var t="global";var l="local";var k=function(x){var w={};var y=function(z){if(z.type&&z.type.toUpperCase()==="SEARCH"&&z.name){return r}else{if(z.scope=="history"){return s}else{if(z.scope=="suggested"){return u}else{if(z.scope=="overview"){return o}else{if(n||(z.scope&&z.scope.lastIndexOf("local",0)===0)){return l}else{return t}}}}}};Array.each(x,function(A){var B=y(A);if(B==="history"&&A.isChild){return}var z=w[B]=w[B]||[];z.push(A)});return w};p.push(function(x){var w=ta.util.Deferred();if(v.debug){x.results.forEach(function(z,y){z.order=y})}x.results=(function(C){var D=[];Array.each(C,function(G){D.push(G);if(G.children){var I=G.children.length;for(var H=0;H<I;H++){var J=G.children[H];J.scope=G.scope;J.parent=G;D.push(J)}}});var z=k(D);var A=[];var F=[o,s,u,l,t,r];for(var B=0;B<F.length;B++){var E=F[B];var y;if(E==l&&n){y=z[E]?[].concat.apply([],g(z[E])):[]}else{y=z[E]}if(y){A=A.concat(y)}}return A})(x.results);w.resolve(x);return w.promise()});j.postResultsFnList=p;j.listTemplate=function(B){var D=[];var C=B.results;var z=k(C);var I=false;var J=false;var x=false;var E=C.length==0;var H=!(B.query&&B.query.query)&&(!z[l]||z[l].length===0)&&(!z[t]||z[t].length===0);var w=function(M,P){var O="resultContainer"+(P?" "+P:"");D.push('<ul class="'+O+'">');for(var N=0;N<M.length;N++){var L=M[N];if(!L){continue}D.push('<li class="'+(L.wrapperCSS||"")+'">');D.push(L.rendered);D.push("</li>")}D.push("</ul>")};if(z[o]&&z[o].length>0){x=true;if(v.overviewLabel){D.push('<div class="title overview">'+v.overviewLabel+"</div>")}w(z[o],"overview")}if(z[s]&&z[s].length>0){I=true;if(v.historyLabel){D.push('<div class="title history">'+v.historyLabel+"</div>")}w(z[s],B.query?null:"history bold_names")}if(z[u]&&z[u].length>0){D.push('<div class="title history">'+v.suggestedLabel+"</div>");w(z[u],"suggested")}if(!H&&v.localLabel&&(z[l]&&z[l].length>0||(v.noResultsMessage&&!x))){J=true;if(!n){D.push('<div class="title local">'+v.localLabel+"</div>")}}if(z[l]&&z[l].length>0){J=true;if(n){var G=g(z[l]);for(var A=0;A<G.length;A++){w(G[A],"local")}}else{w(z[l],"local")}}else{if(J&&v.showNoResultsMessage){D.push('<div class="no-results">'+v.noResultsMessage+"</div>")}}if(z[t]&&z[t].length>0){if(v.globalLabel&&(J||I)){D.push('<div class="title global">'+v.globalLabel+"</div>")}w(z[t],"global")}if(!H&&z[r]&&z[r].length>0){var K=z[r][0];var F=B.query&&B.query.query||"";var y="search resultContainer";if(K.noResults){y+=" noResults"}if(q){D.push('<ul class="'+y+'"><li class="searchRow">'+K.name.replace("%","<b>"+h(F)+"</b>")+"</div></li></ul>")}else{D.push('<ul class="'+y+'"><li class="searchRow">'+h(K.name.replace("%",F))+" &raquo;</div></li></ul>")}}if(E&&!H&&v.showNoResultsMessage&&v.noResultsMessage){D.push('<div class="no-results">'+v.noResultsMessage+"</div>")}return D.join("")};return v};b.views.simpleItemTemplate=function(){return function(j){return[j.details.name,'<span class="addr">',j.details.address,"</span>"].join("")}};b.views.simpleListTemplate=function(j){return function(m){if(!m.results||!m.results.length){return'<div class="noResults">'+j+"</div>"}var l=m.results||[];var k=["<ul>"];var n;l.forEach(function(o){k.push("<li>");if(o.title!==n){n=o.title;k.push('<span class="label">',n,'<img src="/img2/icons/typeahead/',o.type.slice(0,1).toLowerCase(),'.gif"/></span>')}k.push(o.rendered);k.push("</li>")});k.push("</ul>");return k.join("")}};b.views.ptptListTemplate=function(q){var y=['<div class="typeahead-choices">'];var u={};var l={history:true};var m=CDNHOST+"/img2/x.gif";function r(z){var B=z.scope=="history";var A=z.type?z.type.toLowerCase():"";var s=B?"history":A;return{historyScope:B,choiceType:A,headerType:s}}var x=q.results;var k=x.length;for(var p=0;p<k;p++){var o=x[p];var w=r(o);var j="typeahead-choice "+w.choiceType;var n=false;if(!(w.headerType in u)){j+=" first";u[w.headerType]=true;n=true}if(w.historyScope){j+=" history"}y.push('<div class="'+j+'">');y.push('<img src="'+m+'" class="icon" alt="">');y.push('<span class="cutoff">');y.push(o.rendered);y.push("</span>");if(w.historyScope){y.push('<img src="'+m+'" class="history_icon" alt="">')}y.push("</div>");var v=x[p+1];var t=v&&r(v);if(t&&l[w.headerType]&&t.headerType!=w.headerType){y.push('<div class="divider"></div>')}}y.push("</div>");return y.join("")};var g=function(l){var j={};var o=0;var q;for(var m=0;m<l.length;m++){var k=l[m];var n=/(global|local)(_(.*))?/.exec(k.scope);var r=n&&n.length>3?n[3]:k.scope;if(k.isChild&&q){j[q].push(k);continue}q=r==="tag"||r==="keyword"?"common_group":k.type;if(!j[q]){j[q]=[o++,q]}j[q].push(k)}var p=function(t){var s=[];var w=[];var v;for(v in t){if(t.hasOwnProperty(v)){w.push(t[v])}}w=w.sort(function(y,x){if(y.length<=1){return -1}if(x.length<=1){return 1}if(y[1]!=x[1]){if(y[1]=="common_group"){return -1}if(x[1]=="common_group"){return 1}}return y[0]-x[0]});for(var u=0;u<w.length;u++){s.push(w[u].slice(2))}return s};return p(j)}}(TypeAhead));if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["dual_search/DualSearch","dual_search/behaviour/Submit","dual_search/view/DimmerOverlay","dual_search/view/Default","dual_search/view/LoadingBubbles","dual_search/aux/OverviewItems","dual_search/aux/Logging"],["ta","ta","ta","ta","ta","ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"dual_search",files:{"js-amd":{src:{dual_search:{view:{LoadingBubbles:1,DimmerOverlay:1,Default:1},aux:{Logging:1,OverviewItems:1},behaviour:{Submit:1},DualSearch:1}}}},_:{baseUrl:"/"}})};define("dual_search/DualSearch",["ta","Logging","dom-lib","api-mod","mixins/mixin","mixins/Events"],function(c,d,b,e,i,j){var f=function(m,l){if(l.isNeighborhood&&l.details&&l.details.parent_ids&&l.details.parent_ids.length>0){var n=l.details.parent_ids[0];return m.replace("-g1-","-g"+n+"-zfn"+l.value+"-")}else{return m.replace("-g1-","-g"+l.value+"-")}};var a=function(p,n,l){var o=[];var q=[];function m(t,u){var r=false;o.forEach(function(w,v){if(w===u){r=v}});if(u===null){return u}else{if(r&&typeof(u)=="object"){return"(see "+u.constructor.name.toLowerCase()+" with key "+q[r]+")"}else{var s=t||"(empty key)";o.push(u);q.push(s);if(n){return n(t,u)}else{return u}}}}return JSON.stringify(p,m,l)};var h=function(t,m){i(this,j.create([].concat(h.inputEvents,h.emitEvents)));if(t.debug){d.setLevel(3);var o=this.emit;this.emit=function(u){d.info("DualSearch: emit ",u,arguments);o.apply(s,Array.prototype.slice.call(arguments))}}this.options=t;this.whatTypeahead=t.whatTypeahead;this.whereTypeahead=t.whereTypeahead;h.inputEvents.forEach(function(u){if(typeof this[u]=="function"){this.on(u,this[u])}},this);this.whereTypeahead=t.whereTypeahead;this.whatTypeahead=t.whatTypeahead;this.options=t;this.geoInfo=null;this.selection=null;var s=this;this.navigating=false;function r(){return s.selection&&!s.selection.partial&&!s.selection.tabSelection}if(this.whereTypeahead&&this.whatTypeahead){var q=function(w,x){if(x==s.whatTypeahead){s.selection=null}if(x.getInputLength(true)<(t.minCharsForSearch||1)){var u=c.util.Deferred();var v={results:[],normalized:{query:w}};u.resolve(v);return u.promise()}else{return x.searchFn(w)}};this.whatTypeahead.options.search=q;this.whereTypeahead.options.search=q;this.whatTypeahead.options.onSelect=function p(w,A,B,x,v,u){if(!w||r()){return}var z={choice:w,partial:true,tabSelection:v==="tab",url:null,context:"masthead_what",evt:u};if(s.geoInfo.geoID!=1){z.geo=s.geoInfo.geoID}var y=function(){s.selection=e.merge({},z);if(w.scope==="local_keyword"){delete s.selection.url}s.emit("select",B,z)};if(typeof w.type==="string"&&w.type.toUpperCase()==="SEARCH"){z.search=true}else{if(w.url){z.url=w.url;s.setGeoInfoFromWhatChoice(w);if(s.geoInfo.geoID!=1){z.geo=s.geoInfo.geoID}}else{z.category=w.type.toUpperCase()}}if((z.geo&&z.geo>1)||(w.type&&w.type==="AIRLINE")){z.partial=false}y();if(z.partial){s.stopWhatSearch();s.startWhereSearch(false)}};this.whereTypeahead.options.onSelect=function p(z,G,E,w,v,H){if(!z||r()){return}var C={};var F=z.urls;for(var B=0;F&&B<F.length;B++){var u=F[B];C[u.type]={url:u.url,fallback_url:u.fallback_url}}if(!z.value){s.setGeoInfo(1)}else{s.setGeoInfo(z.value,z.details.name,z.details.geo_name,C,z.details.parent_name,z.isNeighborhood,z.type)}var A={choice:z,geo:s.geoInfo.geoID,partial:true,tabSelection:v==="tab",url:null,evt:H,context:"masthead_where"};var x=function(){s.selection={choice:s.selection&&s.selection.choice||A.choice,geo:A.geo,url:A.url,category:s.selection&&s.selection.category,partial:A.partial,context:A.context,tabSelection:A.tabSelection,evt:A.evt,search:s.selection&&s.selection.search};s.emit("select",E,e.merge({},A))};if(s.selection){if(s.selection.partial&&s.selection.category&&C[s.selection.category]){var D=C[s.selection.category].fallback_url;if(D){A.url=D;A.partial=false;x();return}}if(s.selection.partial&&s.selection.url&&z.value&&z.value>1&&z.type!="AIRPORT"){A.url=f(s.selection.url,z);A.partial=false;x();return}}var y=s.whatTypeahead.getNormalizedQuery();if(!y){x();s.stopWhatSearch();s.startWhatSearch(false);return}A.whatQuery=y;A.partial=false;x()};this.whatTypeahead.options.onSelectNavigate=function(){if(r()&&!s.navigating){s.submit(null,true)}};this.whereTypeahead.options.onSelectNavigate=function(){if(r()&&!s.navigating){s.submit(null,true)}};this.whatTypeahead.options.onRender=k.bind(this,"what");this.whereTypeahead.options.onRender=k.bind(this,"where");if(t.geoInfo){this.setGeoInfo(t.geoInfo.geoId,t.geoInfo.geoName,t.geoInfo.parentName,t.geoInfo.categories,t.geoInfo.shortParentName,t.geoInfo.isNeighborhood)}else{this.clearGeoInfo()}m&&Array.isArray(m)||(m=Array.prototype.slice.call(arguments,1));for(var l=0;l<m.length;l++){try{m[l]&&m[l].call(this)}catch(n){c.util.error.record(n,"DualSearch mixin "+l)}}this.whatTypeahead.options=e.merge(this.whatTypeahead.options,{onShow:s.emit.bind(this,"dropdownShown",this.whatTypeahead),onHide:s.emit.bind(this,"dropdownHidden",this.whatTypeahead),doSelectionBeforeLogging:true});this.whereTypeahead.options=e.merge(this.whereTypeahead.options,{onShow:s.emit.bind(this,"dropdownShown",this.whereTypeahead),onHide:s.emit.bind(this,"dropdownHidden",this.whereTypeahead),doSelectionBeforeLogging:true,shouldSubmit:function(){return false}})}this.startWhereSearch=function(u){if(!g(this)){this.whereTypeahead.showStaticResultsIfEnabled()}this.emit("startSearch",u,this.whereTypeahead,"where")};this.stopWhereSearch=function(){this.whereTypeahead.hide()};this.startWhatSearch=function(u){if(!g(this)){this.whatTypeahead.showStaticResultsIfEnabled()}this.emit("startSearch",u,this.whatTypeahead,"what")};this.stopWhatSearch=function(){this.whatTypeahead.hide()}};h.inputEvents=[];h.emitEvents=["startSearch","stopSearch","dropdownShown","dropdownHidden","resultsRendered","select","geoUpdated","submit"];var k=function(m,n,l){if(l.length===0){n.hide()}this.emit("resultsRendered",n,l,m)};h.prototype.clearGeoInfo=function(){this.setGeoInfo()};h.prototype.setGeoInfoFromWhatChoice=function(l){if(l.details&&l.details.parent_name&&l.details.parent_ids&&l.details.parent_ids.length>1){var o=l.details.parent_ids[0];var n=l.details.parent_name;var m=l.details.grandparent_name;this.setGeoInfo(o,n,m,{},m,false)}};h.prototype.setGeoInfo=function(o,q,l,p,x,r,u){var n=o!==undefined;var s=this.geoInfo&&this.geoInfo.getId;var t={geoID:o||1,geoName:q||"",parentName:l||"",shortParentName:x||"",categories:{},isNeighborhood:!!r,type:u,explicitSelection:n};for(var w in p){if(p.hasOwnProperty(w)){var v=p[w];if(v.url){t.categories[w]=v}}}this.geoInfo=t;var m=s!=t.geoID;if(m){if(t.geoID==1){this.whatTypeahead.setGeoId(null)}else{this.whatTypeahead.setGeoId(this.geoInfo.geoID)}}this.emit("geoUpdated",this.geoInfo,m)};h.prototype.submit=function(l,q){if(!c){return true}var r=!!l;l=l||this.selection&&this.selection.evt;var p=this;var m=function(){p.navigating=true;setTimeout(function(){p.navigating=false;p.selection.partial=true},10000)};if(this.selection&&!this.selection.partial&&this.selection.url){m();this.emit("submit",{evt:l,redirectUrl:this.selection.url,context:this.selection.context,submit_clicked:r});return false}var o=this.whatTypeahead.getNormalizedQuery()||this.whatTypeahead.getInputText();var n=this.geoInfo.geoID>1;if(!o||!n){if(!o&&(!this.whatTypeahead.hasBeenShown||!n)){this.stopWhereSearch();this.startWhatSearch(false);return false}if(!n&&!this.whereTypeahead.hasBeenShown&&!q){this.stopWhatSearch();this.startWhereSearch(false);return false}}m();this.emit("submit",{evt:l,submit_clicked:r});return false};h.prototype.focusWhere=function(l,m){this.stopWhatSearch();this.startWhereSearch(true)};h.prototype.focusWhat=function(l,m){this.stopWhereSearch();this.startWhatSearch(true)};h.prototype.stopSearch=function(l,m){this.stopWhatSearch();this.stopWhereSearch();this.emit("stopSearch")};var g=function(l){return l.whatTypeahead.hasBeenShown||l.whereTypeahead.hasBeenShown};h.prototype.submitClicked=function(l){l.preventDefault();this.submit(l,false)};return h});define("dual_search/behaviour/Submit",["dom-lib","ta"],function(b,a){return function(){var e=a.id("global_nav_search_form");var f=function(h,i){function g(j){if(j){var m=j.length;var k;var l=j.lastIndexOf("?");if(j.indexOf("Search")>=0){return j}if(l<0){k=j+"?from_tpa=true"}else{k=j.substring(0,l+1)+"from_tpa=true&"+j.substring(l+1,m)}return k}}window.location=g(h)};var c=function(g,k){var l=this.whatTypeahead.getInputText();if(l){a.id("MASTHEAD_MAIN_QUERY").value=l}var h=a.id("TYPEAHEAD_REDIRECT");h.value="true";var i=true;var j=a.id("mainSearch");var m=a.id("TOURISM_REDIRECT");if(this.geoInfo&&this.geoInfo.geoID>1&&!l&&j&&m){m.value="true";j.value=""}return a.call("ta.common.search.recordAndValidate",g,e,i,this.whatTypeahead,!k)};var d=function(i){var g=a.id("TYPEAHEAD_GEO_ID");var h=i&&i.geoID!=1?this.geoInfo.geoID:null;g.set("value",h);var j=g.get("value")};return function(){this.whatTypeahead.options.doSelectionBeforeLogging=this.whereTypeahead.options.doSelectionBeforeLogging=true;this.whereTypeahead.options.doSelectionBeforeLogging=this.whereTypeahead.options.doSelectionBeforeLogging=true;this.on("geoUpdated",d);var g=function(h){if(h.redirectUrl){f(h.redirectUrl,h.context)}else{c.call(this,h.evt,h.submit_clicked)}};this.on("submit",g.bind(this))}}});define("dual_search/view/DimmerOverlay",["ta","dom-lib","api-mod"],function(a,c,b){return function(){var g;var f=function(){g=new Element("div",{"class":"pageDimOverlay scopeSearchOverlay"});g.appendChild(new Element("div",{"class":"inner"}));c(document.body).append(g);var h=function(){var i=b.getSize(a.id("PAGE"));g.setStyles({width:i.x,height:i.y})};h();c(window).on("resize",h)};var d=function(){g&&g.show()||f()};var e=function(h){g&&g.hide()};return function(){this.on("startSearch",d.bind(this,true));this.on("stopSearch",e.bind(this))}}});define("dual_search/view/Default",["dom-lib","ta","api-mod"],function(c,a,b){return function(e,g,f,i,d){var h={no_results_found:a.retrieve("typeahead.noResultsFound"),all_of_trip:a.retrieve("typeahead.scoped.all_of_trip"),worldwide_title:a.retrieve("typeahead.worldwide"),recently_viewed:a.retrieve("typeahead.history"),typeahead_transport_error:window.JS_location_not_found};var j=function(n){var o;if(n.geoID!=1){o=this.geoInfo.geoName+(this.geoInfo.shortParentName?", "+this.geoInfo.shortParentName:"")}else{o=n.explicitSelection?h.all_of_trip:""}window.setTimeout(function(){g.set("value",o)},0)};var k=function(n,o,p){if(this.whereTypeahead!==p){return}a.select(".twoFieldFocus").removeClass("twoFieldFocus");a.select("."+n).addClass("twoFieldFocus");if(a.find(".tablet_desktop")&&a.find(".hintHeader")){window.scrollTo(0,a.find(".hintHeader").getTop())}var q=a.find(".geoExample");g&&q&&(g.placeholder=q.innerHTML)};var m=function(o,p){if(o){return}var n=p==this.whatTypeahead?i:g;if(document.activeElement!=n){n.focus();n.select()}setTimeout(function(){if(document.activeElement!=n){n.focus();n.select()}},200)};var l=function(w,u){if(w.container&&w.container.innerHTML===""){w.hide();return}var q=b.select(".displayItem.history",w.container);var B=q&&q.length>0;w.container.toggleClass("titleTop",B);var y=a.select(".search-tagged-poi");var v,o,r,n,p;if(y){for(v=0;v<y.length;v++){r=y[v];o=r.getSize().x;var x=[r.getSiblings(".poi-name")[0],r.getSiblings(".geo-name")[0]];for(var z=0;z<x.length;z++){n=x[z];if(!n){continue}p=n.getStyle("max-width");p=p.replace("px","");if(p.contains("%")){p=p.replace("%","");var A=n.getParent("li").getSize().x;p=A*(p/100)}var s=n.getStyle("margin-left").replace("px","");var t=20;n.setStyle("max-width",(p-o-s-t)+"px")}}}};a.removeClass(g,"focusClear");a.removeClass(i,"focusClear");return function(){var p={width:null,positionRelative:"top",offsetX:0,offsetY:0};this.whatTypeahead.options=b.merge(this.whatTypeahead.options,p);this.whatTypeahead.options.errorTemplate=function(){return h.typeahead_transport_error};this.whatTypeahead.options.itemSelector="li";this.whereTypeahead.options.itemSelector="li";var s=(function(){var t={showChildren:true,tagLabels:{newLocation:a.retrieve("typeahead_new_location_label"),moved:a.retrieve("typeahead_moved_label"),closed:a.retrieve("typeahead_closed_label")},poiClasses:"primaryText",geoClasses:"secondaryText",useIconFont:true,simpleChild:true,debug:d};return function(u,w){if(!u.details){return""}var v="displayItem";if(u.scope=="history"){v+=" history"}else{if(u.scope=="overview"){v+=" overview"+(w?" short_cell":"")}else{if(u.scope=="local_tag"||u.scope=="local_keyword"){v+=" overview short_cell"}else{v+=" result"}}}if(u.isChild){v+=" simpleChild"}u.wrapperCSS=v;return TypeAhead.views.itemTemplate(t)(u,{HTMLEscape:false})}})();this.whatTypeahead.options.itemTemplate=s.partial(Function._,true);this.whereTypeahead.options.itemTemplate=s.partial(Function._,false);this.whereTypeahead.options=b.merge(this.whereTypeahead.options,p);this.whereTypeahead.options.errorTemplate=function(){return""};this.whatTypeahead.options.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(this.whatTypeahead.options,{noResultsMessage:h.no_results_found,globalLabel:h.worldwide_title,historyLabel:h.recently_viewed,resultClassWrap:"",groupByPlacetype:true,boldSearchQuery:true,debug:d});this.whereTypeahead.options.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(this.whereTypeahead.options,{localLabel:null,noResultsMessage:h.no_results_found,globalLabel:h.worldwide_title,historyLabel:h.recently_viewed,showNoResultsMessage:true,groupByPlacetype:true,boldSearchQuery:true,debug:d});this.on("geoUpdated",j);this.on("startSearch",k.bind(this,"geoScopeContainer"));this.on("startSearch",m.bind(this));this.on("select",function(u,t){if(!t.partial){a.id("SEARCH_BUTTON").focus()}});this.on("dropdownShown",function(u){var t=u==this.whatTypeahead?f:e;t.addClass("dropdownVisible");u.container.setStyle("width",t.clientWidth)});this.on("dropdownHidden",function(t){(t==this.whatTypeahead?f:e).removeClass("dropdownVisible")});this.on("resultsRendered",l);var o=false;this.on("submit",function(){o=true});var r=this;var q=function(u){var t=u.target&&Element.getParent(u.target,"#GEO_SCOPE_CONTAINER, #MAIN_SEARCH_CONTAINER");if(t){return}if(!o){r.stopSearch()}};var n=c(document.body);n.on("click",q);n.on("focus",q);c(window).on("blur",q)}}});define("dual_search/view/LoadingBubbles",["dom-lib"],function(c){var a=function(i){var f=ta.id("MAIN_SEARCH_CONTAINER");var h=ta.id("GEO_SCOPE_CONTAINER");var d=ta.id("GEO_SCOPED_SEARCH_INPUT");var e=ta.id("mainSearch");var j=ta.id("SEARCH_BUTTON");var g=ta.find(".inputMask");var l=ta.id("SEARCH_BUTTON_CONTENT");var k=ta.id("LOADING_BUBBLE_CONTAINER");if(i){if(g){g.addClass("hidden")}l.removeClass("hidden");k.addClass("hidden");f.removeClass("search_input_disabled");h.removeClass("search_input_disabled");d.set("disabled","");e.set("disabled","");j.set("disabled","")}else{if(g){g.removeClass("hidden")}l.addClass("hidden");k.removeClass("hidden");f.addClass("search_input_disabled");h.addClass("search_input_disabled");d.set("disabled","disabled");e.set("disabled","disabled");j.set("disabled","disabled")}};var b=function(){a(false);setTimeout(function(){a(true)},10000)};return function(){return function(){this.on("submit",b)}}});define("dual_search/aux/OverviewItems",["dom-lib","ta","api-mod"],function(c,a,b){return function(){var i=function(k){if(k){var j=a.retrieve("typeahead.aliases."+k);if(j){return j}}return[]};var h=function(j){return new Element("DIV",{html:j}).get("text")};var e={hotels_text:a.retrieve("typeahead.hotel_list"),hotel_text:a.retrieve("typeahead.hotel"),restaurants_text:a.retrieve("typeahead.restaurant_list"),restaurant_text:a.retrieve("typeahead.restaurant"),vacation_rentals_text:a.retrieve("typeahead.vacation_rental_list"),vacation_rental_text:a.retrieve("typeahead.vacation_rental"),flights_text:a.retrieve("typeahead.flight_list"),all_of_trip:a.retrieve("typeahead.scoped.all_of_trip"),static_local_label:a.retrieve("typeahead.scoped.static_local_label"),title_text:a.retrieve("typeahead.scoped.result_title_text"),worldwide_title:a.retrieve("typeahead.worldwide"),area_title:a.retrieve("typeahead.scoped.geo_area_template"),restaurants:a.retrieve("typeahead.restaurant_list"),hotels:a.retrieve("typeahead.hotel_list"),vacation_rentals:a.retrieve("typeahead.vacation_rental_list"),poi_overview_geo:a.retrieve("typeahead.scoped.poi_overview_geo"),poi_hotels_geo:a.retrieve("typeahead.scoped.poi_hotels_geo"),poi_vr_geo:a.retrieve("typeahead.scoped.poi_vr_geo"),poi_hotels_geo_near:a.retrieve("typeahead.scoped.poi_hotels_geo_near"),poi_vr_geo_near:a.retrieve("typeahead.scoped.poi_vr_geo_near"),poi_attractions_geo:a.retrieve("typeahead.scoped.poi_attractions_geo"),poi_eat_geo:a.retrieve("typeahead.scoped.poi_eat_geo"),poi_flights_geo:a.retrieve("typeahead.scoped.poi_flights_geo"),poi_nbrhd_geo:a.retrieve("typeahead.scoped.poi_nbrhd_geo"),poi_travel_guides_geo:a.retrieve("typeahead.scoped.poi_travel_guides_geo"),overview_text:a.retrieve("typeahead.scoped.overview"),neighborhoods_text:a.retrieve("typeahead.scoped.neighborhoods"),things_to_do_text:a.retrieve("typeahead.things_to_do"),travel_guides_text:a.retrieve("typeahead.scoped.travel_guides")};var g=function(){var k=a.retrieve("typeahead.popularDestinations")||a.retrieve("typeahead.recentHistoryList")||[];function j(l){return k.map(function(m){var n=b.merge({},m);n.scope=l;return n})}return j("history")};var f=function(){var j=a.retrieve("typeahead.localAirports")||[];function k(l){return j.map(function(m){var n=b.merge({},m);n.scope=l;return n})}return k("airports")};var d=function(r,s,j,l,n){l=l||j;var t=r.categories[s];if(!t&&(!r.geoID||r.geoID===1)){t={}}if(!t){return}var p=TypeAhead.views.escapeHTML(r.geoName);var m="";if(r.isNeighborhood&&r.shortParentName){m=", "+TypeAhead.views.escapeHTML(r.shortParentName)}var q=l.replace("%",p);var k=j.replace("%",p+m);var o=Elements.from("<span>"+j.replace("%",p)+"</span>");return{name:q,normalized_name:h(k).trim(),type:s,details:{name:k},scope:"overview",url:t.url,data_type:s==="GEO"?"LOCATION":"PAGE",icon_type:"LOCATION",scoped_render:o,aliases:i(n)}};return function(){var o=this;var k=this.geoInfo;var j=g();this.whatTypeahead.addStaticResults("history",{results:j,types:["accommodation","attraction","eatery","vacation_rental","airport","theme_park","airline","hotel","restaurant"],showOnEmpty:true,integrate:false,predicate:function(p){return k.geoId==1||p.details&&p.details.parent_ids&&p.details.parent_ids.contains(k.geoID)},shouldReplace:function(p){return p.data_type!="PAGE"},getMatchingKey:function(p){return p.url},maxItems:5});function n(t,w){var u=g();var p={name:e.all_of_trip,normalized_name:e.all_of_trip,type:"ALL",scope:"overview",details:{name:e.all_of_trip}};u.splice(0,0,p);if(t&&t.geoID!=1){u=u.filter(function(x){return x.value!=t.geoID});var v=[];for(var q in t.categories){if(t.categories.hasOwnProperty(q)){var s=t.categories[q];s=b.merge(s);s.type=q;v.push(s)}}var r={value:t.geoID,name:t.geoName,type:"GEO",isNeighborhood:t.isNeighborhood,details:{name:t.geoName,geo_name:t.parentName,parent_name:t.shortParentName,isNeighborhood:t.isNeighborhood},scope:"overview",urls:v};u.splice(0,0,r)}w.addStaticResults("history",{results:u,types:["geo","all"],showOnEmpty:true,integrate:false,getMatchingKey:function(x){return x.url},maxItems:6})}n(k,this.whereTypeahead);var m=f();this.whereTypeahead.addStaticResults("local_airports",{results:m,types:["airport"],showOnEmpty:false,integrate:true,getMatchingKey:function(p){return p.url},maxItems:1,bottom:true});var l=function(r,t){if(!r){return}if(t){o.whereTypeahead.clearResults();n(r,o.whereTypeahead)}var q=[];var s=r.type&&r.type=="AIRPORT";var u=r.categories&&r.categories.HOTEL&&r.categories.HOTEL.url.indexOf("HotelsNear")>-1;var p=r.categories&&r.categories.VACATION_RENTAL&&r.categories.VACATION_RENTAL.url.indexOf("VacationRentalsNear")>-1;if(r.geoID!=1){o.whatTypeahead.options.scopeFilter="global";o.whatTypeahead.options.viewOptions.globalLabel=null;o.whatTypeahead.options.viewOptions.localLabel=e.area_title.replace("%",o.geoInfo.geoName);if(t){q.push(d(r,"GEO",e.poi_overview_geo,e.overview_text,""));q.push(d(r,"HOTEL",s||u?e.poi_hotels_geo_near:e.poi_hotels_geo,e.hotels_text,"hotels"));if(!a.retrieve("isDaoDao")){q.push(d(r,"VACATION_RENTAL",s||p?e.poi_vr_geo_near:e.poi_vr_geo,e.vacation_rentals_text,"vacation_rentals"))}q.push(d(r,"ATTRACTION",e.poi_attractions_geo,e.things_to_do_text,"things_to_do"));q.push(d(r,"EATERY",e.poi_eat_geo,e.restaurants_text,"restaurants"));q.push(d(r,"TRAVEL_GUIDE",e.poi_travel_guides_geo,e.travel_guides_text,"travel_guides"));q.push(d(r,"NEIGHBORHOOD",e.poi_nbrhd_geo,e.neighborhoods_text,""));if(a.retrieve("typeahead.flight_enabled")){q.push(d(r,"FLIGHTS_TO",e.poi_flights_geo,e.flights_text,"flights"))}}}else{o.whatTypeahead.options.scopeFilter=null;o.whatTypeahead.options.viewOptions.globalLabel=e.worldwide_title;o.whatTypeahead.options.viewOptions.localLabel=null;if(t){q.push(d(r,"HOTEL",'<span class="poi_overview_item">'+e.hotels_text+"</span>",undefined,"hotels"));if(!a.retrieve("isDaoDao")){q.push(d(r,"VACATION_RENTAL",'<span class="poi_overview_item">'+e.vacation_rentals_text+"</span>"))}q.push(d(r,"ATTRACTION",'<span class="poi_overview_item">'+e.things_to_do_text+"</span>",undefined,"things_to_do"));q.push(d(r,"EATERY",'<span class="poi_overview_item">'+e.restaurants_text+"</span>",undefined,"restaurants"));if(a.retrieve("typeahead.flight_enabled")){q.push(d(r,"FLIGHTS_TO",'<span class="poi_overview_item">'+e.flights_text+"</span>",undefined,"flights"))}}}q=q.filter(function(v){return !!v});if(t){o.whatTypeahead.clearCache();o.whatTypeahead.addStaticResults("overview",{results:q,getMatchingKey:function(v){return v.url},types:[],integrate:true,showOnEmpty:true,maxItems:8})}};this.on("geoUpdated",l);this.on("stopGeoSearch",l);if(k){l(k,true)}}}});define("dual_search/aux/Logging",["ta","api-mod"],function(a,b){return function(e,h){var d=function(k){a.trackEventOnPage(k.module,k.action,k.context,k.value)};var f=function(k){a.addGARecordMevt(k.module,k.action,k.context,k.value,k.url)};var i=null;var c;var g=function(l,m){var l=l||"/Search";var m=m||"masthead";var k=l;if(k&&k.indexOf("?")>0){k=k.substring(0,k.indexOf("?"))}if(k&&k.indexOf("-")>0){k=k.substring(0,k.indexOf("-"))}k=k.replace("/","");var o=m+" | "+k;var n={module:"desktop_typeahead",action:"typeahead_success",context:o,url:l};a.addGARecordMevt(n.module,n.action,n.context,n.value,n.url)};var j=(function(){if(window.performance&&window.performance.now){return function(){return window.performance.now()}}else{if(window.performance&&window.performance.webkitNow){return function(){return window.performance.webkitNow()}}else{return function(){return new Date().getTime()}}}})();return function(){var o=this;var m=function(){return o.whatTypeahead?o.whatTypeahead.getInputText():null};var l=function(r,q){var p=Math.floor(j()-i);q=b.merge(q||{},{beforeGeoId:r.beforeGeoId,afterGeoId:o.geoInfo.geoID,beforeQuery:r.beforeQuery,afterQuery:m(),durationResultsShown:p,});if(o&&o.selection&&o.selection.url){q.url=o.selection.url}return q};var n=function(y,v,A,r){if(A){return}var w=y.options?y.options.startTime:undefined;var z=y.lastSuccessfulQuery;var s=y.options&&y.options.geoId;var t=y.options?y.options.name:undefined;var q=y.historyShown;var x=a.id("TYPEAHEAD_REDIRECT");x.value="true";var C=a.id("MASTAHEAD_TYPEAHEAD_START_TIME");C.value=w;var p=a.id("MASTAHEAD_TYPEAHEAD_UI_ORIGIN");p.value=t;var u=y.options?y.options.searchSessionId:undefined;if(!u){u="no_search_session_id"}var B=l(y,{hadHistory:q,action:"RECORD",eventType:"search_bttn",startTime:w,source:t,query:z,uiOrigin:t,global:(!s||pageServlet=="Search"),scope:(!s||pageServlet=="Search")?"G":s,searchSessionId:u,url:v,userInteractionType:r,});a.addTypeAheadMevt(B)};this.whatTypeahead.options=b.merge(this.whatTypeahead.options,{skipRecordAfterValidate:true,onSubmit:n});this.whereTypeahead.options=b.merge(this.whereTypeahead.options,{skipRecordAfterValidate:true,onSubmit:n});this.whatTypeahead.options.loggingOverride=function(r,p,q){if(c&&!c.partial&&!c.tabSelection){r.eventType="search_from_masthead";r.url=q}return l(o.whatTypeahead,r)}.bind(this);this.whereTypeahead.options.loggingOverride=function(r,p,q){if(c&&!c.partial&&!c.tabSelection){r.eventType="search_from_geo";r.url=q}return l(o.whereTypeahead,r)}.bind(this);var k=function(p){p.beforeGeoId=o.geoInfo.geoID;p.beforeQuery=m()};k(o.whatTypeahead);k(o.whereTypeahead);this.on("startSearch",function(t,v,q){if(t){v.options.startTime=new Date().getTime();var p=o.geoInfo.geoID;var s=v.options.name;var w=v.options.staticResults&&v.options.staticResults.history&&v.options.staticResults.history.results&&v.options.staticResults.history.results.length;var r=v.options?v.options.searchSessionId:undefined;if(!r){r="no_search_session_id"}var u=l(v,{action:"RECORD",eventType:"start",uiOrigin:v.options.name,startTime:v.options.startTime,source:s,linkedTypeAhead:v.options.linkedTypeAhead?v.options.linkedTypeAhead.options.startTime:void 0,global:p?false:true,hadHistory:w,scope:p,searchSessionId:r});new Request({method:"GET",data:u,url:"/TypeAheadJson"}).send()}k(v)});this.on("resultsRendered",function(t,r,s){i=j();if(s==="what"&&o.geoInfo&&o.geoInfo.geoID>1){for(var q=0;q<r.length;q++){var p=r[q];if(p.type==="TRAVEL_GUIDE"){a.trackEventOnPage("TravelGuides_SearchBar","impression",o.geoInfo.geoID,0,true)}}}});this.on("select",function(s,r){c=r;var q={action:"Action",module:s==o.whatTypeahead?"TopNav_Search":"TopNav_geo_search",context:"Selected_TaA_Result",value:r.choice.scope=="history"?1:0,url:r.url};q=l(s,q);if(r.search){q=b.merge(q,{context:"Selected_findmoreresults_inTaA_toSRP",url:"/Search"})}if(r.choice){var p=r.choice;if(p.isChild){q=b.merge(q,{action:"NestedListSelected",context:p.type})}if(p.scope==="local_tag"){q=b.merge(q,{action:"TagSelected",value:p.tagId})}else{if(p.scope==="local_keyword"){q=b.merge(q,{action:"KeywordSelected",value:p.indexInType})}else{if(p.type==="TRAVEL_GUIDE"){q=b.merge(q,{context:q.context+"_TravelGuides"})}}}}if(r.partial){d(q)}else{if(r.whatQuery){q.url="/Search"}f(q)}});this.on("submit",function(q){if(q.redirectUrl&&q.submit_clicked){var p=q&&q.evt?q.evt.type:"enter";n(o.whatTypeahead,q.redirectUrl,false,p)}g(q&&q.redirectUrl,q&&q.context)})}}});(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"dual_search","handlers.js");a(["placement","ta"],function(h,j){i("GEO_SCOPED_SEARCH_INPUT");i("mainSearch");f("GEO_SCOPE_CONTAINER","GEO_SCOPED_SEARCH_INPUT");f("MAIN_SEARCH_CONTAINER","mainSearch");function f(q,p){var r=j.id(q);r&&r.addEvent("click",function(){var s=j.id(p);s&&s.focus()})}function i(w){var u=j.id(w);if(u){var v=u.getParent();var q=v.getChildren(".findNearLabel");if(q.length){var x=parseInt(v.getStyle("width"));if(x){var s=0;for(var p=0;p<q.length;p++){var t=q[p];s+=t.offsetWidth+parseInt(t.getStyle("marginLeft"))+parseInt(t.getStyle("marginRight"))}var r=x-s-parseInt(u.getStyle("marginLeft"))-parseInt(u.getStyle("marginRight"))-8;u.setStyle("width",r)}}}}var o=function(){if(!e){e=j.has("typeahead.searchSessionId")?j.retrieve("typeahead.searchSessionId"):"no_search_session_id"}return e};var e=o();var m=function(p,r){if(!n){return}var t=j.id("GEO_SCOPED_SEARCH_INPUT");var v=j.id("mainSearch");var C=r===v;var u=r===t;var A=3;var s=j.id("MAIN_SEARCH_CONTAINER");var y=new Element("div");s.appendChild(y);var B=j.extend(n.staticTypeAheadOptions,{containerParent:y,containerClass:"scopedSearchDisplay staticPOIDisplay",minChars:1,maxResults:6,geoId:n.geoID>1?n.geoID:undefined,enableQueryDelay:true,throttleRequests:j.retrieve("typeahead_throttle_requests")==="true",defaultValue:"",nextField:false,autoSelectFirst:false,restoreOnFocus:true,searchOnFocus:true,cacheResults:true,selectOnBlur:false,assumeOnBlur:false,selectOnTab:true,cycleInput:false,selectInputText:false,autopopulateHighlighted:false,highlightInputOnFocus:true,jpFirefoxIME:j.retrieve("jp_typeahead_ime_firefox.enabled"),name:"MASTHEAD",trackingName:"masthead_what",searchSessionId:e,startEventOn:null,validator:function(E){return d(E)},searchParams:function(F){var G={};G.interleaved=true;G.geoPages=true;G.details=true;G.types="geo,hotel,eat,attr,vr,air,theme_park,al";G.link_type="geo";G.neighborhood_geos=true;G.matchTags=true;G.matchGlobalTags=true;G.matchKeywords=true;G.strictAnd=true;G.hglt=true;G.disableMaxGroupSize=true;G.max=F.options.maxResults;G.allowPageInsertionOnGeoMatch=false;G.defaultListInsertionType="hotel";if(!F.options.scopeFilter){G.scopeFilter=(F.options.geoId>1)?"global":undefined}else{G.scopeFilter=F.options.scopeFilter}G.injectNeighborhoods=F.options.injectNeighborhoods;G.injectNewLocation=F.options.injectNewLocation;G.injectLists=true;var E=F.options.geoId;if(E!==""){G.nearby=true;G.local=true;G.parentids=E}else{G.global=true}if(n.debug){G.explain=true}return G},postResultsFnList:[function(H){var E=j.util.Deferred();var F=H.results||H;if(F&&typeOf(F)==="array"){var G=F.length==0;F.push({name:j.retrieve("typeahead.searchMore.v2"),title:"Search",type:"SEARCH",url:"#",noResults:G});E.resolve(H);return E.promise()}else{E.reject(window.JS_location_not_found);return E.promise()}}],resolveSelection:function(E){if(!E){return}if(E.type&&E.type.toUpperCase()==="SEARCH"){return v.value}else{return E.scope==="overview"&&E.url&&E.name||E.scope==="overview"&&E.normalized_name||E.details&&E.details.name||E.name&&E.name.stripTags()}}});var z=new TypeAhead(v,B);if(!z.hasDefaultText()){z.query=v.value}var q=j.id("GEO_SCOPE_CONTAINER");var D=new Element("div");q.appendChild(D);var x={containerParent:D,containerClass:"scopedSearchDisplay geoScopeDisplay whiteCaret",minChars:1,maxResults:6,throttleRequests:j.retrieve("typeahead_throttle_requests")==="true",enableQueryDelay:true,defaultValue:"",nextField:false,autoSelectFirst:true,autoHighlightFirst:true,restoreOnFocus:true,searchOnFocus:false,cacheResults:true,selectOnBlur:true,assumeOnBlur:true,selectOnTab:false,cycleInput:false,selectInputText:false,clearDefaultTextOnFocus:false,autopopulateHighlighted:false,highlightInputOnFocus:true,jpFirefoxIME:j.retrieve("jp_typeahead_ime_firefox.enabled"),name:"GEOSCOPE",trackingName:"masthead_where",searchSessionId:e,startEventOn:null,searchParams:function(E){var F={interleaved:true,types:"geo,theme_park",neighborhood_geos:true,link_type:"geo,hotel,vr,attr,eat,flights_to,nbrhd,tg",details:true,max:E.options.maxResults,injectNeighborhoods:E.options.injectNeighborhoods,hglt:true};if(n.debug){F.explain=true}if(j.retrieve("typeahead_airport_search")=="true"){if(F.types){F.types+=",air"}else{F.types+="air"}}return F},resolveSelection:function(E){return""}};var w=new TypeAhead(t,x);w.options.linkedTypeAhead=z;z.options.linkedTypeAhead=w;require(["dual_search/DualSearch","dual_search/behaviour/Submit","dual_search/view/DimmerOverlay","dual_search/view/Default","dual_search/view/LoadingBubbles","dual_search/aux/OverviewItems","dual_search/aux/Logging"],function(G,I,K,F,H,J,E){l=new G({whatTypeahead:z,whereTypeahead:w,geoInfo:n.geoInfo,minCharsForSearch:A},K(),F(q,t,s,v,n.debug),H(),E(C,u),J(),I())})};var l;var n;var g=function(p,q){j.trackEventOnPage("TopNav_geo_search","focus","");if(!l){m(p,q)}if(l&&l.focusWhere){l.focusWhere()}};var c=function(p,q){j.trackEventOnPage("TopNav_search","focus","");if(!l){m(p,q)}if(l&&l.focusWhat){l.focusWhat()}};var k=function(p,q){if(!l){m(p,q)}if(l&&l.submitClicked){return l.submitClicked(p,q)}return false};var d=function(p,q){if(!l){m(p,q)}if(l&&l.submit){return l.submit(p)}return true};var b=function(p){n=p};return{init:b,whereFocused:g,whatFocused:c,submitClicked:k,submitForm:d}})})();(function(){var a=ta.prwidgets.define.bind(ta.prwidgets,"datepickers_desktop_horizontal_styleguide_icon","handlers.js");a(["widget"],function(d){var f=ta.find("[data-datetype=CHECKIN]",d.element),e=ta.find("[data-datetype=CHECKOUT]",d.element);function c(j,i){var h,g=j.getAttribute("data-dateFormat")||ta.widgets.calendar.getDatePickerFormat("classic");if(!i){h=j.getAttribute("data-emptyText")}else{h=ta.widgets.calendar.dateToString(i,g)}ta.find(".picker-inner .picker-label",j).firstChild.nodeValue=h}function b(i,h,g){if(!ta.inDocument(d.element)){ta.page.removeListener("dateSelected",b);f=null;e=null;return}if(h==="CHECKIN"){c(f,g[0])}else{if(h==="CHECKOUT"){c(e,g[0])}else{if(h==="STAYDATES"){c(f,g[0]);c(e,g[1])}}}}ta.queueForLoad(function(){ta.page.on("dateSelected",b)},"datepicker widget handlers")})})();(function(a){a.util.escaping={escapeHTMLSafe:function(b){if((typeof b==="string")||(b instanceof String)){return b.replace(/&/ig,"&amp;").replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/"/ig,"&quot;").replace(/'/ig,"&#x27;").replace(/\//ig,"&#x2F;")}return""},unescapeHTMLSafe:function(b){if((typeof b==="string")||(b instanceof String)){return b.replace(/&amp;/ig,"&").replace(/&lt;/ig,"<").replace(/&gt;/ig,">").replace(/&quot;/ig,'"').replace(/&#x27;/ig,"'").replace(/&#x2F;/ig,"/")}return""}}})(ta);var Syncro=(function(){var a=function(){this.components=[]};a.prototype.add=function(b){if(!b.sync||typeof b.sync!=="function"){throw new Error("API Error: component must implement sync(data) function.")}this.components.push(b);this.data&&b.sync(this.data)};a.prototype.sync=function(b,d){this.data=d;for(var c=this.components.length-1;c>=0;c--){this.components[c]!==b&&this.components[c].sync(d)}};return a}());window.odometerOptions={auto:false};(function(a,c,b,d){b.commerce.odometer=function(e,t){var f=b.id(e),r,j=2000,i=0,g,s=1,n,p,l,m=0,q=0,h=0;function k(){if(o()){r=0}var u=s;var v=i>0?(Math.random()*i):0;if(v>0){u=Math.round(s*v)}if(m&&q<m){q++;h+=u}else{r+=u;if(h){r+=h}p.update(r);q=0;h=0}}function o(){var u=l&&l.getTime()<new Date().getTime();if(!l||u){l=new Date();l.setHours(24);l.setMinutes(0);l.setSeconds(0);l.setMilliseconds(0)}return u}if(t&&t.variation!==d){i=t.variation}if(t&&t.wait!==d){m=t.wait}if(f){if(!Browser.ie||Browser.version>=8){r=parseInt(f.getAttribute("data-start"),10);g=parseInt(f.getAttribute("data-interval"),10);if(g>0&&g<j){s=j/g}n=f.getAttribute("data-separator");p=new c.Odometer({el:f,value:r,duration:j,format:"("+n+"ddd)",theme:""});p.render();k();setInterval(k,j)}}}}(document,window,ta));
/*
odometer 0.4.6
Copyright (c) 2013 HubSpot, Inc.
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
*/
(function(){var an,am,al,ak,aj,ai,ah,ag,af,ae,ad,ac,ab,aa,Z,Y,W,U,S,Q,O,M,K,J,I,H,X,V,T,R,P,N,L=[].slice;W='<span class="odometer-value"></span>',aa='<span class="odometer-ribbon"><span class="odometer-ribbon-inner">'+W+"</span></span>",ak='<span class="odometer-digit"><span class="odometer-digit-spacer">8</span><span class="odometer-digit-inner">'+aa+"</span></span>",ah='<span class="odometer-formatting-mark"></span>',al="(,ddd).dd",ag=/^\(?([^)]*)\)?(?:(.)(d+))?$/,af=30,ai=2000,an=20,ae=2,aj=0.5,ad=1000/af,am=1000/an,Z="transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",I=document.createElement("div").style,Y=null!=I.transition||null!=I.webkitTransition||null!=I.mozTransition||null!=I.oTransition,K=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,ac=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,S=function(d){var c;return c=document.createElement("div"),c.innerHTML=d,c.children[0]},M=function(d,c){return d.className=d.className.replace(new RegExp("(^| )"+c.split(" ").join("|")+"( |$)","gi")," ")},U=function(d,c){return M(d,c),d.className+=" "+c},H=function(e,d){var f;return null!=document.createEvent?(f=document.createEvent("HTMLEvents"),f.initEvent(d,!0,!0),e.dispatchEvent(f)):void 0},O=function(){var d,c;return null!=(d=null!=(c=window.performance)?"function"==typeof c.now?c.now():void 0:void 0)?d:+new Date},J=function(d,c){return null==c&&(c=0),c?(d*=Math.pow(10,c),d+=0.5,d=Math.floor(d),d/=Math.pow(10,c)):Math.round(d)},X=function(b){return 0>b?Math.ceil(b):Math.floor(b)},Q=function(b){return b-J(b)},T=!1,(V=function(){var g,f,j,i,h;if(!T&&null!=window.jQuery){for(T=!0,i=["html","text"],h=[],f=0,j=i.length;j>f;f++){g=i[f],h.push(function(d){var c;return c=window.jQuery.fn[d],window.jQuery.fn[d]=function(b){var e;return null==b||null==(null!=(e=this[0])?e.odometer:void 0)?c.apply(this,arguments):this[0].odometer.update(b)}}(g))}return h}})(),setTimeout(V,0),ab=function(){function b(z){var y,x,w,v,u,t,s,r,k,j,f=this;if(this.options=z,this.el=this.options.el,null!=this.el.odometer){return this.el.odometer}this.el.odometer=this,r=b.options;for(x in r){v=r[x],null==this.options[x]&&(this.options[x]=v)}null==(u=this.options).duration&&(u.duration=ai),this.MAX_VALUES=this.options.duration/ad/ae|0,this.resetFormat(),this.value=this.cleanValue(null!=(k=this.options.value)?k:""),this.renderInside(),this.render();try{for(j=["innerHTML","innerText","textContent"],t=0,s=j.length;s>t;t++){w=j[t],null!=this.el[w]&&!function(c){return Object.defineProperty(f.el,c,{get:function(){var d;return"innerHTML"===c?f.inside.outerHTML:null!=(d=f.inside.innerText)?d:f.inside.textContent},set:function(d){return f.update(d)}})}(w)}}catch(a){y=a,this.watchForMutations()}}return b.prototype.renderInside=function(){return this.inside=document.createElement("div"),this.inside.className="odometer-inside",this.el.innerHTML="",this.el.appendChild(this.inside)},b.prototype.watchForMutations=function(){var e,d=this;if(null!=ac){try{return null==this.observer&&(this.observer=new ac(function(){var c;return c=d.el.innerText,d.renderInside(),d.render(d.value),d.update(c)})),this.watchMutations=!0,this.startWatchingMutations()}catch(f){e=f}}},b.prototype.startWatchingMutations=function(){return this.watchMutations?this.observer.observe(this.el,{childList:!0}):void 0},b.prototype.stopWatchingMutations=function(){var c;return null!=(c=this.observer)?c.disconnect():void 0},b.prototype.cleanValue=function(d){var c;return"string"==typeof d&&(d=d.replace(null!=(c=this.format.radix)?c:".","<radix>"),d=d.replace(/[.,]/g,""),d=d.replace("<radix>","."),d=parseFloat(d,10)||0),J(d,this.format.precision)},b.prototype.bindTransitionEnd=function(){var i,h,n,m,l,k,j=this;if(!this.transitionEndBound){for(this.transitionEndBound=!0,h=!1,l=Z.split(" "),k=[],n=0,m=l.length;m>n;n++){i=l[n],k.push(this.el.addEventListener(i,function(){return h?!0:(h=!0,setTimeout(function(){return j.render(),h=!1,H(j.el,"odometerdone")},0),!0)},!1))}return k}},b.prototype.resetFormat=function(){var h,c,p,o,n,m,l,k;if(h=null!=(l=this.options.format)?l:al,h||(h="d"),p=ag.exec(h),!p){throw new Error("Odometer: Unparsable digit format")}return k=p.slice(1,4),m=k[0],n=k[1],c=k[2],o=(null!=c?c.length:void 0)||0,this.format={repeating:m,radix:n,precision:o}},b.prototype.render=function(z){var y,x,w,v,u,t,s,r,q,p,o,n;for(null==z&&(z=this.value),this.stopWatchingMutations(),this.resetFormat(),this.inside.innerHTML="",t=this.options.theme,y=this.el.className.split(" "),u=[],r=0,p=y.length;p>r;r++){x=y[r],x.length&&((v=/^odometer-theme-(.+)$/.exec(x))?t=v[1]:/^odometer(-|$)/.test(x)||u.push(x))}for(u.push("odometer"),Y||u.push("odometer-no-transitions"),u.push(t?"odometer-theme-"+t:"odometer-auto-theme"),this.el.className=u.join(" "),this.ribbons={},this.digits=[],s=!this.format.precision||!Q(z)||!1,n=z.toString().split("").reverse(),q=0,o=n.length;o>q;q++){w=n[q],"."===w&&(s=!0),this.addDigit(w,s)}return this.startWatchingMutations()},b.prototype.update=function(e){var d,f=this;return e=this.cleanValue(e),(d=e-this.value)?(M(this.el,"odometer-animating-up odometer-animating-down odometer-animating"),d>0?U(this.el,"odometer-animating-up"):U(this.el,"odometer-animating-down"),this.stopWatchingMutations(),this.animate(e),this.startWatchingMutations(),setTimeout(function(){return f.el.offsetHeight,U(f.el,"odometer-animating")},0),this.value=e):void 0},b.prototype.renderDigit=function(){return S(ak)},b.prototype.insertDigit=function(d,c){return null!=c?this.inside.insertBefore(d,c):this.inside.children.length?this.inside.insertBefore(d,this.inside.children[0]):this.inside.appendChild(d)},b.prototype.addSpacer=function(f,e,h){var g;return g=S(ah),g.innerHTML=f,h&&U(g,h),this.insertDigit(g,e)},b.prototype.addDigit=function(h,g){var l,k,j,i;if(null==g&&(g=!0),"-"===h){return this.addSpacer(h,null,"odometer-negation-mark")}if("."===h){return this.addSpacer(null!=(i=this.format.radix)?i:".",null,"odometer-radix-mark")}if(g){for(j=!1;;){if(!this.format.repeating.length){if(j){throw new Error("Bad odometer format without digits")}this.resetFormat(),j=!0}if(l=this.format.repeating[this.format.repeating.length-1],this.format.repeating=this.format.repeating.substring(0,this.format.repeating.length-1),"d"===l){break}this.addSpacer(l)}}return k=this.renderDigit(),k.querySelector(".odometer-value").innerHTML=h,this.digits.push(k),this.insertDigit(k)},b.prototype.animate=function(c){return Y&&"count"!==this.options.animation?this.animateSlide(c):this.animateCount(c)},b.prototype.animateCount=function(i){var o,n,m,l,k,j=this;if(n=+i-this.value){return l=m=O(),o=this.value,(k=function(){var d,c,a;return O()-l>j.options.duration?(j.value=i,j.render(),void H(j.el,"odometerdone")):(d=O()-m,d>am&&(m=O(),a=d/j.options.duration,c=n*a,o+=c,j.render(Math.round(o))),null!=K?K(k):setTimeout(k,am))})()}},b.prototype.getDigitCount=function(){var h,g,l,k,j,i;for(k=1<=arguments.length?L.call(arguments,0):[],h=j=0,i=k.length;i>j;h=++j){l=k[h],k[h]=Math.abs(l)}return g=Math.max.apply(Math,k),Math.ceil(Math.log(g+1)/Math.log(10))},b.prototype.getFractionalDigitCount=function(){var i,h,n,m,l,k,j;for(l=1<=arguments.length?L.call(arguments,0):[],h=/^\-?\d*\.(\d*?)0*$/,i=k=0,j=l.length;j>k;i=++k){m=l[i],l[i]=m.toString(),n=h.exec(l[i]),l[i]=null==n?0:n[1].length}return Math.max.apply(Math,l)},b.prototype.resetDigits=function(){return this.digits=[],this.ribbons=[],this.inside.innerHTML="",this.resetFormat()},b.prototype.animateSlide=function(aL){var aK,aJ,aI,aH,aG,aF,aE,aD,aC,aB,aA,az,ay,ax,aw,at,aq,ao,G,F,A,r,e,av,au,ar,ap;if(at=this.value,aD=this.getFractionalDigitCount(at,aL),aD&&(aL*=Math.pow(10,aD),at*=Math.pow(10,aD)),aI=aL-at){for(this.bindTransitionEnd(),aH=this.getDigitCount(at,aL),aG=[],aK=0,aA=G=0;aH>=0?aH>G:G>aH;aA=aH>=0?++G:--G){if(aq=X(at/Math.pow(10,aH-aA-1)),aE=X(aL/Math.pow(10,aH-aA-1)),aF=aE-aq,Math.abs(aF)>this.MAX_VALUES){for(aB=[],az=aF/(this.MAX_VALUES+this.MAX_VALUES*aK*aj),aJ=aq;aF>0&&aE>aJ||0>aF&&aJ>aE;){aB.push(Math.round(aJ)),aJ+=az}aB[aB.length-1]!==aE&&aB.push(aE),aK++}else{aB=function(){ap=[];for(var c=aq;aE>=aq?aE>=c:c>=aE;aE>=aq?c++:c--){ap.push(c)}return ap}.apply(this)}for(aA=F=0,r=aB.length;r>F;aA=++F){aC=aB[aA],aB[aA]=Math.abs(aC%10)}aG.push(aB)}for(this.resetDigits(),ar=aG.reverse(),aA=A=0,e=ar.length;e>A;aA=++A){for(aB=ar[aA],this.digits[aA]||this.addDigit(" ",aA>=aD),null==(ao=this.ribbons)[aA]&&(ao[aA]=this.digits[aA].querySelector(".odometer-ribbon-inner")),this.ribbons[aA].innerHTML="",0>aI&&(aB=aB.reverse()),ay=au=0,av=aB.length;av>au;ay=++au){aC=aB[ay],aw=document.createElement("div"),aw.className="odometer-value",aw.innerHTML=aC,this.ribbons[aA].appendChild(aw),ay===aB.length-1&&U(aw,"odometer-last-value"),0===ay&&U(aw,"odometer-first-value")}}return 0>aq&&this.addDigit("-"),ax=this.inside.querySelector(".odometer-radix-mark"),null!=ax&&ax.parent.removeChild(ax),aD?this.addSpacer(this.format.radix,this.digits[aD-1],"odometer-radix-mark"):void 0}},b}(),ab.options=null!=(P=window.odometerOptions)?P:{},setTimeout(function(){var g,f,j,i,h;if(window.odometerOptions){i=window.odometerOptions,h=[];for(g in i){f=i[g],h.push(null!=(j=ab.options)[g]?(j=ab.options)[g]:j[g]=f)}return h}},0),ab.init=function(){var h,g,l,k,j,i;if(null!=document.querySelectorAll){for(g=document.querySelectorAll(ab.options.selector||".odometer"),i=[],l=0,k=g.length;k>l;l++){h=g[l],i.push(h.odometer=new ab({el:h,value:null!=(j=h.innerText)?j:h.textContent}))}return i}},null!=(null!=(N=document.documentElement)?N.doScroll:void 0)&&null!=document.createEventObject?(R=document.onreadystatechange,document.onreadystatechange=function(){return"complete"===document.readyState&&ab.options.auto!==!1&&ab.init(),null!=R?R.apply(this,arguments):void 0}):document.addEventListener("DOMContentLoaded",function(){return ab.options.auto!==!1?ab.init():void 0},!1),"function"==typeof define&&define.amd?define(["jquery"],function(){return ab}):typeof exports===!1?module.exports=ab:window.Odometer=ab}).call(this);(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"brand_homepage_header_box","handlers.js");a(["placement"],function(m){var s;var d="#"+m.id;var b=ta.util.sessionStorage&&ta.util.sessionStorage.canUseSessionStore();var l="brand_homepage_header_box_tab_selection";function v(){var C=null;if(b&&sessionStorage.getItem(l)){var B=sessionStorage.getItem(l);C=ta.id(B)}if(C===null||C===undefined){C=ta.id("rdoHotels")}x(C,"tab");if(ta.has("guests_rooms_picker.enabled")){e();w()}p();ta.trackEventOnPage("hp_redesign_search_hotel","impression",null,0,false)}function x(B,C){if(b){sessionStorage.setItem(l,C)}B=ta.id(B);document.getElements("#"+m.id+" .checked").removeClass("checked");B.addClass("checked");f(B,"tab")}function w(){if(ta.overlays&&ta.overlays.NumberPickerOverlay){ta.overlays.NumberPickerOverlay.updateHeaderMsg(d)}if(ta.widgets&&ta.widgets.calendar&&ta.widgets.calendar.justUpdateSessionDates){ta.widgets.calendar.justUpdateSessionDates()}}function e(){var B=ta.select(d+" .roomsChange,"+d+" .guestsChange");B.each(function(C){C.addEventListener("click",function(E){var D;if(E.target.hasClass("roomsChange")){D=ta.overlays.NumberPickerOverlay.roomsPicker(E,E.target)}else{if(E.target.hasClass("guestsChange")){D=ta.overlays.NumberPickerOverlay.guestsPicker(E,E.target)}}D.callback=w})})}function f(F,J){var M=function(O){return !O.is_broad};var C=function(O){return O.is_vr};var B={Flights:{onLoad:function(){$$(".flights_adults").each(function(W){var V=W.getChildren("select")[0];var X=W.getChildren(".select-value")[0];X.innerHTML=V.options[V.selectedIndex].text;V.addEvent("change",function(Y){X.innerHTML=V.options[V.selectedIndex].text.substring(0,12)});V.addEvent("focus",function(Y){W.addClass("focusInput")});V.addEvent("blur",function(Y){W.removeClass("focusInput")})});N(false,"ptptFlights");var U=document.getElement("#FLIGHT_FORM_META #metaFlightFrom");if(U){U.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_flights_from","click",null,0,false)})}var T=document.getElement("#FLIGHT_FORM_META #metaFlightTo");if(T){T.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_flights_to","click",null,0,false)})}var R=document.getElement("#FLIGHT_FORM_META #checkIn");if(R){R.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_flights_checkin","click",null,0,false)})}var O=document.getElement("#FLIGHT_FORM_META #checkOut");if(O){O.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_flights_checkout","click",null,0,false)})}var Q=document.getElement("#FLIGHT_FORM_META #fadults");if(Q){Q.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_flights_travelers","click",null,0,false)})}var S=document.getElement("#FLIGHT_FORM_META #CHECKBOX_UI");if(S){S.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_flights_nonstop","click",null,0,false)})}var P=document.getElement("#FLIGHT_FORM_META #flights-more");if(P){P.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_flights_options","click",null,0,false);setPID(4829)})}}},Hotels:{url:"/vpages/home/ptpt_hotels_brand.html?lt=evt&log=false",typeaheadAction:"HOTELHOME",type:"hotel",onLoad:function(){N(false,"ptptHotels")},staticResults:{history:{showOnEmpty:true,integrate:true,types:["geo","hotel"],linkType:"hotel",predicate:M}},includeNeighborhoods:true},Restaurants:{url:"/vpages/home/ptpt_restaurants_brand.html?lt=evt&log=false",typeaheadAction:"RESTHOME",type:"eat",onLoad:function(){N(false,"ptptRestaurants");var O=document.getElements("#tabRestaurants input");if(O){O.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_restaurant_search","click",null,0,false)})}},staticResults:{history:{showOnEmpty:true,integrate:true,types:["geo","eatery"],linkType:"eat",predicate:M}},nextField:"#SUBMIT_RESTAURANTS",includeNeighborhoods:true},VRs:{url:"/vpages/home/ptpt_vacationrentals_brand.html?lt=evt&log=false",action:"VR",pid:3035,typeaheadAction:"VRHOME",type:"vr",onLoad:function(){N(false,"ptptVRs");var O=document.getElements("#tabVRs .ptptLabelWrap");if(O){O.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_VR_search","click",null,0,false)})}},staticResults:{history:{showOnEmpty:true,integrate:true,types:["geo"],linkType:"vr",predicate:C}}},Destinations:{url:"/vpages/home/ptpt_destinations_brand.html?lt=evt&log=false",action:"Tourism",typeaheadAction:"LOCATION",type:"dest",onLoad:function(){N(false,"ptptDestinations")},staticResults:{history:{showOnEmpty:false,integrate:true,types:[]}},nextField:"#SUBMIT_DESTINATIONS",includeNeighborhoods:true},Attractions:{url:"/vpages/home/ptpt_attractions_brand.html?lt=evt&log=false",action:"Attractions",typeaheadAction:"ATTRHOME",type:"attr",onLoad:function(){N(false,"ptptAttractions");var O=document.getElements("#tabAttractions input");if(O){O.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_attraction_search","click",null,0,false)})}},staticResults:{history:{showOnEmpty:true,integrate:true,types:["geo","attr"],linkType:"attr",predicate:M}},nextField:"#SUBMIT_ATTRACTIONS",includeNeighborhoods:true}};function H(Q,P,R){var T=r(P);Q.removeClass("active");P.addClass("active");if(T){var S=k(T);if(S){S.reset();S.error&&T.focus()}else{var O={onError:function(V,U){T.focus()},includeNeighborhoods:R.includeNeighborhoods,jpFirefoxIME:ta.retrieve("jp_typeahead_ime_firefox.enabled")};if(ta.has("typeahead.integrate_recently_viewed")){O.staticResults=R.staticResults}if(R.nextField){O.nextField=R.nextField}S=z(null,T,R.typeaheadAction,R.type,O)}}}var N=function(S,Q){if(S){var R=function(){P.removeClass("focusOnLoad");if(T){clearTimeout(T);T=null}};var P=ta.select(".ppt_forms .big_text");if(P){var T=setTimeout(function(){P.removeClass("beforeOnLoad");T=null},2000);P.addClass("focusOnLoad");P.addEvent("blur",R)}var O=ta.select(".ppt_forms .focusInput:not(.big_text)");if(O){O.addEvent("focus",R)}}else{var P=ta.select("#"+Q+" .big_text");if(P){P.removeClass("beforeOnLoad").removeClass("focusOnLoad")}}};addEvent("domready",function(){N(true)});J=J||"ptpt";var D=F.id.replace(/^rdo/,""),K=B[D],G=document.getElement("."+J+"Content.active"),L=ta.id(J+D),I=L&&L.hasClass("loaded");if(I){H(G,L,K);return}A("ActionRecord - Homepage - PTPT - "+(K.action||D));K.pid&&setPID(K.pid);function E(){var O=r(L);behavior.apply(L);H(G,L,K);K.onLoad&&K.onLoad();L.addClass("loaded");if(O&&!k(O)){z(null,O,K.typeaheadAction,K.type)}if(O&&O.value!==O.defaultValue){O.removeClass("focusClear")}}if(K.url){new Request.HTML({url:K.url,update:L,onSuccess:E}).send()}else{E()}}function p(){var H=document.getElement("#review_snippet");if(H){H.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_review_snippet","click",null,0,false)})}var I=document.getElement("#search_recently_viewed");if(I){I.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_recently_viewed_top","click",null,0,false)})}var D=document.getElement("#rdoHotels");if(D){D.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_search_hotel","click",null,0,false)})}var F=document.getElement("#rdoVRs");if(F){F.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_search_vr","click",null,0,false)})}var G=document.getElement("#rdoAttractions");if(G){G.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_search_attractions","click",null,0,false)})}var G=document.getElement("#rdoAttractions");if(G){G.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_search_attractions","click",null,0,false)})}var B=document.getElement("#rdoRestaurants");if(B){B.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_search_restaurants","click",null,0,false)})}var E=document.getElement("#rdoFlights");if(E){E.addEvent("click",function(){ta.trackEventOnPage("hp_redesign_search_flights","click",null,0,false)})}var C=document.getElement("#trip_a_day_lightbox_btn_track");if(C){C.addEvent("click",function(){ta.trackEventOnPage("pcb_campaign","promo_bookastay_homepage_click")})}}function r(B){return B.getElement("input[name='q']")}function k(B){return B.retrieve("typeahead")}function t(J){var B=new Event(J);var I="";if(B&&B.target){I=B.target.className}if(I=="promo_featured_image"||I=="ppt_innerContent"||I=="ppt_meta_wrapper"){var F=ta.id("mainImageHeader");var E=741;var L=250;if(F){var D=F.offsetLeft;var C=F.offsetTop;var K=F.offsetParent;if(K){do{D+=K.offsetLeft;C+=K.offsetTop}while(K=K.offsetParent)}E=(F.offsetWidth/2)+D;L=(F.offsetHeight/2)+C}var H=B.pageX;var G=B.pageY;if(H<E&&G<L){ta.trackEventOnPage("Homepage_Hero_Photo","attempted_click","Upper_LHS",0,false)}else{if(H<E&&G>=L){ta.trackEventOnPage("Homepage_Hero_Photo","attempted_click","Lower_LHS",0,false)}else{if(H>=E&&G<L){ta.trackEventOnPage("Homepage_Hero_Photo","attempted_click","Upper_RHS",0,false)}else{if(H>=E&&G>=L){ta.trackEventOnPage("Homepage_Hero_Photo","attempted_click","Lower_RHS",0,false)}}}}}else{if(I=="ppt_header"){ta.trackEventOnPage("Homepage_Hero_Photo","attempted_click","PYPT",0,false)}}}function g(B){var C=new Event(B);var D="";if(C&&C.target){D=C.target.className}if(D.indexOf("headerQuoteAvatar")>-1){ta.trackEventOnPage("Homepage_Hero_Photo","click","Featured_Quote_Avatar",0,false)}else{if(D.indexOf("headerQuoteTitle")>-1){ta.trackEventOnPage("Homepage_Hero_Photo","click","Featured_Quote_Title",0,false)}else{if(D.indexOf("quoteLoc")>-1){ta.trackEventOnPage("Homepage_Hero_Photo","click","Featured_Quote_DestinationName",0,false)}else{ta.trackEventOnPage("Homepage_Hero_Photo","click","Featured_Quote_General",0,false)}}}}function A(B){new Request({url:"/ActionRecord?action="+B}).send()}function z(L,D,E,H,M,I){L&&L.stop();D.removePropertyEvent("focus","createTypeAhead");var J=H;if(H==="hotel_lander"){J="hotel"}s||(s=new Syncro());var F=q({action:E,types:"geo"+(J?","+J:""),hglt:"true",global:"true",neighborhood_geos:M.includeNeighborhoods},E,J);F=Object.merge(F,M.apiData);var K=(J==="hotel")&&ta.retrieve("typeahead_pypt_autofocus")===true;var C=K&&(!document.activeElement||(document.activeElement.nodeName&&document.activeElement.nodeName.toUpperCase()==="BODY"));var B={minChars:3,clearDefaultTextOnFocus:K?false:true,startEventOn:K?"type":"focus",focusOnCreation:C,offsetY:-1,defaultTextClass:"focusClear",autoSelectFirst:true,postResultsFn:function(P){var N=ta.util.Deferred();var O=P.results||P;if(!O||!O.length){N.reject(JS_location_not_found)}else{N.resolve(P)}return N.promise()},search:function(O){var N=ta.util.Deferred();F.startTime=this.startTime;F.uiOrigin="PTPT-"+H;new ta.util.ajax({method:"GET",url:"/TypeAheadJson",data:Object.merge(F,{query:O})}).always(function(P){if(P&&((P.results&&P.results.length)||P.length)){N.resolve(P)}else{N.reject(JS_location_not_found)}});return N.promise()},listTemplate:TypeAhead.views.ptptListTemplate,itemTemplate:function(N){if("eat"===H&&N.address&&N.address.length){return N.name+'<div class="address">'+N.address+"</div>"}return N.name},onSelect:function(N,P,R,S,Q){var O=function(){if(L||window.event){new Event(L||window.event).stop()}var U="/";if(typeof N.url==="string"){U=N.url}else{if(N.url&&N.url.url){U=N.url.url}}if("hotel"===J){if(ta.has("useHotelsFilterState")){if(N.isNeighborhood){window.location=U;return false}else{if("GEO"===N.type){var W="geo="+N.value;var V="&"+W;var T=ta.widgets.calendar.getCheckRatesData();if(T){V=V+"&"+Object.toQueryString(T);ta.store("hac.filters.isUpdateDatesRequest",true)}h(V);return false}else{var U="/Hotel_Review-d"+N.value;var V="&clear=true";var T=ta.widgets.calendar.getCheckRatesData();if(T){V="&"+Object.toQueryString(T)}ta.widgets.calendar.updateSessionDates(U,V);return false}}}else{U="/HACSearch?"+("GEO"===N.type?"geo":"detail")+"="+N.value;var T=ta.widgets.calendar.getCheckRatesData();if(T){U=U+"&"+Object.toQueryString(T)}}}else{if("vr"===H){var T=ta.widgets.calendar.getCheckRatesData();if(T){U="/VRACSearch?"+("GEO"===N.type?"geo":"detail")+"="+N.value;U=U+"&"+Object.toQueryString(T)}}}if(R.query){location.hash=R.query+";"+N.value}window.location=U};D.store("redir",O)},shouldSubmit:function(){if(ta.id("PTPT_HAC_FORM")||ta.id("HOTEL_LANDER_HAC_FORM")){return false}return true},onRestore:function(N){(new Element(D.form)).eliminate("redir")},onSync:function(P,O,N){D.removeClass("focusClear")},onRender:o,onError:o,resolveSelection:function(N){return N.name.stripTags()},validator:n.partial(null,D.form),name:"PTPT-"+H};if(ta.retrieve("typeahead.revised.pypt.mechanics.feature")){B.autopopulateHighlighted=false;B.autoSelectFirst=false;B.assumeOnBlur=false;B.cacheResults=true;B.autoHighlightFirst=true;B.submitOnSecondEnter=true;B.ignoreKeysWhenInvisible=true;B.cycleInput=false;B.nextField=function(Q){var P=(J=="hotel")?"1":H;if(!ta.retrieve("date.picker.pageInDate")){var O=ta.id("date_picker_in_"+P);var N=O&&O.getParent();if(N&&(!N.hasClass("dateSelected")||ta.retrieve("data.picker.cachedDateCleared"))){return N}}if(!ta.retrieve("date.picker.pageOutDate")){var O=ta.id("date_picker_out_"+P);var N=O&&O.getParent();if(N&&(!N.hasClass("dateSelected")||ta.retrieve("data.picker.cachedDateCleared"))){return N}}return Q&&Q.source}}else{B.assumeOnBlur=function(P){for(var O=0,N=P.results.length;O<N;O++){if(P.options.resolveSelection(P.results[O]).toLowerCase().indexOf(P.query.toLowerCase())>=0){return O}}};B.syncro=s}B.containerClass="typeahead-container";if(document.body&&ta.id(document.body).hasClass("tablet_typ")){B.containerClass+=" tablet-text";B.onUserFocus=function(O){var N=function(){var V,T=-1,Q=ta.id(document.body),U=-1,S,P=220,R;if(!this.source||!this.source.retrieve){return}V=this.source;U=V.retrieve("tablet_typ_scroll");if(typeof(U)==="undefined"||U===null){U=-1}if(U<0&&V.getPosition){if(this.container&&typeof(api)!=="undefined"&&api.getSize){if(document.documentElement){R=document.documentElement.clientWidth-window.innerWidth;if(R>50){P=100}}this.container.style.width=(api.getSize(this.source).x+P)+"px"}T=V.getPosition().y-10;if(document.body.hasClass("tablet_typ_v2")){T-=24}V.store("tablet_typ_scroll",Q.getScroll().y);if(T>=0){Q.scrollTo(Q.getScroll().x,T)}}if(V.setSelectionRange&&V.value){S=V.value.length;V.setSelectionRange(S,S)}};if(!O){return}setTimeout(function(){N.call(O)},200)};B.onUserBlur=function(O){var N=function(){var S,Q=-1,P=ta.id(document.body),R=-1;if(!this.source||!this.source.retrieve){return}S=this.source;R=S.retrieve("tablet_typ_scroll");if(typeof(R)==="undefined"||R===null){R=-1}if(R>=0){Q=R;S.store("tablet_typ_scroll",-1);if(Q>=0){P.scrollTo(P.getScroll().x,Q)}}};if(!O){return}setTimeout(function(){N.call(O)},200)}}if(M.staticResults&&M.staticResults.history){M.staticResults.history.sort=function(R,Q){var P=R.type.toLowerCase()=="geo";var O=Q.type.toLowerCase()=="geo";var N=(P!=O);if(N&&P){return -1}else{if(N&&O){return 1}}return 0}}if(M.staticResults&&M.staticResults.history){M.staticResults.history.results=ta.retrieve("typeahead.recentHistoryList").map(function(N){var O=api.extend({},N);O.scope="history";return O})}var G=new TypeAhead(D,api.extend(B,M));D.store("typeahead",G);return G}function h(B){new Request({url:"/FilterState",data:B,method:"post",onSuccess:function(C){ta.widgets.calendar.redirectToHotelOverview(C)},onFailure:function(C){ta.widgets.calendar.redirectToHotelOverview(null)}}).send()}function q(E,D,B){if(ta.has("pypt_typeahead_unified_api")&&(D=="HOTELHOME"||D=="RESTHOME"||D=="LOCATION"||D=="VRHOME"||D=="ATTRHOME")){var C={action:"API",link_type:B,blenderPages:false,scoreThreshold:0.2};if(D=="HOTELHOME"||D=="RESTHOME"){C.filter="nobroad"}if(D=="VRHOME"){C.max=15;C.types="geo";C.filter="is_vr"}if(D=="LOCATION"){C.link_type="geo"}return Object.merge(E,C)}else{return E}}function o(C,B){if(C.query){var D=ta.retrieve("typeahead.results");if(!D){D={}}D[C.query]=true;ta.store("typeahead.results",D)}}function n(I,C){var H=r(C);var F=H.retrieve("typeahead");var E=y(C);var J=null;var G=null;var B=H.value.trim();if(ta.retrieve("typeahead.revised.pypt.mechanics.feature")&&(!B.length||B===H.defaultValue)&&!F.options.staticResults){H.focus();if(F){G="blank";var D;switch(C.id){case"PTPT_DESTINATION_FORM":D=ta.retrieve("ta.pages.home.pypt.msgs.enter.dest");break;case"PTPT_HAC_FORM":D=ta.retrieve("ta.pages.home.pypt.msgs.enter.hotel");break;case"PTPT_RESTAURANT_FORM":D=ta.retrieve("ta.pages.home.pypt.msgs.enter.rest");break;case"PTPT_VRAC_FORM":D=ta.retrieve("ta.pages.home.pypt.msgs.enter.city.vr");break;case"HOTEL_LANDER_HAC_FORM":D=ta.retrieve("ta.pages.home.pypt.msgs.enter.hotel");break;case"PTPT_ATTRATION_FORM":D=ta.retrieve("ta.pages.home.pypt.msgs.enter.attr");break}D=D||JS_location_not_found;F.renderError(D);F.show()}}else{if(!B.length||B===H.defaultValue||(ta.retrieve("typeahead.revised.pypt.mechanics.feature")&&(!F||(F.options.minChars>B.length&&!ta.retrieve("typeahead_pypt_allow_too_few_chars_search_feature"))||((!F.results||!F.results.length)&&B.length>=F.options.minChars&&!F.options.staticResults)))){H.focus();if(F){G="location_not_found;";if(F.options.minChars>B.length){G+=";not_enough_chars"}F.renderError(JS_location_not_found);F.show()}}else{if(ta.retrieve("typeahead.revised.pypt.mechanics.feature")&&F&&F.results&&F.results.length>0&&F.selectedIndex===-1&&!F.getChosenResult()){G="no_selection";F.renderError(ta.retrieve("ta.pages.home.pypt.msgs.select_one_of_these"),true);F.show();H.focus()}else{J=H.retrieve("redir");if(!J){J=function(){C.submit()}}}}}ta.widgets.calendar.trackCRButtonClick();u(C,G,J);if(I||window.event){new Event(I||window.event).stop()}return false}function y(B){switch(B.id){case"PTPT_ATTRACTION_FORM":return"attr";case"PTPT_DESTINATION_FORM":return"dest";case"PTPT_HAC_FORM":return"hotel";case"PTPT_RESTAURANT_FORM":return"eat";case"PTPT_VRAC_FORM":return"vr";case"HOTEL_LANDER_HAC_FORM":return"hotel_lander";default:return undefined}}function u(C,I,G){var E=r(C);var D=E&&E.retrieve("typeahead");if(D){var F=y(C);I=I||"";var H=D&&E.value.trim().length>0&&E.value!==E.defaultValue;if(!ta.retrieve("typeahead.revised.pypt.mechanics.feature")){if(H){if(D.options.minChars>E.value.length){I="not_enough_chars;"+I}else{if(D.selectedIndex<0){I="no_selection;"+I}}}else{I="blank;"+I}}else{if(H&&ta.retrieve("typeahead_pypt_allow_too_few_chars_search_feature")&&D.options.minChars>E.value.length){I="low_chars_search;"+I}}var B=j();i("find",F,"","PTPT",0,0,"",D.options.startTime,G,B,I)}else{if(G){G()}}}function j(){var B=ta.retrieve("ta.pages.home.find.clicked")?"click":"enter";ta.remove("ta.pages.home.find.clicked");return B}function i(B,F,M,H,L,J,E,C,I,G,K){var D={uiOrigin:"PTPT-"+F,global:true,type:M,value:E,eventType:B,source:H,startTime:C,action:"RECORD",selDepth:L,totalNum:J,userInteractionType:G,errors:K};new Request({method:"GET",url:"/TypeAheadJson",data:D,onSuccess:I,onFailure:I}).send()}var c={hideCalendar:function(){if(window.calendar&&window.calendar.flyout){window.calendar.flyout.hide(false)}},validateFlights:function(){var E=$("metaFlightFromCode").value;var B=$("metaFlightToCode").value;var D=$("leaveMonth").value;var C=$("retMonth").value;ta.id("metaFlightTo").removeClass("error");ta.id("metaFlightFrom").removeClass("error");ta.id("checkIn").removeClass("error");ta.id("checkOut").removeClass("error");if(B===""||E===""||D===""||C===""){if(B===""){ta.id("metaFlightTo").addClass("error")}if(E===""){ta.id("metaFlightFrom").addClass("error")}if(D===""){ta.id("checkIn").addClass("error")}if(C===""){ta.id("checkOut").addClass("error")}return false}return true},hideMetaCalendar:function(){if(document.getElement(".date_picker_calendar.overlay")){ta.widgets.calendar.closeCalendarWidgets()}},setLastDate:function(C){var B=new Date();ta.util.date.normalize(B);B.setTime(B.getTime()+28512000000);C.lastDate=B},advanceToCalendar:function(){if(ta.id("metaCheckInSpan")){document.getElement("#metaCheckInSpan .focusInput").focus()}},keepParams:function(){if(ta.util.localstorage&&ta.util.localstorage.canUseLocalStore()){var B=ta.id("fadults").value;localStorage.setItem("adultsNumbers",B);localStorage.setItem("seniorsNumbers",0);localStorage.setItem("childrenNumbers",0)}},odPairButton:function(C){if(!C){return}c.keepParams();var J=$("metaFlightFromCode").value;var K=$("metaFlightToCode").value;var B=$("leaveMonth").value;var D=$("leaveDay").value;var L=$("leaveTime").value;var F=$("retMonth").value;var G=$("retDay").value;var M=$("retTime").value;var H=$("fadults").value;var I=$("nonstopOnly").checked?"yes":"no";var E="/CheapFlightsHome?Dest="+K+"&Orig="+J+"&leavemonth="+B+"&leaveday="+D+"&leavetime="+L+"&retmonth="+F+"&retday="+G+"&rettime="+M+"&adults="+H+"&nonstop="+I;C.href=E}};rules["#metaCheckInSpan"]=c.setLastDate;rules["#metaCheckOutSpan"]=c.setLastDate;window.HomeFFM=c;if(!ta.pages){ta.pages={}}if(!ta.pages.home){ta.pages.home={}}ta.pages.home.validate=n;ta.pages.home.createTypeAhead=z;ta.pages.home.trackFeaturedQuote=g;ta.queueForReady(v);return{selectTab:x,trackHeroPhoto:t}})})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"home_member","handlers.js");a(["placement"],function(d){function f(){if(document.getElement("#"+d.id+" > .contents")){c();e()}}function c(){ta.util.element.doIfElementIsVisible(ta.id(d.id),ta.trackEventOnPage,["hp_redesign_member","impression",null,null,true])}function e(){var g=document.getElements("#"+d.id+" a");if(g){g.addEvent("click",function(){b(null)})}}function b(g){ta.trackEventOnPage("hp_redesign_member","click",g,null,false)}ta.queueForReady(f)})})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"home_newsletter_social","handlers.js");a(["placement"],function(b){function c(){ta.util.element.doIfElementIsVisible(ta.id(b.id),ta.trackEventOnPage,[b.name.replace("home_","homepage_redesign_"),"impression",null,null,true])}ta.queueForReady(c)})})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"home_popular_destinations","handlers.js");a(["placement"],function(e){var g,k,h,c;function l(){if(document.getElement("#"+e.id+" > .section")){f();i();g=document.getElement("#"+e.id+" .regionTabs");k=document.getElement("#"+e.id+" .regionContent");if(g){h=g.getChildren("li")}if(k){c=k.getChildren("li")}if(h&&c){h.addEvent("click",function(o){if(o&&o.target){var n=o.target;if(n.tagName!=="LI"){n=n.getParent("li")}if(n&&!n.hasClass("active")){var p=n.getAttribute("data-id");if(p){d(p)}}}})}if(ta.localStorage.enabled){var m=ta.localStorage.get("homePopDestTab");if(m){d(m)}}}}function f(){ta.util.element.doIfElementIsVisible(ta.id(e.id),ta.trackEventOnPage,["hp_redesign_popular_destination","impression",null,null,true])}function i(){var m=document.getElements("#"+e.id+" .regionTabs li");if(m){m.addEvent("click",function(){j("tab")})}b()}function b(n){if(!n){n=document.getElement("#"+e.id+" .regionContent")}if(n){var m=n.getElements(".tiles > li");if(m){m.addEvent("click",function(){j("city")})}}}function j(m){ta.trackEventOnPage("hp_redesign_popular_destination","click",m,null,false)}function d(r){var n=g.getElement("[data-id="+r+"]");var o=k.getElement("li[data-id="+r+"]");if(h&&c&&n){h.removeClass("active");c.removeClass("active");n.addClass("active");if(ta.localStorage.enabled){ta.localStorage.set("homePopDestTab",r)}if(o){o.addClass("active")}else{var p=setTimeout(function(){k.addClass("loading")},1000);e.requestAJAXPlacement(function q(t){clearTimeout(p);var s=ta.id(document.createElement("li"));s.setAttribute("data-id",r);s.addClass("active");s.innerHTML=t;k.removeClass("loading");s.inject(k);c=k.getChildren("li");b(s)},function m(){},{id:r,metaReferer:window.pageServlet,detail:1})}}}ta.queueForReady(l)})})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"home_recently_viewed","handlers.js");a(["placement"],function(d){function f(){if(document.getElement("#"+d.id+" > .contents")){c();e()}}function c(){ta.util.element.doIfElementIsVisible(ta.id(d.id),ta.trackEventOnPage,["hp_redesign_recently_viewed_bottom","impression",null,null,true])}function e(){var g=document.getElements("#"+d.id+" a.more");if(g){g.addEvent("click",function(){b("more")})}var h=document.getElements("#"+d.id+" .tiles.full li a");if(h){h.addEvent("click",function(){b("hotel")})}var i=document.getElements("#"+d.id+" .tiles.half li a");if(i){i.addEvent("click",function(l){var k=l.target&&ta.id(l.target);var j=k.tagName==="LI"?k:k.getParent("li");if(j){b(j.className)}})}}function b(g){ta.trackEventOnPage("hp_redesign_recently_viewed_bottom","click",g,null,false)}ta.queueForReady(f)})})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"home_travelers_choice","handlers.js");a(["placement"],function(d){function f(){if(document.getElement("#"+d.id+" > .section")){c();e()}}function c(){ta.util.element.doIfElementIsVisible(ta.id(d.id),ta.trackEventOnPage,["hp_redesign_TC","impression",null,null,true])}function e(){var g=document.getElements("#"+d.id+" .tiles a");if(g){g.addEvent("click",function(k){var j=k.target&&ta.id(k.target);var h=j.tagName==="A"?j:j.getParent("a");if(h){var i=h.getAttribute("href");if(i){if(i==="/TravelersChoice"){i=i.replace("/","")}else{i=i.replace("/TravelersChoice-","").replace("-cTop-g1","")}b(i)}}})}}function b(g){ta.trackEventOnPage("hp_redesign_TC","click",g,null,false)}ta.queueForReady(f)})})();