/*Copyright (c) 2016 ksoft http://www.dummysoftware.com*/function onInitialize(){var e=document.querySelector("#interval");chrome.tabs.query({active:!0,currentWindow:!0},function(t){var c=t[0],o=getOptions(c);if(null!=o&&e){var r=o.interval,n=document.querySelector("#chkRandom");1==o.isRandom?(r=o.random+"?",n.checked=!0):n.checked=!1,e.value=r,e.select();var i=document.querySelector("#status");1==o.refresh?i.innerHTML="ON":i.innerHTML="OFF",1==o.isDomain&&(document.querySelector("#chkDomain").checked=!0),1==o.isCache&&(document.querySelector("#chkCache").checked=!0),1==o.isTimer&&(document.querySelector("#chkTimer").checked=!0),1==o.isAllTabs&&(document.querySelector("#chkAllTabs").checked=!0);var u=document.querySelector("#lblLastRefresh"),l=document.querySelector("#lblNextRefresh");isRegistered()&&null!=o.lastRefresh?(u.innerHTML=o.lastRefresh,l.innerHTML=o.nextRefresh):(u.innerHTML="n/a",l.innerHTML="n/a"),1==o.isAutoClick&&(document.querySelector("#chkAutoClick").checked=!0,document.querySelector("#autoClickDiv").style.maxHeight="60px",document.querySelector("#autoClickDiv").classList.add("visible")),document.querySelector("#txtAutoClickId").value=o.autoClickId,document.querySelector("#txtAutoClickIdStatus").setAttribute("data-valid",o.autoClickIdValid),1==o.isAutoClickAfterRefresh&&(document.querySelector("#chkClickAfterRefresh").checked=!0),1==o.isNotify&&(document.querySelector("#chkNotify").checked=!0,document.querySelector("#notifyDiv").style.maxHeight="40px",document.querySelector("#notifyDiv").classList.add("visible")),document.querySelector("#txtNotifyText").value=o.notifyText,1==o.isUrlList&&(document.querySelector("#chkUrlList").checked=!0,document.querySelector("#urlListDiv").style.maxHeight="125px",document.querySelector("#urlListDiv").classList.add("visible")),document.querySelector("#txtUrlList").value=o.urlList?o.urlList.join("\n"):"",isRegistered()&&chrome.runtime.onMessage.addListener(function(t,o,r){t.tabId==c.id&&("updateLastRefresh"==t.message?(u.innerHTML=t.lastRefresh,l.innerHTML=t.nextRefresh):"updateRandomInterval"==t.message&&(e.value=t.value+"?"))})}var d=document.querySelector("#lblDomain");d&&(d.innerHTML=getDomain(c.url))}),e&&(e.removeEventListener("keydown",QhBpJ),e.addEventListener("keydown",QhBpJ),eLuhX())}function QhBpJ(e){if(46==e.keyCode||8==e.keyCode||9==e.keyCode||e.keyCode>=35&&e.keyCode<=40);else if(90==e.keyCode&&e.shiftKey){var t="";localStorage.feedbackOptOut2?(t="Feedback opt-in successful.",localStorage.removeItem("feedbackOptOut2")):(t="Feedback opt-out successful.",localStorage.feedbackOptOut2="true"),document.querySelector("#dialog-message-text").innerHTML=t;var c=document.querySelector("#dialog-message");c.removeEventListener("click",onDialogMessageClick),c.addEventListener("click",onDialogMessageClick),fadeIn(c)}else(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}function eLuhX(){document.querySelector("#interval").select();var e=document.querySelector("#imgLock");e.removeEventListener("click",onLockClick),e.addEventListener("click",onLockClick);var t=(dataSync(),document.querySelector("#advancedOptionsDiv"));t.removeEventListener("click",NwQZz),t.addEventListener("click",NwQZz);var c=document.querySelector("#txtCode");c&&(c.removeEventListener("keypress",xJHmW),c.addEventListener("keypress",xJHmW));var o=document.querySelector("#btnStart");o.removeEventListener("click",eSJAI),o.addEventListener("click",eSJAI);var r=document.querySelector("#btnStop");r.removeEventListener("click",GIxjb),r.addEventListener("click",GIxjb);var n=document.querySelector("#chkDomain");n.removeEventListener("click",MgFEF),n.addEventListener("click",MgFEF);var i=document.querySelector("#chkRandom");i.removeEventListener("click",MxxXk),i.addEventListener("click",MxxXk);var u=document.querySelector("#chkCache");u.removeEventListener("click",apcap),u.addEventListener("click",apcap);var l=document.querySelector("#chkTimer");l.removeEventListener("click",apcap),l.addEventListener("click",apcap);var d=document.querySelector("#chkAllTabs");d.removeEventListener("click",apcap),d.addEventListener("click",apcap);var a=document.querySelector("#btnRegister");a&&(a.removeEventListener("click",validateRegistrationCode),a.addEventListener("click",validateRegistrationCode));var s=document.querySelector("#chkAutoClick");s.removeEventListener("click",KUkSQ),s.addEventListener("click",KUkSQ);var k=document.querySelector("#txtAutoClickId");k.removeEventListener("keyup",VXCMA),k.addEventListener("keyup",VXCMA),k.removeEventListener("paste",VXCMA),k.addEventListener("paste",VXCMA);var m=document.querySelector("#chkClickAfterRefresh");m.removeEventListener("click",apcap),m.addEventListener("click",apcap);var y=document.querySelector("#chkNotify");y.removeEventListener("click",ynSDy),y.addEventListener("click",ynSDy);var v=document.querySelector("#txtNotifyText");v.removeEventListener("keyup",apcap),v.addEventListener("keyup",apcap),v.removeEventListener("paste",apcap),v.addEventListener("paste",apcap);var h=document.querySelector("#chkUrlList");h.removeEventListener("click",RLWSB),h.addEventListener("click",RLWSB);var S=document.querySelector("#txtUrlList");S.removeEventListener("keyup",apcap),S.addEventListener("keyup",apcap),S.removeEventListener("paste",apcap),S.addEventListener("paste",apcap)}function NwQZz(){var e=document.querySelector("#advancedOptions"),t=document.querySelector("#imgAdvancedOptions");e.style.maxHeight&&"0px"!=e.style.maxHeight?t.style.backgroundPosition="0px 0px":(t.style.backgroundPosition="-15px 0px",fFMnS()),slide(e,advancedOptionsSlideHeight)}function xJHmW(e){13==e.keyCode&&document.querySelector("#btnRegister").click()}function KUkSQ(){slide(document.querySelector("#autoClickDiv"),"60px"),document.querySelector("#txtAutoClickId").focus(),VXCMA()}function ynSDy(){slide(document.querySelector("#notifyDiv"),"40px"),document.querySelector("#txtNotifyText").focus(),apcap()}function RLWSB(){slide(document.querySelector("#urlListDiv"),"125px"),document.querySelector("#txtUrlList").focus(),apcap()}function eSJAI(){validateForm()&&chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0],c=getOptions(t);c.interval=document.querySelector("#interval").value,c.refresh=!0,c.isRandom=document.querySelector("#chkRandom").checked,c.random=c.interval,c.isDomain=document.querySelector("#chkDomain").checked,c.isCache=document.querySelector("#chkCache").checked,c.isTimer=document.querySelector("#chkTimer").checked,c.isAllTabs=document.querySelector("#chkAllTabs").checked,c.isAutoClick=document.querySelector("#chkAutoClick").checked,c.autoClickId=document.querySelector("#txtAutoClickId").value,c.autoClickIdValid=document.querySelector("#txtAutoClickIdStatus").getAttribute("data-valid"),c.isAutoClickAfterRefresh=document.querySelector("#chkClickAfterRefresh").checked,c.isNotify=document.querySelector("#chkNotify").checked,c.notifyText=document.querySelector("#txtNotifyText").value,c.isUrlList=document.querySelector("#chkUrlList").checked,c.urlList=cleanArray(document.querySelector("#txtUrlList").value.match(/.+/g)),updateOptions(t,c),chrome.extension.sendRequest({tab:t,refresh:c.refresh},function(e){}),window.close()})}function GIxjb(){validateForm()&&chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0],c={};c.interval=document.querySelector("#interval").value,c.refresh=!1,c.isRandom=document.querySelector("#chkRandom").checked,c.random=c.interval,c.isDomain=document.querySelector("#chkDomain").checked,c.isCache=document.querySelector("#chkCache").checked,c.isTimer=document.querySelector("#chkTimer").checked,c.isAllTabs=document.querySelector("#chkAllTabs").checked,c.isAutoClick=document.querySelector("#chkAutoClick").checked,c.autoClickId=document.querySelector("#txtAutoClickId").value,c.autoClickIdValid=document.querySelector("#txtAutoClickIdStatus").getAttribute("data-valid"),c.isAutoClickAfterRefresh=document.querySelector("#chkClickAfterRefresh").checked,c.isNotify=document.querySelector("#chkNotify").checked,c.notifyText=document.querySelector("#txtNotifyText").value,c.isUrlList=document.querySelector("#chkUrlList").checked,c.urlList=cleanArray(document.querySelector("#txtUrlList").value.match(/.+/g)),updateOptions(t,c),chrome.extension.sendRequest({tab:t,refresh:c.refresh},function(e){}),window.close()})}function MxxXk(){validateForm()&&chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0],c=document.querySelector("#interval");0==document.querySelector("#chkRandom").checked?c.value=c.value.replace(/\?/g,""):c.value=c.value+"?";var o=getOptions(t);o.interval=c.value,o.isRandom=document.querySelector("#chkRandom").checked,o.random=o.interval,o.isDomain=document.querySelector("#chkDomain").checked,o.isCache=document.querySelector("#chkCache").checked,o.isTimer=document.querySelector("#chkTimer").checked,o.isAllTabs=document.querySelector("#chkAllTabs").checked,o.isAutoClick=document.querySelector("#chkAutoClick").checked,o.autoClickId=document.querySelector("#txtAutoClickId").value,o.autoClickIdValid=document.querySelector("#txtAutoClickIdStatus").getAttribute("data-valid"),o.isAutoClickAfterRefresh=document.querySelector("#chkClickAfterRefresh").checked,o.isNotify=document.querySelector("#chkNotify").checked,o.notifyText=document.querySelector("#txtNotifyText").value,o.isUrlList=document.querySelector("#chkUrlList").checked,o.urlList=cleanArray(document.querySelector("#txtUrlList").value.match(/.+/g)),updateOptions(t,o)})}function MgFEF(){validateForm()&&chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0];if(document.querySelector("#chkDomain").checked){var c=getOptions(t);c.interval=document.querySelector("#interval").value,c.isRandom=document.querySelector("#chkRandom").checked,c.random=c.interval,c.isDomain=document.querySelector("#chkDomain").checked,c.isCache=document.querySelector("#chkCache").checked,c.isTimer=document.querySelector("#chkTimer").checked,c.isAllTabs=document.querySelector("#chkAllTabs").checked,c.isAutoClick=document.querySelector("#chkAutoClick").checked,c.autoClickId=document.querySelector("#txtAutoClickId").value,c.autoClickIdValid=document.querySelector("#txtAutoClickIdStatus").getAttribute("data-valid"),c.isAutoClickAfterRefresh=document.querySelector("#chkClickAfterRefresh").checked,c.isNotify=document.querySelector("#chkNotify").checked,c.notifyText=document.querySelector("#txtNotifyText").value,c.isUrlList=document.querySelector("#chkUrlList").checked,c.urlList=cleanArray(document.querySelector("#txtUrlList").value.match(/.+/g)),localStorage[getDomain(t.url)]=c,updateOptions(t,c)}else localStorage.removeItem(getDomain(t.url))})}function apcap(){validateForm()&&chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0],c=getOptions(t);c.interval=document.querySelector("#interval").value,c.isRandom=document.querySelector("#chkRandom").checked,c.random=c.interval,c.isDomain=document.querySelector("#chkDomain").checked,c.isCache=document.querySelector("#chkCache").checked,c.isTimer=document.querySelector("#chkTimer").checked,c.isAllTabs=document.querySelector("#chkAllTabs").checked,c.isAutoClick=document.querySelector("#chkAutoClick").checked,c.autoClickId=document.querySelector("#txtAutoClickId").value,c.autoClickIdValid=document.querySelector("#txtAutoClickIdStatus").getAttribute("data-valid"),c.isAutoClickAfterRefresh=document.querySelector("#chkClickAfterRefresh").checked,c.isNotify=document.querySelector("#chkNotify").checked,c.notifyText=document.querySelector("#txtNotifyText").value,c.isUrlList=document.querySelector("#chkUrlList").checked,c.urlList=cleanArray(document.querySelector("#txtUrlList").value.match(/.+/g)),updateOptions(t,c)})}function VXCMA(){fFMnS(function(){apcap()})}function fFMnS(e){var t=document.querySelector("#txtAutoClickIdStatus"),c=document.querySelector("#txtAutoClickId").value;null!=c&&c.length>0?chrome.tabs.query({active:!0,currentWindow:!0},function(o){var r=o[0];chrome.tabs.executeScript(r.id,{file:"scripts/content.js"},function(o){chrome.tabs.sendMessage(r.id,{action:"getAutoClickIdStatus"+c},function(c){"undefined"!=typeof c&&"OK"==c.result?(t.innerHTML="<img src='/images/green-check.png' alt='OK' title='OK'>",t.setAttribute("data-valid","1")):(t.innerHTML="<img src='/images/red-x.png' alt='Invalid selector or control not found in page' title='Control not found in page'>",t.setAttribute("data-valid","0")),e&&e()})})}):(t.innerHTML="",t.setAttribute("data-valid","0"),e&&e())}function updateOptions(e,t){return t.interval=t.interval.replace(/\?/g,""),t.random=t.random.replace(/\?/g,""),saveOptions(e,t),t}